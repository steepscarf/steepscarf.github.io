// Generated by Construct 3, the game and app creator :: https://www.construct.net
/*
 localForage -- Offline Storage, Improved
    Version 1.5.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/
'use strict';var cr=window.cr={};cr.plugins_={};cr.behaviors={};"function"!==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"===typeof"test".__proto__?function(b){return b.__proto__}:function(b){return b.constructor.prototype});
(function(){function b(c,y){this.x=c;this.y=y;cr.seal(this)}function f(c,y,H,O){this.set(c,y,H,O);cr.seal(this)}function k(){this.bly=this.blx=this.bry=this.brx=this.try_=this.trx=this.tly=this.tlx=0;cr.seal(this)}function q(c,y,H,O){c<y?H<O?(x=c<H?c:H,C=y>O?y:O):(x=c<O?c:O,C=y>H?y:H):H<O?(x=y<H?y:H,C=c>O?c:O):(x=y<O?y:O,C=c>H?c:H)}function v(){this.items=this.s=null;this.item_count=0;S&&(this.s=new Set);this.values_cache=[];this.cache_valid=!0;cr.seal(this)}function n(c){L[R++]=c}function e(){this.sum=
this.t=this.y=this.c=0;cr.seal(this)}function a(c,y){c||(c=[0,0,1,0,1,1,0,1]);this.pts_cache=[];this.bboxBottom=this.bboxRight=this.bboxTop=this.bboxLeft=0;this.convexpolys=null;this.enabled="undefined"===typeof y?!0:y;this.set_pts(c);cr.seal(this)}function d(c,y){this.cellwidth=c;this.cellheight=y;this.cells={}}function h(c,y){this.cellwidth=c;this.cellheight=y;this.cells={}}function r(c,y,H){d.prototype.totalCellCount++;if(g.length){var O=g.pop();O.grid=c;O.x=y;O.y=H;return O}return new cr.GridCell(c,
y,H)}function w(c,y,H){this.grid=c;this.x=y;this.y=H;this.objects=new cr.ObjectSet}function E(c,y,H){h.prototype.totalCellCount++;if(l.length){var O=l.pop();O.grid=c;O.x=y;O.y=H;return O}return new cr.RenderCell(c,y,H)}function t(c,y,H){this.grid=c;this.x=y;this.y=H;this.objects=[];this.is_sorted=!0;this.pending_removal=new cr.ObjectSet;this.any_pending_removal=!1}function p(c,y){return c.zindex-y.zindex}cr.logexport=function(c){window.console&&window.console.log&&window.console.log(c)};cr.logerror=
function(c){window.console&&window.console.error&&window.console.error(c)};cr.seal=function(c){return c};cr.freeze=function(c){return c};cr.is_undefined=function(c){return"undefined"===typeof c};cr.is_number=function(c){return"number"===typeof c};cr.is_string=function(c){return"string"===typeof c};cr.isPOT=function(c){return 0<c&&0===(c-1&c)};cr.nextHighestPowerOfTwo=function(c){--c;for(var y=1;32>y;y<<=1)c|=c>>y;return c+1};cr.abs=function(c){return 0>c?-c:c};cr.max=function(c,y){return c>y?c:y};
cr.min=function(c,y){return c<y?c:y};cr.PI=Math.PI;cr.round=function(c){return c+.5|0};cr.floor=function(c){return 0<=c?c|0:(c|0)-1};cr.ceil=function(c){var y=c|0;return y===c?y:y+1};b.prototype.offset=function(c,y){this.x+=c;this.y+=y;return this};b.prototype.mul=function(c,y){this.x*=c;this.y*=y;return this};cr.vector2=b;cr.segments_intersect=function(c,y,H,O,U,Y,aa,ca){if(c<H){var ha=c;var fa=H}else ha=H,fa=c;if(U<aa){var m=U;var A=aa}else m=aa,A=U;if(fa<m||ha>A)return!1;y<O?(ha=y,fa=O):(ha=O,
fa=y);Y<ca?(m=Y,A=ca):(m=ca,A=Y);if(fa<m||ha>A)return!1;fa=U-c+aa-H;ha=Y-y+ca-O;c=H-c;y=O-y;U=aa-U;Y=ca-Y;ca=cr.abs(y*U-Y*c);return cr.abs(U*ha-Y*fa)>ca?!1:cr.abs(c*ha-y*fa)<=ca};f.prototype.set=function(c,y,H,O){this.left=c;this.top=y;this.right=H;this.bottom=O};f.prototype.copy=function(c){this.left=c.left;this.top=c.top;this.right=c.right;this.bottom=c.bottom};f.prototype.width=function(){return this.right-this.left};f.prototype.height=function(){return this.bottom-this.top};f.prototype.offset=
function(c,y){this.left+=c;this.top+=y;this.right+=c;this.bottom+=y;return this};f.prototype.normalize=function(){if(this.left>this.right){var c=this.left;this.left=this.right;this.right=c}this.top>this.bottom&&(c=this.top,this.top=this.bottom,this.bottom=c)};f.prototype.intersects_rect=function(c){return!(c.right<this.left||c.bottom<this.top||c.left>this.right||c.top>this.bottom)};f.prototype.intersects_rect_off=function(c,y,H){return!(c.right+y<this.left||c.bottom+H<this.top||c.left+y>this.right||
c.top+H>this.bottom)};f.prototype.contains_pt=function(c,y){return c>=this.left&&c<=this.right&&y>=this.top&&y<=this.bottom};f.prototype.equals=function(c){return this.left===c.left&&this.top===c.top&&this.right===c.right&&this.bottom===c.bottom};cr.rect=f;k.prototype.set_from_rect=function(c){this.tlx=c.left;this.tly=c.top;this.trx=c.right;this.try_=c.top;this.brx=c.right;this.bry=c.bottom;this.blx=c.left;this.bly=c.bottom};k.prototype.set_from_rotated_rect=function(c,y){if(0===y)this.set_from_rect(c);
else{var H=Math.sin(y),O=Math.cos(y);y=c.left*H;var U=c.top*H,Y=c.right*H;H*=c.bottom;var aa=c.left*O,ca=c.top*O,ha=c.right*O;c=c.bottom*O;this.tlx=aa-U;this.tly=ca+y;this.trx=ha-U;this.try_=ca+Y;this.brx=ha-H;this.bry=c+Y;this.blx=aa-H;this.bly=c+y}};k.prototype.offset=function(c,y){this.tlx+=c;this.tly+=y;this.trx+=c;this.try_+=y;this.brx+=c;this.bry+=y;this.blx+=c;this.bly+=y;return this};var x=0,C=0;k.prototype.bounding_box=function(c){q(this.tlx,this.trx,this.brx,this.blx);c.left=x;c.right=C;
q(this.tly,this.try_,this.bry,this.bly);c.top=x;c.bottom=C};k.prototype.contains_pt=function(c,y){var H=this.tlx,O=this.tly,U=this.trx-H,Y=this.try_-O,aa=this.brx-H,ca=this.bry-O;c-=H;y-=O;var ha=U*U+Y*Y,fa=U*aa+Y*ca;Y=U*c+Y*y;var m=aa*aa+ca*ca,A=aa*c+ca*y,J=1/(ha*m-fa*fa);U=(m*Y-fa*A)*J;ha=(ha*A-fa*Y)*J;if(0<=U&&0<ha&&1>U+ha)return!0;U=this.blx-H;Y=this.bly-O;ha=U*U+Y*Y;fa=U*aa+Y*ca;Y=U*c+Y*y;J=1/(ha*m-fa*fa);U=(m*Y-fa*A)*J;ha=(ha*A-fa*Y)*J;return 0<=U&&0<ha&&1>U+ha};k.prototype.at=function(c,y){if(y)switch(c){case 0:return this.tlx;
case 1:return this.trx;case 2:return this.brx;case 3:return this.blx;case 4:return this.tlx;default:return this.tlx}else switch(c){case 0:return this.tly;case 1:return this.try_;case 2:return this.bry;case 3:return this.bly;case 4:return this.tly;default:return this.tly}};k.prototype.midX=function(){return(this.tlx+this.trx+this.brx+this.blx)/4};k.prototype.midY=function(){return(this.tly+this.try_+this.bry+this.bly)/4};k.prototype.intersects_segment=function(c,y,H,O){if(this.contains_pt(c,y)||this.contains_pt(H,
O))return!0;var U;for(U=0;4>U;U++){var Y=this.at(U,!0);var aa=this.at(U,!1);var ca=this.at(U+1,!0);var ha=this.at(U+1,!1);if(cr.segments_intersect(c,y,H,O,Y,aa,ca,ha))return!0}return!1};k.prototype.intersects_quad=function(c){var y=c.midX(),H=c.midY();if(this.contains_pt(y,H))return!0;y=this.midX();H=this.midY();if(c.contains_pt(y,H))return!0;var O,U;for(O=0;4>O;O++)for(U=0;4>U;U++){y=this.at(O,!0);H=this.at(O,!1);var Y=this.at(O+1,!0);var aa=this.at(O+1,!1);var ca=c.at(U,!0);var ha=c.at(U,!1);var fa=
c.at(U+1,!0);var m=c.at(U+1,!1);if(cr.segments_intersect(y,H,Y,aa,ca,ha,fa,m))return!0}return!1};cr.quad=k;cr.RGB=function(c,y,H){return Math.max(Math.min(c,255),0)|Math.max(Math.min(y,255),0)<<8|Math.max(Math.min(H,255),0)<<16};cr.RGBAEx=function(c,y,H,O){c=cr.clamp(Math.floor(1024*c),-8192,8191);y=cr.clamp(Math.floor(1024*y),-8192,8191);H=cr.clamp(Math.floor(1024*H),-8192,8191);O=cr.clamp(Math.floor(1024*O),0,1024);0>c&&(c+=16384);0>y&&(y+=16384);0>H&&(H+=16384);return-(274877906944*c+16777216*
y+1024*H+O)};cr.RGBEx=function(c,y,H){return cr.RGBAEx(c,y,H,1)};cr.GetRValue=function(c){if(0<=c)return(c&255)/255;c=Math.floor(-c/274877906944);8191<c&&(c-=16384);return c/1024};cr.GetGValue=function(c){if(0<=c)return((c&65280)>>8)/255;c=Math.floor(-c%274877906944/16777216);8191<c&&(c-=16384);return c/1024};cr.GetBValue=function(c){if(0<=c)return((c&16711680)>>16)/255;c=Math.floor(-c%16777216/1024);8191<c&&(c-=16384);return c/1024};cr.GetAValue=function(c){return 0===c&&0>1/c?0:0<=c?1:Math.floor(-c%
1024)/1024};cr.shallowCopy=function(c,y,H){for(var O in y)y.hasOwnProperty(O)&&(c[O]=y[O]);return c};cr.arrayRemove=function(c,y){var H;y=cr.floor(y);if(!(0>y||y>=c.length)){for(H=c.length-1;y<H;y++)c[y]=c[y+1];cr.truncateArray(c,H)}};cr.truncateArray=function(c,y){c.length=y};cr.clearArray=function(c){cr.truncateArray(c,0)};cr.shallowAssignArray=function(c,y){cr.clearArray(c);var H;var O=0;for(H=y.length;O<H;++O)c[O]=y[O]};cr.appendArray=function(c,y){c.push.apply(c,y)};cr.fastIndexOf=function(c,
y){var H;var O=0;for(H=c.length;O<H;++O)if(c[O]===y)return O;return-1};cr.arrayFindRemove=function(c,y){y=cr.fastIndexOf(c,y);-1!==y&&cr.arrayRemove(c,y)};cr.clamp=function(c,y,H){return c<y?y:c>H?H:c};cr.to_radians=function(c){return c/(180/cr.PI)};cr.to_degrees=function(c){return 180/cr.PI*c};cr.clamp_angle_degrees=function(c){c%=360;0>c&&(c+=360);return c};cr.clamp_angle=function(c){c%=2*cr.PI;0>c&&(c+=2*cr.PI);return c};cr.to_clamped_degrees=function(c){return cr.clamp_angle_degrees(cr.to_degrees(c))};
cr.to_clamped_radians=function(c){return cr.clamp_angle(cr.to_radians(c))};cr.angleTo=function(c,y,H,O){return Math.atan2(O-y,H-c)};cr.angleDiff=function(c,y){if(c===y)return 0;c=Math.sin(c)*Math.sin(y)+Math.cos(c)*Math.cos(y);return 1<=c?0:-1>=c?cr.PI:Math.acos(c)};cr.angleRotate=function(c,y,H){var O=Math.sin(c),U=Math.cos(c),Y=Math.sin(y),aa=Math.cos(y);return Math.acos(O*Y+U*aa)>H?0<U*Y-O*aa?cr.clamp_angle(c+H):cr.clamp_angle(c-H):cr.clamp_angle(y)};cr.angleClockwise=function(c,y){return 0>=Math.cos(c)*
Math.sin(y)-Math.sin(c)*Math.cos(y)};cr.rotatePtAround=function(c,y,H,O,U,Y){if(0===H)return Y?c:y;var aa=Math.sin(H);H=Math.cos(H);c-=O;y-=U;var ca=c*aa;c=c*H-y*aa;return Y?c+O:y*H+ca+U};cr.distanceTo=function(c,y,H,O){c=H-c;y=O-y;return Math.sqrt(c*c+y*y)};cr.xor=function(c,y){return!c!==!y};cr.lerp=function(c,y,H){return c+(y-c)*H};cr.unlerp=function(c,y,H){return c===y?0:(H-c)/(y-c)};cr.anglelerp=function(c,y,H){var O=cr.angleDiff(c,y);return cr.angleClockwise(y,c)?c+O*H:c-O*H};cr.qarp=function(c,
y,H,O){return cr.lerp(cr.lerp(c,y,O),cr.lerp(y,H,O),O)};cr.cubic=function(c,y,H,O,U){return cr.lerp(cr.qarp(c,y,H,U),cr.qarp(y,H,O,U),U)};cr.cosp=function(c,y,H){return(c+y+(c-y)*Math.cos(H*Math.PI))/2};cr.hasAnyOwnProperty=function(c){for(var y in c)if(c.hasOwnProperty(y))return!0;return!1};cr.wipe=function(c){for(var y in c)c.hasOwnProperty(y)&&delete c[y]};var z=+new Date;cr.performance_now=function(){if("undefined"!==typeof window.performance){var c=window.performance;if("undefined"!==typeof c.now)return c.now();
if("undefined"!==typeof c.webkitNow)return c.webkitNow();if("undefined"!==typeof c.mozNow)return c.mozNow();if("undefined"!==typeof c.msNow)return c.msNow()}return Date.now()-z};var K=!1;"undefined"!==typeof window&&(K=/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent),!K&&/safari/i.test(navigator.userAgent),/(iphone|ipod|ipad)/i.test(navigator.userAgent));var S="undefined"!==typeof Set&&"undefined"!==typeof Set.prototype.forEach;v.prototype.contains=function(c){return this.isEmpty()?
!1:S?this.s.has(c):this.items&&this.items.hasOwnProperty(c)};v.prototype.add=function(c){if(S)this.s.has(c)||(this.s.add(c),this.cache_valid=!1);else{var y=c.toString(),H=this.items;H?H.hasOwnProperty(y)||(H[y]=c,this.item_count++,this.cache_valid=!1):(this.items={},this.items[y]=c,this.item_count=1,this.cache_valid=!1)}};v.prototype.remove=function(c){if(!this.isEmpty())if(S)this.s.has(c)&&(this.s["delete"](c),this.cache_valid=!1);else if(this.items){c=c.toString();var y=this.items;y.hasOwnProperty(c)&&
(delete y[c],this.item_count--,this.cache_valid=!1)}};v.prototype.clear=function(){this.isEmpty()||(S?this.s.clear():(this.items=null,this.item_count=0),cr.clearArray(this.values_cache),this.cache_valid=!0)};v.prototype.isEmpty=function(){return 0===this.count()};v.prototype.count=function(){return S?this.s.size:this.item_count};var L=null,R=0;v.prototype.update_cache=function(){if(!this.cache_valid){if(S)cr.clearArray(this.values_cache),L=this.values_cache,R=0,this.s.forEach(n),L=null,R=0;else{var c=
this.values_cache;cr.clearArray(c);var y,H=0,O=this.items;if(O)for(y in O)O.hasOwnProperty(y)&&(c[H++]=O[y])}this.cache_valid=!0}};v.prototype.valuesRef=function(){this.update_cache();return this.values_cache};cr.ObjectSet=v;var F=new cr.ObjectSet;cr.removeArrayDuplicates=function(c){var y;var H=0;for(y=c.length;H<y;++H)F.add(c[H]);cr.shallowAssignArray(c,F.valuesRef());F.clear()};cr.arrayRemoveAllFromObjectSet=function(c,y){S?cr.arrayRemoveAll_set(c,y.s):cr.arrayRemoveAll_arr(c,y.valuesRef())};cr.arrayRemoveAll_set=
function(c,y){var H,O;var U=H=0;for(O=c.length;H<O;++H){var Y=c[H];y.has(Y)||(c[U++]=Y)}cr.truncateArray(c,U)};cr.arrayRemoveAll_arr=function(c,y){var H,O;var U=H=0;for(O=c.length;H<O;++H){var Y=c[H];-1===cr.fastIndexOf(y,Y)&&(c[U++]=Y)}cr.truncateArray(c,U)};e.prototype.add=function(c){this.y=c-this.c;this.t=this.sum+this.y;this.c=this.t-this.sum-this.y;this.sum=this.t};e.prototype.reset=function(){this.sum=this.t=this.y=this.c=0};cr.KahanAdder=e;cr.regexp_escape=function(c){return c.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,
"\\$&")};a.prototype.set_pts=function(c){this.pts_array=c;this.pts_count=c.length/2;this.pts_cache.length=c.length;this.cache_height=this.cache_width=-1;this.cache_angle=0};a.prototype.is_empty=function(){return!this.pts_array.length};a.prototype.update_bbox=function(){for(var c=this.pts_cache,y=c[0],H=y,O=c[1],U=O,Y,aa,ca=1,ha=this.pts_count;ca<ha;++ca)aa=2*ca,Y=c[aa],aa=c[aa+1],Y<y&&(y=Y),Y>H&&(H=Y),aa<O&&(O=aa),aa>U&&(U=aa);this.bboxLeft=y;this.bboxRight=H;this.bboxTop=O;this.bboxBottom=U};a.prototype.set_from_rect=
function(c,y,H){this.pts_cache.length=8;this.pts_count=4;var O=this.pts_cache;O[0]=c.left-y;O[1]=c.top-H;O[2]=c.right-y;O[3]=c.top-H;O[4]=c.right-y;O[5]=c.bottom-H;O[6]=c.left-y;O[7]=c.bottom-H;this.cache_width=c.right-c.left;this.cache_height=c.bottom-c.top;this.update_bbox()};a.prototype.set_from_quad=function(c,y,H,O,U){this.pts_cache.length=8;this.pts_count=4;var Y=this.pts_cache;Y[0]=c.tlx-y;Y[1]=c.tly-H;Y[2]=c.trx-y;Y[3]=c.try_-H;Y[4]=c.brx-y;Y[5]=c.bry-H;Y[6]=c.blx-y;Y[7]=c.bly-H;this.cache_width=
O;this.cache_height=U;this.update_bbox()};a.prototype.set_from_poly=function(c){this.pts_count=c.pts_count;cr.shallowAssignArray(this.pts_cache,c.pts_cache);this.bboxLeft=c.bboxLeft;this.bboxTop-c.bboxTop;this.bboxRight=c.bboxRight;this.bboxBottom=c.bboxBottom};a.prototype.cache_poly=function(c,y,H){if(this.cache_width!==c||this.cache_height!==y||this.cache_angle!==H){this.cache_width=c;this.cache_height=y;this.cache_angle=H;var O,U=0,Y=1,aa=this.pts_array,ca=this.pts_cache;0!==H&&(U=Math.sin(H),
Y=Math.cos(H));H=0;for(O=this.pts_count;H<O;H++){var ha=2*H;var fa=ha+1;var m=aa[ha]*c;var A=aa[fa]*y;ca[ha]=m*Y-A*U;ca[fa]=A*Y+m*U}this.update_bbox()}};a.prototype.contains_pt=function(c,y){var H=this.pts_cache;if(c===H[0]&&y===H[1])return!0;var O,U=this.pts_count,Y=this.bboxLeft-110,aa=this.bboxTop-101,ca=this.bboxRight+131,ha=this.bboxBottom+120,fa=0,m=0;for(O=0;O<U;O++){var A=2*O;var J=(O+1)%U*2;var N=H[A];A=H[A+1];var G=H[J];J=H[J+1];cr.segments_intersect(Y,aa,c,y,N,A,G,J)&&fa++;cr.segments_intersect(ca,
ha,c,y,N,A,G,J)&&m++}return 1===fa%2||1===m%2};a.prototype.intersects_poly=function(c,y,H){var O=c.pts_cache,U=this.pts_cache;if(this.contains_pt(O[0]+y,O[1]+H)||c.contains_pt(U[0]-y,U[1]-H))return!0;var Y,aa;var ca=0;for(Y=this.pts_count;ca<Y;ca++){var ha=2*ca;var fa=(ca+1)%Y*2;var m=U[ha];ha=U[ha+1];var A=U[fa];var J=U[fa+1];fa=0;for(aa=c.pts_count;fa<aa;fa++){var N=2*fa;var G=(fa+1)%aa*2;var B=O[N]+y;N=O[N+1]+H;var I=O[G]+y;G=O[G+1]+H;if(cr.segments_intersect(m,ha,A,J,B,N,I,G))return!0}}return!1};
a.prototype.intersects_segment=function(c,y,H,O,U,Y){var aa=this.pts_cache;if(this.contains_pt(H-c,O-y))return!0;var ca;var ha=0;for(ca=this.pts_count;ha<ca;ha++){var fa=2*ha;var m=(ha+1)%ca*2;var A=aa[fa]+c;fa=aa[fa+1]+y;var J=aa[m]+c;m=aa[m+1]+y;if(cr.segments_intersect(H,O,U,Y,A,fa,J,m))return!0}return!1};a.prototype.mirror=function(c){var y;var H=0;for(y=this.pts_count;H<y;++H){var O=2*H;this.pts_cache[O]=2*c-this.pts_cache[O]}};a.prototype.flip=function(c){var y;var H=0;for(y=this.pts_count;H<
y;++H){var O=2*H+1;this.pts_cache[O]=2*c-this.pts_cache[O]}};a.prototype.diag=function(){var c;var y=0;for(c=this.pts_count;y<c;++y){var H=2*y;var O=H+1;var U=this.pts_cache[H];this.pts_cache[H]=this.pts_cache[O];this.pts_cache[O]=U}};a.prototype.is_enabled=function(){return this.enabled};cr.CollisionPoly=a;d.prototype.totalCellCount=0;d.prototype.getCell=function(c,y,H){var O=this.cells[c];return O?(O=O[y])?O:H?(O=r(this,c,y),this.cells[c][y]=O):null:H?(O=r(this,c,y),this.cells[c]={},this.cells[c][y]=
O):null};d.prototype.XToCell=function(c){return cr.floor(c/this.cellwidth)};d.prototype.YToCell=function(c){return cr.floor(c/this.cellheight)};d.prototype.update=function(c,y,H){var O,U,Y;if(y){var aa=y.left;for(O=y.right;aa<=O;++aa){var ca=y.top;for(U=y.bottom;ca<=U;++ca)if(!H||!H.contains_pt(aa,ca))if(Y=this.getCell(aa,ca,!1))Y.remove(c),Y.isEmpty()&&(d.prototype.totalCellCount--,Y.objects.clear(),1E3>g.length&&g.push(Y),this.cells[aa][ca]=null)}}if(H)for(aa=H.left,O=H.right;aa<=O;++aa)for(ca=
H.top,U=H.bottom;ca<=U;++ca)y&&y.contains_pt(aa,ca)||this.getCell(aa,ca,!0).insert(c)};d.prototype.queryRange=function(c,y){var H,O;var U=this.XToCell(c.left);var Y=this.YToCell(c.top);var aa=this.XToCell(c.right);for(H=this.YToCell(c.bottom);U<=aa;++U)for(c=Y;c<=H;++c)(O=this.getCell(U,c,!1))&&O.dump(y)};cr.SparseGrid=d;h.prototype.totalCellCount=0;h.prototype.getCell=function(c,y,H){var O=this.cells[c];return O?(O=O[y])?O:H?(O=E(this,c,y),this.cells[c][y]=O):null:H?(O=E(this,c,y),this.cells[c]=
{},this.cells[c][y]=O):null};h.prototype.XToCell=function(c){return cr.floor(c/this.cellwidth)};h.prototype.YToCell=function(c){return cr.floor(c/this.cellheight)};h.prototype.update=function(c,y,H){var O,U,Y;if(y){var aa=y.left;for(O=y.right;aa<=O;++aa){var ca=y.top;for(U=y.bottom;ca<=U;++ca)if(!H||!H.contains_pt(aa,ca))if(Y=this.getCell(aa,ca,!1))Y.remove(c),Y.isEmpty()&&(h.prototype.totalCellCount--,Y.reset(),1E3>l.length&&l.push(Y),this.cells[aa][ca]=null)}}if(H)for(aa=H.left,O=H.right;aa<=O;++aa)for(ca=
H.top,U=H.bottom;ca<=U;++ca)y&&y.contains_pt(aa,ca)||this.getCell(aa,ca,!0).insert(c)};h.prototype.queryRange=function(c,y,H,O,U){var Y,aa;c=this.XToCell(c);y=this.YToCell(y);H=this.XToCell(H);for(Y=this.YToCell(O);c<=H;++c)for(O=y;O<=Y;++O)(aa=this.getCell(c,O,!1))&&aa.dump(U)};h.prototype.markRangeChanged=function(c){var y,H;var O=c.left;var U=c.top;var Y=c.right;for(y=c.bottom;O<=Y;++O)for(c=U;c<=y;++c)if(H=this.getCell(O,c,!1))H.is_sorted=!1};cr.RenderGrid=h;var g=[];w.prototype.isEmpty=function(){return this.objects.isEmpty()};
w.prototype.insert=function(c){this.objects.add(c)};w.prototype.remove=function(c){this.objects.remove(c)};w.prototype.dump=function(c){cr.appendArray(c,this.objects.valuesRef())};cr.GridCell=w;var l=[];t.prototype.isEmpty=function(){if(!this.objects.length)return!0;if(this.objects.length>this.pending_removal.count())return!1;this.flush_pending();return!0};t.prototype.insert=function(c){this.pending_removal.contains(c)?(this.pending_removal.remove(c),this.pending_removal.isEmpty()&&(this.any_pending_removal=
!1)):this.objects.length?(this.objects[this.objects.length-1].get_zindex()>c.get_zindex()&&(this.is_sorted=!1),this.objects.push(c)):(this.objects.push(c),this.is_sorted=!0)};t.prototype.remove=function(c){this.pending_removal.add(c);this.any_pending_removal=!0;30<=this.pending_removal.count()&&this.flush_pending()};t.prototype.flush_pending=function(){this.any_pending_removal&&(this.pending_removal.count()===this.objects.length?this.reset():(cr.arrayRemoveAllFromObjectSet(this.objects,this.pending_removal),
this.pending_removal.clear(),this.any_pending_removal=!1))};t.prototype.ensure_sorted=function(){this.is_sorted||(this.objects.sort(p),this.is_sorted=!0)};t.prototype.reset=function(){cr.clearArray(this.objects);this.is_sorted=!0;this.pending_removal.clear();this.any_pending_removal=!1};t.prototype.dump=function(c){this.flush_pending();this.ensure_sorted();this.objects.length&&c.push(this.objects)};cr.RenderCell=t;var u="lighter xor copy destination-over source-in destination-in source-out destination-out source-atop destination-atop".split(" ");
cr.effectToCompositeOp=function(c){return 0>=c||11<=c?"source-over":u[c-1]};cr.setGLBlend=function(c,y,H){if(H)switch(c.srcBlend=H.ONE,c.destBlend=H.ONE_MINUS_SRC_ALPHA,y){case 1:c.srcBlend=H.ONE;c.destBlend=H.ONE;break;case 3:c.srcBlend=H.ONE;c.destBlend=H.ZERO;break;case 4:c.srcBlend=H.ONE_MINUS_DST_ALPHA;c.destBlend=H.ONE;break;case 5:c.srcBlend=H.DST_ALPHA;c.destBlend=H.ZERO;break;case 6:c.srcBlend=H.ZERO;c.destBlend=H.SRC_ALPHA;break;case 7:c.srcBlend=H.ONE_MINUS_DST_ALPHA;c.destBlend=H.ZERO;
break;case 8:c.srcBlend=H.ZERO;c.destBlend=H.ONE_MINUS_SRC_ALPHA;break;case 9:c.srcBlend=H.DST_ALPHA;c.destBlend=H.ONE_MINUS_SRC_ALPHA;break;case 10:c.srcBlend=H.ONE_MINUS_DST_ALPHA,c.destBlend=H.SRC_ALPHA}};cr.round6dp=function(c){return Math.round(1E6*c)/1E6};cr.equals_nocase=function(c,y){return"string"!==typeof c||"string"!==typeof y||c.length!==y.length?!1:c===y?!0:c.toLowerCase()===y.toLowerCase()};cr.cssToCamelCase=function(c){var y="",H,O=!1;var U=0;for(H=c.length;U<H;++U){var Y=c.charAt(U);
"-"===Y?O=!0:O?(y+=Y.toUpperCase(),O=!1):y+=Y}return y};cr.isCanvasInputEvent=function(c){c=c.target;return!c||c===document||c===window||document&&document.body&&c===document.body||cr.equals_nocase(c.tagName,"canvas")?!0:!1}})();var MatrixArray="undefined"!==typeof Float32Array?Float32Array:Array,glMatrixArrayType=MatrixArray,vec3={},mat3={},mat4={},quat4={};vec3.create=function(b){var f=new MatrixArray(3);b&&(f[0]=b[0],f[1]=b[1],f[2]=b[2]);return f};
vec3.set=function(b,f){f[0]=b[0];f[1]=b[1];f[2]=b[2];return f};vec3.add=function(b,f,k){if(!k||b===k)return b[0]+=f[0],b[1]+=f[1],b[2]+=f[2],b;k[0]=b[0]+f[0];k[1]=b[1]+f[1];k[2]=b[2]+f[2];return k};vec3.subtract=function(b,f,k){if(!k||b===k)return b[0]-=f[0],b[1]-=f[1],b[2]-=f[2],b;k[0]=b[0]-f[0];k[1]=b[1]-f[1];k[2]=b[2]-f[2];return k};vec3.negate=function(b,f){f||(f=b);f[0]=-b[0];f[1]=-b[1];f[2]=-b[2];return f};
vec3.scale=function(b,f,k){if(!k||b===k)return b[0]*=f,b[1]*=f,b[2]*=f,b;k[0]=b[0]*f;k[1]=b[1]*f;k[2]=b[2]*f;return k};vec3.normalize=function(b,f){f||(f=b);var k=b[0],q=b[1];b=b[2];var v=Math.sqrt(k*k+q*q+b*b);if(v){if(1===v)return f[0]=k,f[1]=q,f[2]=b,f}else return f[0]=0,f[1]=0,f[2]=0,f;v=1/v;f[0]=k*v;f[1]=q*v;f[2]=b*v;return f};vec3.cross=function(b,f,k){k||(k=b);var q=b[0],v=b[1];b=b[2];var n=f[0],e=f[1];f=f[2];k[0]=v*f-b*e;k[1]=b*n-q*f;k[2]=q*e-v*n;return k};
vec3.length=function(b){var f=b[0],k=b[1];b=b[2];return Math.sqrt(f*f+k*k+b*b)};vec3.dot=function(b,f){return b[0]*f[0]+b[1]*f[1]+b[2]*f[2]};vec3.direction=function(b,f,k){k||(k=b);var q=b[0]-f[0],v=b[1]-f[1];b=b[2]-f[2];f=Math.sqrt(q*q+v*v+b*b);if(!f)return k[0]=0,k[1]=0,k[2]=0,k;f=1/f;k[0]=q*f;k[1]=v*f;k[2]=b*f;return k};vec3.lerp=function(b,f,k,q){q||(q=b);q[0]=b[0]+k*(f[0]-b[0]);q[1]=b[1]+k*(f[1]-b[1]);q[2]=b[2]+k*(f[2]-b[2]);return q};vec3.str=function(b){return"["+b[0]+", "+b[1]+", "+b[2]+"]"};
mat3.create=function(b){var f=new MatrixArray(9);b&&(f[0]=b[0],f[1]=b[1],f[2]=b[2],f[3]=b[3],f[4]=b[4],f[5]=b[5],f[6]=b[6],f[7]=b[7],f[8]=b[8]);return f};mat3.set=function(b,f){f[0]=b[0];f[1]=b[1];f[2]=b[2];f[3]=b[3];f[4]=b[4];f[5]=b[5];f[6]=b[6];f[7]=b[7];f[8]=b[8];return f};mat3.identity=function(b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};
mat3.transpose=function(b,f){if(!f||b===f){f=b[1];var k=b[2],q=b[5];b[1]=b[3];b[2]=b[6];b[3]=f;b[5]=b[7];b[6]=k;b[7]=q;return b}f[0]=b[0];f[1]=b[3];f[2]=b[6];f[3]=b[1];f[4]=b[4];f[5]=b[7];f[6]=b[2];f[7]=b[5];f[8]=b[8];return f};mat3.toMat4=function(b,f){f||(f=mat4.create());f[15]=1;f[14]=0;f[13]=0;f[12]=0;f[11]=0;f[10]=b[8];f[9]=b[7];f[8]=b[6];f[7]=0;f[6]=b[5];f[5]=b[4];f[4]=b[3];f[3]=0;f[2]=b[2];f[1]=b[1];f[0]=b[0];return f};
mat3.str=function(b){return"["+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+", "+b[6]+", "+b[7]+", "+b[8]+"]"};mat4.create=function(b){var f=new MatrixArray(16);b&&(f[0]=b[0],f[1]=b[1],f[2]=b[2],f[3]=b[3],f[4]=b[4],f[5]=b[5],f[6]=b[6],f[7]=b[7],f[8]=b[8],f[9]=b[9],f[10]=b[10],f[11]=b[11],f[12]=b[12],f[13]=b[13],f[14]=b[14],f[15]=b[15]);return f};
mat4.set=function(b,f){f[0]=b[0];f[1]=b[1];f[2]=b[2];f[3]=b[3];f[4]=b[4];f[5]=b[5];f[6]=b[6];f[7]=b[7];f[8]=b[8];f[9]=b[9];f[10]=b[10];f[11]=b[11];f[12]=b[12];f[13]=b[13];f[14]=b[14];f[15]=b[15];return f};mat4.identity=function(b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};
mat4.transpose=function(b,f){if(!f||b===f){f=b[1];var k=b[2],q=b[3],v=b[6],n=b[7],e=b[11];b[1]=b[4];b[2]=b[8];b[3]=b[12];b[4]=f;b[6]=b[9];b[7]=b[13];b[8]=k;b[9]=v;b[11]=b[14];b[12]=q;b[13]=n;b[14]=e;return b}f[0]=b[0];f[1]=b[4];f[2]=b[8];f[3]=b[12];f[4]=b[1];f[5]=b[5];f[6]=b[9];f[7]=b[13];f[8]=b[2];f[9]=b[6];f[10]=b[10];f[11]=b[14];f[12]=b[3];f[13]=b[7];f[14]=b[11];f[15]=b[15];return f};
mat4.determinant=function(b){var f=b[0],k=b[1],q=b[2],v=b[3],n=b[4],e=b[5],a=b[6],d=b[7],h=b[8],r=b[9],w=b[10],E=b[11],t=b[12],p=b[13],x=b[14];b=b[15];return t*r*a*v-h*p*a*v-t*e*w*v+n*p*w*v+h*e*x*v-n*r*x*v-t*r*q*d+h*p*q*d+t*k*w*d-f*p*w*d-h*k*x*d+f*r*x*d+t*e*q*E-n*p*q*E-t*k*a*E+f*p*a*E+n*k*x*E-f*e*x*E-h*e*q*b+n*r*q*b+h*k*a*b-f*r*a*b-n*k*w*b+f*e*w*b};
mat4.inverse=function(b,f){f||(f=b);var k=b[0],q=b[1],v=b[2],n=b[3],e=b[4],a=b[5],d=b[6],h=b[7],r=b[8],w=b[9],E=b[10],t=b[11],p=b[12],x=b[13],C=b[14];b=b[15];var z=k*a-q*e,K=k*d-v*e,S=k*h-n*e,L=q*d-v*a,R=q*h-n*a,F=v*h-n*d,g=r*x-w*p,l=r*C-E*p,u=r*b-t*p,c=w*C-E*x,y=w*b-t*x,H=E*b-t*C,O=1/(z*H-K*y+S*c+L*u-R*l+F*g);f[0]=(a*H-d*y+h*c)*O;f[1]=(-q*H+v*y-n*c)*O;f[2]=(x*F-C*R+b*L)*O;f[3]=(-w*F+E*R-t*L)*O;f[4]=(-e*H+d*u-h*l)*O;f[5]=(k*H-v*u+n*l)*O;f[6]=(-p*F+C*S-b*K)*O;f[7]=(r*F-E*S+t*K)*O;f[8]=(e*y-a*u+h*g)*
O;f[9]=(-k*y+q*u-n*g)*O;f[10]=(p*R-x*S+b*z)*O;f[11]=(-r*R+w*S-t*z)*O;f[12]=(-e*c+a*l-d*g)*O;f[13]=(k*c-q*l+v*g)*O;f[14]=(-p*L+x*K-C*z)*O;f[15]=(r*L-w*K+E*z)*O;return f};mat4.toRotationMat=function(b,f){f||(f=mat4.create());f[0]=b[0];f[1]=b[1];f[2]=b[2];f[3]=b[3];f[4]=b[4];f[5]=b[5];f[6]=b[6];f[7]=b[7];f[8]=b[8];f[9]=b[9];f[10]=b[10];f[11]=b[11];f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};
mat4.toMat3=function(b,f){f||(f=mat3.create());f[0]=b[0];f[1]=b[1];f[2]=b[2];f[3]=b[4];f[4]=b[5];f[5]=b[6];f[6]=b[8];f[7]=b[9];f[8]=b[10];return f};mat4.toInverseMat3=function(b,f){var k=b[0],q=b[1],v=b[2],n=b[4],e=b[5],a=b[6],d=b[8],h=b[9];b=b[10];var r=b*e-a*h,w=-b*n+a*d,E=h*n-e*d,t=k*r+q*w+v*E;if(!t)return null;t=1/t;f||(f=mat3.create());f[0]=r*t;f[1]=(-b*q+v*h)*t;f[2]=(a*q-v*e)*t;f[3]=w*t;f[4]=(b*k-v*d)*t;f[5]=(-a*k+v*n)*t;f[6]=E*t;f[7]=(-h*k+q*d)*t;f[8]=(e*k-q*n)*t;return f};
mat4.multiply=function(b,f,k){k||(k=b);var q=b[0],v=b[1],n=b[2],e=b[3],a=b[4],d=b[5],h=b[6],r=b[7],w=b[8],E=b[9],t=b[10],p=b[11],x=b[12],C=b[13],z=b[14];b=b[15];var K=f[0],S=f[1],L=f[2],R=f[3],F=f[4],g=f[5],l=f[6],u=f[7],c=f[8],y=f[9],H=f[10],O=f[11],U=f[12],Y=f[13],aa=f[14];f=f[15];k[0]=K*q+S*a+L*w+R*x;k[1]=K*v+S*d+L*E+R*C;k[2]=K*n+S*h+L*t+R*z;k[3]=K*e+S*r+L*p+R*b;k[4]=F*q+g*a+l*w+u*x;k[5]=F*v+g*d+l*E+u*C;k[6]=F*n+g*h+l*t+u*z;k[7]=F*e+g*r+l*p+u*b;k[8]=c*q+y*a+H*w+O*x;k[9]=c*v+y*d+H*E+O*C;k[10]=c*
n+y*h+H*t+O*z;k[11]=c*e+y*r+H*p+O*b;k[12]=U*q+Y*a+aa*w+f*x;k[13]=U*v+Y*d+aa*E+f*C;k[14]=U*n+Y*h+aa*t+f*z;k[15]=U*e+Y*r+aa*p+f*b;return k};mat4.multiplyVec3=function(b,f,k){k||(k=f);var q=f[0],v=f[1];f=f[2];k[0]=b[0]*q+b[4]*v+b[8]*f+b[12];k[1]=b[1]*q+b[5]*v+b[9]*f+b[13];k[2]=b[2]*q+b[6]*v+b[10]*f+b[14];return k};
mat4.multiplyVec4=function(b,f,k){k||(k=f);var q=f[0],v=f[1],n=f[2];f=f[3];k[0]=b[0]*q+b[4]*v+b[8]*n+b[12]*f;k[1]=b[1]*q+b[5]*v+b[9]*n+b[13]*f;k[2]=b[2]*q+b[6]*v+b[10]*n+b[14]*f;k[3]=b[3]*q+b[7]*v+b[11]*n+b[15]*f;return k};
mat4.translate=function(b,f,k){var q=f[0],v=f[1];f=f[2];if(!k||b===k)return b[12]=b[0]*q+b[4]*v+b[8]*f+b[12],b[13]=b[1]*q+b[5]*v+b[9]*f+b[13],b[14]=b[2]*q+b[6]*v+b[10]*f+b[14],b[15]=b[3]*q+b[7]*v+b[11]*f+b[15],b;var n=b[0];var e=b[1];var a=b[2];var d=b[3];var h=b[4];var r=b[5];var w=b[6];var E=b[7];var t=b[8];var p=b[9];var x=b[10];var C=b[11];k[0]=n;k[1]=e;k[2]=a;k[3]=d;k[4]=h;k[5]=r;k[6]=w;k[7]=E;k[8]=t;k[9]=p;k[10]=x;k[11]=C;k[12]=n*q+h*v+t*f+b[12];k[13]=e*q+r*v+p*f+b[13];k[14]=a*q+w*v+x*f+b[14];
k[15]=d*q+E*v+C*f+b[15];return k};mat4.scale=function(b,f,k){var q=f[0],v=f[1];f=f[2];if(!k||b===k)return b[0]*=q,b[1]*=q,b[2]*=q,b[3]*=q,b[4]*=v,b[5]*=v,b[6]*=v,b[7]*=v,b[8]*=f,b[9]*=f,b[10]*=f,b[11]*=f,b;k[0]=b[0]*q;k[1]=b[1]*q;k[2]=b[2]*q;k[3]=b[3]*q;k[4]=b[4]*v;k[5]=b[5]*v;k[6]=b[6]*v;k[7]=b[7]*v;k[8]=b[8]*f;k[9]=b[9]*f;k[10]=b[10]*f;k[11]=b[11]*f;k[12]=b[12];k[13]=b[13];k[14]=b[14];k[15]=b[15];return k};
mat4.rotate=function(b,f,k,q){var v=k[0],n=k[1];k=k[2];var e=Math.sqrt(v*v+n*n+k*k);if(!e)return null;1!==e&&(e=1/e,v*=e,n*=e,k*=e);var a=Math.sin(f);var d=Math.cos(f);var h=1-d;f=b[0];e=b[1];var r=b[2];var w=b[3];var E=b[4];var t=b[5];var p=b[6];var x=b[7];var C=b[8];var z=b[9];var K=b[10];var S=b[11];var L=v*v*h+d;var R=n*v*h+k*a;var F=k*v*h-n*a;var g=v*n*h-k*a;var l=n*n*h+d;var u=k*n*h+v*a;var c=v*k*h+n*a;v=n*k*h-v*a;n=k*k*h+d;q?b!==q&&(q[12]=b[12],q[13]=b[13],q[14]=b[14],q[15]=b[15]):q=b;q[0]=
f*L+E*R+C*F;q[1]=e*L+t*R+z*F;q[2]=r*L+p*R+K*F;q[3]=w*L+x*R+S*F;q[4]=f*g+E*l+C*u;q[5]=e*g+t*l+z*u;q[6]=r*g+p*l+K*u;q[7]=w*g+x*l+S*u;q[8]=f*c+E*v+C*n;q[9]=e*c+t*v+z*n;q[10]=r*c+p*v+K*n;q[11]=w*c+x*v+S*n;return q};
mat4.rotateX=function(b,f,k){var q=Math.sin(f);f=Math.cos(f);var v=b[4],n=b[5],e=b[6],a=b[7],d=b[8],h=b[9],r=b[10],w=b[11];k?b!==k&&(k[0]=b[0],k[1]=b[1],k[2]=b[2],k[3]=b[3],k[12]=b[12],k[13]=b[13],k[14]=b[14],k[15]=b[15]):k=b;k[4]=v*f+d*q;k[5]=n*f+h*q;k[6]=e*f+r*q;k[7]=a*f+w*q;k[8]=v*-q+d*f;k[9]=n*-q+h*f;k[10]=e*-q+r*f;k[11]=a*-q+w*f;return k};
mat4.rotateY=function(b,f,k){var q=Math.sin(f);f=Math.cos(f);var v=b[0],n=b[1],e=b[2],a=b[3],d=b[8],h=b[9],r=b[10],w=b[11];k?b!==k&&(k[4]=b[4],k[5]=b[5],k[6]=b[6],k[7]=b[7],k[12]=b[12],k[13]=b[13],k[14]=b[14],k[15]=b[15]):k=b;k[0]=v*f+d*-q;k[1]=n*f+h*-q;k[2]=e*f+r*-q;k[3]=a*f+w*-q;k[8]=v*q+d*f;k[9]=n*q+h*f;k[10]=e*q+r*f;k[11]=a*q+w*f;return k};
mat4.rotateZ=function(b,f,k){var q=Math.sin(f);f=Math.cos(f);var v=b[0],n=b[1],e=b[2],a=b[3],d=b[4],h=b[5],r=b[6],w=b[7];k?b!==k&&(k[8]=b[8],k[9]=b[9],k[10]=b[10],k[11]=b[11],k[12]=b[12],k[13]=b[13],k[14]=b[14],k[15]=b[15]):k=b;k[0]=v*f+d*q;k[1]=n*f+h*q;k[2]=e*f+r*q;k[3]=a*f+w*q;k[4]=v*-q+d*f;k[5]=n*-q+h*f;k[6]=e*-q+r*f;k[7]=a*-q+w*f;return k};
mat4.frustum=function(b,f,k,q,v,n,e){e||(e=mat4.create());var a=f-b,d=q-k,h=n-v;e[0]=2*v/a;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=2*v/d;e[6]=0;e[7]=0;e[8]=(f+b)/a;e[9]=(q+k)/d;e[10]=-(n+v)/h;e[11]=-1;e[12]=0;e[13]=0;e[14]=-(n*v*2)/h;e[15]=0;return e};mat4.perspective=function(b,f,k,q,v){b=k*Math.tan(b*Math.PI/360);f*=b;return mat4.frustum(-f,f,-b,b,k,q,v)};
mat4.ortho=function(b,f,k,q,v,n,e){e||(e=mat4.create());var a=f-b,d=q-k,h=n-v;e[0]=2/a;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=2/d;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=-2/h;e[11]=0;e[12]=-(b+f)/a;e[13]=-(q+k)/d;e[14]=-(n+v)/h;e[15]=1;return e};
mat4.lookAt=function(b,f,k,q){q||(q=mat4.create());var v=b[0],n=b[1];b=b[2];var e=k[0];var a=k[1];var d=k[2];k=f[1];var h=f[2];if(v===f[0]&&n===k&&b===h)return mat4.identity(q);k=v-f[0];h=n-f[1];var r=b-f[2];var w=1/Math.sqrt(k*k+h*h+r*r);k*=w;h*=w;r*=w;f=a*r-d*h;d=d*k-e*r;e=e*h-a*k;(w=Math.sqrt(f*f+d*d+e*e))?(w=1/w,f*=w,d*=w,e*=w):e=d=f=0;a=h*e-r*d;var E=r*f-k*e;var t=k*d-h*f;(w=Math.sqrt(a*a+E*E+t*t))?(w=1/w,a*=w,E*=w,t*=w):t=E=a=0;q[0]=f;q[1]=a;q[2]=k;q[3]=0;q[4]=d;q[5]=E;q[6]=h;q[7]=0;q[8]=e;
q[9]=t;q[10]=r;q[11]=0;q[12]=-(f*v+d*n+e*b);q[13]=-(a*v+E*n+t*b);q[14]=-(k*v+h*n+r*b);q[15]=1;return q};mat4.fromRotationTranslation=function(b,f,k){k||(k=mat4.create());var q=b[0],v=b[1],n=b[2],e=b[3],a=q+q,d=v+v,h=n+n;b=q*a;var r=q*d;q*=h;var w=v*d;v*=h;n*=h;a*=e;d*=e;e*=h;k[0]=1-(w+n);k[1]=r+e;k[2]=q-d;k[3]=0;k[4]=r-e;k[5]=1-(b+n);k[6]=v+a;k[7]=0;k[8]=q+d;k[9]=v-a;k[10]=1-(b+w);k[11]=0;k[12]=f[0];k[13]=f[1];k[14]=f[2];k[15]=1;return k};
mat4.str=function(b){return"["+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+", "+b[6]+", "+b[7]+", "+b[8]+", "+b[9]+", "+b[10]+", "+b[11]+", "+b[12]+", "+b[13]+", "+b[14]+", "+b[15]+"]"};quat4.create=function(b){var f=new MatrixArray(4);b&&(f[0]=b[0],f[1]=b[1],f[2]=b[2],f[3]=b[3]);return f};quat4.set=function(b,f){f[0]=b[0];f[1]=b[1];f[2]=b[2];f[3]=b[3];return f};
quat4.calculateW=function(b,f){var k=b[0],q=b[1],v=b[2];if(!f||b===f)return b[3]=-Math.sqrt(Math.abs(1-k*k-q*q-v*v)),b;f[0]=k;f[1]=q;f[2]=v;f[3]=-Math.sqrt(Math.abs(1-k*k-q*q-v*v));return f};quat4.inverse=function(b,f){if(!f||b===f)return b[0]*=-1,b[1]*=-1,b[2]*=-1,b;f[0]=-b[0];f[1]=-b[1];f[2]=-b[2];f[3]=b[3];return f};quat4.length=function(b){var f=b[0],k=b[1],q=b[2];b=b[3];return Math.sqrt(f*f+k*k+q*q+b*b)};
quat4.normalize=function(b,f){f||(f=b);var k=b[0],q=b[1],v=b[2];b=b[3];var n=Math.sqrt(k*k+q*q+v*v+b*b);if(0===n)return f[0]=0,f[1]=0,f[2]=0,f[3]=0,f;n=1/n;f[0]=k*n;f[1]=q*n;f[2]=v*n;f[3]=b*n;return f};quat4.multiply=function(b,f,k){k||(k=b);var q=b[0],v=b[1],n=b[2];b=b[3];var e=f[0],a=f[1],d=f[2];f=f[3];k[0]=q*f+b*e+v*d-n*a;k[1]=v*f+b*a+n*e-q*d;k[2]=n*f+b*d+q*a-v*e;k[3]=b*f-q*e-v*a-n*d;return k};
quat4.multiplyVec3=function(b,f,k){k||(k=f);var q=f[0],v=f[1],n=f[2];f=b[0];var e=b[1],a=b[2];b=b[3];var d=b*q+e*n-a*v,h=b*v+a*q-f*n,r=b*n+f*v-e*q;q=-f*q-e*v-a*n;k[0]=d*b+q*-f+h*-a-r*-e;k[1]=h*b+q*-e+r*-f-d*-a;k[2]=r*b+q*-a+d*-e-h*-f;return k};quat4.toMat3=function(b,f){f||(f=mat3.create());var k=b[0],q=b[1],v=b[2];b=b[3];var n=k+k,e=q+q,a=v+v,d=k*n,h=k*e;k*=a;var r=q*e;q*=a;v*=a;n*=b;e*=b;b*=a;f[0]=1-(r+v);f[1]=h+b;f[2]=k-e;f[3]=h-b;f[4]=1-(d+v);f[5]=q+n;f[6]=k+e;f[7]=q-n;f[8]=1-(d+r);return f};
quat4.toMat4=function(b,f){f||(f=mat4.create());var k=b[0],q=b[1],v=b[2];b=b[3];var n=k+k,e=q+q,a=v+v,d=k*n,h=k*e;k*=a;var r=q*e;q*=a;v*=a;n*=b;e*=b;b*=a;f[0]=1-(r+v);f[1]=h+b;f[2]=k-e;f[3]=0;f[4]=h-b;f[5]=1-(d+v);f[6]=q+n;f[7]=0;f[8]=k+e;f[9]=q-n;f[10]=1-(d+r);f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};
quat4.slerp=function(b,f,k,q){q||(q=b);var v=b[0]*f[0]+b[1]*f[1]+b[2]*f[2]+b[3]*f[3];if(1<=Math.abs(v))return q!==b&&(q[0]=b[0],q[1]=b[1],q[2]=b[2],q[3]=b[3]),q;var n=Math.acos(v);var e=Math.sqrt(1-v*v);if(.001>Math.abs(e))return q[0]=.5*b[0]+.5*f[0],q[1]=.5*b[1]+.5*f[1],q[2]=.5*b[2]+.5*f[2],q[3]=.5*b[3]+.5*f[3],q;v=Math.sin((1-k)*n)/e;k=Math.sin(k*n)/e;q[0]=b[0]*v+f[0]*k;q[1]=b[1]*v+f[1]*k;q[2]=b[2]*v+f[2]*k;q[3]=b[3]*v+f[3]*k;return q};
quat4.str=function(b){return"["+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+"]"};
(function(){function b(a,d,h){this.isIE=/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent);this.height=this.width=0;this.enableFrontToBack=!!h;this.isBatchInEarlyZPass=this.isEarlyZPass=!1;this.currentZ=0;this.zNear=1;this.zFar=1E3;this.zIncrement=(this.zFar-this.zNear)/32768;this.zA=this.zFar/(this.zFar-this.zNear);this.zB=this.zFar*this.zNear/(this.zNear-this.zFar);this.kzA=65536*this.zA;this.kzB=65536*this.zB;this.cam=vec3.create([0,0,100]);this.look=vec3.create([0,0,0]);this.up=
vec3.create([0,1,0]);this.worldScale=vec3.create([1,1,1]);this.enable_mipmaps=!0;this.matP=mat4.create();this.matMV=mat4.create();this.lastMV=mat4.create();this.currentMV=mat4.create();this.gl=a;this.version=0===this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2")?2:1;this.timerExt=null;this.isTiming=!1;this.timerExt=2===this.version?this.gl.getExtension("EXT_disjoint_timer_query_webgl2")||this.gl.getExtension("EXT_disjoint_timer_query"):this.gl.getExtension("EXT_disjoint_timer_query");this.frameNumber=
0;this.timerResults=[];this.initState()}function f(a,d,h){this.gl=a;this.shaderProgram=d;this.name=h;this.locAPos=a.getAttribLocation(d,"aPos");this.locATex=a.getAttribLocation(d,"aTex");this.locMatP=a.getUniformLocation(d,"matP");this.locMatMV=a.getUniformLocation(d,"matMV");this.locOpacity=a.getUniformLocation(d,"opacity");this.locColorFill=a.getUniformLocation(d,"colorFill");this.locSamplerFront=a.getUniformLocation(d,"samplerFront");this.locSamplerBack=a.getUniformLocation(d,"samplerBack");this.locSrcStart=
a.getUniformLocation(d,"srcStart");this.locSrcEnd=a.getUniformLocation(d,"srcEnd");this.locSrcOriginStart=a.getUniformLocation(d,"srcOriginStart");this.locSrcOriginEnd=a.getUniformLocation(d,"srcOriginEnd");this.locLayoutStart=a.getUniformLocation(d,"layoutStart");this.locLayoutEnd=a.getUniformLocation(d,"layoutEnd");this.locDestStart=a.getUniformLocation(d,"destStart");this.locDestEnd=a.getUniformLocation(d,"destEnd");this.locSeconds=a.getUniformLocation(d,"seconds");this.locPixelSize=a.getUniformLocation(d,
"pixelSize");this.locLayerScale=a.getUniformLocation(d,"layerScale");this.locLayerAngle=a.getUniformLocation(d,"layerAngle");this.hasAnyOptionalUniforms=!!(this.locPixelSize||this.locSeconds||this.locSamplerBack||this.locSrcStart||this.locSrcEnd||this.locSrcOriginStart||this.locSrcOriginEnd||this.locLayoutStart||this.locLayoutEnd||this.locDestStart||this.locDestEnd||this.locLayerScale||this.locLayerAngle);this.lpPixelHeight=this.lpPixelWidth=-999;this.lpOpacity=1;this.lpDestStartY=this.lpDestStartX=
this.lpLayoutEndY=this.lpLayoutEndX=this.lpLayoutStartY=this.lpLayoutStartX=this.lpSrcOriginEndY=this.lpSrcOriginEndX=this.lpSrcOriginStartY=this.lpSrcOriginStartX=this.lpSrcEndY=this.lpSrcEndX=this.lpSrcStartY=this.lpSrcStartX=0;this.lpLayerScale=this.lpDestEndY=this.lpDestEndX=1;this.lpSeconds=this.lpLayerAngle=0;this.lastCustomParams=[];this.lpMatMV=mat4.create();this.locOpacity&&a.uniform1f(this.locOpacity,1);this.locColorFill&&a.uniform4f(this.locColorFill,1,1,1,1);this.locSamplerFront&&a.uniform1i(this.locSamplerFront,
0);this.locSamplerBack&&a.uniform1i(this.locSamplerBack,1);this.locSrcStart&&a.uniform2f(this.locSrcStart,0,0);this.locSrcEnd&&a.uniform2f(this.locSrcEnd,1,1);this.locSrcOriginStart&&a.uniform2f(this.locSrcOriginStart,0,0);this.locSrcOriginEnd&&a.uniform2f(this.locSrcOriginEnd,0,0);this.locLayoutStart&&a.uniform2f(this.locLayoutStart,0,0);this.locLayoutEnd&&a.uniform2f(this.locLayoutEnd,0,0);this.locDestStart&&a.uniform2f(this.locDestStart,0,0);this.locDestEnd&&a.uniform2f(this.locDestEnd,1,1);this.locLayerScale&&
a.uniform1f(this.locLayerScale,1);this.locLayerAngle&&a.uniform1f(this.locLayerAngle,0);this.locSeconds&&a.uniform1f(this.locSeconds,0);this.hasCurrentMatMV=!1}function k(a,d){return a[0]===d[0]&&a[1]===d[1]&&a[2]===d[2]&&a[3]===d[3]&&a[4]===d[4]&&a[5]===d[5]&&a[6]===d[6]&&a[7]===d[7]&&a[8]===d[8]&&a[9]===d[9]&&a[10]===d[10]&&a[11]===d[11]&&a[12]===d[12]&&a[13]===d[13]&&a[14]===d[14]&&a[15]===d[15]}function q(a,d){this.type=a;this.glwrap=d;this.gl=d.gl;this.indexCount=this.startIndex=this.opacityParam=
0;this.mat4param=this.texParam=null;this.layoutRect=quat4.create();this.srcOriginRect=quat4.create();this.shaderParams=[];cr.seal(this)}var v=mat4.create();b.prototype.initState=function(){var a=this.gl,d;this.lastOpacity=1;this.lastTexture1=this.lastTexture0=null;this.currentOpacity=1;a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);a.disable(a.CULL_FACE);a.disable(a.STENCIL_TEST);a.disable(a.DITHER);this.enableFrontToBack?(a.enable(a.DEPTH_TEST),
a.depthFunc(a.LEQUAL)):a.disable(a.DEPTH_TEST);this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE);this.lastSrcBlend=a.ONE;this.lastDestBlend=a.ONE_MINUS_SRC_ALPHA;this.vertexData=new Float32Array(8E3*(this.enableFrontToBack?3:2));this.texcoordData=new Float32Array(16E3);this.pointData=new Float32Array(32E3);this.pointBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.pointBuffer);a.bufferData(a.ARRAY_BUFFER,this.pointData.byteLength,a.DYNAMIC_DRAW);this.vertexBuffers=Array(4);this.texcoordBuffers=
Array(4);for(d=0;4>d;d++)this.vertexBuffers[d]=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffers[d]),a.bufferData(a.ARRAY_BUFFER,this.vertexData.byteLength,a.DYNAMIC_DRAW),this.texcoordBuffers[d]=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.texcoordBuffers[d]),a.bufferData(a.ARRAY_BUFFER,this.texcoordData.byteLength,a.DYNAMIC_DRAW);this.curBuffer=0;this.indexBuffer=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);for(var h=new Uint16Array(12E3),r=d=0;12E3>
d;)h[d++]=r,h[d++]=r+1,h[d++]=r+2,h[d++]=r,h[d++]=r+2,h[d++]=r+3,r+=4;a.bufferData(a.ELEMENT_ARRAY_BUFFER,h,a.STATIC_DRAW);this.pointPtr=this.texPtr=this.vertexPtr=0;this.shaderPrograms=[];d=this.enableFrontToBack?"attribute highp vec3 aPos;\nattribute mediump vec2 aTex;\nvarying mediump vec2 vTex;\nuniform highp mat4 matP;\nuniform highp mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, aPos.z, 1.0);\n\tvTex = aTex;\n}":"attribute highp vec2 aPos;\nattribute mediump vec2 aTex;\nvarying mediump vec2 vTex;\nuniform highp mat4 matP;\nuniform highp mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);\n\tvTex = aTex;\n}";
h=this.createShaderProgram({src:"varying mediump vec2 vTex;\nuniform lowp float opacity;\nuniform lowp sampler2D samplerFront;\nvoid main(void) {\n\tgl_FragColor = texture2D(samplerFront, vTex);\n\tgl_FragColor *= opacity;\n}"},d,"<default>");this.shaderPrograms.push(h);h=this.createShaderProgram({src:"uniform mediump sampler2D samplerFront;\nvarying lowp float opacity;\nvoid main(void) {\n\tgl_FragColor = texture2D(samplerFront, gl_PointCoord);\n\tgl_FragColor *= opacity;\n}"},"attribute vec4 aPos;\nvarying float opacity;\nuniform mat4 matP;\nuniform mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);\n\tgl_PointSize = aPos.z;\n\topacity = aPos.w;\n}",
"<point>");this.shaderPrograms.push(h);h=this.createShaderProgram({src:"varying mediump vec2 vTex;\nuniform lowp sampler2D samplerFront;\nvoid main(void) {\n\tif (texture2D(samplerFront, vTex).a < 1.0)\n\t\tdiscard;\n}"},d,"<earlyz>");this.shaderPrograms.push(h);h=this.createShaderProgram({src:"uniform lowp vec4 colorFill;\nvoid main(void) {\n\tgl_FragColor = colorFill;\n}"},d,"<fill>");this.shaderPrograms.push(h);for(var w in cr.shaders)cr.shaders.hasOwnProperty(w)&&this.shaderPrograms.push(this.createShaderProgram(cr.shaders[w],
d,w));a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,null);this.batch=[];this.batchPtr=0;this.hasPointBatchTop=this.hasQuadBatchTop=!1;this.currentProgram=this.lastProgram=-1;this.currentShader=null;this.fbo=a.createFramebuffer();this.depthBuffer=this.renderToTex=null;this.attachedDepthBuffer=!1;this.enableFrontToBack&&(this.depthBuffer=a.createRenderbuffer());this.tmpVec3=vec3.create([0,0,0]);a=a.getParameter(a.ALIASED_POINT_SIZE_RANGE);this.minPointSize=a[0];this.maxPointSize=a[1];2048<
this.maxPointSize&&(this.maxPointSize=2048);this.switchProgram(0);cr.seal(this)};f.prototype.updateMatMV=function(a){k(this.lpMatMV,a)||(mat4.set(a,this.lpMatMV),this.gl.uniformMatrix4fv(this.locMatMV,!1,a))};b.prototype.createShaderProgram=function(a,d,h){var r=this.gl,w=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(w,a.src);r.compileShader(w);if(!r.getShaderParameter(w,r.COMPILE_STATUS))throw a=r.getShaderInfoLog(w),r.deleteShader(w),Error("error compiling fragment shader: "+a);var E=r.createShader(r.VERTEX_SHADER);
r.shaderSource(E,d);r.compileShader(E);if(!r.getShaderParameter(E,r.COMPILE_STATUS))throw a=r.getShaderInfoLog(E),r.deleteShader(w),r.deleteShader(E),Error("error compiling vertex shader: "+a);d=r.createProgram();r.attachShader(d,w);r.attachShader(d,E);r.linkProgram(d);if(!r.getProgramParameter(d,r.LINK_STATUS))throw a=r.getProgramInfoLog(d),r.deleteShader(w),r.deleteShader(E),r.deleteProgram(d),Error("error linking shader program: "+a);r.useProgram(d);r.deleteShader(w);r.deleteShader(E);w=new f(r,
d,h);w.extendBoxHorizontal=a.extendBoxHorizontal||0;w.extendBoxVertical=a.extendBoxVertical||0;w.crossSampling=!!a.crossSampling;w.preservesOpaqueness=!!a.preservesOpaqueness;w.animated=!!a.animated;w.parameters=a.parameters||[];a=0;for(E=w.parameters.length;a<E;a++)w.parameters[a][1]=r.getUniformLocation(d,w.parameters[a][0]),w.lastCustomParams.push(0);cr.seal(w);return w};b.prototype.getShaderIndex=function(a){var d;var h=0;for(d=this.shaderPrograms.length;h<d;h++)if(this.shaderPrograms[h].name===
a)return h;return-1};b.prototype.project=function(a,d,h){var r=this.matMV,w=this.matP,E=[0,0,0,0,0,0,0,0];E[0]=r[0]*a+r[4]*d+r[12];E[1]=r[1]*a+r[5]*d+r[13];E[2]=r[2]*a+r[6]*d+r[14];E[3]=r[3]*a+r[7]*d+r[15];E[4]=w[0]*E[0]+w[4]*E[1]+w[8]*E[2]+w[12]*E[3];E[5]=w[1]*E[0]+w[5]*E[1]+w[9]*E[2]+w[13]*E[3];E[6]=w[2]*E[0]+w[6]*E[1]+w[10]*E[2]+w[14]*E[3];E[7]=-E[2];0!==E[7]&&(E[7]=1/E[7],E[4]*=E[7],E[5]*=E[7],E[6]*=E[7],h[0]=(.5*E[4]+.5)*this.width,h[1]=(.5*E[5]+.5)*this.height)};b.prototype.setSize=function(a,
d,h){if(this.width!==a||this.height!==d||h){this.endBatch();h=this.gl;this.width=a;this.height=d;h.viewport(0,0,a,d);mat4.lookAt(this.cam,this.look,this.up,this.matMV);this.enableFrontToBack?(mat4.ortho(-a/2,a/2,d/2,-d/2,this.zNear,this.zFar,this.matP),this.worldScale[0]=1,this.worldScale[1]=1):(mat4.perspective(45,a/d,this.zNear,this.zFar,this.matP),a=[0,0],d=[0,0],this.project(0,0,a),this.project(1,1,d),this.worldScale[0]=1/(d[0]-a[0]),this.worldScale[1]=-1/(d[1]-a[1]));a=0;for(d=this.shaderPrograms.length;a<
d;a++){var r=this.shaderPrograms[a];r.hasCurrentMatMV=!1;r.locMatP&&(h.useProgram(r.shaderProgram),h.uniformMatrix4fv(r.locMatP,!1,this.matP))}h.useProgram(this.shaderPrograms[this.lastProgram].shaderProgram);h.bindTexture(h.TEXTURE_2D,null);h.activeTexture(h.TEXTURE1);h.bindTexture(h.TEXTURE_2D,null);h.activeTexture(h.TEXTURE0);this.lastTexture1=this.lastTexture0=null;this.depthBuffer&&(h.bindFramebuffer(h.FRAMEBUFFER,this.fbo),h.bindRenderbuffer(h.RENDERBUFFER,this.depthBuffer),h.renderbufferStorage(h.RENDERBUFFER,
h.DEPTH_COMPONENT16,this.width,this.height),this.attachedDepthBuffer||(h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,this.depthBuffer),this.attachedDepthBuffer=!0),h.bindRenderbuffer(h.RENDERBUFFER,null),h.bindFramebuffer(h.FRAMEBUFFER,null),this.renderToTex=null)}};b.prototype.resetModelView=function(){mat4.lookAt(this.cam,this.look,this.up,this.matMV);mat4.scale(this.matMV,this.worldScale)};b.prototype.translate=function(a,d){if(0!==a||0!==d)this.tmpVec3[0]=a,this.tmpVec3[1]=
d,this.tmpVec3[2]=0,mat4.translate(this.matMV,this.tmpVec3)};b.prototype.scale=function(a,d){if(1!==a||1!==d)this.tmpVec3[0]=a,this.tmpVec3[1]=d,this.tmpVec3[2]=1,mat4.scale(this.matMV,this.tmpVec3)};b.prototype.rotateZ=function(a){0!==a&&mat4.rotateZ(this.matMV,a)};b.prototype.updateModelView=function(){if(!k(this.lastMV,this.matMV)){var a=this.pushBatch();a.type=5;a.mat4param?mat4.set(this.matMV,a.mat4param):a.mat4param=mat4.create(this.matMV);mat4.set(this.matMV,this.lastMV);this.hasPointBatchTop=
this.hasQuadBatchTop=!1}};b.prototype.setEarlyZIndex=function(a){this.enableFrontToBack&&(32760<a&&(a=32760),this.currentZ=this.cam[2]-this.zNear-a*this.zIncrement)};q.prototype.doSetEarlyZPass=function(){var a=this.gl,d=this.glwrap;0!==this.startIndex?(a.depthMask(!0),a.colorMask(!1,!1,!1,!1),a.disable(a.BLEND),a.bindFramebuffer(a.FRAMEBUFFER,d.fbo),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,null,0),a.clear(a.DEPTH_BUFFER_BIT),a.bindFramebuffer(a.FRAMEBUFFER,null),d.isBatchInEarlyZPass=
!0):(a.depthMask(!1),a.colorMask(!0,!0,!0,!0),a.enable(a.BLEND),d.isBatchInEarlyZPass=!1)};q.prototype.doSetTexture=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texParam)};q.prototype.doSetTexture1=function(){var a=this.gl;a.activeTexture(a.TEXTURE1);a.bindTexture(a.TEXTURE_2D,this.texParam);a.activeTexture(a.TEXTURE0)};q.prototype.doSetOpacity=function(){var a=this.opacityParam,d=this.glwrap;d.currentOpacity=a;d=d.currentShader;d.locOpacity&&d.lpOpacity!==a&&(d.lpOpacity=a,this.gl.uniform1f(d.locOpacity,
a))};q.prototype.doQuad=function(){this.gl.drawElements(this.gl.TRIANGLES,this.indexCount,this.gl.UNSIGNED_SHORT,this.startIndex)};q.prototype.doSetBlend=function(){this.gl.blendFunc(this.startIndex,this.indexCount)};q.prototype.doUpdateModelView=function(){var a,d=this.glwrap.shaderPrograms,h=this.glwrap.currentProgram;var r=0;for(a=d.length;r<a;r++){var w=d[r];r===h&&w.locMatMV?(w.updateMatMV(this.mat4param),w.hasCurrentMatMV=!0):w.hasCurrentMatMV=!1}mat4.set(this.mat4param,this.glwrap.currentMV)};
q.prototype.doRenderToTexture=function(){var a=this.gl,d=this.glwrap;this.texParam?(d.lastTexture1===this.texParam&&(a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,null),d.lastTexture1=null,a.activeTexture(a.TEXTURE0)),a.bindFramebuffer(a.FRAMEBUFFER,d.fbo),d.isBatchInEarlyZPass||a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texParam,0)):(d.enableFrontToBack||a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,null,0),a.bindFramebuffer(a.FRAMEBUFFER,
null))};q.prototype.doClear=function(){var a=this.gl,d=this.startIndex;0===d?(a.clearColor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),a.clear(a.COLOR_BUFFER_BIT)):1===d?(a.enable(a.SCISSOR_TEST),a.scissor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT),a.disable(a.SCISSOR_TEST)):a.clear(a.DEPTH_BUFFER_BIT)};q.prototype.doSetDepthTestEnabled=function(){var a=this.gl;0!==this.startIndex?a.enable(a.DEPTH_TEST):
a.disable(a.DEPTH_TEST)};q.prototype.doPoints=function(){var a=this.gl,d=this.glwrap;d.enableFrontToBack&&a.disable(a.DEPTH_TEST);var h=d.shaderPrograms[1];a.useProgram(h.shaderProgram);!h.hasCurrentMatMV&&h.locMatMV&&(h.updateMatMV(d.currentMV),h.hasCurrentMatMV=!0);a.enableVertexAttribArray(h.locAPos);a.bindBuffer(a.ARRAY_BUFFER,d.pointBuffer);a.vertexAttribPointer(h.locAPos,4,a.FLOAT,!1,0,0);a.drawArrays(a.POINTS,this.startIndex/4,this.indexCount);h=d.currentShader;a.useProgram(h.shaderProgram);
0<=h.locAPos&&(a.enableVertexAttribArray(h.locAPos),a.bindBuffer(a.ARRAY_BUFFER,d.vertexBuffers[d.curBuffer]),a.vertexAttribPointer(h.locAPos,d.enableFrontToBack?3:2,a.FLOAT,!1,0,0));0<=h.locATex&&(a.enableVertexAttribArray(h.locATex),a.bindBuffer(a.ARRAY_BUFFER,d.texcoordBuffers[d.curBuffer]),a.vertexAttribPointer(h.locATex,2,a.FLOAT,!1,0,0));d.enableFrontToBack&&a.enable(a.DEPTH_TEST)};q.prototype.doSetProgram=function(){var a=this.gl,d=this.glwrap,h=d.shaderPrograms[this.startIndex];d.currentProgram=
this.startIndex;d.currentShader=h;a.useProgram(h.shaderProgram);!h.hasCurrentMatMV&&h.locMatMV&&(h.updateMatMV(d.currentMV),h.hasCurrentMatMV=!0);h.locOpacity&&h.lpOpacity!==d.currentOpacity&&(h.lpOpacity=d.currentOpacity,a.uniform1f(h.locOpacity,d.currentOpacity));0<=h.locAPos&&(a.enableVertexAttribArray(h.locAPos),a.bindBuffer(a.ARRAY_BUFFER,d.vertexBuffers[d.curBuffer]),a.vertexAttribPointer(h.locAPos,d.enableFrontToBack?3:2,a.FLOAT,!1,0,0));0<=h.locATex&&(a.enableVertexAttribArray(h.locATex),
a.bindBuffer(a.ARRAY_BUFFER,d.texcoordBuffers[d.curBuffer]),a.vertexAttribPointer(h.locATex,2,a.FLOAT,!1,0,0))};q.prototype.doSetColor=function(){var a=this.mat4param;this.gl.uniform4f(this.glwrap.currentShader.locColorFill,a[0],a[1],a[2],a[3])};q.prototype.doSetProgramParameters=function(){var a=this.glwrap.currentShader,d=this.gl;var h=this.mat4param;var r=this.layoutRect;var w=this.srcOriginRect;a.locSamplerBack&&this.glwrap.lastTexture1!==this.texParam&&(d.activeTexture(d.TEXTURE1),d.bindTexture(d.TEXTURE_2D,
this.texParam),this.glwrap.lastTexture1=this.texParam,d.activeTexture(d.TEXTURE0));var E=h[0],t=h[1];!a.locPixelSize||E===a.lpPixelWidth&&t===a.lpPixelHeight||(a.lpPixelWidth=E,a.lpPixelHeight=t,d.uniform2f(a.locPixelSize,E,t));E=h[2];t=h[3];!a.locDestStart||E===a.lpDestStartX&&t===a.lpDestStartY||(a.lpDestStartX=E,a.lpDestStartY=t,d.uniform2f(a.locDestStart,E,t));E=h[4];t=h[5];!a.locDestEnd||E===a.lpDestEndX&&t===a.lpDestEndY||(a.lpDestEndX=E,a.lpDestEndY=t,d.uniform2f(a.locDestEnd,E,t));E=h[6];
a.locLayerScale&&E!==a.lpLayerScale&&(a.lpLayerScale=E,d.uniform1f(a.locLayerScale,E));E=h[7];a.locLayerAngle&&E!==a.lpLayerAngle&&(a.lpLayerAngle=E,d.uniform1f(a.locLayerAngle,E));E=h[12];t=h[13];!a.locSrcStart||E===a.lpSrcStartX&&t===a.lpSrcStartY||(a.lpSrcStartX=E,a.lpSrcStartY=t,d.uniform2f(a.locSrcStart,E,t));E=h[14];t=h[15];!a.locSrcEnd||E===a.lpSrcEndX&&t===a.lpSrcEndY||(a.lpSrcEndX=E,a.lpSrcEndY=t,d.uniform2f(a.locSrcEnd,E,t));E=w[0];t=w[1];!a.locSrcOriginStart||E===a.lpSrcOriginStartX&&t===
a.lpSrcOriginStartY||(a.lpSrcOriginStartX=E,a.lpSrcOriginStartY=t,d.uniform2f(a.locSrcOriginStart,E,t));E=w[2];t=w[3];!a.locSrcOriginEnd||E===a.lpSrcOriginEndX&&t===a.lpSrcOriginEndY||(a.lpSrcOriginEndX=E,a.lpSrcOriginEndY=t,d.uniform2f(a.locSrcOriginEnd,E,t));E=r[0];t=r[1];!a.locLayoutStart||E===a.lpLayoutStartX&&t===a.lpLayoutStartY||(a.lpLayoutStartX=E,a.lpLayoutStartY=t,d.uniform2f(a.locLayoutStart,E,t));E=r[2];t=r[3];!a.locLayoutEnd||E===a.lpLayoutEndX&&t===a.lpLayoutEndY||(a.lpLayoutEndX=E,
a.lpLayoutEndY=t,d.uniform2f(a.locLayoutEnd,E,t));E=this.startIndex;a.locSeconds&&E!==a.lpSeconds&&(a.lpSeconds=E,d.uniform1f(a.locSeconds,E));if(a.parameters.length)for(h=0,r=a.parameters.length;h<r;h++)E=this.shaderParams[h],Array.isArray(E)?d.uniform3fv(a.parameters[h][1],E):E!==a.lastCustomParams[h]&&(a.lastCustomParams[h]=E,d.uniform1f(a.parameters[h][1],E))};b.prototype.pushBatch=function(){this.batchPtr===this.batch.length&&this.batch.push(new q(0,this));return this.batch[this.batchPtr++]};
b.prototype.endBatch=function(){if(0!==this.batchPtr&&!this.gl.isContextLost()){this.maybeStartTiming();var a=this.gl;0<this.pointPtr&&(a.bindBuffer(a.ARRAY_BUFFER,this.pointBuffer),a.bufferSubData(a.ARRAY_BUFFER,0,this.pointData.subarray(0,this.pointPtr)),d&&0<=d.locAPos&&"<point>"===d.name&&a.vertexAttribPointer(d.locAPos,4,a.FLOAT,!1,0,0));if(0<this.vertexPtr){var d=this.currentShader;a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffers[this.curBuffer]);a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexData.subarray(0,
this.vertexPtr));d&&0<=d.locAPos&&"<point>"!==d.name&&a.vertexAttribPointer(d.locAPos,this.enableFrontToBack?3:2,a.FLOAT,!1,0,0);a.bindBuffer(a.ARRAY_BUFFER,this.texcoordBuffers[this.curBuffer]);a.bufferSubData(a.ARRAY_BUFFER,0,this.texcoordData.subarray(0,this.texPtr));d&&0<=d.locATex&&"<point>"!==d.name&&a.vertexAttribPointer(d.locATex,2,a.FLOAT,!1,0,0)}a=0;for(d=this.batchPtr;a<d;a++){var h=this.batch[a];switch(h.type){case 1:h.doQuad();break;case 2:h.doSetTexture();break;case 3:h.doSetOpacity();
break;case 4:h.doSetBlend();break;case 5:h.doUpdateModelView();break;case 6:h.doRenderToTexture();break;case 7:h.doClear();break;case 8:h.doPoints();break;case 9:h.doSetProgram();break;case 10:h.doSetProgramParameters();break;case 11:h.doSetTexture1();break;case 12:h.doSetColor();break;case 13:h.doSetDepthTestEnabled();break;case 14:h.doSetEarlyZPass()}}this.pointPtr=this.texPtr=this.vertexPtr=this.batchPtr=0;this.isBatchInEarlyZPass=this.hasPointBatchTop=this.hasQuadBatchTop=!1;this.curBuffer++;
4<=this.curBuffer&&(this.curBuffer=0)}};b.prototype.maybeStartTiming=function(){if(!this.isTiming&&this.timerExt){this.isTiming=!0;var a={frameNumber:this.frameNumber,query:null,result:0};2===this.version?(a.query=this.gl.createQuery(),this.gl.beginQuery(this.timerExt.TIME_ELAPSED_EXT,a.query)):(a.query=this.timerExt.createQueryEXT(),this.timerExt.beginQueryEXT(this.timerExt.TIME_ELAPSED_EXT,a.query));this.timerResults.push(a);1E3<this.timerResults.length&&(a=this.timerResults.shift(),a.query&&(2===
this.version?this.gl.deleteQuery(a.query):this.timerExt.deleteQueryEXT(a.query)))}};b.prototype.maybeFinishTiming=function(){this.isTiming&&this.timerResults.length&&(2===this.version?this.gl.endQuery(this.timerExt.TIME_ELAPSED_EXT):this.timerExt.endQueryEXT(this.timerExt.TIME_ELAPSED_EXT),this.isTiming=!1)};b.prototype.checkForTimerResults=function(a){var d;var h=0;for(d=this.timerResults.length;h<d;++h){var r=this.timerResults[h];if(r.frameNumber>=a)break;if(r.query){var w=2===this.version?this.gl.getQueryParameter(r.query,
this.gl.QUERY_RESULT_AVAILABLE):this.timerExt.getQueryObjectEXT(r.query,this.timerExt.QUERY_RESULT_AVAILABLE_EXT);var E=this.gl.getParameter(this.timerExt.GPU_DISJOINT_EXT);w&&!E&&(r.result=2===this.version?this.gl.getQueryParameter(r.query,this.gl.QUERY_RESULT):this.timerExt.getQueryObjectEXT(r.query,this.timerExt.QUERY_RESULT_EXT),r.result/=1E9);if(w||E)2===this.version?this.gl.deleteQuery(r.query):this.timerExt.deleteQueryEXT(r.query),r.query=null}}};b.prototype.getFrameRangeTimerResults=function(a,
d){if(d<=a)return-1;var h,r=0,w=0;var E=0;for(h=this.timerResults.length;E<h;++E){var t=this.timerResults[E];if(t.frameNumber>=d)break;if(t.frameNumber>=a){if(t.query)return-1;r+=t.result;w++}}return w<d-a?-1:r};b.prototype.deleteTimerResultsToFrame=function(a){var d;var h=0;for(d=this.timerResults.length;h<d;++h){var r=this.timerResults[h];if(r.frameNumber>=a){0<h&&this.timerResults.splice(0,h);break}}};b.prototype.setOpacity=function(a){if(a!==this.lastOpacity&&!this.isEarlyZPass){var d=this.pushBatch();
d.type=3;this.lastOpacity=d.opacityParam=a;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.setTexture=function(a){if(a!==this.lastTexture0){var d=this.pushBatch();d.type=2;this.lastTexture0=d.texParam=a;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.setBlend=function(a,d){if((a!==this.lastSrcBlend||d!==this.lastDestBlend)&&!this.isEarlyZPass){var h=this.pushBatch();h.type=4;h.startIndex=a;h.indexCount=d;this.lastSrcBlend=a;this.lastDestBlend=d;this.hasPointBatchTop=this.hasQuadBatchTop=
!1}};b.prototype.isPremultipliedAlphaBlend=function(){return this.lastSrcBlend===this.gl.ONE&&this.lastDestBlend===this.gl.ONE_MINUS_SRC_ALPHA};b.prototype.setAlphaBlend=function(){this.setBlend(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)};b.prototype.setNoPremultiplyAlphaBlend=function(){this.setBlend(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)};b.prototype.quad=function(a,d,h,r,w,E,t,p){15992<=this.vertexPtr&&this.endBatch();var x=this.vertexPtr,C=this.texPtr,z=this.vertexData,K=this.texcoordData,
S=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var L=this.pushBatch();L.type=1;L.startIndex=this.enableFrontToBack?x:x/2*3;L.indexCount=6;this.hasQuadBatchTop=!0;this.hasPointBatchTop=!1}this.enableFrontToBack?(z[x++]=a,z[x++]=d,z[x++]=S,z[x++]=h,z[x++]=r,z[x++]=S,z[x++]=w,z[x++]=E,z[x++]=S,z[x++]=t,z[x++]=p,z[x++]=S):(z[x++]=a,z[x++]=d,z[x++]=h,z[x++]=r,z[x++]=w,z[x++]=E,z[x++]=t,z[x++]=p);K[C++]=0;K[C++]=0;K[C++]=1;K[C++]=0;K[C++]=1;K[C++]=1;K[C++]=0;K[C++]=
1;this.vertexPtr=x;this.texPtr=C};b.prototype.quadTex=function(a,d,h,r,w,E,t,p,x){15992<=this.vertexPtr&&this.endBatch();var C=this.vertexPtr,z=this.texPtr,K=this.vertexData,S=this.texcoordData,L=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var R=this.pushBatch();R.type=1;R.startIndex=this.enableFrontToBack?C:C/2*3;R.indexCount=6;this.hasQuadBatchTop=!0;this.hasPointBatchTop=!1}R=x.left;var F=x.top,g=x.right;x=x.bottom;this.enableFrontToBack?(K[C++]=a,K[C++]=
d,K[C++]=L,K[C++]=h,K[C++]=r,K[C++]=L,K[C++]=w,K[C++]=E,K[C++]=L,K[C++]=t,K[C++]=p,K[C++]=L):(K[C++]=a,K[C++]=d,K[C++]=h,K[C++]=r,K[C++]=w,K[C++]=E,K[C++]=t,K[C++]=p);S[z++]=R;S[z++]=F;S[z++]=g;S[z++]=F;S[z++]=g;S[z++]=x;S[z++]=R;S[z++]=x;this.vertexPtr=C;this.texPtr=z};b.prototype.quadTexUV=function(a,d,h,r,w,E,t,p,x,C,z,K,S,L,R,F){15992<=this.vertexPtr&&this.endBatch();var g=this.vertexPtr,l=this.texPtr,u=this.vertexData,c=this.texcoordData,y=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-
1].indexCount+=6;else{var H=this.pushBatch();H.type=1;H.startIndex=this.enableFrontToBack?g:g/2*3;H.indexCount=6;this.hasQuadBatchTop=!0;this.hasPointBatchTop=!1}this.enableFrontToBack?(u[g++]=a,u[g++]=d,u[g++]=y,u[g++]=h,u[g++]=r,u[g++]=y,u[g++]=w,u[g++]=E,u[g++]=y,u[g++]=t,u[g++]=p,u[g++]=y):(u[g++]=a,u[g++]=d,u[g++]=h,u[g++]=r,u[g++]=w,u[g++]=E,u[g++]=t,u[g++]=p);c[l++]=x;c[l++]=C;c[l++]=z;c[l++]=K;c[l++]=S;c[l++]=L;c[l++]=R;c[l++]=F;this.vertexPtr=g;this.texPtr=l};b.prototype.convexPoly=function(a){var d=
a.length/2-2,h=d-1,r=a[0],w=a[1],E;for(E=0;E<d;E+=2){var t=2*E;var p=a[t+2];var x=a[t+3];var C=a[t+4];var z=a[t+5];if(E===h)this.quad(r,w,p,x,C,z,C,z);else{var K=a[t+6];t=a[t+7];this.quad(r,w,p,x,C,z,K,t)}}};b.prototype.point=function(a,d,h,r){7996<=this.pointPtr&&this.endBatch();var w=this.pointPtr,E=this.pointData;if(this.hasPointBatchTop)this.batch[this.batchPtr-1].indexCount++;else{var t=this.pushBatch();t.type=8;t.startIndex=w;t.indexCount=1;this.hasPointBatchTop=!0;this.hasQuadBatchTop=!1}E[w++]=
a;E[w++]=d;E[w++]=h;E[w++]=r;this.pointPtr=w};b.prototype.switchProgram=function(a){if(this.lastProgram!==a){if(!this.shaderPrograms[a]){if(0===this.lastProgram)return;a=0}var d=this.pushBatch();d.type=9;this.lastProgram=d.startIndex=a;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.programUsesDest=function(a){a=this.shaderPrograms[a];return!(!a.locDestStart&&!a.locDestEnd)};b.prototype.programUsesCrossSampling=function(a){a=this.shaderPrograms[a];return!!(a.locDestStart||a.locDestEnd||
a.crossSampling)};b.prototype.programPreservesOpaqueness=function(a){return this.shaderPrograms[a].preservesOpaqueness};b.prototype.programExtendsBox=function(a){a=this.shaderPrograms[a];return 0!==a.extendBoxHorizontal||0!==a.extendBoxVertical};b.prototype.getProgramBoxExtendHorizontal=function(a){return this.shaderPrograms[a].extendBoxHorizontal};b.prototype.getProgramBoxExtendVertical=function(a){return this.shaderPrograms[a].extendBoxVertical};b.prototype.getProgramParameterType=function(a,d){return this.shaderPrograms[a].parameters[d][2]};
b.prototype.programIsAnimated=function(a){return this.shaderPrograms[a].animated};b.prototype.setProgramParameters=function(a,d,h,r,w,E,t,p,x,C,z,K,S,L,R,F,g,l,u,c,y,H,O){var U=this.shaderPrograms[this.lastProgram];if(U.hasAnyOptionalUniforms||O.length){var Y=this.pushBatch();Y.type=10;Y.mat4param?mat4.set(this.matMV,Y.mat4param):Y.mat4param=mat4.create();var aa=Y.mat4param;aa[0]=d;aa[1]=h;aa[2]=F;aa[3]=g;aa[4]=l;aa[5]=u;aa[6]=c;aa[7]=y;aa[12]=r;aa[13]=w;aa[14]=E;aa[15]=t;d=Y.srcOriginRect;d[0]=p;
d[1]=x;d[2]=C;d[3]=z;p=Y.layoutRect;p[0]=K;p[1]=R;p[2]=L;p[3]=S;Y.startIndex=H;Y.texParam=U.locSamplerBack?a:null;if(O.length)for(S=Y.shaderParams,S.length=O.length,a=0,K=O.length;a<K;a++)S[a]=O[a];this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.clear=function(a,d,h,r){var w=this.pushBatch();w.type=7;w.startIndex=0;w.mat4param||(w.mat4param=mat4.create());w.mat4param[0]=a;w.mat4param[1]=d;w.mat4param[2]=h;w.mat4param[3]=r;this.hasPointBatchTop=this.hasQuadBatchTop=!1};b.prototype.clearRect=
function(a,d,h,r){if(!(0>h||0>r)){var w=this.pushBatch();w.type=7;w.startIndex=1;w.mat4param||(w.mat4param=mat4.create());w.mat4param[0]=a;w.mat4param[1]=d;w.mat4param[2]=h;w.mat4param[3]=r;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.clearDepth=function(){var a=this.pushBatch();a.type=7;a.startIndex=2;this.hasPointBatchTop=this.hasQuadBatchTop=!1};b.prototype.setEarlyZPass=function(a){if(this.enableFrontToBack&&(a=!!a,this.isEarlyZPass!==a)){var d=this.pushBatch();d.type=14;d.startIndex=
a?1:0;this.hasPointBatchTop=this.hasQuadBatchTop=!1;this.isEarlyZPass=a;this.renderToTex=null;this.isEarlyZPass?this.switchProgram(2):this.switchProgram(0)}};b.prototype.setDepthTestEnabled=function(a){if(this.enableFrontToBack){var d=this.pushBatch();d.type=13;d.startIndex=a?1:0;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.fullscreenQuad=function(){mat4.set(this.lastMV,v);this.resetModelView();this.updateModelView();var a=this.width/2,d=this.height/2;this.quad(-a,d,a,d,a,-d,-a,-d);
mat4.set(v,this.matMV);this.updateModelView()};b.prototype.setColorFillMode=function(a,d,h,r){this.switchProgram(3);var w=this.pushBatch();w.type=12;w.mat4param||(w.mat4param=mat4.create());w.mat4param[0]=a;w.mat4param[1]=d;w.mat4param[2]=h;w.mat4param[3]=r;this.hasPointBatchTop=this.hasQuadBatchTop=!1};b.prototype.setTextureFillMode=function(){this.switchProgram(0)};b.prototype.restoreEarlyZMode=function(){this.switchProgram(2)};b.prototype.getFrameNumber=function(){return this.frameNumber};b.prototype.present=
function(){this.endBatch();this.maybeFinishTiming();this.gl.flush();this.checkForTimerResults(this.frameNumber);this.frameNumber++};b.prototype.supportsGpuProfiling=function(){return!!this.timerExt};var n=[],e={};b.prototype.contextLost=function(){cr.clearArray(n);e={}};b.prototype.loadTexture=function(a,d,h,r,w,E){d=!!d;h=!!h;var t=a.src+","+d+","+h+(d?","+w:"");if("undefined"!==typeof a.src&&e.hasOwnProperty(t)){var p=e[t];p.c2refcount++;return p}this.endBatch();var x=this.gl,C=cr.isPOT(a.width)&&
cr.isPOT(a.height);p=x.createTexture();x.bindTexture(x.TEXTURE_2D,p);x.pixelStorei(x.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);var z=x.RGBA,K=x.RGBA,S=x.UNSIGNED_BYTE;if(r&&!this.isIE)switch(r){case 1:K=z=x.RGB;break;case 2:S=x.UNSIGNED_SHORT_4_4_4_4;break;case 3:S=x.UNSIGNED_SHORT_5_5_5_1;break;case 4:K=z=x.RGB,S=x.UNSIGNED_SHORT_5_6_5}if(1===this.version&&!C&&d){r=document.createElement("canvas");r.width=cr.nextHighestPowerOfTwo(a.width);r.height=cr.nextHighestPowerOfTwo(a.height);var L=r.getContext("2d");
L.imageSmoothingEnabled=h;L.drawImage(a,0,0,a.width,a.height,0,0,r.width,r.height);x.texImage2D(x.TEXTURE_2D,0,z,K,S,r)}else x.texImage2D(x.TEXTURE_2D,0,z,K,S,a);d?"repeat-x"===w?(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.REPEAT),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE)):("repeat-y"===w?x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE):x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.REPEAT),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.REPEAT)):(x.texParameteri(x.TEXTURE_2D,
x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE));h?(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.LINEAR),(C||2<=this.version)&&this.enable_mipmaps&&!E?(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.LINEAR_MIPMAP_LINEAR),x.generateMipmap(x.TEXTURE_2D)):x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.LINEAR)):(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.NEAREST),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.NEAREST));x.bindTexture(x.TEXTURE_2D,
null);this.lastTexture0=null;p.c2width=a.width;p.c2height=a.height;p.c2refcount=1;p.c2texkey=t;n.push(p);return e[t]=p};b.prototype.createEmptyTexture=function(a,d,h,r,w){this.endBatch();var E=this.gl;this.isIE&&(r=!1);var t=E.createTexture();E.bindTexture(E.TEXTURE_2D,t);E.texImage2D(E.TEXTURE_2D,0,E.RGBA,a,d,0,E.RGBA,r?E.UNSIGNED_SHORT_4_4_4_4:E.UNSIGNED_BYTE,null);w?(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,E.REPEAT),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,E.REPEAT)):(E.texParameteri(E.TEXTURE_2D,
E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE));E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,h?E.LINEAR:E.NEAREST);E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,h?E.LINEAR:E.NEAREST);E.bindTexture(E.TEXTURE_2D,null);this.lastTexture0=null;t.c2width=a;t.c2height=d;n.push(t);return t};b.prototype.videoToTexture=function(a,d,h){this.endBatch();var r=this.gl;this.isIE&&(h=!1);r.bindTexture(r.TEXTURE_2D,d);r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
!0);try{r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,h?r.UNSIGNED_SHORT_4_4_4_4:r.UNSIGNED_BYTE,a)}catch(w){console&&console.error&&console.error("Error updating WebGL texture: ",w)}r.bindTexture(r.TEXTURE_2D,null);this.lastTexture0=null};b.prototype.deleteTexture=function(a){a&&("undefined"!==typeof a.c2refcount&&1<a.c2refcount?a.c2refcount--:(this.endBatch(),a===this.lastTexture0&&(this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.lastTexture0=null),a===this.lastTexture1&&(this.gl.activeTexture(this.gl.TEXTURE1),
this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.activeTexture(this.gl.TEXTURE0),this.lastTexture1=null),cr.arrayFindRemove(n,a),"undefined"!==typeof a.c2texkey&&delete e[a.c2texkey],this.gl.deleteTexture(a)))};b.prototype.estimateVRAM=function(){var a=this.width*this.height*8,d;var h=0;for(d=n.length;h<d;h++){var r=n[h];a+=r.c2width*r.c2height*4}return a};b.prototype.textureCount=function(){return n.length};b.prototype.setRenderingToTexture=function(a){if(a!==this.renderToTex){var d=this.pushBatch();
d.type=6;this.renderToTex=d.texParam=a;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};cr.GLWrap=b})();
(function(){function b(m){var A=m.canvas,J=m.projectDataUrl;A||(A=document.createElement("canvas"),document.body.appendChild(A));if(A&&A.getContext){window.c3runtime=this;window.c3canvas=A;var N=this;this.exportType=m.exportType;this.isPreview="preview"===this.exportType;this.isRemotePreview=!!m.isRemotePreview;this.isCrosswalk=/crosswalk/i.test(navigator.userAgent)||/xwalk/i.test(navigator.userAgent)||!("undefined"===typeof window.c2isCrosswalk||!window.c2isCrosswalk);this.isPhoneGap=this.isCordova=
"cordova"===this.exportType;this.isMicrosoftEdge=/edge\//i.test(navigator.userAgent);this.isIE=(/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent)||/iemobile/i.test(navigator.userAgent))&&!this.isMicrosoftEdge;this.isTizen=/tizen/i.test(navigator.userAgent);this.isAndroid=/android/i.test(navigator.userAgent)&&!this.isTizen&&!this.isIE&&!this.isMicrosoftEdge;this.isiPhone=(/iphone/i.test(navigator.userAgent)||/ipod/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge;
this.isiPad=/ipad/i.test(navigator.userAgent);this.isiOS=this.isiPhone||this.isiPad;this.isChrome=(/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge;this.isAmazonWebApp=/amazonwebappplatform/i.test(navigator.userAgent);this.isFirefox=/firefox/i.test(navigator.userAgent);this.isSafari=/safari/i.test(navigator.userAgent)&&!this.isChrome&&!this.isIE&&!this.isMicrosoftEdge;this.isWindows=/windows/i.test(navigator.userAgent);this.isNodeWebkit=
this.isNWjs="nwjs"===this.exportType||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent);this.isArcade="scirra-arcade"===this.exportType;this.isWindows8App=!("undefined"===typeof window.c2isWindows8||!window.c2isWindows8);this.isWindowsPhone8=!("undefined"===typeof window.c2isWindowsPhone8||!window.c2isWindowsPhone8);this.isWindowsPhone81=!("undefined"===typeof window.c2isWindowsPhone81||!window.c2isWindowsPhone81);this.isWindows10="windows-uwp"===this.exportType;this.isWinJS=
this.isWindows8App||this.isWindowsPhone81||this.isWindows10;this.isBlackberry10=!("undefined"===typeof window.c2isBlackberry10||!window.c2isBlackberry10);this.isAndroidStockBrowser=this.isAndroid&&!this.isChrome&&!this.isCrosswalk&&!this.isFirefox&&!this.isAmazonWebApp;this.devicePixelRatio=1;this.isMobile=this.isCordova||this.isCrosswalk||this.isAndroid||this.isiOS||this.isWindowsPhone8||this.isWindowsPhone81||this.isBlackberry10||this.isTizen;this.isMobile||(this.isMobile=/(blackberry|bb10|playbook|palm|symbian|nokia|windows\s+ce|phone|mobile|tablet|kindle|silk)/i.test(navigator.userAgent));
this.isWKWebView=!(!this.isiOS||!this.isCordova);this.isPreview&&!this.isNWjs&&("?nw"===window.location.search||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent))&&(this.isNWjs=!0);this.isDebug=this.isPreview&&-1<window.location.search.indexOf("debug");this.useFbInstant="undefined"!==typeof FBInstant&&!this.isPreview&&!this.isCordova;this.hasInitialized=!1;this.canvas=A;this.glwrap=this.gl=null;this.glUnmaskedRenderer="(unavailable)";this.enableFrontToBack=!1;this.earlyz_index=
0;this.ctx=null;this.firstInFullscreen=!1;this.oldHeight=this.oldWidth=0;this.canvas.oncontextmenu=function(G){G.preventDefault&&G.preventDefault();return!1};this.canvas.onselectstart=function(G){G.preventDefault&&G.preventDefault();return!1};this.canvas.ontouchstart=function(G){G.preventDefault&&G.preventDefault();return!1};this.isNWjs&&(window.ondragover=function(G){G.preventDefault();return!1},window.ondrop=function(G){G.preventDefault();return!1},window.nwgui&&window.nwgui.App.clearCache&&window.nwgui.App.clearCache());
if(this.isCordova&&this.isiOS){function G(){var B=document.activeElement;if(!B)return!1;var I=B.tagName.toLowerCase(),M="email number password search tel text url".split(" ");if("textarea"===I)return!0;if("input"===I)return-1<M.indexOf(B.type.toLowerCase()||"text");a:{do{if(B.parentNode&&B.hasAttribute("contenteditable")){B=!0;break a}B=B.parentNode}while(B);B=!1}return B}window.addEventListener("focusout",function(){G()||(document.scrollingElement.scrollTop=0)})}this.projectDataUrl=J||"";this.width=
A.width;this.height=A.height;this.draw_width=this.width;this.draw_height=this.height;this.cssWidth=this.width;this.cssHeight=this.height;this.lastWindowWidth=window.innerWidth;this.lastWindowHeight=window.innerHeight;this.forceCanvasAlpha=!1;this.redraw=!0;this.isSuspended=!1;Date.now||(Date.now=function(){return+new Date});this.plugins=[];this.types={};this.types_lowercase={};this.types_by_index=[];this.behaviors=[];this.layouts={};this.layouts_by_index=[];this.eventsheets={};this.eventsheets_by_index=
[];this.wait_for_textures=[];this.triggers_to_postinit=[];this.all_global_vars=[];this.all_local_vars=[];this.shadowcasterBehavior=this.jumpthruBehavior=this.solidBehavior=null;this.deathRow={};this.isInClearDeathRow=this.hasPendingInstances=!1;this.isInOnDestroy=0;this.isEndingLayout=this.isRunningEvents=!1;this.createRow=[];this.isLoadingState=!1;this.loadFromSlot=this.saveToSlot="";this.loadFromJson=null;this.lastSaveJson="";this.suspendDrawing=this.signalledContinuousPreview=!1;this.fireOnCreateAfterLoad=
[];this.dt1=this.dt=0;this.minimumFramerate=30;this.cpuutilisation=this.logictime=0;this.timescale=1;this.kahanTime=new cr.KahanAdder;this.wallTime=new cr.KahanAdder;this.gpuTimeEndFrame=this.gpuTimeStartFrame=this.objectcount=this.framecount=this.execcount=this.tickcount_nosave=this.tickcount=this.last_fps_time=this.fps=this.last_tick_time=0;this.gpuCurUtilisation=-1;this.gpuLastUtilisation=0;this.changelayout=null;this.destroycallbacks=[];this.event_stack=[];this.event_stack_index=-1;this.localvar_stack=
[[]];this.trigger_depth=this.localvar_stack_index=0;this.pushEventStack(null);this.loop_stack=[];this.loop_stack_index=-1;this.next_puid=this.next_uid=0;this.layout_first_tick=!0;this.family_count=0;this.suspend_events=[];this.timeout_id=this.raf_id=-1;this.isloading=!0;this.stackLocalCount=this.loadingprogress=0;this.audioInstance=null;this.isInUserInputEvent=this.had_a_click=!1;this.objects_to_pretick=new cr.ObjectSet;this.objects_to_tick=new cr.ObjectSet;this.objects_to_tick2=new cr.ObjectSet;
this.registered_collisions=[];this.temp_poly=new cr.CollisionPoly([]);this.temp_poly2=new cr.CollisionPoly([]);this.allGroups=[];this.groups_by_name={};this.cndsBySid={};this.actsBySid={};this.varsBySid={};this.blocksBySid={};this.layout_ctx=this.layout_canvas=this.layout_tex=this.layer_tex=this.layer_ctx=this.layer_canvas=this.running_layout=null;this.uses_background_blending=this.is_WebGL_context_lost=!1;this.fx_tex=[null,null];this.fullscreen_scaling=0;this.files_subfolder="";this.objectsByUid=
{};this.webFontNames=this.loaderlogos=null;this.enhancedAccelerationPrecision=!0;this.snapshotCanvas=null;this.snapshotData="";this.objectRefTable=[];"html5"===this.exportType&&"file"===location.protocol.substr(0,4)&&alert("Exported games won't work until you upload them. (When running on the file: protocol, browsers block many features from working for security reasons.)");this.useFbInstant?(FBInstant.initializeAsync().then(function(){N.requestProjectData()}).catch(function(G){console.warn("[Instant Games] Unable to load: ",
G);N.requestProjectData()}),window.setTimeout(function(){N.hasInitialized||(console.warn("[Instant Games] Initialization timed out after 4 seconds. Continuing with Instant Games disabled."),N.useFbInstant=!1,N.requestProjectData())},4E3)):this.requestProjectData()}}function f(){var m=window.cordova&&window.cordova.plugins&&window.cordova.plugins.permissions;"object"!==typeof m&&Promise.reject("Permission API is not loaded");return Promise.resolve(m)}function k(m){return f().then(function(A){return new Promise(function(J,
N){A.requestPermission(A[m],function(G){J(G.hasPermission)},N)})})}function q(m){return f().then(function(A){return new Promise(function(J,N){A.checkPermission(A[m],function(G){J(G.hasPermission)},N)})})}function v(){try{return!!window.indexedDB}catch(m){return!1}}function n(m){m.target.result.createObjectStore("saves",{keyPath:"slot"})}function e(m,A,J,N){try{var G=indexedDB.open("_C2SaveStates");G.onupgradeneeded=n;G.onerror=N;G.onsuccess=function(B){B=B.target.result;B.onerror=N;B.transaction(["saves"],
"readwrite").objectStore("saves").put({slot:m,data:A}).onsuccess=J}}catch(B){N(B)}}function a(m,A,J){try{var N=indexedDB.open("_C2SaveStates");N.onupgradeneeded=n;N.onerror=J;N.onsuccess=function(G){G=G.target.result;G.onerror=J;var B=G.transaction(["saves"]).objectStore("saves").get(m);B.onsuccess=function(I){B.result?A(B.result.data):A(null)}}}catch(G){J(G)}}function d(){cr.logexport("Reloading for continuous preview");-1<window.location.search.indexOf("continuous")?window.location.reload(!0):window.location+=
"?continuous"}function h(m){var A,J={};for(A in m)!m.hasOwnProperty(A)||m[A]instanceof cr.ObjectSet||m[A]&&"undefined"!==typeof m[A].c2userdata||"spriteCreatedDestroyCallback"!==A&&(J[A]=m[A]);return J}var r=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,w=new Audio,E={"audio/webm; codecs=opus":!!w.canPlayType("audio/webm; codecs=opus"),"audio/ogg; codecs=opus":!!w.canPlayType("audio/ogg; codecs=opus"),
"audio/webm; codecs=vorbis":!!w.canPlayType("audio/webm; codecs=vorbis"),"audio/ogg; codecs=vorbis":!!w.canPlayType("audio/ogg; codecs=vorbis"),"audio/mp4":!!w.canPlayType("audio/mp4"),"audio/mpeg":!!w.canPlayType("audio/mpeg")};w=null;b.prototype.requestProjectData=function(){if(!this.hasInitialized){this.hasInitialized=!0;var m=this;if(this.isWKWebView)this.fetchLocalFileViaCordovaAsText("data.js",function(G){m.loadProject(JSON.parse(G))},function(G){alert("Error fetching data.js")});else{var A=
this.isWindowsPhone8?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;var J=this.projectDataUrl||"data.js";if(this.isWindows8App||this.isWindowsPhone8||this.isWindowsPhone81||this.isWindows10)J="data.json";A.open("GET",J,!0);var N=!1;if("response"in A&&"responseType"in A)try{A.responseType="json",N="json"===A.responseType}catch(G){N=!1}if(!N&&"responseType"in A)try{A.responseType="text"}catch(G){}if("overrideMimeType"in A)try{A.overrideMimeType("application/json; charset=utf-8")}catch(G){}this.isWindowsPhone8?
A.onreadystatechange=function(){4===A.readyState&&m.loadProject(JSON.parse(A.responseText))}:(A.onload=function(){N?m.loadProject(A.response):m.loadProject(JSON.parse(A.responseText))},A.onerror=function(G){cr.logerror("Error requesting "+J+":");cr.logerror(G)});A.send()}}};b.prototype.initRendererAndLoader=function(){var m=this,A,J;this.isRetina=this.useHighDpi&&!this.isAndroidStockBrowser;0===this.fullscreen_mode&&this.isiOS&&(this.isRetina=!1);var N=window.devicePixelRatio||window.webkitDevicePixelRatio||
window.mozDevicePixelRatio||window.msDevicePixelRatio||1;this.devicePixelRatio=this.isRetina?N:1;"object"===typeof window.StatusBar&&window.StatusBar.hide();"object"===typeof window.AndroidFullScreen&&window.AndroidFullScreen.immersiveMode();this.ClearDeathRow();0<this.fullscreen_mode&&this.setSize(window.innerWidth,window.innerHeight,!0);try{if(this.enableWebGL){var G={alpha:!0,depth:!1,antialias:!1,failIfMajorPerformanceCaveat:!0};this.isAndroid||(this.gl=this.canvas.getContext("webgl2",G));this.gl||
(this.gl=this.canvas.getContext("webgl",G)||this.canvas.getContext("experimental-webgl",G))}}catch(W){}if(this.gl){this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2");if(N=this.gl.getExtension("WEBGL_debug_renderer_info"))G=this.gl.getParameter(N.UNMASKED_VENDOR_WEBGL),this.glUnmaskedRenderer=this.gl.getParameter(N.UNMASKED_RENDERER_WEBGL)+" ["+G+"]";this.enableFrontToBack&&(this.glUnmaskedRenderer+=" [front-to-back enabled]");this.overlay_canvas=document.createElement("canvas");this.canvas.parentNode.appendChild(this.overlay_canvas);
this.overlay_canvas.oncontextmenu=function(W){return!1};this.overlay_canvas.onselectstart=function(W){return!1};this.overlay_canvas.width=Math.round(this.cssWidth*this.devicePixelRatio);this.overlay_canvas.height=Math.round(this.cssHeight*this.devicePixelRatio);this.overlay_canvas.style.width=this.cssWidth+"px";this.overlay_canvas.style.height=this.cssHeight+"px";this.overlay_canvas.style.position="absolute";this.overlay_ctx=this.overlay_canvas.getContext("2d");this.glwrap=new cr.GLWrap(this.gl,this.isMobile,
this.enableFrontToBack);this.glwrap.setSize(this.canvas.width,this.canvas.height);this.glwrap.enable_mipmaps=0!==this.downscalingQuality;this.ctx=null;this.canvas.addEventListener("webglcontextlost",function(W){W.preventDefault();m.onContextLost();cr.logexport("[Construct 2] WebGL context lost");window.cr_setSuspended(!0)},!1);this.canvas.addEventListener("webglcontextrestored",function(W){m.glwrap.initState();m.glwrap.setSize(m.glwrap.width,m.glwrap.height,!0);m.layer_tex=null;m.layout_tex=null;
m.fx_tex[0]=null;m.fx_tex[1]=null;m.onContextRestored();m.redraw=!0;cr.logexport("[Construct 2] WebGL context restored");window.cr_setSuspended(!1)},!1);this.glwrap.supportsGpuProfiling()||(this.gpuLastUtilisation=NaN);N=0;for(G=this.types_by_index.length;N<G;N++){var B=this.types_by_index[N];var I=0;for(A=B.effect_types.length;I<A;I++){var M=B.effect_types[I];M.shaderindex=this.glwrap.getShaderIndex(M.id);M.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(M.shaderindex);this.uses_background_blending=
this.uses_background_blending||this.glwrap.programUsesDest(M.shaderindex)}}N=0;for(G=this.layouts_by_index.length;N<G;N++){var Q=this.layouts_by_index[N];I=0;for(A=Q.effect_types.length;I<A;I++)M=Q.effect_types[I],M.shaderindex=this.glwrap.getShaderIndex(M.id),M.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(M.shaderindex);Q.updateActiveEffects();I=0;for(A=Q.layers.length;I<A;I++){var Z=Q.layers[I];B=0;for(J=Z.effect_types.length;B<J;B++)M=Z.effect_types[B],M.shaderindex=this.glwrap.getShaderIndex(M.id),
M.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(M.shaderindex),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(M.shaderindex);Z.updateActiveEffects()}}}else G={alpha:!0},this.ctx=this.canvas.getContext("2d",G),this.ctx.imageSmoothingEnabled=this.linearSampling,this.overlay_ctx=this.overlay_canvas=null,this.gpuLastUtilisation=NaN,this.fullscreenScalingQuality=this.wantFullscreenScalingQuality=!0;this.tickFunc=function(W){m.tick(!1,W)};window==window.top||
this.isWinJS||this.isWindowsPhone8||(document.addEventListener("mousedown",function(){window.focus()},!0),document.addEventListener("touchstart",function(){window.focus()},!0));this.isPreview&&(-1<window.location.search.indexOf("continuous")&&(cr.logexport("Reloading for continuous preview"),this.loadFromSlot="__c2_continuouspreview",this.suspendDrawing=!0),this.pauseOnBlur&&!this.isMobile&&(window.addEventListener("focus",function(){m.setSuspended(!1)}),window.addEventListener("blur",function(){var W=
window.parent;W&&W.document.hasFocus()||m.setSuspended(!0)})));window.addEventListener("blur",function(){m.onWindowBlur()});N=function(W){"mousedown"===W.type&&1===W.button&&W.preventDefault();if(cr.isCanvasInputEvent(W)&&document.activeElement&&document.activeElement!==document.getElementsByTagName("body")[0]&&document.activeElement.blur)try{document.activeElement.blur()}catch(X){}};"undefined"!==typeof PointerEvent?document.addEventListener("pointerdown",N):window.navigator.msPointerEnabled?document.addEventListener("MSPointerDown",
N):document.addEventListener("touchstart",N);document.addEventListener("mousedown",N);0===this.fullscreen_mode&&this.isRetina&&1<this.devicePixelRatio?this.setSize(this.original_width,this.original_height,!0):this.setSize(window.innerWidth,window.innerHeight,!0);this.tryLockOrientation();this.getready();this.go();this.extra={};cr.seal(this)};b.prototype.setSize=function(m,A,J){var N=0,G=0;if(this.lastWindowWidth!==m||this.lastWindowHeight!==A||J){if(this.isiPhone&&this.isCordova&&window.screen){var B=
document.documentElement.style;var I=document.body.style;var M=window.innerWidth<window.innerHeight;var Q=M?window.screen.height:window.screen.width;M=M?window.screen.width:window.screen.height;Q&&M&&(I.height=B.height=Q+"px",I.width=B.width=M+"px")}this.lastWindowWidth=m;this.lastWindowHeight=A;B=this.fullscreen_mode;if((I=(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen)&&!this.isCordova)||0!==this.fullscreen_mode||J)I&&(B=this.fullscreen_scaling),
J=this.devicePixelRatio,4<=B?(5===B&&1!==J&&(m+=1,A+=1),I=this.original_width/this.original_height,m/A>I?(I*=A,5===B?(N=I*J/this.original_width,1<N?N=Math.floor(N):1>N&&(N=1/Math.ceil(1/N)),I=this.original_width*N/J,Q=this.original_height*N/J,N=(m-I)/2,G=(A-Q)/2,m=I,A=Q):(N=(m-I)/2,m=I)):(Q=m/I,5===B?(N=Q*J/this.original_height,1<N?N=Math.floor(N):1>N&&(N=1/Math.ceil(1/N)),I=this.original_width*N/J,Q=this.original_height*N/J,N=(m-I)/2,G=(A-Q)/2,m=I):G=(A-Q)/2,A=Q)):I&&0===B&&(N=Math.floor((m-this.original_width)/
2),G=Math.floor((A-this.original_height)/2),m=this.original_width,A=this.original_height),2>B&&(this.aspect_scale=J),this.cssWidth=Math.round(m),this.cssHeight=Math.round(A),this.width=Math.round(m*J),this.height=Math.round(A*J),this.redraw=!0,this.wantFullscreenScalingQuality?(this.draw_width=this.width,this.draw_height=this.height,this.fullscreenScalingQuality=!0):this.width<this.original_width&&this.height<this.original_height||1===B?(this.draw_width=this.width,this.draw_height=this.height,this.fullscreenScalingQuality=
!0):(this.draw_width=this.original_width,this.draw_height=this.original_height,this.fullscreenScalingQuality=!1,2===B?(I=this.original_width/this.original_height,B=this.lastWindowWidth/this.lastWindowHeight,B<I?this.draw_width=this.draw_height*B:B>I&&(this.draw_height=this.draw_width/B)):3===B&&(I=this.original_width/this.original_height,B=this.lastWindowWidth/this.lastWindowHeight,B>I?this.draw_width=this.draw_height*B:B<I&&(this.draw_height=this.draw_width/B))),this.canvas&&(this.canvas.width=Math.round(m*
J),this.canvas.height=Math.round(A*J),this.isRetina&&(this.canvas.style.width=Math.round(m)+"px",this.canvas.style.height=Math.round(A)+"px"),this.canvas.style.marginLeft=Math.floor(N)+"px",this.canvas.style.marginTop=Math.floor(G)+"px"),this.overlay_canvas&&(this.overlay_canvas.width=Math.round(m*J),this.overlay_canvas.height=Math.round(A*J),this.overlay_canvas.style.width=this.cssWidth+"px",this.overlay_canvas.style.height=this.cssHeight+"px",this.overlay_canvas.style.left=Math.floor(N)+"px",this.overlay_canvas.style.top=
Math.floor(G)+"px"),this.glwrap&&this.glwrap.setSize(Math.round(m*J),Math.round(A*J)),this.ctx&&(this.ctx.imageSmoothingEnabled=this.linearSampling),this.tryLockOrientation(),this.isiPhone&&!this.isCordova&&window.scrollTo(0,0)}};b.prototype.tryLockOrientation=function(){if(this.autoLockOrientation&&0!==this.orientations){var m="portrait";2===this.orientations&&(m="landscape");try{screen.orientation&&screen.orientation.lock?screen.orientation.lock(m).catch(function(){}):screen.lockOrientation?screen.lockOrientation(m):
screen.webkitLockOrientation?screen.webkitLockOrientation(m):screen.mozLockOrientation?screen.mozLockOrientation(m):screen.msLockOrientation&&screen.msLockOrientation(m)}catch(A){console&&console.warn&&console.warn("Failed to lock orientation: ",A)}}};b.prototype.onContextLost=function(){this.glwrap.contextLost();this.is_WebGL_context_lost=!0;var m;var A=0;for(m=this.types_by_index.length;A<m;A++){var J=this.types_by_index[A];if(J.onLostWebGLContext)J.onLostWebGLContext()}};b.prototype.onContextRestored=
function(){this.is_WebGL_context_lost=!1;var m;var A=0;for(m=this.types_by_index.length;A<m;A++){var J=this.types_by_index[A];if(J.onRestoreWebGLContext)J.onRestoreWebGLContext()}};var t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame;b.prototype.setSuspended=function(m){var A;if(m&&!this.isSuspended)for(cr.logexport("[Construct 2] Suspending"),this.isSuspended=!0,-1!==this.raf_id&&t(this.raf_id),
-1!==this.timeout_id&&clearTimeout(this.timeout_id),m=0,A=this.suspend_events.length;m<A;m++)this.suspend_events[m](!0);else if(!m&&this.isSuspended){cr.logexport("[Construct 2] Resuming");this.isSuspended=!1;this.last_tick_time=cr.performance_now();this.last_fps_time=cr.performance_now();m=this.logictime=this.framecount=0;for(A=this.suspend_events.length;m<A;m++)this.suspend_events[m](!1);this.tick(!1)}};b.prototype.addSuspendCallback=function(m){this.suspend_events.push(m)};b.prototype.GetObjectReference=
function(m){return this.objectRefTable[m]};b.prototype.loadProject=function(m){m&&m.project||cr.logerror("Project model unavailable");m=m.project;this.name=m[0];this.first_layout=m[1];this.fullscreen_mode=m[12];this.fullscreen_mode_set=m[12];this.original_width=m[10];this.original_height=m[11];this.parallax_x_origin=this.original_width/2;this.parallax_y_origin=this.original_height/2;this.uses_loader_layout=m[18];this.loaderstyle=m[19];this.iconsFolder=m[28];this.webFontNames=m[29].map(function(ja){return ja[0]});
if(0===this.loaderstyle){var A=new Image;A.crossOrigin="anonymous";var J=this.loaderlogos={logo:A};A.addEventListener("error",function(){J.logo=null});var N=m[39];N=this.isPreview?this.getProjectFileUrl(N):this.iconsFolder+N;this.setImageSrc(A,N)}else if(4===this.loaderstyle){A=new Image;A.src="splash-images/splash-logo.svg";N=new Image;N.src="splash-images/splash-poweredby-512.png";var G=new Image;G.src="splash-images/splash-poweredby-256.png";var B=new Image;B.src="splash-images/splash-poweredby-128.png";
var I=new Image;I.src="splash-images/splash-website-512.png";var M=new Image;M.src="splash-images/splash-website-256.png";var Q=new Image;Q.src="splash-images/splash-website-128.png";this.loaderlogos={logo:A,powered:[N,G,B],website:[I,M,Q]}}this.next_uid=m[21];this.objectRefTable=cr.getObjectRefTable();this.system=new cr.system_object(this);A=0;for(N=m[2].length;A<N;A++){Q=m[2][A];G=this.GetObjectReference(Q[0]);cr.add_common_aces(Q,G.prototype);var Z=new G(this);Z.singleglobal=Q[1];Z.is_world=Q[2];
Z.is_rotatable=Q[5];Z.must_predraw=Q[9];if(Z.onCreate)Z.onCreate();cr.seal(Z);this.plugins.push(Z)}this.objectRefTable=cr.getObjectRefTable();A=0;for(N=m[3].length;A<N;A++){Q=m[3][A];I=this.GetObjectReference(Q[1]);Z=null;G=0;for(B=this.plugins.length;G<B;G++)if(this.plugins[G]instanceof I){Z=this.plugins[G];break}var W=new Z.Type(Z);W.name=Q[0];W.is_family=Q[2];W.instvar_sids=Q[3].slice(0);W.vars_count=Q[3].length;W.behs_count=Q[4];W.fx_count=Q[5];W.sid=Q[11];W.is_family?(W.members=[],W.family_index=
this.family_count++,W.families=null):(W.members=null,W.family_index=-1,W.families=[]);W.family_var_map=null;W.family_beh_map=null;W.family_fx_map=null;W.is_contained=!1;W.container=null;Q[6]?(W.texture_file=Q[6][0],W.texture_filesize=Q[6][1],W.texture_pixelformat=Q[6][2],W.texture_data=Q[6]):(W.texture_file=null,W.texture_filesize=0,W.texture_pixelformat=0,W.texture_data=null);W.animations=Q[7]?Q[7]:null;W.index=A;W.instances=[];W.deadCache=[];W.solstack=[new cr.selection(W)];W.cur_sol=0;W.default_instance=
null;W.default_layerindex=0;W.stale_iids=!0;W.updateIIDs=cr.type_updateIIDs;W.getFirstPicked=cr.type_getFirstPicked;W.getPairedInstance=cr.type_getPairedInstance;W.getCurrentSol=cr.type_getCurrentSol;W.pushCleanSol=cr.type_pushCleanSol;W.pushCopySol=cr.type_pushCopySol;W.popSol=cr.type_popSol;W.getBehaviorByName=cr.type_getBehaviorByName;W.getBehaviorIndexByName=cr.type_getBehaviorIndexByName;W.getEffectIndexByName=cr.type_getEffectIndexByName;W.applySolToContainer=cr.type_applySolToContainer;W.getInstanceByIID=
cr.type_getInstanceByIID;W.collision_grid=new cr.SparseGrid(this.original_width,this.original_height);W.any_cell_changed=!0;W.any_instance_parallaxed=!1;W.extra={};W.toString=cr.type_toString;W.behaviors=[];G=0;for(B=Q[8].length;G<B;G++){var X=Q[8][G];var ba=this.GetObjectReference(X[1]),da=null;I=0;for(M=this.behaviors.length;I<M;I++)if(this.behaviors[I]instanceof ba){da=this.behaviors[I];break}if(!da){da=new ba(this);da.my_types=[];da.my_instances=new cr.ObjectSet;if(da.onCreate)da.onCreate();cr.seal(da);
this.behaviors.push(da);cr.behaviors.solid&&da instanceof cr.behaviors.solid&&(this.solidBehavior=da);cr.behaviors.jumpthru&&da instanceof cr.behaviors.jumpthru&&(this.jumpthruBehavior=da);cr.behaviors.shadowcaster&&da instanceof cr.behaviors.shadowcaster&&(this.shadowcasterBehavior=da)}-1===da.my_types.indexOf(W)&&da.my_types.push(W);I=new da.Type(da,W);I.name=X[0];I.sid=X[2];I.onCreate();cr.seal(I);W.behaviors.push(I)}W.global=Q[9];W.isOnLoaderLayout=Q[10];W.effect_types=[];G=0;for(B=Q[12].length;G<
B;G++)W.effect_types.push({id:Q[12][G][0],name:Q[12][G][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:G});G=Q[13];W.tile_poly_data=G?G[0]:null;if(!this.uses_loader_layout||W.is_family||W.isOnLoaderLayout||!Z.is_world)W.onCreate(),cr.seal(W);W.name&&(this.types[W.name]=W,this.types_lowercase[W.name.toLowerCase()]=W);this.types_by_index.push(W);Z.singleglobal&&(G=new Z.Instance(W),G.uid=this.next_uid++,G.puid=this.next_puid++,G.iid=0,G.get_iid=cr.inst_get_iid,G.toString=cr.inst_toString,
G.properties=Q[16],G.onCreate(),cr.seal(G),W.instances.push(G),this.objectsByUid[G.uid.toString()]=G)}A=0;for(N=m[4].length;A<N;A++)for(I=m[4][A],M=this.types_by_index[I[0]],G=1,B=I.length;G<B;G++)Q=this.types_by_index[I[G]],Q.families.push(M),M.members.push(Q);A=0;for(N=m[27].length;A<N;A++){I=m[27][A];M=[];G=0;for(B=I.length;G<B;G++)M.push(this.types_by_index[I[G]]);G=0;for(B=M.length;G<B;G++)M[G].is_contained=!0,M[G].container=M}if(0<this.family_count)for(A=0,N=this.types_by_index.length;A<N;A++)if(Q=
this.types_by_index[A],!Q.is_family&&Q.families.length){Q.family_var_map=Array(this.family_count);Q.family_beh_map=Array(this.family_count);Q.family_fx_map=Array(this.family_count);W=[];G=da=ba=X=0;for(B=Q.families.length;G<B;G++)for(Z=Q.families[G],Q.family_var_map[Z.family_index]=X,X+=Z.vars_count,Q.family_beh_map[Z.family_index]=ba,ba+=Z.behs_count,Q.family_fx_map[Z.family_index]=da,da+=Z.fx_count,I=0,M=Z.effect_types.length;I<M;I++)W.push(cr.shallowCopy({},Z.effect_types[I]));Q.effect_types=W.concat(Q.effect_types);
G=0;for(B=Q.effect_types.length;G<B;G++)Q.effect_types[G].index=G}A=0;for(N=m[5].length;A<N;A++)Q=m[5][A],G=new cr.layout(this,Q),cr.seal(G),this.layouts[G.name]=G,this.layouts_by_index.push(G);A=0;for(N=m[6].length;A<N;A++)Q=m[6][A],G=new cr.eventsheet(this,Q),cr.seal(G),this.eventsheets[G.name]=G,this.eventsheets_by_index.push(G);A=0;for(N=this.eventsheets_by_index.length;A<N;A++)this.eventsheets_by_index[A].postInit();A=0;for(N=this.eventsheets_by_index.length;A<N;A++)this.eventsheets_by_index[A].updateDeepIncludes();
A=0;for(N=this.triggers_to_postinit.length;A<N;A++)this.triggers_to_postinit[A].postInit();cr.clearArray(this.triggers_to_postinit);this.audio_files_info=m[7];this.audio_files_map={};A=0;for(N=this.audio_files_info.length;A<N;++A)G=this.audio_files_info[A],this.audio_files_map[G[0]]=G[1];this.files_subfolder=m[8];this.pixel_rounding=m[9];this.aspect_scale=1;this.enableWebGL=m[13];this.linearSampling=m[14];this.clearBackground=m[15];this.versionstr=m[16];this.useHighDpi=m[17];this.orientations=m[20];
this.autoLockOrientation=0<this.orientations;this.pauseOnBlur=m[22];this.fullscreenScalingQuality=this.wantFullscreenScalingQuality=m[23];this.downscalingQuality=m[24];this.preloadSounds=m[25];this.enableFrontToBack=m[26]&&!this.isIE;this.enhancedAccelerationPrecision=m[30];this.start_time=Date.now();cr.clearArray(this.objectRefTable);this.preloadSounds||E["audio/webm; codecs=opus"]||!window.OpusDecoder||window.OpusDecoder.Initialise();this.initRendererAndLoader()};var p=!1;b.prototype.waitForImageLoad=
function(m,A){window.cr_remotePreviewImageFiles&&A&&"blob:"!==A.substr(0,5)&&(A=window.cr_remotePreviewImageFiles[A]);m.onerror=function(J){p=m.c2error=!0;console&&console.error&&console.error("Error loading image '"+m.src+"': ",J)};m.src||("undefined"!==typeof XAPKReader?XAPKReader.get(A,function(J){m.src=J},function(J){p=m.c2error=!0;console&&console.error&&console.error("Error extracting image '"+A+"' from expansion file: ",J)}):(m.crossOrigin="anonymous",this.setImageSrc(m,A)));this.wait_for_textures.push(m)};
b.prototype.findWaitingTexture=function(m){var A;var J=0;for(A=this.wait_for_textures.length;J<A;J++)if(this.wait_for_textures[J].cr_src===m)return this.wait_for_textures[J];return null};var x=0,C=!1;b.prototype.getready=function(){if(this.audioInstance&&this.preloadSounds){var m=[],A;var J=0;for(A=this.audio_files_info.length;J<A;++J){var N=this.audio_files_info[J];var G=N[0];var B=N[2];(N=this.getPreferredAudioFile(G))&&!B&&m.push({filename:G+N[1],size:N[2],type:N[0]})}x=this.audioInstance.setPreloadList(m)}};
b.prototype.areAllTexturesAndSoundsLoaded=function(){var m=x,A=0,J=!0,N;var G=0;for(N=this.wait_for_textures.length;G<N;G++){var B=this.wait_for_textures[G];var I=B.cr_filesize;if(!I||0>=I)I=5E4;m+=I;B.src&&B.complete&&!B.c2error?A+=I:J=!1}J&&this.preloadSounds&&this.audioInstance&&(C||(this.audioInstance.startPreloads(),C=!0),G=this.audioInstance.getPreloadedSize(),A+=G,G<x&&(J=!1));this.progress=0==m?1:A/m;return J};var z=!1;b.prototype.go=function(){if(this.ctx||this.glwrap){var m=this.ctx||this.overlay_ctx;
if(0<this.fullscreen_mode){var A=window.innerWidth,J=window.innerHeight;this.lastWindowWidth===A&&this.lastWindowHeight===J||this.setSize(A,J)}this.progress=0;this.last_progress=-1;var N=this;if(this.areAllTexturesAndSoundsLoaded()&&(4!==this.loaderstyle||z))this.useFbInstant?FBInstant.startGameAsync().then(function(){N.go_loading_finished()}):this.go_loading_finished();else{this.useFbInstant&&FBInstant.setLoadingProgress(100*this.progress);J=Date.now()-this.start_time;if(m){var G=this.width,B=this.height;
A=this.devicePixelRatio;if(3>this.loaderstyle&&500<=J&&this.last_progress!=this.progress){m.clearRect(0,0,G,B);J=G/2;B/=2;G=0===this.loaderstyle&&this.loaderlogos.logo&&this.loaderlogos.logo.complete;var I=40*A,M=0,Q=80*A;if(G){var Z=this.loaderlogos.logo;Q=Z.width*A;var W=Z.height*A;I=Q/2;M=W/2;m.drawImage(Z,cr.floor(J-I),cr.floor(B-M),Q,W)}1>=this.loaderstyle?(B+=M+(G?12*A:0),J=cr.floor(J-I)+.5,B=cr.floor(B)+.5,m.fillStyle=p?"red":"DodgerBlue",m.fillRect(J,B,Math.floor(Q*this.progress),6*A),m.strokeStyle=
"black",m.strokeRect(J,B,Q,6*A),m.strokeStyle="white",m.strokeRect(J-1*A,B-1*A,Q+2*A,8*A)):2===this.loaderstyle&&(m.font="12pt Arial",m.fillStyle=p?"#f00":"#999",m.textBaseLine="middle",A=Math.round(100*this.progress)+"%",G=m.measureText?m.measureText(A):null,m.fillText(A,J-(G?G.width:0)/2,B));this.last_progress=this.progress}else if(4===this.loaderstyle){this.draw_c3_splash_loader(m);r?r(function(){N.go()}):setTimeout(function(){N.go()},16);return}}setTimeout(function(){N.go()},100)}}};var K=-1,
S=!0,L=!1,R=0,F=0,g=null,l=null,u=0;b.prototype.draw_c3_splash_loader=function(m){if(!z){var A=this.isPreview||this.useFbInstant,J=A?0:200,N=A?0:3E3,G=Math.ceil(this.width),B=Math.ceil(this.height),I=this.loaderlogos.logo,M=this.loaderlogos.powered,Q=this.loaderlogos.website;if(I.complete){for(var Z=0;3>Z;++Z)if(!M[Z].complete||!Q[Z].complete)return;0===u&&(K=Date.now());Z=Date.now();var W=!1,X=m;S||L?(m.clearRect(0,0,G,B),g&&g.width===G&&g.height===B||(g=document.createElement("canvas"),g.width=
G,g.height=B,l=g.getContext("2d")),X=l,W=!0,S&&1===u&&(K=Date.now())):m.globalAlpha=1;X.fillStyle="#3B4045";X.fillRect(0,0,G,B);try{if(256<this.cssHeight){var ba=1.5*cr.clamp(.22*B,105,.6*G);var da=ba/8;X.drawImage(128>=ba?M[2]:256>=ba?M[1]:M[0],.5*G-ba/2,.2*B-da/2,ba,da);da=ba=Math.min(.395*B,.95*G);X.drawImage(I,.5*G-ba/2,.485*B-da/2,ba,da);ba=1.5*cr.clamp(.22*B,105,.6*G);da=ba/8;X.drawImage(128>=ba?Q[2]:256>=ba?Q[1]:Q[0],.5*G-ba/2,.868*B-da/2,ba,da);X.fillStyle="#4D565D";ba=G;da=Math.max(.005*
B,2);X.fillRect(0,.8*B-da/2,ba,da);X.fillStyle=p?"red":"#29F3D0";ba=G*this.progress;X.fillRect(.5*G-ba/2,.8*B-da/2,ba,da)}else da=ba=.55*B,X.drawImage(I,.5*G-ba/2,.45*B-da/2,ba,da),X.fillStyle="#4D565D",ba=G,da=Math.max(.005*B,2),X.fillRect(0,.85*B-da/2,ba,da),X.fillStyle=p?"red":"#29F3D0",ba=G*this.progress,X.fillRect(.5*G-ba/2,.85*B-da/2,ba,da);W&&(S?m.globalAlpha=0===u?0:Math.min((Z-K)/300,1):L&&(m.globalAlpha=Math.max(1-(Z-F)/300,0)),m.drawImage(g,0,0,G,B))}catch(ja){}S&&300<=Z-K&&2<=u&&(S=!1,
R=Z);!S&&Z-R>=N&&!L&&1<=this.progress&&(L=!0,F=Z);if(L&&Z-F>=300+J||A&&1<=this.progress&&500>Date.now()-K)z=!0,L=S=!1,this.loaderlogos=l=g=null;++u}}};b.prototype.go_loading_finished=function(){if(this.webFontNames.length&&document.fonts&&document.fonts.load){var m=this;Promise.all(this.webFontNames.map(function(A){return document.fonts.load("1em '"+A+"'")})).then(function(){m.start_first_layout()})}else this.start_first_layout()};b.prototype.start_first_layout=function(){this.overlay_canvas&&(this.canvas.parentNode.removeChild(this.overlay_canvas),
this.overlay_canvas=this.overlay_ctx=null);this.start_time=Date.now();this.last_fps_time=cr.performance_now();var m;if(this.uses_loader_layout){var A=0;for(m=this.types_by_index.length;A<m;A++){var J=this.types_by_index[A];J.is_family||J.isOnLoaderLayout||!J.plugin.is_world||(J.onCreate(),cr.seal(J))}}else this.isloading=!1;A=0;for(m=this.layouts_by_index.length;A<m;A++)this.layouts_by_index[A].createGlobalNonWorlds();2<=this.fullscreen_mode&&(A=this.original_width/this.original_height,m=this.width/
this.height,this.aspect_scale=2!==this.fullscreen_mode&&m>A||2===this.fullscreen_mode&&m<A?this.height/this.original_height:this.width/this.original_width);A=0;for(m=this.types_by_index.length;A<m;A++)if(J=this.types_by_index[A],J.onBeforeAppBegin)J.onBeforeAppBegin();this.first_layout?this.layouts[this.first_layout].startRunning():this.layouts_by_index[0].startRunning();this.uses_loader_layout||(this.loadingprogress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C3_RegisterSW&&
window.C3_RegisterSW());navigator.splashscreen&&navigator.splashscreen.hide&&navigator.splashscreen.hide();A=0;for(m=this.types_by_index.length;A<m;A++)if(J=this.types_by_index[A],J.onAppBegin)J.onAppBegin();A=function(){document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?window.cr_setSuspended(!0):window.cr_setSuspended(!1)};document.addEventListener("visibilitychange",A,!1);document.addEventListener("mozvisibilitychange",A,!1);document.addEventListener("webkitvisibilitychange",
A,!1);document.addEventListener("msvisibilitychange",A,!1);this.isCordova&&(document.addEventListener("pause",function(){window.cr_setSuspended(!0)}),document.addEventListener("resume",function(){window.cr_setSuspended(!1)}));document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?window.cr_setSuspended(!0):this.tick(!1)};b.prototype.tick=function(m,A,J){if(this.running_layout){var N=cr.performance_now();if(J||!this.isSuspended||m){m||(r?this.raf_id=r(this.tickFunc):this.timeout_id=
setTimeout(this.tickFunc,this.isMobile?1:16));A=A||N;var G=this.fullscreen_mode;(J=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement)&&!this.isCordova)&&0<this.fullscreen_scaling&&(G=this.fullscreen_scaling);if(0<G){G=window.innerWidth;var B=window.innerHeight;this.lastWindowWidth===G&&this.lastWindowHeight===B||this.setSize(G,B)}J?this.firstInFullscreen||(this.firstInFullscreen=!0):this.firstInFullscreen?(this.firstInFullscreen=!1,0===this.fullscreen_mode&&
this.setSize(Math.round(this.oldWidth/this.devicePixelRatio),Math.round(this.oldHeight/this.devicePixelRatio),!0)):(this.oldWidth=this.width,this.oldHeight=this.height);this.isloading&&(J=this.areAllTexturesAndSoundsLoaded(),this.loadingprogress=this.progress,J&&(this.isloading=!1,this.progress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C3_RegisterSW&&window.C3_RegisterSW()));this.logic(A);!this.redraw||this.is_WebGL_context_lost||this.suspendDrawing||m||(this.redraw=
!1,this.glwrap?this.drawGL():this.draw(),this.snapshotCanvas&&(this.canvas&&this.canvas.toDataURL&&(this.snapshotData=this.canvas.toDataURL(this.snapshotCanvas[0],this.snapshotCanvas[1]),window.cr_onSnapshot&&window.cr_onSnapshot(this.snapshotData),this.trigger(cr.system_object.prototype.cnds.OnCanvasSnapshot,null)),this.snapshotCanvas=null));this.hit_breakpoint||(this.tickcount++,this.tickcount_nosave++,this.execcount++,this.framecount++);this.logictime+=cr.performance_now()-N}}};b.prototype.logic=
function(m){var A;1E3<=m-this.last_fps_time&&(this.last_fps_time+=1E3,1E3<=m-this.last_fps_time&&(this.last_fps_time=m),this.fps=this.framecount,this.framecount=0,this.cpuutilisation=Math.min(this.logictime,1E3),this.logictime=0,this.glwrap&&0===this.gpuTimeEndFrame&&(this.gpuTimeEndFrame=this.glwrap.getFrameNumber(),this.gpuCurUtilisation=-1));this.glwrap&&-1===this.gpuCurUtilisation&&this.glwrap.supportsGpuProfiling()&&(this.gpuCurUtilisation=this.glwrap.getFrameRangeTimerResults(this.gpuTimeStartFrame,
this.gpuTimeEndFrame),-1!==this.gpuCurUtilisation&&(this.glwrap.deleteTimerResultsToFrame(this.gpuTimeEndFrame),this.gpuLastUtilisation=Math.min(this.gpuCurUtilisation,1),this.gpuTimeStartFrame=this.gpuTimeEndFrame,this.gpuTimeEndFrame=0));if(0!==this.last_tick_time){var J=m-this.last_tick_time;0>J&&(J=0);this.dt1=J/1E3;.5<this.dt1?this.dt1=0:this.dt1>1/this.minimumFramerate&&(this.dt1=1/this.minimumFramerate)}this.last_tick_time=m;this.dt=this.dt1*this.timescale;this.kahanTime.add(this.dt);this.wallTime.add(this.dt1);
m=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement)&&!this.isCordova;if(2<=this.fullscreen_mode||m&&0<this.fullscreen_scaling){J=this.original_width/this.original_height;var N=this.width/this.height;var G=this.fullscreen_mode;m&&0<this.fullscreen_scaling&&(G=this.fullscreen_scaling);this.aspect_scale=2!==G&&N>J||2===G&&N<J?this.height/this.original_height:this.width/this.original_width;this.running_layout&&(this.running_layout.scrollToX(this.running_layout.scrollX),
this.running_layout.scrollToY(this.running_layout.scrollY))}else this.aspect_scale=this.isRetina?this.devicePixelRatio:1;this.ClearDeathRow();this.isInOnDestroy++;this.system.runWaits();this.isInOnDestroy--;this.ClearDeathRow();this.isInOnDestroy++;N=this.objects_to_pretick.valuesRef();m=0;for(J=N.length;m<J;m++)N[m].pretick();m=0;for(J=this.types_by_index.length;m<J;m++){var B=this.types_by_index[m];if(!B.is_family&&(B.behaviors.length||B.families.length))for(N=0,G=B.instances.length;N<G;N++){var I=
B.instances[N];var M=0;for(A=I.behavior_insts.length;M<A;M++)I.behavior_insts[M].tick()}}m=0;for(J=this.types_by_index.length;m<J;m++)if(B=this.types_by_index[m],!B.is_family&&(B.behaviors.length||B.families.length))for(N=0,G=B.instances.length;N<G;N++)for(I=B.instances[N],M=0,A=I.behavior_insts.length;M<A;M++){var Q=I.behavior_insts[M];Q.posttick&&Q.posttick()}N=this.objects_to_tick.valuesRef();m=0;for(J=N.length;m<J;m++)N[m].tick();this.isInOnDestroy--;this.handleSaveLoad();for(m=0;this.changelayout&&
10>m++;)this.doChangeLayout(this.changelayout);m=0;for(J=this.eventsheets_by_index.length;m<J;m++)this.eventsheets_by_index[m].hasRun=!1;this.running_layout.event_sheet&&this.running_layout.event_sheet.run();cr.clearArray(this.registered_collisions);this.layout_first_tick=!1;this.isInOnDestroy++;m=0;for(J=this.types_by_index.length;m<J;m++)if(B=this.types_by_index[m],!B.is_family&&(B.behaviors.length||B.families.length))for(N=0,G=B.instances.length;N<G;N++)for(I=B.instances[N],M=0,A=I.behavior_insts.length;M<
A;M++)Q=I.behavior_insts[M],Q.tick2&&Q.tick2();N=this.objects_to_tick2.valuesRef();m=0;for(J=N.length;m<J;m++)N[m].tick2();this.isInOnDestroy--};b.prototype.onWindowBlur=function(){var m,A,J;var N=0;for(m=this.types_by_index.length;N<m;N++){var G=this.types_by_index[N];if(!G.is_family){var B=0;for(A=G.instances.length;B<A;B++){var I=G.instances[B];if(I.onWindowBlur)I.onWindowBlur();if(I.behavior_insts){var M=0;for(J=I.behavior_insts.length;M<J;M++){var Q=I.behavior_insts[M];if(Q.onWindowBlur)Q.onWindowBlur()}}}}}};
b.prototype.doChangeLayout=function(m){var A=this.running_layout;this.running_layout.stopRunning();var J;if(this.glwrap){var N=0;for(J=this.types_by_index.length;N<J;N++){var G=this.types_by_index[N];G.is_family||!G.unloadTextures||G.global&&0!==G.instances.length||-1!==m.initial_types.indexOf(G)||G.unloadTextures()}}A==m&&cr.clearArray(this.system.waits);cr.clearArray(this.registered_collisions);this.runLayoutChangeMethods(!0);m.startRunning();this.runLayoutChangeMethods(!1);this.layout_first_tick=
this.redraw=!0;this.ClearDeathRow()};b.prototype.runLayoutChangeMethods=function(m){var A,J,N;var G=0;for(A=this.behaviors.length;G<A;G++){var B=this.behaviors[G];if(m){if(B.onBeforeLayoutChange)B.onBeforeLayoutChange()}else if(B.onLayoutChange)B.onLayoutChange()}G=0;for(A=this.types_by_index.length;G<A;G++)if(B=this.types_by_index[G],B.global||B.plugin.singleglobal){var I=0;for(J=B.instances.length;I<J;I++){var M=B.instances[I];if(m){if(M.onBeforeLayoutChange)M.onBeforeLayoutChange()}else if(M.onLayoutChange)M.onLayoutChange();
if(M.behavior_insts){var Q=0;for(N=M.behavior_insts.length;Q<N;Q++){var Z=M.behavior_insts[Q];if(m){if(Z.onBeforeLayoutChange)Z.onBeforeLayoutChange()}else if(Z.onLayoutChange)Z.onLayoutChange()}}}}};b.prototype.pretickMe=function(m){this.objects_to_pretick.add(m)};b.prototype.unpretickMe=function(m){this.objects_to_pretick.remove(m)};b.prototype.tickMe=function(m){this.objects_to_tick.add(m)};b.prototype.untickMe=function(m){this.objects_to_tick.remove(m)};b.prototype.tick2Me=function(m){this.objects_to_tick2.add(m)};
b.prototype.untick2Me=function(m){this.objects_to_tick2.remove(m)};b.prototype.getDt=function(m){return m&&-1!==m.my_timescale?this.dt1*m.my_timescale:this.dt};b.prototype.draw=function(){this.running_layout.draw(this.ctx)};b.prototype.drawGL=function(){this.enableFrontToBack&&(this.earlyz_index=1,this.running_layout.drawGL_earlyZPass(this.glwrap));this.running_layout.drawGL(this.glwrap);this.glwrap.present()};b.prototype.addDestroyCallback=function(m){m&&this.destroycallbacks.push(m)};b.prototype.removeDestroyCallback=
function(m){cr.arrayFindRemove(this.destroycallbacks,m)};b.prototype.getObjectByUID=function(m){m=m.toString();return this.objectsByUid.hasOwnProperty(m)?this.objectsByUid[m]:null};var c=[];b.prototype.DestroyInstance=function(m){var A;var J=m.type.name;if(this.deathRow.hasOwnProperty(J)){var N=this.deathRow[J];if(N.contains(m))return}else N=c.length?c.pop():new cr.ObjectSet,this.deathRow[J]=N;m.isDestroyed=!0;N.add(m);this.hasPendingInstances=!0;if(m.is_contained)for(J=0,A=m.siblings.length;J<A;J++)this.DestroyInstance(m.siblings[J]);
this.isInClearDeathRow&&N.values_cache.push(m);this.isEndingLayout||(this.isInOnDestroy++,this.trigger(Object.getPrototypeOf(m.type.plugin).cnds.OnDestroyed,m),this.isInOnDestroy--)};b.prototype.ClearDeathRow=function(){if(this.hasPendingInstances){var m,A;this.isInClearDeathRow=!0;var J=0;for(m=this.createRow.length;J<m;++J){var N=this.createRow[J];var G=N.type;G.instances.push(N);var B=0;for(A=G.families.length;B<A;++B)G.families[B].instances.push(N),G.families[B].stale_iids=!0}cr.clearArray(this.createRow);
this.IterateDeathRow();cr.wipe(this.deathRow);this.hasPendingInstances=this.isInClearDeathRow=!1}};b.prototype.IterateDeathRow=function(){for(var m in this.deathRow)this.deathRow.hasOwnProperty(m)&&this.ClearDeathRowForType(this.deathRow[m])};b.prototype.ClearDeathRowForType=function(m){var A=m.valuesRef(),J=A[0].type,N,G;cr.arrayRemoveAllFromObjectSet(J.instances,m);J.stale_iids=!0;0===J.instances.length&&(J.any_instance_parallaxed=!1);var B=0;for(N=J.families.length;B<N;++B){var I=J.families[B];
cr.arrayRemoveAllFromObjectSet(I.instances,m);I.stale_iids=!0}B=0;for(N=this.system.waits.length;B<N;++B){var M=this.system.waits[B];M.sols.hasOwnProperty(J.index)&&cr.arrayRemoveAllFromObjectSet(M.sols[J.index].insts,m);if(!J.is_family){var Q=0;for(G=J.families.length;Q<G;++Q)I=J.families[Q],M.sols.hasOwnProperty(I.index)&&cr.arrayRemoveAllFromObjectSet(M.sols[I.index].insts,m)}}if(M=A[0].layer){if(M.useRenderCells)for(Q=M.instances,B=0,N=Q.length;B<N;++B)G=Q[B],m.contains(G)&&(G.update_bbox(),M.render_grid.update(G,
G.rendercells,null),G.rendercells.set(0,0,-1,-1));cr.arrayRemoveAllFromObjectSet(M.instances,m);M.setZIndicesStaleFrom(0)}for(B=0;B<A.length;++B)this.ClearDeathRowForSingleInstance(A[B],J);m.clear();c.push(m);this.redraw=!0};b.prototype.ClearDeathRowForSingleInstance=function(m,A){var J;var N=0;for(J=this.destroycallbacks.length;N<J;++N)this.destroycallbacks[N](m);m.collcells&&A.collision_grid.update(m,m.collcells,null);(N=m.layer)&&N.removeFromInstanceList(m,!0);if(m.behavior_insts)for(N=0,J=m.behavior_insts.length;N<
J;++N){var G=m.behavior_insts[N];if(G.onDestroy)G.onDestroy();G.behavior.my_instances.remove(m)}this.objects_to_pretick.remove(m);this.objects_to_tick.remove(m);this.objects_to_tick2.remove(m);if(m.onDestroy)m.onDestroy();this.objectsByUid.hasOwnProperty(m.uid.toString())&&delete this.objectsByUid[m.uid.toString()];this.objectcount--;100>A.deadCache.length&&A.deadCache.push(m)};b.prototype.createInstance=function(m,A,J,N){if(m.is_family){var G=cr.floor(Math.random()*m.members.length);return this.createInstance(m.members[G],
A,J,N)}return m.default_instance?this.createInstanceFromInit(m.default_instance,A,!1,J,N,!1):null};var y=[];b.prototype.createInstanceFromInit=function(m,A,J,N,G,B){var I,M;if(!m)return null;var Q=this.types_by_index[m[1]],Z=Q.plugin.is_world;if(this.isloading&&Z&&!Q.isOnLoaderLayout||Z&&!this.glwrap&&11===m[0][11])return null;var W=A;Z||(A=null);if(Q.deadCache.length){var X=Q.deadCache.pop();X.recycled=!0;Q.plugin.Instance.call(X,Q)}else X=new Q.plugin.Instance(Q),X.recycled=!1;!J||B||this.objectsByUid.hasOwnProperty(m[2].toString())?
X.uid=this.next_uid++:X.uid=m[2];this.objectsByUid[X.uid.toString()]=X;X.puid=this.next_puid++;X.iid=Q.instances.length;var ba=0;for(I=this.createRow.length;ba<I;++ba)this.createRow[ba].type===Q&&X.iid++;X.get_iid=cr.inst_get_iid;X.toString=cr.inst_toString;X.isDestroyed=!1;var da=m[3];if(X.recycled)cr.wipe(X.extra);else{X.extra={};if(this.isPreview)for(X.instance_var_names=[],X.instance_var_names.length=da.length,ba=0,I=da.length;ba<I;ba++)X.instance_var_names[ba]=da[ba][1];X.instance_vars=[];X.instance_vars.length=
da.length}ba=0;for(I=da.length;ba<I;ba++)X.instance_vars[ba]=da[ba][0];if(Z){var ja=m[0];X.x=cr.is_undefined(N)?ja[0]:N;X.y=cr.is_undefined(G)?ja[1]:G;X.z=ja[2];X.width=ja[3];X.height=ja[4];X.depth=ja[5];X.angle=ja[6];X.opacity=ja[7];X.hotspotX=ja[8];X.hotspotY=ja[9];X.blend_mode=ja[10];ba=ja[11];!this.glwrap&&Q.effect_types.length&&(X.blend_mode=ba);X.compositeOp=cr.effectToCompositeOp(X.blend_mode);this.gl&&cr.setGLBlend(X,X.blend_mode,this.gl);if(X.recycled){ba=0;for(I=ja[12].length;ba<I;ba++)for(da=
0,M=ja[12][ba].length;da<M;da++)X.effect_params[ba][da]=ja[12][ba][da],Array.isArray(X.effect_params[ba][da])&&(X.effect_params[ba][da]=X.effect_params[ba][da].slice(0));X.bbox.set(0,0,0,0);X.collcells.set(0,0,-1,-1);X.rendercells.set(0,0,-1,-1);X.bquad.set_from_rect(X.bbox);cr.clearArray(X.bbox_changed_callbacks)}else{X.effect_params=ja[12].slice(0);ba=0;for(I=X.effect_params.length;ba<I;ba++)for(X.effect_params[ba]=ja[12][ba].slice(0),da=0,M=X.effect_params[ba].length;da<M;++da)Array.isArray(X.effect_params[ba][da])&&
(X.effect_params[ba][da]=X.effect_params[ba][da].slice(0));X.active_effect_types=[];X.active_effect_flags=[];X.active_effect_flags.length=Q.effect_types.length;X.bbox=new cr.rect(0,0,0,0);X.collcells=new cr.rect(0,0,-1,-1);X.rendercells=new cr.rect(0,0,-1,-1);X.bquad=new cr.quad;X.bbox_changed_callbacks=[];X.set_bbox_changed=cr.set_bbox_changed;X.add_bbox_changed_callback=cr.add_bbox_changed_callback;X.contains_pt=cr.inst_contains_pt;X.update_bbox=cr.update_bbox;X.update_render_cell=cr.update_render_cell;
X.update_collision_cell=cr.update_collision_cell;X.get_zindex=cr.inst_get_zindex}X.tilemap_exists=!1;X.tilemap_width=0;X.tilemap_height=0;X.tilemap_data=null;ja[13]&&(X.tilemap_exists=!0,X.tilemap_width=ja[13][0],X.tilemap_height=ja[13][1],X.tilemap_data=ja[13][2]);ba=0;for(I=Q.effect_types.length;ba<I;ba++)X.active_effect_flags[ba]=!0;X.shaders_preserve_opaqueness=!0;X.updateActiveEffects=cr.inst_updateActiveEffects;X.updateActiveEffects();X.uses_shaders=!!X.active_effect_types.length;X.bbox_changed=
!0;X.cell_changed=!0;Q.any_cell_changed=!0;X.visible=!0;X.my_timescale=-1;X.layer=A;X.zindex=A.instances.length;X.earlyz_index=0;"undefined"===typeof X.collision_poly&&(X.collision_poly=null);this.redraw=X.collisionsEnabled=!0}cr.clearArray(y);ba=0;for(I=Q.families.length;ba<I;ba++)y.push.apply(y,Q.families[ba].behaviors);y.push.apply(y,Q.behaviors);if(X.recycled)for(ba=0,I=y.length;ba<I;ba++){var la=y[ba];var na=X.behavior_insts[ba];na.recycled=!0;la.behavior.Instance.call(na,la,X);ja=m[4][ba];da=
0;for(M=ja.length;da<M;da++)na.properties[da]=ja[da];na.onCreate();la.behavior.my_instances.add(X)}else for(X.behavior_insts=[],ba=0,I=y.length;ba<I;ba++)la=y[ba],na=new la.behavior.Instance(la,X),na.recycled=!1,na.properties=m[4][ba].slice(0),na.onCreate(),cr.seal(na),X.behavior_insts.push(na),la.behavior.my_instances.add(X);ja=m[5];if(X.recycled)for(ba=0,I=ja.length;ba<I;ba++)X.properties[ba]=ja[ba];else X.properties=ja.slice(0);this.createRow.push(X);this.hasPendingInstances=!0;A&&(A.appendToInstanceList(X,
!0),1!==A.parallaxX||1!==A.parallaxY)&&(Q.any_instance_parallaxed=!0);this.objectcount++;if(Q.is_contained){if(X.is_contained=!0,X.recycled?cr.clearArray(X.siblings):X.siblings=[],!J&&!B){ba=0;for(I=Q.container.length;ba<I;ba++)if(Q.container[ba]!==Q){if(!Q.container[ba].default_instance)return null;X.siblings.push(this.createInstanceFromInit(Q.container[ba].default_instance,W,!1,Z?X.x:N,Z?X.y:G,!0))}ba=0;for(I=X.siblings.length;ba<I;ba++)for(X.siblings[ba].siblings.push(X),da=0;da<I;da++)ba!==da&&
X.siblings[ba].siblings.push(X.siblings[da])}}else X.is_contained=!1,X.siblings=null;X.onCreate();X.recycled||cr.seal(X);ba=0;for(I=X.behavior_insts.length;ba<I;ba++)X.behavior_insts[ba].postCreate&&X.behavior_insts[ba].postCreate();return X};b.prototype.getLayerByName=function(m){var A;var J=0;for(A=this.running_layout.layers.length;J<A;J++){var N=this.running_layout.layers[J];if(cr.equals_nocase(N.name,m))return N}return null};b.prototype.getLayerByNumber=function(m){m=cr.floor(m);0>m&&(m=0);m>=
this.running_layout.layers.length&&(m=this.running_layout.layers.length-1);return this.running_layout.layers[m]};b.prototype.getLayer=function(m){return cr.is_number(m)?this.getLayerByNumber(m):this.getLayerByName(m.toString())};b.prototype.clearSol=function(m){var A;var J=0;for(A=m.length;J<A;J++)m[J].getCurrentSol().select_all=!0};b.prototype.pushCleanSol=function(m){var A;var J=0;for(A=m.length;J<A;J++)m[J].pushCleanSol()};b.prototype.pushCopySol=function(m){var A;var J=0;for(A=m.length;J<A;J++)m[J].pushCopySol()};
b.prototype.popSol=function(m){var A;var J=0;for(A=m.length;J<A;J++)m[J].popSol()};b.prototype.updateAllCells=function(m){if(m.any_cell_changed){var A,J=m.instances;var N=0;for(A=J.length;N<A;++N)J[N].update_collision_cell();J=this.createRow;N=0;for(A=J.length;N<A;++N)J[N].type===m&&J[N].update_collision_cell();m.any_cell_changed=!1}};b.prototype.getCollisionCandidates=function(m,A,J,N){var G,B=m?1!==m.parallaxX||1!==m.parallaxY:!1;if(A.is_family)for(m=0,G=A.members.length;m<G;++m){var I=A.members[m];
B||I.any_instance_parallaxed?cr.appendArray(N,I.instances):(this.updateAllCells(I),I.collision_grid.queryRange(J,N))}else B||A.any_instance_parallaxed?cr.appendArray(N,A.instances):(this.updateAllCells(A),A.collision_grid.queryRange(J,N))};b.prototype.getTypesCollisionCandidates=function(m,A,J,N){var G;var B=0;for(G=A.length;B<G;++B)this.getCollisionCandidates(m,A[B],J,N)};b.prototype.getSolidCollisionCandidates=function(m,A,J){var N=this.getSolidBehavior();if(!N)return null;this.getTypesCollisionCandidates(m,
N.my_types,A,J)};b.prototype.getJumpthruCollisionCandidates=function(m,A,J){var N=this.getJumpthruBehavior();if(!N)return null;this.getTypesCollisionCandidates(m,N.my_types,A,J)};b.prototype.testAndSelectCanvasPointOverlap=function(m,A,J,N){var G=m.getCurrentSol(),B,I=this.getCurrentEventStack().current_event.orblock;if(G.select_all){N||(G.select_all=!1,cr.clearArray(G.instances));var M=0;for(B=m.instances.length;M<B;M++){var Q=m.instances[M];Q.update_bbox();var Z=Q.layer.canvasToLayer(A,J,!0);var W=
Q.layer.canvasToLayer(A,J,!1);if(Q.contains_pt(Z,W)){if(N)return!1;G.instances.push(Q)}else I&&G.else_instances.push(Q)}}else{var X=0;var ba=I?G.else_instances:G.instances;M=0;for(B=ba.length;M<B;M++)if(Q=ba[M],Q.update_bbox(),Z=Q.layer.canvasToLayer(A,J,!0),W=Q.layer.canvasToLayer(A,J,!1),Q.contains_pt(Z,W)){if(N)return!1;I?G.instances.push(Q):(G.instances[X]=G.instances[M],X++)}N||(ba.length=X)}m.applySolToContainer();return N?!0:G.hasObjects()};b.prototype.testOverlap=function(m,A){if(!(m&&A&&
m!==A&&m.collisionsEnabled&&A.collisionsEnabled))return!1;m.update_bbox();A.update_bbox();var J=m.layer,N=A.layer,G;if(J===N||J.parallaxX===N.parallaxX&&N.parallaxY===N.parallaxY&&J.scale===N.scale&&J.angle===N.angle&&J.zoomRate===N.zoomRate){if(!m.bbox.intersects_rect(A.bbox)||!m.bquad.intersects_quad(A.bquad)||m.tilemap_exists&&A.tilemap_exists)return!1;if(m.tilemap_exists)return this.testTilemapOverlap(m,A);if(A.tilemap_exists)return this.testTilemapOverlap(A,m);var B=m.collision_poly&&!m.collision_poly.is_empty();
var I=A.collision_poly&&!A.collision_poly.is_empty();if(!B&&!I)return!0;B?(m.collision_poly.cache_poly(m.width,m.height,m.angle),B=m.collision_poly):(this.temp_poly.set_from_quad(m.bquad,m.x,m.y,m.width,m.height),B=this.temp_poly);if(I){A.collision_poly.cache_poly(A.width,A.height,A.angle);var M=A.collision_poly}else this.temp_poly.set_from_quad(A.bquad,A.x,A.y,A.width,A.height),M=this.temp_poly;return B.intersects_poly(M,A.x-m.x,A.y-m.y)}B=m.collision_poly&&!m.collision_poly.is_empty();I=A.collision_poly&&
!A.collision_poly.is_empty();B?(m.collision_poly.cache_poly(m.width,m.height,m.angle),this.temp_poly.set_from_poly(m.collision_poly)):this.temp_poly.set_from_quad(m.bquad,m.x,m.y,m.width,m.height);B=this.temp_poly;I?(A.collision_poly.cache_poly(A.width,A.height,A.angle),this.temp_poly2.set_from_poly(A.collision_poly)):this.temp_poly2.set_from_quad(A.bquad,A.x,A.y,A.width,A.height);M=this.temp_poly2;I=0;for(G=B.pts_count;I<G;I++){var Q=2*I;var Z=Q+1;var W=B.pts_cache[Q];var X=B.pts_cache[Z];B.pts_cache[Q]=
J.layerToCanvas(W+m.x,X+m.y,!0);B.pts_cache[Z]=J.layerToCanvas(W+m.x,X+m.y,!1)}B.update_bbox();I=0;for(G=M.pts_count;I<G;I++)Q=2*I,Z=Q+1,W=M.pts_cache[Q],X=M.pts_cache[Z],M.pts_cache[Q]=N.layerToCanvas(W+A.x,X+A.y,!0),M.pts_cache[Z]=N.layerToCanvas(W+A.x,X+A.y,!1);M.update_bbox();return B.intersects_poly(M,0,0)};var H=new cr.quad,O=new cr.rect(0,0,0,0),U=[];b.prototype.testTilemapOverlap=function(m,A){var J,N=A.bbox,G=m.x,B=m.y;m.getCollisionRectCandidates(N,U);var I=A.collision_poly&&!A.collision_poly.is_empty();
m=0;for(J=U.length;m<J;++m){var M=U[m];var Q=M.rc;if(N.intersects_rect_off(Q,G,B)&&(H.set_from_rect(Q),H.offset(G,B),H.intersects_quad(A.bquad)))if(I)if(A.collision_poly.cache_poly(A.width,A.height,A.angle),M.poly){if(M.poly.intersects_poly(A.collision_poly,A.x-(G+Q.left),A.y-(B+Q.top)))return cr.clearArray(U),!0}else{if(this.temp_poly.set_from_quad(H,0,0,Q.right-Q.left,Q.bottom-Q.top),this.temp_poly.intersects_poly(A.collision_poly,A.x,A.y))return cr.clearArray(U),!0}else if(M.poly){if(this.temp_poly.set_from_quad(A.bquad,
0,0,A.width,A.height),M.poly.intersects_poly(this.temp_poly,-(G+Q.left),-(B+Q.top)))return cr.clearArray(U),!0}else return cr.clearArray(U),!0}cr.clearArray(U);return!1};b.prototype.testRectOverlap=function(m,A){if(!A||!A.collisionsEnabled)return!1;A.update_bbox();if(!A.bbox.intersects_rect(m))return!1;if(A.tilemap_exists){A.getCollisionRectCandidates(m,U);var J,N=A.x,G=A.y;A=0;for(J=U.length;A<J;++A){var B=U[A];var I=B.rc;if(m.intersects_rect_off(I,N,G))if(B.poly){if(this.temp_poly.set_from_rect(m,
0,0),B.poly.intersects_poly(this.temp_poly,-(N+I.left),-(G+I.top)))return cr.clearArray(U),!0}else return cr.clearArray(U),!0}cr.clearArray(U);return!1}H.set_from_rect(m);if(!A.bquad.intersects_quad(H))return!1;if(!A.collision_poly||A.collision_poly.is_empty())return!0;A.collision_poly.cache_poly(A.width,A.height,A.angle);H.offset(-m.left,-m.top);this.temp_poly.set_from_quad(H,0,0,1,1);return A.collision_poly.intersects_poly(this.temp_poly,m.left-A.x,m.top-A.y)};b.prototype.testSegmentOverlap=function(m,
A,J,N,G){if(!G||!G.collisionsEnabled)return!1;G.update_bbox();O.set(cr.min(m,J),cr.min(A,N),cr.max(m,J),cr.max(A,N));if(!G.bbox.intersects_rect(O))return!1;if(G.tilemap_exists){G.getCollisionRectCandidates(O,U);var B,I=G.x,M=G.y;G=0;for(B=U.length;G<B;++G){var Q=U[G];var Z=Q.rc;if(O.intersects_rect_off(Z,I,M)&&(H.set_from_rect(Z),H.offset(I,M),H.intersects_segment(m,A,J,N)))if(Q.poly){if(Q.poly.intersects_segment(I+Z.left,M+Z.top,m,A,J,N))return cr.clearArray(U),!0}else return cr.clearArray(U),!0}cr.clearArray(U);
return!1}if(!G.bquad.intersects_segment(m,A,J,N))return!1;if(!G.collision_poly||G.collision_poly.is_empty())return!0;G.collision_poly.cache_poly(G.width,G.height,G.angle);return G.collision_poly.intersects_segment(G.x,G.y,m,A,J,N)};b.prototype.typeHasBehavior=function(m,A){if(!A)return!1;var J,N;var G=0;for(J=m.behaviors.length;G<J;G++)if(m.behaviors[G].behavior instanceof A)return!0;if(!m.is_family)for(G=0,J=m.families.length;G<J;G++){var B=m.families[G];var I=0;for(N=B.behaviors.length;I<N;I++)if(B.behaviors[I].behavior instanceof
A)return!0}return!1};b.prototype.typeHasNoSaveBehavior=function(m){return this.typeHasBehavior(m,cr.behaviors.NoSave)};b.prototype.typeHasPersistBehavior=function(m){return this.typeHasBehavior(m,cr.behaviors.Persist)};b.prototype.getSolidBehavior=function(){return this.solidBehavior};b.prototype.getJumpthruBehavior=function(){return this.jumpthruBehavior};var Y=[];b.prototype.testOverlapSolid=function(m){var A;m.update_bbox();this.getSolidCollisionCandidates(m.layer,m.bbox,Y);var J=0;for(A=Y.length;J<
A;++J){var N=Y[J];if(N.extra.solidEnabled&&this.testOverlap(m,N))return cr.clearArray(Y),N}cr.clearArray(Y);return null};b.prototype.testRectOverlapSolid=function(m){var A;this.getSolidCollisionCandidates(null,m,Y);var J=0;for(A=Y.length;J<A;++J){var N=Y[J];if(N.extra.solidEnabled&&this.testRectOverlap(m,N))return cr.clearArray(Y),N}cr.clearArray(Y);return null};var aa=[];b.prototype.testOverlapJumpThru=function(m,A){var J=null;A&&(J=aa,cr.clearArray(J));m.update_bbox();this.getJumpthruCollisionCandidates(m.layer,
m.bbox,Y);var N;var G=0;for(N=Y.length;G<N;++G){var B=Y[G];if(B.extra.jumpthruEnabled&&this.testOverlap(m,B))if(A)J.push(B);else return cr.clearArray(Y),B}cr.clearArray(Y);return J};b.prototype.pushOutSolid=function(m,A,J,N,G,B){N=N||50;var I=m.x,M=m.y,Q,Z=null,W=null;for(Q=0;Q<N;Q++)if(m.x=I+A*Q,m.y=M+J*Q,m.set_bbox_changed(),!this.testOverlap(m,Z)&&((Z=this.testOverlapSolid(m))&&(W=Z),!Z&&(G&&(Z=B?this.testOverlap(m,B)?B:null:this.testOverlapJumpThru(m))&&(W=Z),!Z)))return W&&this.pushInFractional(m,
A,J,W,16),!0;m.x=I;m.y=M;m.set_bbox_changed();return!1};b.prototype.pushOutSolidAxis=function(m,A,J,N){N=N||50;var G=m.x,B=m.y,I=null,M=null,Q,Z;for(Q=0;Q<N;++Q)for(Z=0;2>Z;++Z){var W=2*Z-1;m.x=G+A*Q*W;m.y=B+J*Q*W;m.set_bbox_changed();if(!this.testOverlap(m,I))if(I=this.testOverlapSolid(m))M=I;else return M&&this.pushInFractional(m,A*W,J*W,M,16),!0}m.x=G;m.y=B;m.set_bbox_changed();return!1};b.prototype.pushOut=function(m,A,J,N,G){N=N||50;var B=m.x,I=m.y,M;for(M=0;M<N;M++)if(m.x=B+A*M,m.y=I+J*M,m.set_bbox_changed(),
!this.testOverlap(m,G))return!0;m.x=B;m.y=I;m.set_bbox_changed();return!1};b.prototype.pushInFractional=function(m,A,J,N,G){var B=2,I=!1;var M=!1;for(var Q=m.x,Z=m.y;B<=G;)M=1/B,B*=2,m.x+=A*M*(I?1:-1),m.y+=J*M*(I?1:-1),m.set_bbox_changed(),this.testOverlap(m,N)?M=I=!0:(M=I=!1,Q=m.x,Z=m.y);M&&(m.x=Q,m.y=Z,m.set_bbox_changed())};b.prototype.pushOutSolidNearest=function(m,A){A=cr.is_undefined(A)?100:A;var J=0,N=m.x,G=m.y,B=0,I=0,M=0,Q=this.testOverlapSolid(m);if(!Q)return!0;for(;J<=A;){switch(B){case 0:I=
0;M=-1;J++;break;case 1:I=1;M=-1;break;case 2:I=1;M=0;break;case 3:M=I=1;break;case 4:I=0;M=1;break;case 5:I=-1;M=1;break;case 6:I=-1;M=0;break;case 7:M=I=-1}B=(B+1)%8;m.x=cr.floor(N+I*J);m.y=cr.floor(G+M*J);m.set_bbox_changed();if(!this.testOverlap(m,Q)&&(Q=this.testOverlapSolid(m),!Q))return!0}m.x=N;m.y=G;m.set_bbox_changed();return!1};b.prototype.registerCollision=function(m,A){m.collisionsEnabled&&A.collisionsEnabled&&this.registered_collisions.push([m,A])};b.prototype.addRegisteredCollisionCandidates=
function(m,A,J){var N;var G=0;for(N=this.registered_collisions.length;G<N;++G){var B=this.registered_collisions[G];if(B[0]===m)B=B[1];else if(B[1]===m)B=B[0];else continue;if(A.is_family){if(-1===A.members.indexOf(A))continue}else if(B.type!==A)continue;-1===J.indexOf(B)&&J.push(B)}};b.prototype.checkRegisteredCollision=function(m,A){var J;var N=0;for(J=this.registered_collisions.length;N<J;N++){var G=this.registered_collisions[N];if(G[0]===m&&G[1]===A||G[0]===A&&G[1]===m)return!0}return!1};b.prototype.calculateSolidBounceAngle=
function(m,A,J,N){var G=m.x,B=m.y,I=cr.max(10,cr.distanceTo(A,J,G,B)),M=cr.angleTo(A,J,G,B),Q=N||this.testOverlapSolid(m);if(!Q)return cr.clamp_angle(M+cr.PI);var Z=Q,W,X=cr.to_radians(5);for(W=1;36>W;W++){var ba=M-W*X;m.x=A+Math.cos(ba)*I;m.y=J+Math.sin(ba)*I;m.set_bbox_changed();if(!this.testOverlap(m,Z)&&(Z=N?null:this.testOverlapSolid(m),!Z)){var da=ba;break}}36===W&&(da=cr.clamp_angle(M+cr.PI));Z=Q;for(W=1;36>W;W++)if(ba=M+W*X,m.x=A+Math.cos(ba)*I,m.y=J+Math.sin(ba)*I,m.set_bbox_changed(),!this.testOverlap(m,
Z)&&(Z=N?null:this.testOverlapSolid(m),!Z)){var ja=ba;break}36===W&&(ja=cr.clamp_angle(M+cr.PI));m.x=G;m.y=B;m.set_bbox_changed();if(ja===da)return ja;m=cr.angleDiff(ja,da)/2;m=cr.angleClockwise(ja,da)?cr.clamp_angle(da+m+cr.PI):cr.clamp_angle(ja+m);da=Math.cos(M);M=Math.sin(M);ja=Math.cos(m);m=Math.sin(m);A=da*ja+M*m;return cr.angleTo(0,0,da-2*A*ja,M-2*A*m)};var ca=-1;b.prototype.trigger=function(m,A,J){if(!this.running_layout)return!1;var N=this.running_layout.event_sheet;if(!N)return!1;var G=!1,
B;ca++;var I=N.deep_includes;var M=0;for(B=I.length;M<B;++M){var Q=this.triggerOnSheet(m,A,I[M],J);G=G||Q}Q=this.triggerOnSheet(m,A,N,J);ca--;return G||Q};b.prototype.triggerOnSheet=function(m,A,J,N){var G=!1,B;if(A){var I=this.triggerOnSheetForTypeName(m,A,A.type.name,J,N);G=G||I;var M=A.type.families;var Q=0;for(B=M.length;Q<B;++Q)I=this.triggerOnSheetForTypeName(m,A,M[Q].name,J,N),G=G||I}else I=this.triggerOnSheetForTypeName(m,A,"system",J,N),G=G||I;return G};b.prototype.triggerOnSheetForTypeName=
function(m,A,J,N,G){var B,I=!1;var M="undefined"!==typeof G;var Q=(M?N.fasttriggers:N.triggers)[J];if(!Q)return I;var Z=null;N=0;for(B=Q.length;N<B;++N)if(Q[N].method==m){Z=Q[N].evs;break}if(!Z)return I;m=M?Z[G]:Z;if(!m)return null;N=0;for(B=m.length;N<B;N++)G=m[N][0],M=m[N][1],G=this.executeSingleTrigger(A,J,G,M),I=I||G;return I};b.prototype.executeSingleTrigger=function(m,A,J,N){var G,B=!1;this.trigger_depth++;var I=this.getCurrentEventStack().current_event;I&&this.pushCleanSol(I.solModifiersIncludingParents);
var M=1<this.trigger_depth;this.pushCleanSol(J.solModifiersIncludingParents);M&&this.pushLocalVarStack();var Q=this.pushEventStack(J);Q.current_event=J;if(m){var Z=this.types[A].getCurrentSol();Z.select_all=!1;cr.clearArray(Z.instances);Z.instances[0]=m;this.types[A].applySolToContainer()}m=!0;if(J.parent){A=Q.temp_parents_arr;for(Z=J.parent;Z;)A.push(Z),Z=Z.parent;A.reverse();Z=0;for(G=A.length;Z<G;Z++)if(!A[Z].run_pretrigger()){m=!1;break}}m&&(this.execcount++,J.orblock?J.run_orblocktrigger(N):
J.run(),B=B||Q.last_event_true);this.popEventStack();M&&this.popLocalVarStack();this.popSol(J.solModifiersIncludingParents);I&&this.popSol(I.solModifiersIncludingParents);this.hasPendingInstances&&0===this.isInOnDestroy&&0===ca&&!this.isRunningEvents&&this.ClearDeathRow();this.trigger_depth--;return B};b.prototype.getCurrentCondition=function(){var m=this.getCurrentEventStack();return m.current_event.conditions[m.cndindex]};b.prototype.getCurrentConditionObjectType=function(){return this.getCurrentCondition().type};
b.prototype.isCurrentConditionFirst=function(){return 0===this.getCurrentEventStack().cndindex};b.prototype.getCurrentAction=function(){var m=this.getCurrentEventStack();return m.current_event.actions[m.actindex]};b.prototype.pushLocalVarStack=function(){this.localvar_stack_index++;this.localvar_stack_index>=this.localvar_stack.length&&this.localvar_stack.push([])};b.prototype.popLocalVarStack=function(){this.localvar_stack_index--};b.prototype.getCurrentLocalVarStack=function(){return this.localvar_stack[this.localvar_stack_index]};
b.prototype.pushEventStack=function(m){this.event_stack_index++;this.event_stack_index>=this.event_stack.length&&this.event_stack.push(new cr.eventStackFrame);var A=this.getCurrentEventStack();A.reset(m);return A};b.prototype.popEventStack=function(){this.event_stack_index--};b.prototype.getCurrentEventStack=function(){return this.event_stack[this.event_stack_index]};b.prototype.pushLoopStack=function(m){this.loop_stack_index++;this.loop_stack_index>=this.loop_stack.length&&this.loop_stack.push(cr.seal({name:m,
index:0,stopped:!1}));var A=this.getCurrentLoop();A.name=m;A.index=0;A.stopped=!1;return A};b.prototype.popLoopStack=function(){this.loop_stack_index--};b.prototype.getCurrentLoop=function(){return this.loop_stack[this.loop_stack_index]};b.prototype.getEventVariableByName=function(m,A){for(var J,N,G,B,I;A;){J=0;for(N=A.subevents.length;J<N;J++)if(I=A.subevents[J],I instanceof cr.eventvariable&&cr.equals_nocase(m,I.name))return I;A=A.parent}J=0;for(N=this.eventsheets_by_index.length;J<N;J++)for(B=
this.eventsheets_by_index[J],A=0,G=B.events.length;A<G;A++)if(I=B.events[A],I instanceof cr.eventvariable&&cr.equals_nocase(m,I.name))return I;return null};b.prototype.getLayoutBySid=function(m){var A;var J=0;for(A=this.layouts_by_index.length;J<A;J++)if(this.layouts_by_index[J].sid===m)return this.layouts_by_index[J];return null};b.prototype.getObjectTypeBySid=function(m){var A;var J=0;for(A=this.types_by_index.length;J<A;J++)if(this.types_by_index[J].sid===m)return this.types_by_index[J];return null};
b.prototype.getGroupBySid=function(m){var A;var J=0;for(A=this.allGroups.length;J<A;J++)if(this.allGroups[J].sid===m)return this.allGroups[J];return null};b.prototype.requirePermissions=function(m){return this.getPermissions(m).then(function(A){if(!1===A)return Promise.reject("Permission not granted")})};b.prototype.getPermissions=function(m){return this.isCordova&&this.isAndroid?m.reduce(function(A,J){return A.then(function(N){return!1===N?!1:q(J).then(function(G){return G?!0:k(J)})})},Promise.resolve(!0)):
Promise.resolve(!0)};b.prototype.doCanvasSnapshot=function(m,A){this.snapshotCanvas=[m,A];this.redraw=!0};b.prototype.signalContinuousPreview=function(){this.signalledContinuousPreview=!0};b.prototype.handleSaveLoad=function(){var m=this,A=this.saveToSlot,J=this.lastSaveJson,N=this.loadFromSlot,G=!1;this.signalledContinuousPreview&&(G=!0,A="__c2_continuouspreview",this.signalledContinuousPreview=!1);if(A.length){this.ClearDeathRow();J=this.saveToJSONString();if(v())e(A,J,function(){cr.logexport("Saved state to IndexedDB storage ("+
J.length+" bytes)");m.lastSaveJson=J;m.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null);J=m.lastSaveJson="";G&&d()},function(B){try{localStorage.setItem("__c2save_"+A,J),cr.logexport("Saved state to WebStorage ("+J.length+" bytes)"),m.lastSaveJson=J,m.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),J=m.lastSaveJson="",G&&d()}catch(I){cr.logexport("Failed to save game state: "+B+"; "+I),m.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}});else try{localStorage.setItem("__c2save_"+
A,J),cr.logexport("Saved state to WebStorage ("+J.length+" bytes)"),m.lastSaveJson=J,this.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),J=m.lastSaveJson="",G&&d()}catch(B){cr.logexport("Error saving to WebStorage: "+B),m.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}this.loadFromSlot=this.saveToSlot="";this.loadFromJson=null}if(N.length){if(v())a(N,function(B){B?(m.loadFromJson=B,cr.logexport("Loaded state from IndexedDB storage ("+m.loadFromJson.length+" bytes)")):(m.loadFromJson=
localStorage.getItem("__c2save_"+N)||"",cr.logexport("Loaded state from WebStorage ("+m.loadFromJson.length+" bytes)"));m.suspendDrawing=!1;m.loadFromJson||(m.loadFromJson=null,m.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))},function(B){m.loadFromJson=localStorage.getItem("__c2save_"+N)||"";cr.logexport("Loaded state from WebStorage ("+m.loadFromJson.length+" bytes)");m.suspendDrawing=!1;m.loadFromJson||(m.loadFromJson=null,m.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))});
else{try{this.loadFromJson=localStorage.getItem("__c2save_"+N)||"",cr.logexport("Loaded state from WebStorage ("+this.loadFromJson.length+" bytes)")}catch(B){this.loadFromJson=null}this.suspendDrawing=!1;m.loadFromJson||(m.loadFromJson=null,m.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))}this.saveToSlot=this.loadFromSlot=""}null!==this.loadFromJson&&(this.ClearDeathRow(),this.loadFromJSONString(this.loadFromJson)?(this.lastSaveJson=this.loadFromJson,this.trigger(cr.system_object.prototype.cnds.OnLoadComplete,
null),this.lastSaveJson=""):m.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null),this.loadFromJson=null)};b.prototype.saveToJSONString=function(){var m,A,J,N={c2save:!0,version:1,rt:{time:this.kahanTime.sum,walltime:this.wallTime.sum,timescale:this.timescale,tickcount:this.tickcount,execcount:this.execcount,next_uid:this.next_uid,running_layout:this.running_layout.sid,start_time_offset:Date.now()-this.start_time},types:{},layouts:{},events:{groups:{},cnds:{},acts:{},vars:{}}};var G=0;for(m=
this.types_by_index.length;G<m;G++){var B=this.types_by_index[G];if(!B.is_family&&!this.typeHasNoSaveBehavior(B)){var I={instances:[]};cr.hasAnyOwnProperty(B.extra)&&(I.ex=h(B.extra));var M=0;for(A=B.instances.length;M<A;M++)I.instances.push(this.saveInstanceToJSON(B.instances[M]));N.types[B.sid.toString()]=I}}G=0;for(m=this.layouts_by_index.length;G<m;G++)M=this.layouts_by_index[G],N.layouts[M.sid.toString()]=M.saveToJSON();A=N.events.groups;G=0;for(m=this.allGroups.length;G<m;G++)M=this.allGroups[G],
A[M.sid.toString()]=this.groups_by_name[M.group_name].group_active;m=N.events.cnds;for(J in this.cndsBySid)this.cndsBySid.hasOwnProperty(J)&&(G=this.cndsBySid[J],cr.hasAnyOwnProperty(G.extra)&&(m[J]={ex:h(G.extra)}));m=N.events.acts;for(J in this.actsBySid)this.actsBySid.hasOwnProperty(J)&&(G=this.actsBySid[J],cr.hasAnyOwnProperty(G.extra)&&(m[J]={ex:h(G.extra)}));m=N.events.vars;for(J in this.varsBySid)this.varsBySid.hasOwnProperty(J)&&(G=this.varsBySid[J],G.is_constant||G.parent&&!G.is_static||
(m[J]=G.data));N.system=this.system.saveToJSON();return JSON.stringify(N)};b.prototype.refreshUidMap=function(){var m,A;this.objectsByUid={};var J=0;for(m=this.types_by_index.length;J<m;J++){var N=this.types_by_index[J];if(!N.is_family){var G=0;for(A=N.instances.length;G<A;G++){var B=N.instances[G];this.objectsByUid[B.uid.toString()]=B}}}};b.prototype.loadFromJSONString=function(m){try{var A=JSON.parse(m)}catch(W){return!1}if(!A.c2save||1<A.version)return!1;this.isLoadingState=!0;m=A.rt;this.kahanTime.reset();
this.kahanTime.sum=m.time;this.wallTime.reset();this.wallTime.sum=m.walltime||0;this.timescale=m.timescale;this.tickcount=m.tickcount;this.execcount=m.execcount;this.start_time=Date.now()-m.start_time_offset;var J=m.running_layout;if(J!==this.running_layout.sid)if(J=this.getLayoutBySid(J))this.doChangeLayout(J);else return;var N,G,B;var I=A.types;for(G in I)if(I.hasOwnProperty(G)&&(B=this.getObjectTypeBySid(parseInt(G,10)))&&!B.is_family&&!this.typeHasNoSaveBehavior(B)){I[G].ex?B.extra=I[G].ex:cr.wipe(B.extra);
var M=B.instances;var Q=I[G].instances;J=0;for(N=cr.min(M.length,Q.length);J<N;J++)this.loadInstanceFromJSON(M[J],Q[J]);J=Q.length;for(N=M.length;J<N;J++)this.DestroyInstance(M[J]);J=M.length;for(N=Q.length;J<N;J++){M=null;if(B.plugin.is_world&&(M=this.running_layout.getLayerBySid(Q[J].w.l),!M))continue;M=this.createInstanceFromInit(B.default_instance,M,!1,0,0,!0);this.loadInstanceFromJSON(M,Q[J])}B.stale_iids=!0}this.ClearDeathRow();this.refreshUidMap();N=A.layouts;for(G in N)N.hasOwnProperty(G)&&
(J=this.getLayoutBySid(parseInt(G,10)))&&J.loadFromJSON(N[G]);N=A.events.groups;for(G in N)N.hasOwnProperty(G)&&(J=this.getGroupBySid(parseInt(G,10)))&&this.groups_by_name[J.group_name]&&this.groups_by_name[J.group_name].setGroupActive(N[G]);J=A.events.cnds;for(G in this.cndsBySid)this.cndsBySid.hasOwnProperty(G)&&(J.hasOwnProperty(G)?this.cndsBySid[G].extra=J[G].ex:this.cndsBySid[G].extra={});J=A.events.acts;for(G in this.actsBySid)this.actsBySid.hasOwnProperty(G)&&(J.hasOwnProperty(G)?this.actsBySid[G].extra=
J[G].ex:this.actsBySid[G].extra={});J=A.events.vars;for(G in J)J.hasOwnProperty(G)&&this.varsBySid.hasOwnProperty(G)&&(this.varsBySid[G].data=J[G]);this.next_uid=m.next_uid;this.isLoadingState=!1;J=0;for(N=this.fireOnCreateAfterLoad.length;J<N;++J)M=this.fireOnCreateAfterLoad[J],this.trigger(Object.getPrototypeOf(M.type.plugin).cnds.OnCreated,M);cr.clearArray(this.fireOnCreateAfterLoad);this.system.loadFromJSON(A.system);J=0;for(N=this.types_by_index.length;J<N;J++)if(B=this.types_by_index[J],!B.is_family&&
!this.typeHasNoSaveBehavior(B))for(A=0,G=B.instances.length;A<G;A++){M=B.instances[A];if(B.is_contained)for(I=M.get_iid(),cr.clearArray(M.siblings),m=0,Q=B.container.length;m<Q;m++){var Z=B.container[m];B!==Z&&M.siblings.push(Z.instances[I])}M.afterLoad&&M.afterLoad();if(M.behavior_insts)for(m=0,Q=M.behavior_insts.length;m<Q;m++)I=M.behavior_insts[m],I.afterLoad&&I.afterLoad()}return this.redraw=!0};b.prototype.saveInstanceToJSON=function(m,A){var J;var N=m.type;var G=N.plugin;var B={};A?B.c2=!0:
B.uid=m.uid;cr.hasAnyOwnProperty(m.extra)&&(B.ex=h(m.extra));if(m.instance_vars&&m.instance_vars.length)for(B.ivs={},A=0,J=m.instance_vars.length;A<J;A++)B.ivs[m.type.instvar_sids[A].toString()]=m.instance_vars[A];if(G.is_world){G={x:m.x,y:m.y,w:m.width,h:m.height,l:m.layer.sid,zi:m.get_zindex()};0!==m.angle&&(G.a=m.angle);1!==m.opacity&&(G.o=m.opacity);.5!==m.hotspotX&&(G.hX=m.hotspotX);.5!==m.hotspotY&&(G.hY=m.hotspotY);0!==m.blend_mode&&(G.bm=m.blend_mode);m.visible||(G.v=m.visible);m.collisionsEnabled||
(G.ce=m.collisionsEnabled);-1!==m.my_timescale&&(G.mts=m.my_timescale);if(N.effect_types.length)for(G.fx=[],A=0,J=N.effect_types.length;A<J;A++){var I=N.effect_types[A];G.fx.push({name:I.name,active:m.active_effect_flags[I.index],params:m.effect_params[I.index]})}B.w=G}if(m.behavior_insts&&m.behavior_insts.length)for(B.behs={},A=0,J=m.behavior_insts.length;A<J;A++)N=m.behavior_insts[A],N.saveToJSON&&(B.behs[N.type.sid.toString()]=N.saveToJSON());m.saveToJSON&&(B.data=m.saveToJSON());return B};b.prototype.getInstanceVarIndexBySid=
function(m,A){var J;var N=0;for(J=m.instvar_sids.length;N<J;N++)if(m.instvar_sids[N]===A)return N;return-1};b.prototype.getBehaviorIndexBySid=function(m,A){var J;var N=0;for(J=m.behavior_insts.length;N<J;N++)if(m.behavior_insts[N].type.sid===A)return N;return-1};b.prototype.loadInstanceFromJSON=function(m,A,J){var N,G;var B=m.type;var I=B.plugin;if(J){if(!A.c2)return}else m.uid=A.uid;A.ex?m.extra=A.ex:cr.wipe(m.extra);if(G=A.ivs)for(N in G)if(G.hasOwnProperty(N)){var M=this.getInstanceVarIndexBySid(B,
parseInt(N,10));if(!(0>M||M>=m.instance_vars.length)){var Q=G[N];null===Q&&(Q=NaN);m.instance_vars[M]=Q}}if(I.is_world){M=A.w;m.layer.sid!==M.l&&(G=m.layer,m.layer=this.running_layout.getLayerBySid(M.l),m.layer?(G.removeFromInstanceList(m,!0),m.layer.appendToInstanceList(m,!0),m.set_bbox_changed(),m.layer.setZIndicesStaleFrom(0)):(m.layer=G,J||this.DestroyInstance(m)));m.x=M.x;m.y=M.y;m.width=M.w;m.height=M.h;m.zindex=M.zi;m.angle=M.hasOwnProperty("a")?M.a:0;m.opacity=M.hasOwnProperty("o")?M.o:1;
m.hotspotX=M.hasOwnProperty("hX")?M.hX:.5;m.hotspotY=M.hasOwnProperty("hY")?M.hY:.5;m.visible=M.hasOwnProperty("v")?M.v:!0;m.collisionsEnabled=M.hasOwnProperty("ce")?M.ce:!0;m.my_timescale=M.hasOwnProperty("mts")?M.mts:-1;m.blend_mode=M.hasOwnProperty("bm")?M.bm:0;m.compositeOp=cr.effectToCompositeOp(m.blend_mode);this.gl&&cr.setGLBlend(m,m.blend_mode,this.gl);m.set_bbox_changed();if(M.hasOwnProperty("fx"))for(J=0,G=M.fx.length;J<G;J++)Q=B.getEffectIndexByName(M.fx[J].name),0>Q||(m.active_effect_flags[Q]=
M.fx[J].active,m.effect_params[Q]=M.fx[J].params);m.updateActiveEffects()}if(B=A.behs)for(N in B)B.hasOwnProperty(N)&&(J=this.getBehaviorIndexBySid(m,parseInt(N,10)),0>J||m.behavior_insts[J].loadFromJSON(B[N]));A.data&&m.loadFromJSON(A.data)};b.prototype.getProjectFileUrl=function(m){return this.isPreview?window.cr_previewProjectFiles.hasOwnProperty(m.toLowerCase())?window.cr_previewProjectFiles[m.toLowerCase()]:m:this.files_subfolder+m};b.prototype.getProjectFileBlob=function(m){return this.isPreview?
window.cr_previewProjectFileBlobs&&window.cr_previewProjectFiles.hasOwnProperty(m.toLowerCase())?window.cr_previewProjectFileBlobs[m.toLowerCase()]:null:null};b.prototype.getLocalFileUrl=function(m){return this.isPreview?window.cr_previewProjectFiles.hasOwnProperty(m.toLowerCase())?window.cr_previewProjectFiles[m.toLowerCase()]:m:m};b.prototype.fetchLocalFileViaCordova=function(m,A,J){window.resolveLocalFileSystemURL(window.cordova.file.applicationDirectory+"www/"+m,function(N){N.file(A,J)},J)};b.prototype.fetchLocalFileViaCordovaAsText=
function(m,A,J){this.fetchLocalFileViaCordova(m,function(N){var G=new FileReader;G.onload=function(B){A(B.target.result)};G.onerror=J;G.readAsText(N)},J)};var ha=[],fa=0;b.prototype.maybeStartNextArrayBufferRead=function(){if(ha.length&&!(8<=fa)){fa++;var m=ha.shift();this.doFetchLocalFileViaCordovaAsArrayBuffer(m.filename,m.successCallback,m.errorCallback)}};b.prototype.fetchLocalFileViaCordovaAsArrayBuffer=function(m,A,J){var N=this;ha.push({filename:m,successCallback:function(G){fa--;N.maybeStartNextArrayBufferRead();
A(G)},errorCallback:function(G){fa--;N.maybeStartNextArrayBufferRead();J(G)}});this.maybeStartNextArrayBufferRead()};b.prototype.doFetchLocalFileViaCordovaAsArrayBuffer=function(m,A,J){this.fetchLocalFileViaCordova(m,function(N){var G=new FileReader;G.onload=function(B){A(B.target.result)};G.readAsArrayBuffer(N)},J)};b.prototype.fetchLocalFileViaCordovaAsURL=function(m,A,J){var N="",G=m.toLowerCase(),B=G.substr(G.length-4);G=G.substr(G.length-5);".mp4"===B?N="video/mp4":".webm"===G?N="video/webm":
".m4a"===B?N="audio/mp4":".mp3"===B&&(N="audio/mpeg");this.fetchLocalFileViaCordovaAsArrayBuffer(m,function(I){I=new Blob([I],{type:N});I=URL.createObjectURL(I);A(I)},J)};b.prototype.isAbsoluteUrl=function(m){return/^(?:[a-z]+:)?\/\//.test(m)||"data:"===m.substr(0,5)||"blob:"===m.substr(0,5)};b.prototype.setImageSrc=function(m,A){this.isWKWebView&&!this.isAbsoluteUrl(A)?this.fetchLocalFileViaCordovaAsURL(A,function(J){m.src=J},function(J){alert("Failed to load image: "+J)}):this.isPreview&&!this.isAbsoluteUrl(A)?
m.src=this.getLocalFileUrl(A):(this.isAbsoluteUrl(A)||(A=A.toLowerCase()),m.src=A)};b.prototype.getPreferredAudioFile=function(m){m=m.toLowerCase();if(!this.audio_files_map.hasOwnProperty(m))return null;m=this.audio_files_map[m];var A=null,J;var N=0;for(J=m.length;N<J;++N){var G=m[N];var B=G[0];A||"audio/webm; codecs=opus"!==B||(A=G);if(E[B])return G}return A};b.prototype.getProjectAudioFileUrl=function(m){var A=m.toLowerCase();return(m=this.getPreferredAudioFile(m))?{url:this.getProjectFileUrl(A+
m[1]),type:m[0]}:null};b.prototype.getStatusInfo=function(){return{fps:this.fps,cpu:this.cpuutilisation/1E3,gpu:this.gpuLastUtilisation,layout:this.running_layout?this.running_layout.name:"",renderer:this.glUnmaskedRenderer}};b.prototype.accelerate=function(m,A,J,N,G){return this.enhancedAccelerationPrecision?cr.clamp(m*G+.5*N*G*G,A*G,J*G):m*G};cr.runtime=b;cr.createRuntime=function(m){return new b(m)};window.cr_createRuntime=cr.createRuntime})();
window.cr_getSnapshot=function(b,f){var k=window.c3runtime;k&&k.doCanvasSnapshot(b,f)};window.cr_sizeCanvas=function(b,f){if(0!==b&&0!==f){var k=window.c3runtime;k&&k.setSize(b,f)}};window.cr_setSuspended=function(b){var f=window.c3runtime;f&&f.setSuspended(b)};
(function(){function b(a,d){return a.zindex-d.zindex}function f(a,d){this.layout=a;this.runtime=a.runtime;this.instances=[];this.scale=1;this.angle=0;this.disableAngle=!1;this.tmprect=new cr.rect(0,0,0,0);this.tmpquad=new cr.quad;this.viewBottom=this.viewTop=this.viewRight=this.viewLeft=0;this.zindices_stale=!1;this.zindices_stale_from=-1;this.clear_earlyz_index=0;this.name=d[0];this.index=d[1];this.sid=d[2];this.visible=d[3];this.background_color=d[4];this.transparent=d[5];this.parallaxX=d[6];this.parallaxY=
d[7];this.opacity=d[8];this.forceOwnTexture=d[9];this.useRenderCells=d[10];this.zoomRate=d[11];this.blend_mode=d[12];this.effect_fallback=d[13];this.compositeOp="source-over";this.destBlend=this.srcBlend=0;this.render_grid=null;this.last_render_list=k();this.render_list_stale=!0;this.last_render_cells=new cr.rect(0,0,-1,-1);this.cur_render_cells=new cr.rect(0,0,-1,-1);this.useRenderCells&&(this.render_grid=new cr.RenderGrid(this.runtime.original_width,this.runtime.original_height));this.render_offscreen=
!1;a=d[14];var h;this.startup_initial_instances=[];this.initial_instances=[];this.created_globals=[];var r=0;for(h=a.length;r<h;r++){var w=a[r],E=this.runtime.types_by_index[w[1]];E.default_instance||(E.default_instance=w,E.default_layerindex=this.index);this.initial_instances.push(w);-1===this.layout.initial_types.indexOf(E)&&this.layout.initial_types.push(E)}cr.shallowAssignArray(this.startup_initial_instances,this.initial_instances);this.effect_types=[];this.active_effect_types=[];this.shaders_preserve_opaqueness=
!0;this.effect_params=[];r=0;for(h=d[15].length;r<h;r++)this.effect_types.push({id:d[15][r][0],name:d[15][r][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:r}),this.effect_params.push(d[15][r][2].slice(0));this.updateActiveEffects();this.rcTexBounce=new cr.rect(0,0,1,1);this.rcTexDest=new cr.rect(0,0,1,1);this.rcTexOrigin=new cr.rect(0,0,1,1)}function k(){return v.length?v.pop():[]}function q(a){cr.clearArray(a);v.push(a)}f.prototype.updateActiveEffects=function(){cr.clearArray(this.active_effect_types);
this.shaders_preserve_opaqueness=!0;var a;var d=0;for(a=this.effect_types.length;d<a;d++){var h=this.effect_types[d];h.active&&(this.active_effect_types.push(h),h.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))}};f.prototype.getEffectByName=function(a){var d;var h=0;for(d=this.effect_types.length;h<d;h++){var r=this.effect_types[h];if(r.name===a)return r}return null};f.prototype.createInitialInstances=function(a){var d,h;var r=d=0;for(h=this.initial_instances.length;d<h;d++){var w=this.initial_instances[d];
var E=this.runtime.types_by_index[w[1]];var t=this.runtime.typeHasPersistBehavior(E);E=!0;if(!t||this.layout.first_visit){w=this.runtime.createInstanceFromInit(w,this,!0);if(!w)continue;a.push(w);w.type.global&&(E=!1,this.created_globals.push(w.uid))}E&&(this.initial_instances[r]=this.initial_instances[d],r++)}this.initial_instances.length=r;this.runtime.ClearDeathRow();!this.runtime.glwrap&&this.effect_types.length&&(this.blend_mode=this.effect_fallback);this.compositeOp=cr.effectToCompositeOp(this.blend_mode);
this.runtime.gl&&cr.setGLBlend(this,this.blend_mode,this.runtime.gl);this.render_list_stale=!0};f.prototype.recreateInitialObjects=function(a,d){var h,r=this.runtime.types_by_index,w=a.is_family,E=a.members;var t=0;for(h=this.initial_instances.length;t<h;++t){var p=this.initial_instances[t];var x=p[0];var C=x[0];x=x[1];if(d.contains_pt(C,x)){C=r[p[1]];if(C!==a)if(w){if(0>E.indexOf(C))continue}else continue;p=this.runtime.createInstanceFromInit(p,this,!1);this.runtime.isInOnDestroy++;this.runtime.trigger(Object.getPrototypeOf(C.plugin).cnds.OnCreated,
p);if(p.is_contained)for(C=0,x=p.siblings.length;C<x;C++){var z=p.siblings[t];this.runtime.trigger(Object.getPrototypeOf(z.type.plugin).cnds.OnCreated,z)}this.runtime.isInOnDestroy--}}};f.prototype.removeFromInstanceList=function(a,d){var h=cr.fastIndexOf(this.instances,a);0>h||(d&&this.useRenderCells&&a.rendercells&&a.rendercells.right>=a.rendercells.left&&(a.update_bbox(),this.render_grid.update(a,a.rendercells,null),a.rendercells.set(0,0,-1,-1)),h===this.instances.length-1?this.instances.pop():
(cr.arrayRemove(this.instances,h),this.setZIndicesStaleFrom(h)),this.render_list_stale=!0)};f.prototype.appendToInstanceList=function(a,d){a.zindex=this.instances.length;this.instances.push(a);d&&this.useRenderCells&&a.rendercells&&a.set_bbox_changed();this.render_list_stale=!0};f.prototype.prependToInstanceList=function(a,d){this.instances.unshift(a);this.setZIndicesStaleFrom(0);d&&this.useRenderCells&&a.rendercells&&a.set_bbox_changed()};f.prototype.moveInstanceAdjacent=function(a,d,h){var r=a.get_zindex();
d=d.get_zindex();cr.arrayRemove(this.instances,r);r<d&&d--;h&&d++;d===this.instances.length?this.instances.push(a):this.instances.splice(d,0,a);this.setZIndicesStaleFrom(r<d?r:d)};f.prototype.setZIndicesStaleFrom=function(a){-1===this.zindices_stale_from?this.zindices_stale_from=a:a<this.zindices_stale_from&&(this.zindices_stale_from=a);this.render_list_stale=this.zindices_stale=!0};f.prototype.updateZIndices=function(){if(this.zindices_stale){-1===this.zindices_stale_from&&(this.zindices_stale_from=
0);var a;if(this.useRenderCells){var d=this.zindices_stale_from;for(a=this.instances.length;d<a;++d){var h=this.instances[d];h.zindex=d;this.render_grid.markRangeChanged(h.rendercells)}}else for(d=this.zindices_stale_from,a=this.instances.length;d<a;++d)this.instances[d].zindex=d;this.zindices_stale=!1;this.zindices_stale_from=-1}};f.prototype.getScale=function(a){return this.getNormalScale()*(this.runtime.fullscreenScalingQuality||a?this.runtime.aspect_scale:1)};f.prototype.getNormalScale=function(){return(this.scale*
this.layout.scale-1)*this.zoomRate+1};f.prototype.getAngle=function(){return this.disableAngle?0:cr.clamp_angle(this.layout.angle+this.angle)};var v=[],n=[],e=[];f.prototype.getRenderCellInstancesToDraw=function(){this.updateZIndices();this.render_grid.queryRange(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom,e);if(!e.length)return k();if(1===e.length){var a=k();cr.shallowAssignArray(a,e[0]);cr.clearArray(e);return a}for(var d=!0;1<e.length;){var h;a=e;var r=d;var w=0;for(h=a.length;w<
h-1;w+=2){var E=a[w];var t=a[w+1];d=k();var p=E,x=t,C=d,z=0,K=0,S=0,L=p.length,R=x.length;for(C.length=L+R;z<L&&K<R;++S){var F=p[z];var g=x[K];F.zindex<g.zindex?(C[S]=F,++z):(C[S]=g,++K)}for(;z<L;++z,++S)C[S]=p[z];for(;K<R;++K,++S)C[S]=x[K];r||(q(E),q(t));n.push(d)}1===h%2&&(r?(E=k(),cr.shallowAssignArray(E,a[h-1]),n.push(E)):n.push(a[h-1]));cr.shallowAssignArray(a,n);cr.clearArray(n);d=!1}a=e[0];cr.clearArray(e);return a};f.prototype.draw=function(a){this.render_offscreen=this.forceOwnTexture||1!==
this.opacity||0!==this.blend_mode;var d=this.runtime.canvas,h=a,r=!1;this.render_offscreen&&(this.runtime.layer_canvas||(this.runtime.layer_canvas=document.createElement("canvas"),d=this.runtime.layer_canvas,d.width=this.runtime.draw_width,d.height=this.runtime.draw_height,this.runtime.layer_ctx=d.getContext("2d"),r=!0),d=this.runtime.layer_canvas,h=this.runtime.layer_ctx,d.width!==this.runtime.draw_width&&(d.width=this.runtime.draw_width,r=!0),d.height!==this.runtime.draw_height&&(d.height=this.runtime.draw_height,
r=!0),r&&(h.imageSmoothingEnabled=this.runtime.linearSampling),this.transparent&&h.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height));h.globalAlpha=1;h.globalCompositeOperation="source-over";this.transparent||(h.fillStyle="rgb("+this.background_color[0]+","+this.background_color[1]+","+this.background_color[2]+")",h.fillRect(0,0,this.runtime.draw_width,this.runtime.draw_height));h.save();this.disableAngle=!0;r=this.canvasToLayer(0,0,!0,!0);var w=this.canvasToLayer(0,0,!1,!0);this.disableAngle=
!1;this.runtime.pixel_rounding&&(r=Math.round(r),w=Math.round(w));this.rotateViewport(r,w,h);var E=this.getScale();h.scale(E,E);h.translate(-r,-w);this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?
(q(this.last_render_list),r=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):r=this.last_render_list):r=this.instances;var t=null;w=0;for(E=r.length;w<E;++w){var p=r[w];p!==t&&(this.drawInstance(p,h),t=p)}this.useRenderCells&&(this.last_render_list=r);h.restore();this.render_offscreen&&(a.globalCompositeOperation=this.compositeOp,a.globalAlpha=this.opacity,a.drawImage(d,0,0))};f.prototype.drawInstance=function(a,d){if(a.visible&&0!==
a.width&&0!==a.height){a.update_bbox();var h=a.bbox;h.right<this.viewLeft||h.bottom<this.viewTop||h.left>this.viewRight||h.top>this.viewBottom||(d.globalCompositeOperation=a.compositeOp,a.draw(d))}};f.prototype.updateViewport=function(a){this.disableAngle=!0;var d=this.canvasToLayer(0,0,!0,!0),h=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1;this.runtime.pixel_rounding&&(d=Math.round(d),h=Math.round(h));this.rotateViewport(d,h,a)};f.prototype.rotateViewport=function(a,d,h){var r=this.getScale();
this.viewLeft=a;this.viewTop=d;this.viewRight=a+1/r*this.runtime.draw_width;this.viewBottom=d+1/r*this.runtime.draw_height;a=this.getAngle();0!==a&&(h&&(h.translate(this.runtime.draw_width/2,this.runtime.draw_height/2),h.rotate(-a),h.translate(this.runtime.draw_width/-2,this.runtime.draw_height/-2)),this.tmprect.set(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom),this.tmprect.offset((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),this.tmpquad.set_from_rotated_rect(this.tmprect,
a),this.tmpquad.bounding_box(this.tmprect),this.tmprect.offset((this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2),this.viewLeft=this.tmprect.left,this.viewTop=this.tmprect.top,this.viewRight=this.tmprect.right,this.viewBottom=this.tmprect.bottom)};f.prototype.drawGL_earlyZPass=function(a){if(this.render_offscreen=this.forceOwnTexture){this.runtime.layer_tex||(this.runtime.layer_tex=a.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling));
if(this.runtime.layer_tex.c2width!==this.runtime.draw_width||this.runtime.layer_tex.c2height!==this.runtime.draw_height)a.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=a.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling);a.setRenderingToTexture(this.runtime.layer_tex)}this.disableAngle=!0;var d=this.canvasToLayer(0,0,!0,!0),h=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1;this.runtime.pixel_rounding&&(d=Math.round(d),h=Math.round(h));
this.rotateViewport(d,h,null);d=this.getScale();a.resetModelView();a.scale(d,d);a.rotateZ(-this.getAngle());a.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2);a.updateModelView();this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),
this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(q(this.last_render_list),d=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):d=this.last_render_list):d=this.instances;var r=null;for(h=d.length-1;0<=h;--h){var w=d[h];w!==r&&(this.drawInstanceGL_earlyZPass(d[h],a),r=w)}this.useRenderCells&&(this.last_render_list=d);this.transparent||(this.clear_earlyz_index=this.runtime.earlyz_index++,a.setEarlyZIndex(this.clear_earlyz_index),
a.setColorFillMode(1,1,1,1),a.fullscreenQuad(),a.restoreEarlyZMode())};f.prototype.drawGL=function(a){if(this.render_offscreen=this.forceOwnTexture||1!==this.opacity||0<this.active_effect_types.length||0!==this.blend_mode){this.runtime.layer_tex||(this.runtime.layer_tex=a.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling));if(this.runtime.layer_tex.c2width!==this.runtime.draw_width||this.runtime.layer_tex.c2height!==this.runtime.draw_height)a.deleteTexture(this.runtime.layer_tex),
this.runtime.layer_tex=a.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling);a.setRenderingToTexture(this.runtime.layer_tex);this.transparent&&a.clear(0,0,0,0)}this.transparent||(this.runtime.enableFrontToBack?(a.setEarlyZIndex(this.clear_earlyz_index),a.setColorFillMode(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1),a.fullscreenQuad(),a.setTextureFillMode()):a.clear(this.background_color[0]/255,this.background_color[1]/
255,this.background_color[2]/255,1));this.disableAngle=!0;var d=this.canvasToLayer(0,0,!0,!0);var h=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1;this.runtime.pixel_rounding&&(d=Math.round(d),h=Math.round(h));this.rotateViewport(d,h,null);d=this.getScale();a.resetModelView();a.scale(d,d);a.rotateZ(-this.getAngle());a.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2);a.updateModelView();this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),
this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(q(this.last_render_list),h=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):h=this.last_render_list):h=this.instances;var r,w=null;if(2.220446049250313E-16<
this.getNormalScale()){var E=0;for(r=h.length;E<r;++E){var t=h[E];t!==w&&(this.drawInstanceGL(h[E],a),w=t)}}this.useRenderCells&&(this.last_render_list=h);this.render_offscreen&&(h=this.active_effect_types.length?this.active_effect_types[0].shaderindex:0,E=this.active_effect_types.length?this.active_effect_types[0].index:0,0===this.active_effect_types.length||1===this.active_effect_types.length&&!a.programUsesCrossSampling(h)&&1===this.opacity?(1===this.active_effect_types.length?(a.switchProgram(h),
a.setProgramParameters(this.layout.getRenderTarget(),1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,0,0,1,1,this.viewLeft,this.viewTop,this.viewRight,this.viewBottom,0,0,1,1,d,this.getAngle(),this.runtime.kahanTime.sum,this.effect_params[E]),a.programIsAnimated(h)&&(this.runtime.redraw=!0)):a.switchProgram(0),a.setRenderingToTexture(this.layout.getRenderTarget()),a.setOpacity(this.opacity),a.setTexture(this.runtime.layer_tex),a.setBlend(this.srcBlend,this.destBlend),a.resetModelView(),
a.updateModelView(),d=this.runtime.draw_width/2,h=this.runtime.draw_height/2,a.quad(-d,h,d,h,d,-h,-d,-h),a.setTexture(null)):this.layout.renderEffectChain(a,this,null,this.layout.getRenderTarget()))};f.prototype.drawInstanceGL=function(a,d){if(a.visible&&0!==a.width&&0!==a.height){a.update_bbox();var h=a.bbox;h.right<this.viewLeft||h.bottom<this.viewTop||h.left>this.viewRight||h.top>this.viewBottom||(d.setEarlyZIndex(a.earlyz_index),a.uses_shaders?this.drawInstanceWithShadersGL(a,d):(d.switchProgram(0),
d.setBlend(a.srcBlend,a.destBlend),a.drawGL(d)))}};f.prototype.drawInstanceGL_earlyZPass=function(a,d){if(a.visible&&0!==a.width&&0!==a.height){a.update_bbox();var h=a.bbox;h.right<this.viewLeft||h.bottom<this.viewTop||h.left>this.viewRight||h.top>this.viewBottom||(a.earlyz_index=this.runtime.earlyz_index++,0===a.blend_mode&&1===a.opacity&&a.shaders_preserve_opaqueness&&a.drawGL_earlyZPass&&(d.setEarlyZIndex(a.earlyz_index),a.drawGL_earlyZPass(d)))}};f.prototype.drawInstanceWithShadersGL=function(a,
d){var h=a.active_effect_types[0].shaderindex,r=a.active_effect_types[0].index,w=this.getScale(),E=this.runtime.draw_width,t=this.runtime.draw_height;if(1!==a.active_effect_types.length||d.programUsesCrossSampling(h)||d.programExtendsBox(h)||(a.angle||a.layer.getAngle())&&d.programUsesDest(h)||1!==a.opacity||a.type.plugin.must_predraw)this.layout.renderEffectChain(d,this,a,this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget()),d.resetModelView(),d.scale(w,w),d.rotateZ(-this.getAngle()),
d.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),d.updateModelView();else{d.switchProgram(h);d.setBlend(a.srcBlend,a.destBlend);d.programIsAnimated(h)&&(this.runtime.redraw=!0);var p=0,x=0,C=0,z=0;d.programUsesDest(h)&&(z=a.bbox,p=this.layerToCanvas(z.left,z.top,!0,!0),x=this.layerToCanvas(z.left,z.top,!1,!0),C=this.layerToCanvas(z.right,z.bottom,!0,!0),z=this.layerToCanvas(z.right,z.bottom,!1,!0),p/=E,x=1-x/t,C/=E,z=1-z/t);t=E=0;var K=h=1,S=1/a.width,L=1/a.height;
a.curFrame&&a.curFrame.sheetTex&&(E=a.curFrame.sheetTex.left,t=a.curFrame.sheetTex.top,h=a.curFrame.sheetTex.right,K=a.curFrame.sheetTex.bottom,a.curFrame.texture_img&&(S=1/a.curFrame.texture_img.width,L=1/a.curFrame.texture_img.height));d.setProgramParameters(this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget(),S,L,E,t,h,K,E,t,h,K,a.bbox.left,a.bbox.top,a.bbox.right,a.bbox.bottom,p,x,C,z,w,this.getAngle(),this.runtime.kahanTime.sum,a.effect_params[r]);a.drawGL(d)}};f.prototype.canvasToLayer=
function(a,d,h,r){var w=this.runtime.devicePixelRatio;this.runtime.isRetina&&(a*=w,d*=w);w=this.runtime.parallax_x_origin;var E=this.runtime.parallax_y_origin;w=(this.layout.scrollX-w)*this.parallaxX+w;E=(this.layout.scrollY-E)*this.parallaxY+E;var t=w,p=E,x=1/this.getScale(!r);r?(t-=this.runtime.draw_width*x/2,p-=this.runtime.draw_height*x/2):(t-=this.runtime.width*x/2,p-=this.runtime.height*x/2);t+=a*x;p+=d*x;d=this.getAngle();0!==d&&(t-=w,p-=E,a=Math.cos(d),d=Math.sin(d),r=t*a-p*d,p=p*a+t*d,t=
r+w,p+=E);return h?t:p};f.prototype.layerToCanvas=function(a,d,h,r){var w=this.runtime.parallax_x_origin,E=this.runtime.parallax_y_origin,t=(this.layout.scrollX-w)*this.parallaxX+w,p=(this.layout.scrollY-E)*this.parallaxY+E;E=t;w=p;var x=this.getAngle();if(0!==x){a-=t;d-=p;var C=Math.cos(-x);x=Math.sin(-x);var z=a*C-d*x;d=d*C+a*x;a=z+t;d+=p}t=1/this.getScale(!r);r?(E-=this.runtime.draw_width*t/2,w-=this.runtime.draw_height*t/2):(E-=this.runtime.width*t/2,w-=this.runtime.height*t/2);E=(a-E)/t;w=(d-
w)/t;a=this.runtime.devicePixelRatio;this.runtime.isRetina&&!r&&(E/=a,w/=a);return h?E:w};f.prototype.rotatePt=function(a,d,h){if(0===this.getAngle())return h?a:d;var r=this.layerToCanvas(a,d,!0);d=this.layerToCanvas(a,d,!1);this.disableAngle=!0;a=this.canvasToLayer(r,d,!0);r=this.canvasToLayer(r,d,!0);this.disableAngle=!1;return h?a:r};f.prototype.saveToJSON=function(){var a,d={s:this.scale,a:this.angle,vl:this.viewLeft,vt:this.viewTop,vr:this.viewRight,vb:this.viewBottom,v:this.visible,bc:this.background_color,
t:this.transparent,px:this.parallaxX,py:this.parallaxY,o:this.opacity,zr:this.zoomRate,fx:[],cg:this.created_globals,instances:[]};var h=0;for(a=this.effect_types.length;h<a;h++){var r=this.effect_types[h];d.fx.push({name:r.name,active:r.active,params:this.effect_params[r.index]})}return d};f.prototype.loadFromJSON=function(a){var d;this.scale=a.s;this.angle=a.a;this.viewLeft=a.vl;this.viewTop=a.vt;this.viewRight=a.vr;this.viewBottom=a.vb;this.visible=a.v;this.background_color=a.bc;this.transparent=
a.t;this.parallaxX=a.px;this.parallaxY=a.py;this.opacity=a.o;this.zoomRate=a.zr;this.created_globals=a.cg||[];cr.shallowAssignArray(this.initial_instances,this.startup_initial_instances);var h=new cr.ObjectSet;var r=0;for(d=this.created_globals.length;r<d;++r)h.add(this.created_globals[r]);var w=r=0;for(d=this.initial_instances.length;r<d;++r)h.contains(this.initial_instances[r][2])||(this.initial_instances[w]=this.initial_instances[r],++w);cr.truncateArray(this.initial_instances,w);w=a.fx;r=0;for(d=
w.length;r<d;r++)if(a=this.getEffectByName(w[r].name))a.active=w[r].active,this.effect_params[a.index]=w[r].params;this.updateActiveEffects();this.instances.sort(b);this.zindices_stale=!0};cr.layer=f})();
(function(){function b(e,a){this.runtime=e;this.event_sheet=null;this.scrollX=this.runtime.original_width/2;this.scrollY=this.runtime.original_height/2;this.scale=1;this.angle=0;this.first_visit=!0;this.name=a[0];this.originalWidth=a[1];this.originalHeight=a[2];this.width=a[1];this.height=a[2];this.unbounded_scrolling=a[3];this.sheetname=a[4];this.sid=a[5];var d=a[6],h;this.layers=[];this.initial_types=[];e=0;for(h=d.length;e<h;e++){var r=new cr.layer(this,d[e]);r.number=e;cr.seal(r);this.layers.push(r)}d=
a[7];this.initial_nonworld=[];e=0;for(h=d.length;e<h;e++){r=d[e];var w=this.runtime.types_by_index[r[1]];w.default_instance||(w.default_instance=r);this.initial_nonworld.push(r);-1===this.initial_types.indexOf(w)&&this.initial_types.push(w)}this.effect_types=[];this.active_effect_types=[];this.shaders_preserve_opaqueness=!0;this.effect_params=[];e=0;for(h=a[8].length;e<h;e++)this.effect_types.push({id:a[8][e][0],name:a[8][e][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:e}),this.effect_params.push(a[8][e][2].slice(0));
this.updateActiveEffects();this.rcTexBounce=new cr.rect(0,0,1,1);this.rcTexDest=new cr.rect(0,0,1,1);this.rcTexOrigin=new cr.rect(0,0,1,1);this.viewRect=new cr.rect(0,0,0,0);this.persist_data={}}function f(e,a){return e.zindex-a.zindex}function k(e){return e.some(function(a){return a.plugin.is_world})}b.prototype.saveObjectToPersist=function(e){var a=e.type.sid.toString();this.persist_data.hasOwnProperty(a)||(this.persist_data[a]=[]);this.persist_data[a].push(this.runtime.saveInstanceToJSON(e))};
b.prototype.hasOpaqueBottomLayer=function(){var e=this.layers[0];return!e.transparent&&1===e.opacity&&!e.forceOwnTexture&&e.visible};b.prototype.updateActiveEffects=function(){cr.clearArray(this.active_effect_types);this.shaders_preserve_opaqueness=!0;var e;var a=0;for(e=this.effect_types.length;a<e;a++){var d=this.effect_types[a];d.active&&(this.active_effect_types.push(d),d.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))}};b.prototype.getEffectByName=function(e){var a;var d=0;for(a=
this.effect_types.length;d<a;d++){var h=this.effect_types[d];if(h.name===e)return h}return null};var q=[],v=!0;b.prototype.startRunning=function(){this.sheetname&&(this.event_sheet=this.runtime.eventsheets[this.sheetname],this.event_sheet.updateDeepIncludes());this.runtime.running_layout=this;this.width=this.originalWidth;this.height=this.originalHeight;this.scrollX=this.runtime.original_width/2;this.scrollY=this.runtime.original_height/2;var e,a;var d=0;for(e=this.runtime.types_by_index.length;d<
e;d++){var h=this.runtime.types_by_index[d];if(!h.is_family){var r=h.instances;h=0;for(a=r.length;h<a;h++){var w=r[h];if(w.layer){var E=w.layer.number;E>=this.layers.length&&(E=this.layers.length-1);w.layer=this.layers[E];-1===w.layer.instances.indexOf(w)&&w.layer.instances.push(w);w.layer.zindices_stale=!0}}}}if(!v)for(d=0,e=this.layers.length;d<e;++d)this.layers[d].instances.sort(f);cr.clearArray(q);this.boundScrolling();d=0;for(e=this.layers.length;d<e;d++)w=this.layers[d],w.createInitialInstances(q),
w.updateViewport(null);r=!1;if(!this.first_visit){for(t in this.persist_data)if(this.persist_data.hasOwnProperty(t)&&(h=this.runtime.getObjectTypeBySid(parseInt(t,10)))&&!h.is_family&&this.runtime.typeHasPersistBehavior(h)){a=this.persist_data[t];d=0;for(e=a.length;d<e;d++){w=null;if(h.plugin.is_world&&(w=this.getLayerBySid(a[d].w.l),!w))continue;w=this.runtime.createInstanceFromInit(h.default_instance,w,!1,0,0,!0);this.runtime.loadInstanceFromJSON(w,a[d]);r=!0;q.push(w)}cr.clearArray(a)}d=0;for(e=
this.layers.length;d<e;d++)this.layers[d].instances.sort(f),this.layers[d].zindices_stale=!0}r&&(this.runtime.ClearDeathRow(),this.runtime.refreshUidMap());this.createAndLinkContainerInstances(q);d=0;for(e=this.initial_nonworld.length;d<e;d++){var t=this.initial_nonworld[d];h=this.runtime.types_by_index[t[1]];h.is_contained||this.runtime.createInstanceFromInit(this.initial_nonworld[d],null,!0)}this.runtime.changelayout=null;this.runtime.ClearDeathRow();if(this.runtime.ctx)for(d=0,e=this.runtime.types_by_index.length;d<
e;d++)t=this.runtime.types_by_index[d],!t.is_family&&t.instances.length&&t.preloadCanvas2D&&t.preloadCanvas2D(this.runtime.ctx);if(this.runtime.isLoadingState)cr.shallowAssignArray(this.runtime.fireOnCreateAfterLoad,q);else for(d=0,e=q.length;d<e;d++)w=q[d],this.runtime.trigger(Object.getPrototypeOf(w.type.plugin).cnds.OnCreated,w);cr.clearArray(q);this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutStart,null);this.first_visit=!1};b.prototype.createAndLinkContainerInstances=
function(e){var a,d;for(a=0;a<e.length;a++){var h=e[a];if(h.type.is_contained){var r=h.get_iid();var w=0;for(d=h.type.container.length;w<d;w++){var E=h.type.container[w];if(h.type!==E)if(E.instances.length>r)h.siblings.push(E.instances[r]);else if(E.default_instance){var t=this.runtime.createInstanceFromInit(E.default_instance,h.layer,!0,h.x,h.y,!0);this.runtime.ClearDeathRow();E.updateIIDs();h.siblings.push(t);e.push(t)}}}}};b.prototype.createGlobalNonWorlds=function(){var e,a,d=[];var h=e=0;for(a=
this.initial_nonworld.length;e<a;e++){var r=this.initial_nonworld[e];var w=this.runtime.types_by_index[r[1]];w.global?w.is_contained&&k(w.container)||d.push(this.runtime.createInstanceFromInit(r,null,!0)):(this.initial_nonworld[h]=r,h++)}cr.truncateArray(this.initial_nonworld,h);this.runtime.ClearDeathRow();this.createAndLinkContainerInstances(d)};b.prototype.stopRunning=function(){this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutEnd,null);this.runtime.isEndingLayout=
!0;cr.clearArray(this.runtime.system.waits);var e,a;if(!this.first_visit){var d=0;for(e=this.layers.length;d<e;d++){this.layers[d].updateZIndices();var h=this.layers[d].instances;var r=0;for(a=h.length;r<a;r++){var w=h[r];w.type.global||this.runtime.typeHasPersistBehavior(w.type)&&this.saveObjectToPersist(w)}}}d=0;for(e=this.layers.length;d<e;d++){h=this.layers[d].instances;r=0;for(a=h.length;r<a;r++)w=h[r],w.type.global||this.runtime.DestroyInstance(w);this.runtime.ClearDeathRow();cr.clearArray(h);
this.layers[d].zindices_stale=!0}d=0;for(e=this.runtime.types_by_index.length;d<e;d++)if(h=this.runtime.types_by_index[d],!(h.global||h.plugin.is_world||h.plugin.singleglobal||h.is_family)){r=0;for(a=h.instances.length;r<a;r++)this.runtime.DestroyInstance(h.instances[r]);this.runtime.ClearDeathRow()}v=!1;this.runtime.isEndingLayout=!1};var n=new cr.rect(0,0,0,0);b.prototype.recreateInitialObjects=function(e,a,d,h,r){n.set(a,d,h,r);a=0;for(d=this.layers.length;a<d;a++)this.layers[a].recreateInitialObjects(e,
n)};b.prototype.draw=function(e){var a=e,d=!1,h=!this.runtime.fullscreenScalingQuality;if(h){if(!this.runtime.layout_canvas){this.runtime.layout_canvas=document.createElement("canvas");var r=this.runtime.layout_canvas;r.width=this.runtime.draw_width;r.height=this.runtime.draw_height;this.runtime.layout_ctx=r.getContext("2d");d=!0}r=this.runtime.layout_canvas;a=this.runtime.layout_ctx;r.width!==this.runtime.draw_width&&(r.width=this.runtime.draw_width,d=!0);r.height!==this.runtime.draw_height&&(r.height=
this.runtime.draw_height,d=!0);d&&(a.imageSmoothingEnabled=this.runtime.linearSampling)}a.globalAlpha=1;a.globalCompositeOperation="source-over";this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&a.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height);var w;d=0;for(w=this.layers.length;d<w;d++){var E=this.layers[d];E.visible&&0<E.opacity&&11!==E.blend_mode&&(E.instances.length||!E.transparent)?E.draw(a):E.updateViewport(null)}h&&e.drawImage(r,0,0,this.runtime.width,this.runtime.height)};
b.prototype.drawGL_earlyZPass=function(e){e.setEarlyZPass(!0);this.runtime.layout_tex||(this.runtime.layout_tex=e.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling));if(this.runtime.layout_tex.c2width!==this.runtime.draw_width||this.runtime.layout_tex.c2height!==this.runtime.draw_height)e.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=e.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling);e.setRenderingToTexture(this.runtime.layout_tex);
this.runtime.fullscreenScalingQuality||e.setSize(this.runtime.draw_width,this.runtime.draw_height);var a;for(a=this.layers.length-1;0<=a;--a){var d=this.layers[a];d.visible&&1===d.opacity&&d.shaders_preserve_opaqueness&&0===d.blend_mode&&(d.instances.length||!d.transparent)?d.drawGL_earlyZPass(e):d.updateViewport(null)}e.setEarlyZPass(!1)};b.prototype.drawGL=function(e){var a=0<this.active_effect_types.length||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack;
if(a){this.runtime.layout_tex||(this.runtime.layout_tex=e.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling));if(this.runtime.layout_tex.c2width!==this.runtime.draw_width||this.runtime.layout_tex.c2height!==this.runtime.draw_height)e.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=e.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling);e.setRenderingToTexture(this.runtime.layout_tex);this.runtime.fullscreenScalingQuality||
e.setSize(this.runtime.draw_width,this.runtime.draw_height)}else this.runtime.layout_tex&&(e.setRenderingToTexture(null),e.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=null);this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&e.clear(0,0,0,0);var d;var h=0;for(d=this.layers.length;h<d;h++){var r=this.layers[h];r.visible&&0<r.opacity&&(r.instances.length||!r.transparent)?r.drawGL(e):r.updateViewport(null)}a&&(0===this.active_effect_types.length||1===this.active_effect_types.length&&
this.runtime.fullscreenScalingQuality?(1===this.active_effect_types.length?(a=this.active_effect_types[0].index,h=this.calculateViewRect(),e.switchProgram(this.active_effect_types[0].shaderindex),e.setProgramParameters(null,1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,0,0,1,1,h.left,h.top,h.right,h.bottom,0,0,1,1,this.scale,this.angle,this.runtime.kahanTime.sum,this.effect_params[a]),e.programIsAnimated(this.active_effect_types[0].shaderindex)&&(this.runtime.redraw=!0)):e.switchProgram(0),
this.runtime.fullscreenScalingQuality||e.setSize(this.runtime.width,this.runtime.height),e.setRenderingToTexture(null),e.setDepthTestEnabled(!1),e.setOpacity(1),e.setTexture(this.runtime.layout_tex),e.setAlphaBlend(),e.resetModelView(),e.updateModelView(),a=this.runtime.width/2,h=this.runtime.height/2,e.quad(-a,h,a,h,a,-h,-a,-h),e.setTexture(null),e.setDepthTestEnabled(!0)):this.renderEffectChain(e,null,null,null))};b.prototype.getRenderTarget=function(){return 0<this.active_effect_types.length||
this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack?this.runtime.layout_tex:null};b.prototype.getMinLayerScale=function(){var e=this.layers[0].getScale(),a;var d=1;for(a=this.layers.length;d<a;d++){var h=this.layers[d];(0!==h.parallaxX||0!==h.parallaxY)&&h.getScale()<e&&(e=h.getScale())}return e};b.prototype.scrollToX=function(e){if(!this.unbounded_scrolling){var a=this.runtime.draw_width*(1/this.getMinLayerScale())/2;e>this.width-a&&(e=this.width-
a);e<a&&(e=a)}this.scrollX!==e&&(this.scrollX=e,this.runtime.redraw=!0)};b.prototype.scrollToY=function(e){if(!this.unbounded_scrolling){var a=this.runtime.draw_height*(1/this.getMinLayerScale())/2;e>this.height-a&&(e=this.height-a);e<a&&(e=a)}this.scrollY!==e&&(this.scrollY=e,this.runtime.redraw=!0)};b.prototype.boundScrolling=function(){this.scrollToX(this.scrollX);this.scrollToY(this.scrollY)};b.prototype.calculateViewRect=function(){var e=this.scrollX,a=this.scrollY,d=1/(this.scale*this.runtime.aspect_scale);
e-=this.runtime.width*d/2;a-=this.runtime.height*d/2;this.viewRect.set(e,a,e+this.runtime.draw_width*d,a+this.runtime.draw_height*d);return this.viewRect};b.prototype.renderEffectChain=function(e,a,d,h){var r=d?d.active_effect_types:a?a.active_effect_types:this.active_effect_types;if(d){var w=d.layer.getScale();var E=d.layer.getAngle();var t=d.layer.viewLeft;var p=d.layer.viewTop;var x=d.layer.viewRight;var C=d.layer.viewBottom}else a?(w=a.getScale(),E=a.getAngle(),t=a.viewLeft,p=a.viewTop,x=a.viewRight,
C=a.viewBottom):(w=this.scale,E=this.angle,C=this.calculateViewRect(),t=C.left,p=C.top,x=C.right,C=C.bottom);var z=this.runtime.fx_tex,K,S,L=0,R=1,F=this.runtime.draw_width,g=this.runtime.draw_height,l=F/2,u=g/2,c=a?a.rcTexBounce:this.rcTexBounce,y=a?a.rcTexDest:this.rcTexDest,H=a?a.rcTexOrigin:this.rcTexOrigin,O=0,U=0,Y=0,aa=0,ca=F,ha=F,fa=g,m=g,A=S=0,J=d?d.layer.getAngle():0;if(d){var N=0;for(K=r.length;N<K;N++)S+=e.getProgramBoxExtendHorizontal(r[N].shaderindex),A+=e.getProgramBoxExtendVertical(r[N].shaderindex);
aa=d.bbox;O=a.layerToCanvas(aa.left,aa.top,!0,!0);Y=a.layerToCanvas(aa.left,aa.top,!1,!0);ca=a.layerToCanvas(aa.right,aa.bottom,!0,!0);fa=a.layerToCanvas(aa.right,aa.bottom,!1,!0);if(0!==J){N=a.layerToCanvas(aa.right,aa.top,!0,!0);K=a.layerToCanvas(aa.right,aa.top,!1,!0);U=a.layerToCanvas(aa.left,aa.bottom,!0,!0);aa=a.layerToCanvas(aa.left,aa.bottom,!1,!0);var G=Math.min(O,ca,N,U);ca=Math.max(O,ca,N,U);O=G;G=Math.min(Y,fa,K,aa);fa=Math.max(Y,fa,K,aa);Y=G}H.left=O/F;H.top=1-Y/g;H.right=ca/F;H.bottom=
1-fa/g;O-=S;Y-=A;ca+=S;fa+=A;y.left=O/F;y.top=1-Y/g;y.right=ca/F;y.bottom=1-fa/g;U=O=cr.floor(O);aa=Y=cr.floor(Y);ha=ca=cr.ceil(ca);m=fa=cr.ceil(fa);U-=S;aa-=A;ha+=S;m+=A;0>O&&(O=0);0>Y&&(Y=0);ca>F&&(ca=F);fa>g&&(fa=g);0>U&&(U=0);0>aa&&(aa=0);ha>F&&(ha=F);m>g&&(m=g);c.left=O/F;c.top=1-Y/g;c.right=ca/F;c.bottom=1-fa/g}else c.left=y.left=H.left=0,c.top=y.top=H.top=0,c.right=y.right=H.right=1,c.bottom=y.bottom=1;A=d&&(e.programUsesDest(r[0].shaderindex)||0!==S||0!==A||1!==d.opacity||d.type.plugin.must_predraw)||
a&&!d&&1!==a.opacity;e.setAlphaBlend();if(A){z[L]||(z[L]=e.createEmptyTexture(F,g,this.runtime.linearSampling));if(z[L].c2width!==F||z[L].c2height!==g)e.deleteTexture(z[L]),z[L]=e.createEmptyTexture(F,g,this.runtime.linearSampling);e.switchProgram(0);e.setRenderingToTexture(z[L]);var B=m-aa;e.clearRect(U,g-aa-B,ha-U,B);d?d.drawGL(e):(e.setTexture(this.runtime.layer_tex),e.setOpacity(a.opacity),e.resetModelView(),e.translate(-l,-u),e.updateModelView(),e.quadTex(O,fa,ca,fa,ca,Y,O,Y,c));y.left=y.top=
0;y.right=y.bottom=1;d&&(G=c.top,c.top=c.bottom,c.bottom=G);L=1;R=0}e.setOpacity(1);S=r.length-1;J=e.programUsesCrossSampling(r[S].shaderindex)||!a&&!d&&!this.runtime.fullscreenScalingQuality;N=0;for(K=r.length;N<K;N++){z[L]||(z[L]=e.createEmptyTexture(F,g,this.runtime.linearSampling));if(z[L].c2width!==F||z[L].c2height!==g)e.deleteTexture(z[L]),z[L]=e.createEmptyTexture(F,g,this.runtime.linearSampling);e.switchProgram(r[N].shaderindex);G=r[N].index;e.programIsAnimated(r[N].shaderindex)&&(this.runtime.redraw=
!0);if(0!=N||A){e.setProgramParameters(h,1/F,1/g,0,0,1,1,H.left,H.top,H.right,H.bottom,t,p,x,C,y.left,y.top,y.right,y.bottom,w,E,this.runtime.kahanTime.sum,d?d.effect_params[G]:a?a.effect_params[G]:this.effect_params[G]);e.setTexture(null);if(N!==S||J){e.setRenderingToTexture(z[L]);B=m-aa;var I=g-aa-B;e.clearRect(U,I,ha-U,B)}else d?e.setBlend(d.srcBlend,d.destBlend):a&&e.setBlend(a.srcBlend,a.destBlend),e.setRenderingToTexture(h);e.setTexture(z[R]);e.resetModelView();e.translate(-l,-u);e.updateModelView();
e.quadTex(O,fa,ca,fa,ca,Y,O,Y,c);N!==S||J||e.setTexture(null)}else{e.setRenderingToTexture(z[L]);B=m-aa;I=g-aa-B;e.clearRect(U,I,ha-U,B);if(d){I=R=0;var M=B=1,Q=1/d.width,Z=1/d.height;d.curFrame&&d.curFrame.sheetTex&&(R=d.curFrame.sheetTex.left,I=d.curFrame.sheetTex.top,B=d.curFrame.sheetTex.right,M=d.curFrame.sheetTex.bottom,d.curFrame.texture_img&&(Q=1/d.curFrame.texture_img.width,Z=1/d.curFrame.texture_img.height));e.setProgramParameters(h,Q,Z,R,I,B,M,R,I,B,M,d.bbox.left,d.bbox.top,d.bbox.right,
d.bbox.bottom,y.left,y.top,y.right,y.bottom,w,E,this.runtime.kahanTime.sum,d.effect_params[G]);d.drawGL(e)}else e.setProgramParameters(h,1/F,1/g,0,0,1,1,0,0,1,1,t,p,x,C,0,0,1,1,w,E,this.runtime.kahanTime.sum,a?a.effect_params[G]:this.effect_params[G]),e.setTexture(a?this.runtime.layer_tex:this.runtime.layout_tex),e.resetModelView(),e.translate(-l,-u),e.updateModelView(),e.quadTex(O,fa,ca,fa,ca,Y,O,Y,c);y.left=y.top=0;y.right=y.bottom=1;d&&!J&&(G=fa,fa=Y,Y=G)}L=0===L?1:0;R=0===L?1:0}J&&(e.switchProgram(0),
d?e.setBlend(d.srcBlend,d.destBlend):a?e.setBlend(a.srcBlend,a.destBlend):this.runtime.fullscreenScalingQuality||(e.setSize(this.runtime.width,this.runtime.height),l=this.runtime.width/2,u=this.runtime.height/2,Y=O=0,ca=this.runtime.width,fa=this.runtime.height),e.setRenderingToTexture(h),e.setTexture(z[R]),e.resetModelView(),e.translate(-l,-u),e.updateModelView(),d&&1===r.length&&!A?e.quadTex(O,Y,ca,Y,ca,fa,O,fa,c):e.quadTex(O,fa,ca,fa,ca,Y,O,Y,c),e.setTexture(null))};b.prototype.getLayerBySid=function(e){var a;
var d=0;for(a=this.layers.length;d<a;d++)if(this.layers[d].sid===e)return this.layers[d];return null};b.prototype.saveToJSON=function(){var e,a={sx:this.scrollX,sy:this.scrollY,s:this.scale,a:this.angle,w:this.width,h:this.height,fv:this.first_visit,persist:this.persist_data,fx:[],layers:{}};var d=0;for(e=this.effect_types.length;d<e;d++){var h=this.effect_types[d];a.fx.push({name:h.name,active:h.active,params:this.effect_params[h.index]})}d=0;for(e=this.layers.length;d<e;d++)h=this.layers[d],a.layers[h.sid.toString()]=
h.saveToJSON();return a};b.prototype.loadFromJSON=function(e){var a,d,h;this.scrollX=e.sx;this.scrollY=e.sy;this.scale=e.s;this.angle=e.a;this.width=e.w;this.height=e.h;this.persist_data=e.persist;"undefined"!==typeof e.fv&&(this.first_visit=e.fv);var r=e.fx;var w=0;for(a=r.length;w<a;w++)if(d=this.getEffectByName(r[w].name))d.active=r[w].active,this.effect_params[d.index]=r[w].params;this.updateActiveEffects();w=e.layers;for(h in w)w.hasOwnProperty(h)&&(e=this.getLayerBySid(parseInt(h,10)))&&e.loadFromJSON(w[h])};
cr.layout=b})();
(function(){function b(z,K){var S,L=z.length;switch(L){case 0:return!0;case 1:return z[0]===K[0];case 2:return z[0]===K[0]&&z[1]===K[1];default:for(S=0;S<L;S++)if(z[S]!==K[S])return!1;return!0}}function f(z,K){return z.index-K.index}function k(z){var K;if(2===z.length){if(z[0].index>z[1].index){var S=z[0];z[0]=z[1];z[1]=S}}else 2<z.length&&z.sort(f);z.length>=p.length&&(p.length=z.length+1);p[z.length]||(p[z.length]=[]);var L=p[z.length];S=0;for(K=L.length;S<K;S++){var R=L[S];if(b(z,R))return R}L.push(z);
return z}function q(z,K){this.runtime=z;this.triggers={};this.fasttriggers={};this.hasRun=!1;this.includes=new cr.ObjectSet;this.deep_includes=[];this.already_included_sheets=[];this.name=K[0];z=K[1];this.events=[];var S;K=0;for(S=z.length;K<S;K++)this.init_event(z[K],null,this.events)}function v(z){this.type=z;this.instances=[];this.else_instances=[];this.select_all=!0}function n(z,K,S){this.sheet=z;this.parent=K;this.runtime=z.runtime;this.solModifiers=[];this.solModifiersIncludingParents=[];this.has_else_block=
this.toplevelgroup=this.toplevelevent=this.initially_activated=this.group=this.solWriterAfterCnds=!1;this.conditions=[];this.actions=[];this.subevents=[];this.group_name="";this.group_active=this.initially_activated=this.group=!1;this.contained_includes=null;3===S[0]&&(this.group_name=S[1][1].toLowerCase(),this.group=!0,this.initially_activated=!!S[1][0],this.contained_includes=[],this.group_active=this.initially_activated,this.runtime.allGroups.push(this),this.runtime.groups_by_name[this.group_name]=
this);this.orblock=S[2];this.sid=S[4];this.group||(this.runtime.blocksBySid[this.sid.toString()]=this);var L=S[6];z=0;for(K=L.length;z<K;z++){var R=new cr.condition(this,L[z]);R.index=z;cr.seal(R);this.conditions.push(R);this.addSolModifier(R.type)}L=S[7];z=0;for(K=L.length;z<K;z++)R=new cr.action(this,L[z]),R.index=z,cr.seal(R),this.actions.push(R);if(9===S.length)for(S=S[8],z=0,K=S.length;z<K;z++)this.sheet.init_event(S[z],this,this.subevents);this.is_else_block=!1;this.conditions.length&&(this.is_else_block=
null==this.conditions[0].type&&this.conditions[0].func==cr.system_object.prototype.cnds.Else)}function e(z,K){var S;if(z&&(-1===K.indexOf(z)&&K.push(z),z.is_contained)){var L=0;for(S=z.container.length;L<S;L++){var R=z.container[L];z!==R&&-1===K.indexOf(R)&&K.push(R)}}}function a(z,K){this.block=z;this.sheet=z.sheet;this.runtime=z.runtime;this.parameters=[];this.results=[];this.extra={};this.index=-1;this.anyParamVariesPerInstance=!1;this.func=this.runtime.GetObjectReference(K[1]);this.trigger=0<
K[3];this.fasttrigger=2===K[3];this.looping=K[4];this.inverted=K[5];this.isstatic=K[6];this.sid=K[7];this.runtime.cndsBySid[this.sid.toString()]=this;-1===K[0]?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[K[0]],this.run=this.isstatic?this.run_static:this.run_object,K[2]?(this.behaviortype=this.type.getBehaviorByName(K[2]),this.beh_index=this.type.getBehaviorIndexByName(K[2])):(this.behaviortype=null,this.beh_index=-1),this.block.parent&&
this.block.parent.setSolWriterAfterCnds());this.fasttrigger&&(this.run=this.run_true);if(10===K.length){var S=K[9];z=0;for(K=S.length;z<K;z++){var L=new cr.parameter(this,S[z]);cr.seal(L);this.parameters.push(L)}this.results.length=S.length}}function d(z,K){this.block=z;this.sheet=z.sheet;this.runtime=z.runtime;this.parameters=[];this.results=[];this.extra={};this.index=-1;this.anyParamVariesPerInstance=!1;this.func=this.runtime.GetObjectReference(K[1]);-1===K[0]?(this.type=null,this.run=this.run_system,
this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[K[0]],this.run=this.run_object,K[2]?(this.behaviortype=this.type.getBehaviorByName(K[2]),this.beh_index=this.type.getBehaviorIndexByName(K[2])):(this.behaviortype=null,this.beh_index=-1));this.sid=K[3];this.runtime.actsBySid[this.sid.toString()]=this;if(7===K.length){var S=K[6];z=0;for(K=S.length;z<K;z++){var L=new cr.parameter(this,S[z]);cr.seal(L);this.parameters.push(L)}this.results.length=S.length}}function h(){C++;
x.length===C&&x.push(new cr.expvalue);return x[C]}function r(z,K){this.owner=z;this.block=z.block;this.sheet=z.sheet;this.runtime=z.runtime;this.type=K[0];this.expression=null;this.solindex=0;this.get=null;this.combosel=0;this.layout=null;this.key=0;this.object=null;this.index=0;this.variadicret=this.subparams=this.fileinfo=this.eventvar=this.varname=null;this.variesPerInstance=!1;var S;switch(this.type){case 0:case 7:this.expression=new cr.expNode(this,K[1]);this.solindex=0;this.get=this.get_exp;
break;case 1:case 14:this.expression=new cr.expNode(this,K[1]);this.solindex=0;this.get=this.get_exp_str;14===this.type&&(this.block.setAllSolModifiers(),this.owner instanceof cr.action&&this.block.setSolWriterAfterCnds());break;case 5:this.expression=new cr.expNode(this,K[1]);this.solindex=0;this.get=this.get_layer;break;case 3:case 8:this.combosel=K[1];this.get=this.get_combosel;break;case 16:this.combosel=K[1]?1:0;this.get=this.get_boolean;break;case 6:this.layout=this.runtime.layouts[K[1]];this.get=
this.get_layout;break;case 9:this.key=K[1];this.get=this.get_key;break;case 4:this.object=this.runtime.types_by_index[K[1]];this.get=this.get_object;this.block.addSolModifier(this.object);this.owner instanceof cr.action?this.block.setSolWriterAfterCnds():this.block.parent&&this.block.parent.setSolWriterAfterCnds();break;case 10:this.index=K[1];z.type&&z.type.is_family?(this.get=this.get_familyvar,this.variesPerInstance=!0):this.get=this.get_instvar;break;case 11:this.varname=K[1];this.eventvar=null;
this.get=this.get_eventvar;break;case 2:case 12:this.fileinfo=K[1];this.get=this.get_audiofile;break;case 13:for(this.get=this.get_variadic,this.subparams=[],this.variadicret=[],z=1,S=K.length;z<S;z++){var L=new cr.parameter(this.owner,K[z]);cr.seal(L);this.subparams.push(L);this.variadicret.push(0)}}}function w(z,K,S){this.sheet=z;this.parent=K;this.runtime=z.runtime;this.solModifiers=[];this.name=S[1];this.vartype=S[2];this.initial=S[3];this.is_static=!!S[4];this.is_constant=!!S[5];this.sid=S[6];
this.runtime.varsBySid[this.sid.toString()]=this;this.data=this.initial;this.parent?(this.localIndex=this.is_static||this.is_constant?-1:this.runtime.stackLocalCount++,this.runtime.all_local_vars.push(this)):(this.localIndex=-1,this.runtime.all_global_vars.push(this))}function E(z,K,S){this.sheet=z;this.parent=K;this.runtime=z.runtime;this.solModifiers=[];this.include_sheet=null;this.include_sheet_name=S[1];this.active=!0}function t(){this.temp_parents_arr=[];this.reset(null);cr.seal(this)}var p=
[];q.prototype.toString=function(){return this.name};q.prototype.init_event=function(z,K,S){switch(z[0]){case 0:case 3:z=new cr.eventblock(this,K,z);cr.seal(z);if(z.orblock)for(S.push(z),S=0,K=z.conditions.length;S<K;S++)z.conditions[S].trigger&&this.init_trigger(z,S);else z.is_trigger()?this.init_trigger(z,0):S.push(z);break;case 1:z=new cr.eventvariable(this,K,z);cr.seal(z);S.push(z);break;case 2:z=new cr.eventinclude(this,K,z),cr.seal(z),S.push(z)}};q.prototype.postInit=function(){var z;var K=
0;for(z=this.events.length;K<z;K++)this.events[K].postInit(K<z-1&&this.events[K+1].is_else_block)};q.prototype.updateDeepIncludes=function(){cr.clearArray(this.deep_includes);cr.clearArray(this.already_included_sheets);this.addDeepIncludes(this);cr.clearArray(this.already_included_sheets)};q.prototype.addDeepIncludes=function(z){var K,S=z.deep_includes,L=z.already_included_sheets,R=this.includes.valuesRef();var F=0;for(K=R.length;F<K;++F){var g=R[F];var l=g.include_sheet;!g.isActive()||z===l||-1<
L.indexOf(l)||(L.push(l),l.addDeepIncludes(z),S.push(l))}};q.prototype.run=function(z){this.runtime.resuming_breakpoint||(this.hasRun=!0,z||(this.runtime.isRunningEvents=!0));var K;var S=0;for(K=this.events.length;S<K;S++){var L=this.events[S];L.run();this.runtime.clearSol(L.solModifiers);this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()}z||(this.runtime.isRunningEvents=!1)};q.prototype.init_trigger=function(z,K){z.orblock||this.runtime.triggers_to_postinit.push(z);var S,L,R=z.conditions[K];
var F=R.type?R.type.name:"system";var g=(S=R.fasttrigger)?this.fasttriggers:this.triggers;g[F]||(g[F]=[]);F=g[F];g=R.func;if(S){if(R.parameters.length&&(R=R.parameters[0],1===R.type&&2===R.expression.type)){R=R.expression.value.toLowerCase();S=0;for(L=F.length;S<L;S++)if(F[S].method==g){S=F[S].evs;S[R]?S[R].push([z,K]):S[R]=[[z,K]];return}S={};S[R]=[[z,K]];F.push({method:g,evs:S})}}else{S=0;for(L=F.length;S<L;S++)if(F[S].method==g){F[S].evs.push([z,K]);return}R=cr.plugins_.Sprite&&g===cr.plugins_.Sprite.prototype.cnds.OnFrameChanged?
!0:!1;R?F.unshift({method:g,evs:[[z,K]]}):F.push({method:g,evs:[[z,K]]})}};cr.eventsheet=q;v.prototype.hasObjects=function(){return this.select_all?this.type.instances.length:this.instances.length};v.prototype.getObjects=function(){return this.select_all?this.type.instances:this.instances};v.prototype.pick_one=function(z){z&&(z.runtime.getCurrentEventStack().current_event.orblock?(this.select_all&&(cr.clearArray(this.instances),cr.shallowAssignArray(this.else_instances,z.type.instances),this.select_all=
!1),z=this.else_instances.indexOf(z),-1!==z&&(this.instances.push(this.else_instances[z]),this.else_instances.splice(z,1))):(this.select_all=!1,cr.clearArray(this.instances),this.instances[0]=z))};cr.selection=v;n.prototype.postInit=function(z){var K,S=this.parent;if(this.group)for(this.toplevelgroup=!0;S;){if(!S.group){this.toplevelgroup=!1;break}S=S.parent}this.toplevelevent=!this.is_trigger()&&(!this.parent||this.parent.group&&this.parent.toplevelgroup);this.has_else_block=!!z;S=this.runtime.types_by_index;
if(this.solModifiers===S)this.solModifiersIncludingParents=S;else{this.solModifiersIncludingParents=this.solModifiers.slice(0);for(S=this.parent;S;){z=0;for(K=S.solModifiers.length;z<K;z++)this.addParentSolModifier(S.solModifiers[z]);S=S.parent}this.solModifiers=k(this.solModifiers);this.solModifiersIncludingParents=k(this.solModifiersIncludingParents)}z=0;for(K=this.conditions.length;z<K;z++)this.conditions[z].postInit();z=0;for(K=this.actions.length;z<K;z++)this.actions[z].postInit();z=0;for(K=
this.subevents.length;z<K;z++)this.subevents[z].postInit(z<K-1&&this.subevents[z+1].is_else_block)};n.prototype.setGroupActive=function(z){if(this.group_active!==!!z){this.group_active=!!z;var K;z=0;for(K=this.contained_includes.length;z<K;++z)this.contained_includes[z].updateActive();0<K&&this.runtime.running_layout.event_sheet&&this.runtime.running_layout.event_sheet.updateDeepIncludes()}};n.prototype.addSolModifier=function(z){e(z,this.solModifiers)};n.prototype.addParentSolModifier=function(z){e(z,
this.solModifiersIncludingParents)};n.prototype.setAllSolModifiers=function(){this.solModifiers=this.runtime.types_by_index};n.prototype.setSolWriterAfterCnds=function(){this.solWriterAfterCnds=!0;this.parent&&this.parent.setSolWriterAfterCnds()};n.prototype.is_trigger=function(){return this.conditions.length?this.conditions[0].trigger:!1};n.prototype.run=function(){var z,K=!1,S=this.runtime,L=this.runtime.getCurrentEventStack();L.current_event=this;var R=this.conditions;this.is_else_block||(L.else_branch_ran=
!1);if(this.orblock){0===R.length&&(K=!0);L.cndindex=0;for(z=R.length;L.cndindex<z;L.cndindex++){var F=R[L.cndindex];F.trigger||(F=F.run())&&(K=!0)}(L.last_event_true=K)&&this.run_actions_and_subevents()}else{L.cndindex=0;for(z=R.length;L.cndindex<z;L.cndindex++)if(F=R[L.cndindex].run(),!F){L.last_event_true=!1;this.toplevelevent&&S.hasPendingInstances&&S.ClearDeathRow();return}L.last_event_true=!0;this.run_actions_and_subevents()}this.end_run(L)};n.prototype.end_run=function(z){z.last_event_true&&
this.has_else_block&&(z.else_branch_ran=!0);this.toplevelevent&&this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()};n.prototype.run_orblocktrigger=function(z){this.runtime.getCurrentEventStack().current_event=this;this.conditions[z].run()&&(this.run_actions_and_subevents(),this.runtime.getCurrentEventStack().last_event_true=!0)};n.prototype.run_actions_and_subevents=function(){var z=this.runtime.getCurrentEventStack(),K;z.actindex=0;for(K=this.actions.length;z.actindex<K;z.actindex++)if(this.actions[z.actindex].run())return;
this.run_subevents()};n.prototype.resume_actions_and_subevents=function(){var z=this.runtime.getCurrentEventStack(),K;for(K=this.actions.length;z.actindex<K;z.actindex++)if(this.actions[z.actindex].run())return;this.run_subevents()};n.prototype.run_subevents=function(){if(this.subevents.length){var z,K,S=this.subevents.length-1;this.runtime.pushEventStack(this);if(this.solWriterAfterCnds){var L=0;for(z=this.subevents.length;L<z;L++){var R=this.subevents[L];(K=!this.toplevelgroup||!this.group&&L<S)&&
this.runtime.pushCopySol(R.solModifiers);R.run();K?this.runtime.popSol(R.solModifiers):this.runtime.clearSol(R.solModifiers)}}else for(L=0,z=this.subevents.length;L<z;L++)this.subevents[L].run();this.runtime.popEventStack()}};n.prototype.run_pretrigger=function(){var z=this.runtime.getCurrentEventStack();z.current_event=this;var K=!1,S;z.cndindex=0;for(S=this.conditions.length;z.cndindex<S;z.cndindex++)if(this.conditions[z.cndindex].run())K=!0;else if(!this.orblock)return!1;return this.orblock?K:
!0};n.prototype.retrigger=function(){this.runtime.execcount++;var z=this.runtime.getCurrentEventStack().cndindex,K=this.runtime.pushEventStack(this);if(!this.orblock)for(K.cndindex=z+1,z=this.conditions.length;K.cndindex<z;K.cndindex++)if(!this.conditions[K.cndindex].run())return this.runtime.popEventStack(),!1;this.run_actions_and_subevents();this.runtime.popEventStack();return!0};n.prototype.isFirstConditionOfType=function(z){var K=z.index;if(0===K)return!0;for(--K;0<=K;--K)if(this.conditions[K].type===
z.type)return!1;return!0};cr.eventblock=n;a.prototype.postInit=function(){var z;var K=0;for(z=this.parameters.length;K<z;K++){var S=this.parameters[K];S.postInit();S.variesPerInstance&&(this.anyParamVariesPerInstance=!0)}};a.prototype.run_true=function(){return!0};a.prototype.run_system=function(){var z;var K=0;for(z=this.parameters.length;K<z;K++)this.results[K]=this.parameters[K].get();return cr.xor(this.func.apply(this.runtime.system,this.results),this.inverted)};a.prototype.run_static=function(){var z;
var K=0;for(z=this.parameters.length;K<z;K++)this.results[K]=this.parameters[K].get();K=this.func.apply(this.behaviortype?this.behaviortype:this.type,this.results);this.type.applySolToContainer();return K};a.prototype.run_object=function(){var z,K,S,L=this.type,R=L.getCurrentSol(),F=this.block.orblock&&!this.trigger,g=L.is_contained,l=L.is_family,u=L.family_index,c=this.beh_index,y=-1<c,H=this.anyParamVariesPerInstance,O=this.parameters,U=this.results,Y=this.inverted,aa=this.func;if(H){var ca=0;for(K=
O.length;ca<K;++ca){var ha=O[ca];ha.variesPerInstance||(U[ca]=ha.get(0))}}else for(ca=0,K=O.length;ca<K;++ca)U[ca]=O[ca].get(0);if(R.select_all){cr.clearArray(R.instances);cr.clearArray(R.else_instances);var fa=L.instances;var m=0;for(z=fa.length;m<z;++m){var A=fa[m];if(H)for(ca=0,K=O.length;ca<K;++ca)ha=O[ca],ha.variesPerInstance&&(U[ca]=ha.get(m));y?(ca=0,l&&(ca=A.type.family_beh_map[u]),ca=aa.apply(A.behavior_insts[c+ca],U)):ca=aa.apply(A,U);(S=cr.xor(ca,Y))?R.instances.push(A):F&&R.else_instances.push(A)}L.finish&&
L.finish(!0);R.select_all=!1;L.applySolToContainer();return R.hasObjects()}var J=0;fa=(S=F&&!this.block.isFirstConditionOfType(this))?R.else_instances:R.instances;var N=!1;m=0;for(z=fa.length;m<z;++m){A=fa[m];if(H)for(ca=0,K=O.length;ca<K;++ca)ha=O[ca],ha.variesPerInstance&&(U[ca]=ha.get(m));y?(ca=0,l&&(ca=A.type.family_beh_map[u]),ca=aa.apply(A.behavior_insts[c+ca],U)):ca=aa.apply(A,U);if(cr.xor(ca,Y))if(N=!0,S){if(R.instances.push(A),g)for(ca=0,K=A.siblings.length;ca<K;ca++)ha=A.siblings[ca],ha.type.getCurrentSol().instances.push(ha)}else{fa[J]=
A;if(g)for(ca=0,K=A.siblings.length;ca<K;ca++)ha=A.siblings[ca],ha.type.getCurrentSol().instances[J]=ha;J++}else if(S){fa[J]=A;if(g)for(ca=0,K=A.siblings.length;ca<K;ca++)ha=A.siblings[ca],ha.type.getCurrentSol().else_instances[J]=ha;J++}else if(F&&(R.else_instances.push(A),g))for(ca=0,K=A.siblings.length;ca<K;ca++)ha=A.siblings[ca],ha.type.getCurrentSol().else_instances.push(ha)}cr.truncateArray(fa,J);if(g)for(l=L.container,m=0,z=l.length;m<z;m++)A=l[m].getCurrentSol(),S?cr.truncateArray(A.else_instances,
J):cr.truncateArray(A.instances,J);J=N;if(S&&!N)for(m=0,z=R.instances.length;m<z;m++){A=R.instances[m];if(H)for(ca=0,K=O.length;ca<K;ca++)ha=O[ca],ha.variesPerInstance&&(U[ca]=ha.get(m));ca=y?aa.apply(A.behavior_insts[c],U):aa.apply(A,U);if(cr.xor(ca,Y)){N=!0;break}}L.finish&&L.finish(J||F);return F?N:R.hasObjects()};cr.condition=a;d.prototype.postInit=function(){var z;var K=0;for(z=this.parameters.length;K<z;K++){var S=this.parameters[K];S.postInit();S.variesPerInstance&&(this.anyParamVariesPerInstance=
!0)}};d.prototype.run_system=function(){var z=this.runtime,K,S=this.parameters,L=this.results;var R=0;for(K=S.length;R<K;++R)L[R]=S[R].get();return this.func.apply(z.system,L)};d.prototype.run_object=function(){var z=this.type,K=this.beh_index,S=z.family_index,L=this.anyParamVariesPerInstance,R=this.parameters,F=this.results,g=this.func,l=z.getCurrentSol().getObjects();z=z.is_family;var u=-1<K,c,y;if(L){var H=0;for(y=R.length;H<y;++H){var O=R[H];O.variesPerInstance||(F[H]=O.get(0))}}else for(H=0,
y=R.length;H<y;++H)F[H]=R[H].get(0);var U=0;for(c=l.length;U<c;++U){var Y=l[U];if(L)for(H=0,y=R.length;H<y;++H)O=R[H],O.variesPerInstance&&(F[H]=O.get(U));u?(H=0,z&&(H=Y.type.family_beh_map[S]),g.apply(Y.behavior_insts[K+H],F)):g.apply(Y,F)}return!1};cr.action=d;var x=[],C=-1;r.prototype.postInit=function(){var z;if(11===this.type)this.eventvar=this.runtime.getEventVariableByName(this.varname,this.block.parent);else if(13===this.type){var K=0;for(z=this.subparams.length;K<z;K++)this.subparams[K].postInit()}this.expression&&
this.expression.postInit()};r.prototype.maybeVaryForType=function(z){this.variesPerInstance||!z||z.plugin.singleglobal||(this.variesPerInstance=!0)};r.prototype.setVaries=function(){this.variesPerInstance=!0};r.prototype.get_exp=function(z){this.solindex=z||0;z=h();this.expression.get(z);C--;return z.data};r.prototype.get_exp_str=function(z){this.solindex=z||0;z=h();this.expression.get(z);C--;return cr.is_string(z.data)?z.data:""};r.prototype.get_object=function(){return this.object};r.prototype.get_combosel=
function(){return this.combosel};r.prototype.get_boolean=function(){return!!this.combosel};r.prototype.get_layer=function(z){this.solindex=z||0;z=h();this.expression.get(z);C--;return z.is_number()?this.runtime.getLayerByNumber(z.data):this.runtime.getLayerByName(z.data)};r.prototype.get_layout=function(){return this.layout};r.prototype.get_key=function(){return this.key};r.prototype.get_instvar=function(){return this.index};r.prototype.get_familyvar=function(z){var K=z||0;z=this.owner.type;var S=
z.getCurrentSol(),L=S.getObjects();if(L.length)K=L[K%L.length].type;else if(S.else_instances.length)K=S.else_instances[K%S.else_instances.length].type;else if(z.instances.length)K=z.instances[K%z.instances.length].type;else return 0;return this.index+K.family_var_map[z.family_index]};r.prototype.get_eventvar=function(){return this.eventvar};r.prototype.get_audiofile=function(){return this.fileinfo};r.prototype.get_variadic=function(){var z;var K=0;for(z=this.subparams.length;K<z;K++)this.variadicret[K]=
this.subparams[K].get();return this.variadicret};cr.parameter=r;w.prototype.postInit=function(){this.solModifiers=k(this.solModifiers)};w.prototype.setValue=function(z){var K=this.runtime.getCurrentLocalVarStack();this.parent&&!this.is_static&&K?(this.localIndex>=K.length&&(K.length=this.localIndex+1),K[this.localIndex]=z):this.data=z};w.prototype.getValue=function(){var z=this.runtime.getCurrentLocalVarStack();return!this.parent||this.is_static||!z||this.is_constant?this.data:this.localIndex>=z.length||
"undefined"===typeof z[this.localIndex]?this.initial:z[this.localIndex]};w.prototype.run=function(){!this.parent||this.is_static||this.is_constant||this.setValue(this.initial)};cr.eventvariable=w;E.prototype.toString=function(){return"include:"+this.include_sheet.toString()};E.prototype.postInit=function(){this.include_sheet=this.runtime.eventsheets[this.include_sheet_name];this.sheet.includes.add(this);this.solModifiers=k(this.solModifiers);for(var z=this.parent;z;)z.group&&z.contained_includes.push(this),
z=z.parent;this.updateActive()};E.prototype.run=function(){this.parent&&this.runtime.pushCleanSol(this.runtime.types_by_index);this.include_sheet.hasRun||this.include_sheet.run(!0);this.parent&&this.runtime.popSol(this.runtime.types_by_index)};E.prototype.updateActive=function(){for(var z=this.parent;z;){if(z.group&&!z.group_active){this.active=!1;return}z=z.parent}this.active=!0};E.prototype.isActive=function(){return this.active};cr.eventinclude=E;t.prototype.reset=function(z){this.current_event=
z;this.actindex=this.cndindex=0;cr.clearArray(this.temp_parents_arr);this.any_true_state=this.else_branch_ran=this.last_event_true=!1};t.prototype.isModifierAfterCnds=function(){return this.current_event.solWriterAfterCnds?!0:this.cndindex<this.current_event.conditions.length-1?!!this.current_event.solModifiers.length:!1};cr.eventStackFrame=t})();
(function(){function b(e,a){this.owner=e;this.runtime=e.runtime;this.type=a[0];this.get=[this.eval_int,this.eval_float,this.eval_string,this.eval_unaryminus,this.eval_add,this.eval_subtract,this.eval_multiply,this.eval_divide,this.eval_mod,this.eval_power,this.eval_and,this.eval_or,this.eval_equal,this.eval_notequal,this.eval_less,this.eval_lessequal,this.eval_greater,this.eval_greaterequal,this.eval_conditional,this.eval_system_exp,this.eval_object_exp,this.eval_instvar_exp,this.eval_behavior_exp,
this.eval_eventvar_exp][this.type];var d=null;this.object_type=this.parameters=this.results=this.func=this.third=this.second=this.first=this.value=null;this.beh_index=-1;this.instance_expr=null;this.varindex=-1;this.eventvar=this.varname=this.behavior_type=null;this.return_string=!1;switch(this.type){case 0:case 1:case 2:this.value=a[1];break;case 3:this.first=new cr.expNode(e,a[1]);break;case 18:this.first=new cr.expNode(e,a[1]);this.second=new cr.expNode(e,a[2]);this.third=new cr.expNode(e,a[3]);
break;case 19:this.func=this.runtime.GetObjectReference(a[1]);this.func!==cr.system_object.prototype.exps.random&&this.func!==cr.system_object.prototype.exps.choose||this.owner.setVaries();this.results=[];this.parameters=[];3===a.length?(d=a[2],this.results.length=d.length+1):this.results.length=1;break;case 20:this.object_type=this.runtime.types_by_index[a[1]];this.beh_index=-1;this.func=this.runtime.GetObjectReference(a[2]);this.return_string=a[3];cr.plugins_.Function&&this.func===cr.plugins_.Function.prototype.exps.Call&&
this.owner.setVaries();this.instance_expr=a[4]?new cr.expNode(e,a[4]):null;this.results=[];this.parameters=[];6===a.length?(d=a[5],this.results.length=d.length+1):this.results.length=1;break;case 21:this.object_type=this.runtime.types_by_index[a[1]];this.return_string=a[2];this.instance_expr=a[3]?new cr.expNode(e,a[3]):null;this.varindex=a[4];break;case 22:this.object_type=this.runtime.types_by_index[a[1]];this.behavior_type=this.object_type.getBehaviorByName(a[2]);this.beh_index=this.object_type.getBehaviorIndexByName(a[2]);
this.func=this.runtime.GetObjectReference(a[3]);this.return_string=a[4];this.instance_expr=a[5]?new cr.expNode(e,a[5]):null;this.results=[];this.parameters=[];7===a.length?(d=a[6],this.results.length=d.length+1):this.results.length=1;break;case 23:this.varname=a[1],this.eventvar=null}this.owner.maybeVaryForType(this.object_type);4<=this.type&&17>=this.type&&(this.first=new cr.expNode(e,a[1]),this.second=new cr.expNode(e,a[2]));if(d){var h;a=0;for(h=d.length;a<h;a++)this.parameters.push(new cr.expNode(e,
d[a]))}cr.seal(this)}function f(){++n;v.length===n&&v.push(new cr.expvalue);return v[n]}function k(e,a,d){var h;var r=0;for(h=e.length;r<h;++r)e[r].get(d),a[r+1]=d.data}function q(e,a){this.type=e||cr.exptype.Integer;this.data=a||0;this.object_class=null;this.type==cr.exptype.Integer&&(this.data=Math.floor(this.data));cr.seal(this)}b.prototype.postInit=function(){23===this.type&&(this.eventvar=this.owner.runtime.getEventVariableByName(this.varname,this.owner.block.parent));this.first&&this.first.postInit();
this.second&&this.second.postInit();this.third&&this.third.postInit();this.instance_expr&&this.instance_expr.postInit();if(this.parameters){var e;var a=0;for(e=this.parameters.length;a<e;a++)this.parameters[a].postInit()}};var v=[],n=-1;b.prototype.eval_system_exp=function(e){var a=this.parameters,d=this.results;d[0]=e;e=f();k(a,d,e);--n;this.func.apply(this.runtime.system,d)};b.prototype.eval_object_exp=function(e){var a=this.object_type,d=this.results,h=this.parameters,r=this.instance_expr,w=this.func,
E=this.owner.solindex,t=a.getCurrentSol(),p=t.getObjects();if(!p.length)if(t.else_instances.length)p=t.else_instances;else{this.return_string?e.set_string(""):e.set_int(0);return}d[0]=e;e.object_class=a;e=f();k(h,d,e);r&&(r.get(e),e.is_number()&&(E=e.data,p=a.instances));--n;a=p.length;if(E>=a||E<=-a)E%=a;0>E&&(E+=a);w.apply(p[E],d)};b.prototype.eval_behavior_exp=function(e){var a=this.object_type,d=this.results,h=this.parameters,r=this.instance_expr,w=this.beh_index,E=this.func,t=this.owner.solindex,
p=a.getCurrentSol(),x=p.getObjects();if(!x.length)if(p.else_instances.length)x=p.else_instances;else{this.return_string?e.set_string(""):e.set_int(0);return}d[0]=e;e.object_class=a;e=f();k(h,d,e);r&&(r.get(e),e.is_number()&&(t=e.data,x=a.instances));--n;h=x.length;if(t>=h||t<=-h)t%=h;0>t&&(t+=h);t=x[t];x=0;a.is_family&&(x=t.type.family_beh_map[a.family_index]);E.apply(t.behavior_insts[w+x],d)};b.prototype.eval_instvar_exp=function(e){var a=this.instance_expr,d=this.object_type,h=this.varindex,r=this.owner.solindex,
w=d.getCurrentSol(),E=w.getObjects();if(!E.length)if(w.else_instances.length)E=w.else_instances;else{this.return_string?e.set_string(""):e.set_int(0);return}if(a){w=f();a.get(w);if(w.is_number()){r=w.data;E=d.instances;0!==E.length&&(r%=E.length,0>r&&(r+=E.length));r=d.getInstanceByIID(r);d=r.instance_vars[h];cr.is_string(d)?e.set_string(d):e.set_float(d);--n;return}--n}a=E.length;if(r>=a||r<=-a)r%=a;0>r&&(r+=a);r=E[r];E=0;d.is_family&&(E=r.type.family_var_map[d.family_index]);d=r.instance_vars[h+
E];cr.is_string(d)?e.set_string(d):e.set_float(d)};b.prototype.eval_int=function(e){e.type=cr.exptype.Integer;e.data=this.value};b.prototype.eval_float=function(e){e.type=cr.exptype.Float;e.data=this.value};b.prototype.eval_string=function(e){e.type=cr.exptype.String;e.data=this.value};b.prototype.eval_unaryminus=function(e){this.first.get(e);e.is_number()&&(e.data=-e.data)};b.prototype.eval_add=function(e){this.first.get(e);var a=f();this.second.get(a);e.is_number()&&a.is_number()&&(e.data+=a.data,
a.is_float()&&e.make_float());--n};b.prototype.eval_subtract=function(e){this.first.get(e);var a=f();this.second.get(a);e.is_number()&&a.is_number()&&(e.data-=a.data,a.is_float()&&e.make_float());--n};b.prototype.eval_multiply=function(e){this.first.get(e);var a=f();this.second.get(a);e.is_number()&&a.is_number()&&(e.data*=a.data,a.is_float()&&e.make_float());--n};b.prototype.eval_divide=function(e){this.first.get(e);var a=f();this.second.get(a);e.is_number()&&a.is_number()&&(e.data/=a.data,e.make_float());
--n};b.prototype.eval_mod=function(e){this.first.get(e);var a=f();this.second.get(a);e.is_number()&&a.is_number()&&(e.data%=a.data,a.is_float()&&e.make_float());--n};b.prototype.eval_power=function(e){this.first.get(e);var a=f();this.second.get(a);e.is_number()&&a.is_number()&&(e.data=Math.pow(e.data,a.data),a.is_float()&&e.make_float());--n};b.prototype.eval_and=function(e){this.first.get(e);var a=f();this.second.get(a);a.is_string()||e.is_string()?this.eval_and_stringconcat(e,a):this.eval_and_logical(e,
a);--n};b.prototype.eval_and_stringconcat=function(e,a){e.is_string()&&a.is_string()?this.eval_and_stringconcat_str_str(e,a):this.eval_and_stringconcat_num(e,a)};b.prototype.eval_and_stringconcat_str_str=function(e,a){e.data+=a.data};b.prototype.eval_and_stringconcat_num=function(e,a){e.is_string()?e.data+=(Math.round(1E10*a.data)/1E10).toString():e.set_string(e.data.toString()+a.data)};b.prototype.eval_and_logical=function(e,a){e.set_int(e.data&&a.data?1:0)};b.prototype.eval_or=function(e){this.first.get(e);
var a=f();this.second.get(a);e.is_number()&&a.is_number()&&(e.data||a.data?e.set_int(1):e.set_int(0));--n};b.prototype.eval_conditional=function(e){this.first.get(e);e.data?this.second.get(e):this.third.get(e)};b.prototype.eval_equal=function(e){this.first.get(e);var a=f();this.second.get(a);e.set_int(e.data===a.data?1:0);--n};b.prototype.eval_notequal=function(e){this.first.get(e);var a=f();this.second.get(a);e.set_int(e.data!==a.data?1:0);--n};b.prototype.eval_less=function(e){this.first.get(e);
var a=f();this.second.get(a);e.set_int(e.data<a.data?1:0);--n};b.prototype.eval_lessequal=function(e){this.first.get(e);var a=f();this.second.get(a);e.set_int(e.data<=a.data?1:0);--n};b.prototype.eval_greater=function(e){this.first.get(e);var a=f();this.second.get(a);e.set_int(e.data>a.data?1:0);--n};b.prototype.eval_greaterequal=function(e){this.first.get(e);var a=f();this.second.get(a);e.set_int(e.data>=a.data?1:0);--n};b.prototype.eval_eventvar_exp=function(e){var a=this.eventvar.getValue();"number"===
typeof a?e.set_float(a):"boolean"===typeof a?e.set_int(a?1:0):e.set_string(a)};cr.expNode=b;q.prototype.is_int=function(){return this.type===cr.exptype.Integer};q.prototype.is_float=function(){return this.type===cr.exptype.Float};q.prototype.is_number=function(){return this.type===cr.exptype.Integer||this.type===cr.exptype.Float};q.prototype.is_string=function(){return this.type===cr.exptype.String};q.prototype.make_int=function(){this.is_int()||(this.is_float()?this.data=Math.floor(this.data):this.is_string()&&
(this.data=parseInt(this.data,10)),this.type=cr.exptype.Integer)};q.prototype.make_float=function(){this.is_float()||(this.is_string()&&(this.data=parseFloat(this.data)),this.type=cr.exptype.Float)};q.prototype.make_string=function(){this.is_string()||(this.data=this.data.toString(),this.type=cr.exptype.String)};q.prototype.set_int=function(e){this.type=cr.exptype.Integer;this.data=Math.floor(e)};q.prototype.set_float=function(e){this.type=cr.exptype.Float;this.data=e};q.prototype.set_string=function(e){this.type=
cr.exptype.String;this.data=e};q.prototype.set_any=function(e){cr.is_number(e)?(this.type=cr.exptype.Float,this.data=e):cr.is_string(e)?(this.type=cr.exptype.String,this.data=e.toString()):(this.type=cr.exptype.Integer,this.data=0)};cr.expvalue=q;cr.exptype={Integer:0,Float:1,String:2}})();cr.system_object=function(b){this.runtime=b;this.waits=[]};
cr.system_object.prototype.saveToJSON=function(){var b={},f,k,q;b.waits=[];var v=b.waits;var n=0;for(f=this.waits.length;n<f;n++){var e=this.waits[n];var a={t:e.time,st:e.signaltag,s:e.signalled,ev:e.ev.sid,sm:[],sols:{}};e.ev.actions[e.actindex]&&(a.act=e.ev.actions[e.actindex].sid);var d=0;for(k=e.solModifiers.length;d<k;d++)a.sm.push(e.solModifiers[d].sid);for(q in e.sols)if(e.sols.hasOwnProperty(q)){var h=this.runtime.types_by_index[parseInt(q,10)];var r={sa:e.sols[q].sa,insts:[]};d=0;for(k=e.sols[q].insts.length;d<
k;d++)r.insts.push(e.sols[q].insts[d].uid);a.sols[h.sid.toString()]=r}v.push(a)}return b};
cr.system_object.prototype.loadFromJSON=function(b){b=b.waits;var f,k,q,v,n;cr.clearArray(this.waits);var e=0;for(f=b.length;e<f;e++){var a=b[e];if(v=this.runtime.blocksBySid[a.ev.toString()]){var d=-1;var h=0;for(k=v.actions.length;h<k;h++)if(v.actions[h].sid===a.act){d=h;break}if(-1!==d){var r={sols:{},solModifiers:[],deleteme:!1};r.time=a.t;r.signaltag=a.st||"";r.signalled=!!a.s;r.ev=v;r.actindex=d;h=0;for(k=a.sm.length;h<k;h++)(v=this.runtime.getObjectTypeBySid(a.sm[h]))&&r.solModifiers.push(v);
for(q in a.sols)if(a.sols.hasOwnProperty(q)&&(v=this.runtime.getObjectTypeBySid(parseInt(q,10)))){d=a.sols[q];var w={sa:d.sa,insts:[]};h=0;for(k=d.insts.length;h<k;h++)(n=this.runtime.getObjectByUID(d.insts[h]))&&w.insts.push(n);r.sols[v.index.toString()]=w}this.waits.push(r)}}}};
(function(){function b(){}function f(g,l){g=g.extra.c2_feo_val;l=l.extra.c2_feo_val;if(cr.is_number(g)&&cr.is_number(l))return g-l;g=""+g;l=""+l;return g<l?-1:g>l?1:0}function k(g,l){t&&g===p&&l===x||(t=new RegExp(g,l),p=g,x=l);t.lastIndex=0;return t}function q(){}function v(){var g=z.length?z.pop():{sols:{},solModifiers:[]};g.deleteme=!1;return g}function n(){var g=K.length?K.pop():{insts:[]};g.sa=!1;return g}function e(g,l){var u=g[0]-l[0];return 0!==u?u:g[1]-l[1]}function a(g,l){return g[1]-l[1]}
function d(){}function h(g,l,u){if(g!==L||l!==R||u!==F){var c=k(l,u);S=g.match(c);L=g;R=l;F=u}}var r=cr.system_object.prototype;b.prototype.EveryTick=function(){return!0};b.prototype.OnLayoutStart=function(){return!0};b.prototype.OnLayoutEnd=function(){return!0};b.prototype.Compare=function(g,l,u){return cr.do_cmp(g,l,u)};b.prototype.CompareTime=function(g,l){var u=this.runtime.kahanTime.sum;return 0===g?(g=this.runtime.getCurrentCondition(),!g.extra.CompareTime_executed&&u>=l?g.extra.CompareTime_executed=
!0:!1):cr.do_cmp(u,g,l)};b.prototype.LayerVisible=function(g){return g?g.visible:!1};b.prototype.LayerEmpty=function(g){return g?!g.instances.length:!1};b.prototype.LayerCmpOpacity=function(g,l,u){return g?cr.do_cmp(100*g.opacity,l,u):!1};b.prototype.Repeat=function(g){var l=this.runtime.getCurrentEventStack(),u=l.current_event,c=l.isModifierAfterCnds();l=this.runtime.pushLoopStack();if(c)for(c=0;c<g&&!l.stopped;c++)this.runtime.pushCopySol(u.solModifiers),l.index=c,u.retrigger(),this.runtime.popSol(u.solModifiers);
else for(c=0;c<g&&!l.stopped;c++)l.index=c,u.retrigger();this.runtime.popLoopStack();return!1};b.prototype.While=function(g){var l=this.runtime.getCurrentEventStack();g=l.current_event;var u=l.isModifierAfterCnds();l=this.runtime.pushLoopStack();if(u)for(u=0;!l.stopped;u++)this.runtime.pushCopySol(g.solModifiers),l.index=u,g.retrigger()||(l.stopped=!0),this.runtime.popSol(g.solModifiers);else for(u=0;!l.stopped;u++)l.index=u,g.retrigger()||(l.stopped=!0);this.runtime.popLoopStack();return!1};b.prototype.For=
function(g,l,u){var c=this.runtime.getCurrentEventStack(),y=c.current_event;c=c.isModifierAfterCnds();g=this.runtime.pushLoopStack(g);if(u<l)if(c)for(;l>=u&&!g.stopped;--l)this.runtime.pushCopySol(y.solModifiers),g.index=l,y.retrigger(),this.runtime.popSol(y.solModifiers);else for(;l>=u&&!g.stopped;--l)g.index=l,y.retrigger();else if(c)for(;l<=u&&!g.stopped;++l)this.runtime.pushCopySol(y.solModifiers),g.index=l,y.retrigger(),this.runtime.popSol(y.solModifiers);else for(;l<=u&&!g.stopped;++l)g.index=
l,y.retrigger();this.runtime.popLoopStack();return!1};var w=[],E=-1;b.prototype.ForEach=function(g){var l=g.getCurrentSol();E++;w.length===E&&w.push([]);var u=w[E];cr.shallowAssignArray(u,l.getObjects());var c=this.runtime.getCurrentEventStack(),y=c.current_event,H=c.isModifierAfterCnds();c=this.runtime.pushLoopStack();var O,U,Y=g.is_contained;if(H)for(H=0,O=u.length;H<O&&!c.stopped;H++){this.runtime.pushCopySol(y.solModifiers);var aa=u[H];l=g.getCurrentSol();l.select_all=!1;cr.clearArray(l.instances);
l.instances[0]=aa;if(Y){var ca=0;for(U=aa.siblings.length;ca<U;ca++){var ha=aa.siblings[ca];var fa=ha.type.getCurrentSol();fa.select_all=!1;cr.clearArray(fa.instances);fa.instances[0]=ha}}c.index=H;y.retrigger();this.runtime.popSol(y.solModifiers)}else for(l.select_all=!1,cr.clearArray(l.instances),H=0,O=u.length;H<O&&!c.stopped;H++){aa=u[H];l.instances[0]=aa;if(Y)for(ca=0,U=aa.siblings.length;ca<U;ca++)ha=aa.siblings[ca],fa=ha.type.getCurrentSol(),fa.select_all=!1,cr.clearArray(fa.instances),fa.instances[0]=
ha;c.index=H;y.retrigger()}cr.clearArray(u);this.runtime.popLoopStack();E--;return!1};b.prototype.ForEachOrdered=function(g,l,u){l=g.getCurrentSol();E++;w.length===E&&w.push([]);var c=w[E];cr.shallowAssignArray(c,l.getObjects());var y=this.runtime.getCurrentEventStack(),H=y.current_event,O=this.runtime.getCurrentCondition(),U=y.isModifierAfterCnds();y=this.runtime.pushLoopStack();var Y;var aa=0;for(Y=c.length;aa<Y;aa++)c[aa].extra.c2_feo_val=O.parameters[1].get(aa);c.sort(f);1===u&&c.reverse();u=
g.is_contained;if(U)for(aa=0,Y=c.length;aa<Y&&!y.stopped;aa++){this.runtime.pushCopySol(H.solModifiers);var ca=c[aa];l=g.getCurrentSol();l.select_all=!1;cr.clearArray(l.instances);l.instances[0]=ca;if(u)for(O=0,U=ca.siblings.length;O<U;O++){var ha=ca.siblings[O];var fa=ha.type.getCurrentSol();fa.select_all=!1;cr.clearArray(fa.instances);fa.instances[0]=ha}y.index=aa;H.retrigger();this.runtime.popSol(H.solModifiers)}else for(l.select_all=!1,cr.clearArray(l.instances),aa=0,Y=c.length;aa<Y&&!y.stopped;aa++){ca=
c[aa];l.instances[0]=ca;if(u)for(O=0,U=ca.siblings.length;O<U;O++)ha=ca.siblings[O],fa=ha.type.getCurrentSol(),fa.select_all=!1,cr.clearArray(fa.instances),fa.instances[0]=ha;y.index=aa;H.retrigger()}cr.clearArray(c);this.runtime.popLoopStack();E--;return!1};b.prototype.PickByComparison=function(g,l,u,c){var y,H;if(g){E++;w.length===E&&w.push([]);var O=w[E],U=g.getCurrentSol();cr.shallowAssignArray(O,U.getObjects());U.select_all&&cr.clearArray(U.else_instances);var Y=this.runtime.getCurrentCondition();
var aa=y=0;for(H=O.length;y<H;y++){var ca=O[y];O[aa]=ca;l=Y.parameters[1].get(y);c=Y.parameters[3].get(y);cr.do_cmp(l,u,c)?aa++:U.else_instances.push(ca)}cr.truncateArray(O,aa);U.select_all=!1;cr.shallowAssignArray(U.instances,O);cr.clearArray(O);E--;g.applySolToContainer();return!!U.instances.length}};b.prototype.PickByEvaluate=function(g,l){var u,c;if(g){E++;w.length===E&&w.push([]);var y=w[E],H=g.getCurrentSol();cr.shallowAssignArray(y,H.getObjects());H.select_all&&cr.clearArray(H.else_instances);
var O=this.runtime.getCurrentCondition();var U=u=0;for(c=y.length;u<c;u++){var Y=y[u];y[U]=Y;(l=O.parameters[1].get(u))?U++:H.else_instances.push(Y)}cr.truncateArray(y,U);H.select_all=!1;cr.shallowAssignArray(H.instances,y);cr.clearArray(y);E--;g.applySolToContainer();return!!H.instances.length}};b.prototype.TriggerOnce=function(){var g=this.runtime.getCurrentCondition().extra;"undefined"===typeof g.TriggerOnce_lastTick&&(g.TriggerOnce_lastTick=-1);var l=g.TriggerOnce_lastTick,u=this.runtime.tickcount;
g.TriggerOnce_lastTick=u;return this.runtime.layout_first_tick||l!==u-1};b.prototype.Every=function(g){var l=this.runtime.getCurrentCondition(),u=l.extra.Every_lastTime||0,c=this.runtime.kahanTime.sum;"undefined"===typeof l.extra.Every_seconds&&(l.extra.Every_seconds=g);var y=l.extra.Every_seconds;if(c>=u+y)return l.extra.Every_lastTime=u+y,c>=l.extra.Every_lastTime+.04&&(l.extra.Every_lastTime=c),l.extra.Every_seconds=g,!0;c<u-.1&&(l.extra.Every_lastTime=c);return!1};b.prototype.PickNth=function(g,
l){if(!g)return!1;var u=g.getCurrentSol(),c=u.getObjects();l=cr.floor(l);if(0>l||l>=c.length)return!1;u.pick_one(c[l]);g.applySolToContainer();return!0};b.prototype.PickRandom=function(g){if(!g)return!1;var l=g.getCurrentSol(),u=l.getObjects(),c=cr.floor(Math.random()*u.length);if(c>=u.length)return!1;l.pick_one(u[c]);g.applySolToContainer();return!0};b.prototype.CompareVar=function(g,l,u){return cr.do_cmp(g.getValue(),l,u)};b.prototype.CompareBoolVar=function(g){return g.getValue()};b.prototype.IsGroupActive=
function(g){return(g=this.runtime.groups_by_name[g.toLowerCase()])&&g.group_active};b.prototype.IsPreview=function(){return this.runtime.isPreview};b.prototype.PickAll=function(g){if(!g||!g.instances.length)return!1;g.getCurrentSol().select_all=!0;g.applySolToContainer();return!0};b.prototype.IsMobile=function(){return this.runtime.isMobile};b.prototype.CompareBetween=function(g,l,u){return g>=l&&g<=u};b.prototype.Else=function(){var g=this.runtime.getCurrentEventStack();return g.else_branch_ran?
!1:!g.last_event_true};b.prototype.OnLoadFinished=function(){return!0};b.prototype.OnCanvasSnapshot=function(){return!0};b.prototype.EffectsSupported=function(){return!!this.runtime.glwrap};b.prototype.OnSaveComplete=function(){return!0};b.prototype.OnSaveFailed=function(){return!0};b.prototype.OnLoadComplete=function(){return!0};b.prototype.OnLoadFailed=function(){return!0};b.prototype.ObjectUIDExists=function(g){return!!this.runtime.getObjectByUID(g)};b.prototype.IsOnPlatform=function(g){var l=
this.runtime;switch(g){case 0:return!l.isNodeWebkit&&!l.isCordova&&!l.isWinJS&&!l.isWindowsPhone8&&!l.isBlackberry10&&!l.isAmazonWebApp;case 1:return l.isiOS;case 2:return l.isAndroid;case 3:return l.isWindows8App;case 4:return l.isWindowsPhone8;case 5:return l.isBlackberry10;case 6:return l.isTizen;case 7:return!1;case 8:return l.isCordova;case 9:return l.isArcade;case 10:return l.isNodeWebkit;case 11:return l.isCrosswalk;case 12:return l.isAmazonWebApp;case 13:return l.isWindows10;default:return!1}};
var t=null,p="",x="";b.prototype.RegexTest=function(g,l,u){return k(l,u).test(g)};var C=[];b.prototype.PickOverlappingPoint=function(g,l,u){if(!g)return!1;var c=g.getCurrentSol(),y=c.getObjects(),H=this.runtime.getCurrentEventStack().current_event.orblock,O=this.runtime.getCurrentCondition(),U;c.select_all?(cr.shallowAssignArray(C,y),cr.clearArray(c.else_instances),c.select_all=!1,cr.clearArray(c.instances)):H?(cr.shallowAssignArray(C,c.else_instances),cr.clearArray(c.else_instances)):(cr.shallowAssignArray(C,
y),cr.clearArray(c.instances));y=0;for(H=C.length;y<H;++y){var Y=C[y];Y.update_bbox();(U=cr.xor(Y.contains_pt(l,u),O.inverted))?c.instances.push(Y):c.else_instances.push(Y)}g.applySolToContainer();return cr.xor(!!c.instances.length,O.inverted)};b.prototype.PickLastCreated=function(g){if(!g)return!1;var l=this.runtime.createRow,u,c=null,y=g.is_family;for(u=l.length-1;0<=u;--u){var H=l[u];if(y){if(0<=H.type.families.indexOf(g)){c=H;break}}else if(H.type===g){c=H;break}}!c&&g.instances.length&&(c=g.instances[g.instances.length-
1]);if(!c)return!1;g.getCurrentSol().pick_one(c);g.applySolToContainer();return!0};b.prototype.IsNaN=function(g){return!!isNaN(g)};b.prototype.AngleWithin=function(g,l,u){return cr.angleDiff(cr.to_radians(g),cr.to_radians(u))<=cr.to_radians(l)};b.prototype.IsClockwiseFrom=function(g,l){return cr.angleClockwise(cr.to_radians(g),cr.to_radians(l))};b.prototype.IsBetweenAngles=function(g,l,u){g=cr.to_clamped_radians(g);l=cr.to_clamped_radians(l);u=cr.to_clamped_radians(u);return cr.angleClockwise(u,l)?
cr.angleClockwise(g,l)&&!cr.angleClockwise(g,u):!(!cr.angleClockwise(g,l)&&cr.angleClockwise(g,u))};b.prototype.IsValueType=function(g,l){return"number"===typeof g?0===l:1===l};r.cnds=new b;q.prototype.GoToLayout=function(g){this.runtime.isloading||this.runtime.changelayout||(this.runtime.changelayout=g)};q.prototype.NextPrevLayout=function(g){if(!this.runtime.isloading&&!this.runtime.changelayout){var l=this.runtime.layouts_by_index.indexOf(this.runtime.running_layout);if(!g||0!==l)if(g||l!==this.runtime.layouts_by_index.length-
1)this.runtime.changelayout=this.runtime.layouts_by_index[l+(g?-1:1)]}};q.prototype.CreateObject=function(g,l,u,c){if(l&&g&&(l=this.runtime.createInstance(g,l,u,c))){this.runtime.isInOnDestroy++;this.runtime.trigger(Object.getPrototypeOf(g.plugin).cnds.OnCreated,l);if(l.is_contained)for(u=0,c=l.siblings.length;u<c;u++){var y=l.siblings[u];this.runtime.trigger(Object.getPrototypeOf(y.type.plugin).cnds.OnCreated,y)}this.runtime.isInOnDestroy--;g=g.getCurrentSol();g.select_all=!1;cr.clearArray(g.instances);
g.instances[0]=l;if(l.is_contained)for(u=0,c=l.siblings.length;u<c;u++)y=l.siblings[u],g=y.type.getCurrentSol(),g.select_all=!1,cr.clearArray(g.instances),g.instances[0]=y}};q.prototype.CreateObjectByName=function(g,l,u,c){l&&g&&(g=this.runtime.types_lowercase[g.toLowerCase()])&&q.prototype.CreateObject.call(this,g,l,u,c)};q.prototype.SetLayerVisible=function(g,l){g&&g.visible!==l&&(g.visible=l,this.runtime.redraw=!0)};q.prototype.SetLayerOpacity=function(g,l){g&&(l=cr.clamp(l/100,0,1),g.opacity!==
l&&(g.opacity=l,this.runtime.redraw=!0))};q.prototype.SetLayerScaleRate=function(g,l){g&&g.zoomRate!==l&&(g.zoomRate=l,this.runtime.redraw=!0)};q.prototype.SetLayerForceOwnTexture=function(g,l){g&&(l=!!l,g.forceOwnTexture!==l&&(g.forceOwnTexture=l,this.runtime.redraw=!0))};q.prototype.SetLayoutScale=function(g){this.runtime.running_layout&&this.runtime.running_layout.scale!==g&&(this.runtime.running_layout.scale=g,this.runtime.running_layout.boundScrolling(),this.runtime.redraw=!0)};q.prototype.ScrollX=
function(g){this.runtime.running_layout.scrollToX(g)};q.prototype.ScrollY=function(g){this.runtime.running_layout.scrollToY(g)};q.prototype.Scroll=function(g,l){this.runtime.running_layout.scrollToX(g);this.runtime.running_layout.scrollToY(l)};q.prototype.ScrollToObject=function(g){if(g=g.getFirstPicked())this.runtime.running_layout.scrollToX(g.x),this.runtime.running_layout.scrollToY(g.y)};q.prototype.SetVar=function(g,l){0===g.vartype?cr.is_number(l)?g.setValue(l):g.setValue(parseFloat(l)):1===
g.vartype&&g.setValue(l.toString())};q.prototype.AddVar=function(g,l){0===g.vartype?cr.is_number(l)?g.setValue(g.getValue()+l):g.setValue(g.getValue()+parseFloat(l)):1===g.vartype&&g.setValue(g.getValue()+l.toString())};q.prototype.SubVar=function(g,l){0===g.vartype&&(cr.is_number(l)?g.setValue(g.getValue()-l):g.setValue(g.getValue()-parseFloat(l)))};q.prototype.SetBoolVar=function(g,l){g.setValue(0!==l)};q.prototype.ToggleBoolVar=function(g){g.setValue(!g.getValue())};q.prototype.SetGroupActive=
function(g,l){if(g=this.runtime.groups_by_name[g.toLowerCase()])switch(l){case 0:g.setGroupActive(!1);break;case 1:g.setGroupActive(!0);break;case 2:g.setGroupActive(!g.group_active)}};q.prototype.SetTimescale=function(g){0>g&&(g=0);this.runtime.timescale=g};q.prototype.SetObjectTimescale=function(g,l){0>l&&(l=0);if(g){g=g.getCurrentSol().getObjects();var u;var c=0;for(u=g.length;c<u;c++)g[c].my_timescale=l}};q.prototype.RestoreObjectTimescale=function(g){if(!g)return!1;g=g.getCurrentSol().getObjects();
var l;var u=0;for(l=g.length;u<l;u++)g[u].my_timescale=-1};var z=[],K=[];q.prototype.Wait=function(g){if(!(0>g)){var l,u=this.runtime.getCurrentEventStack(),c=v();c.time=this.runtime.kahanTime.sum+g;c.signaltag="";c.signalled=!1;c.ev=u.current_event;c.actindex=u.actindex+1;g=0;for(l=this.runtime.types_by_index.length;g<l;g++){var y=this.runtime.types_by_index[g];var H=y.getCurrentSol();H.select_all&&-1===u.current_event.solModifiers.indexOf(y)||(c.solModifiers.push(y),y=n(),y.sa=H.select_all,cr.shallowAssignArray(y.insts,
H.instances),c.sols[g.toString()]=y)}this.waits.push(c);return!0}};q.prototype.WaitForSignal=function(g){var l,u=this.runtime.getCurrentEventStack(),c=v();c.time=-1;c.signaltag=g.toLowerCase();c.signalled=!1;c.ev=u.current_event;c.actindex=u.actindex+1;g=0;for(l=this.runtime.types_by_index.length;g<l;g++){var y=this.runtime.types_by_index[g];var H=y.getCurrentSol();H.select_all&&-1===u.current_event.solModifiers.indexOf(y)||(c.solModifiers.push(y),y=n(),y.sa=H.select_all,cr.shallowAssignArray(y.insts,
H.instances),c.sols[g.toString()]=y)}this.waits.push(c);return!0};q.prototype.Signal=function(g){g=g.toLowerCase();var l;var u=0;for(l=this.waits.length;u<l;++u){var c=this.waits[u];-1===c.time&&c.signaltag===g&&(c.signalled=!0)}};q.prototype.SetLayerScale=function(g,l){g&&g.scale!==l&&(g.scale=l,this.runtime.redraw=!0)};q.prototype.ResetGlobals=function(){var g;var l=0;for(g=this.runtime.all_global_vars.length;l<g;l++){var u=this.runtime.all_global_vars[l];u.data=u.initial}};q.prototype.SetLayoutAngle=
function(g){g=cr.to_radians(g);g=cr.clamp_angle(g);this.runtime.running_layout&&this.runtime.running_layout.angle!==g&&(this.runtime.running_layout.angle=g,this.runtime.redraw=!0)};q.prototype.SetLayerAngle=function(g,l){g&&(l=cr.to_radians(l),l=cr.clamp_angle(l),g.angle!==l&&(g.angle=l,this.runtime.redraw=!0))};q.prototype.SetLayerParallax=function(g,l,u){if(g&&(g.parallaxX!==l/100||g.parallaxY!==u/100)){g.parallaxX=l/100;g.parallaxY=u/100;if(1!==g.parallaxX||1!==g.parallaxY)for(u=g.instances,g=
0,l=u.length;g<l;++g)u[g].type.any_instance_parallaxed=!0;this.runtime.redraw=!0}};q.prototype.SetLayerBackground=function(g,l){if(g){var u=cr.clamp(Math.floor(255*cr.GetRValue(l)),0,255),c=cr.clamp(Math.floor(255*cr.GetGValue(l)),0,255);l=cr.clamp(Math.floor(255*cr.GetBValue(l)),0,255);if(g.background_color[0]!==u||g.background_color[1]!==c||g.background_color[2]!==l)g.background_color[0]=u,g.background_color[1]=c,g.background_color[2]=l,this.runtime.redraw=!0}};q.prototype.SetLayerTransparent=function(g,
l){g&&!!l!==!!g.transparent&&(g.transparent=!!l,this.runtime.redraw=!0)};q.prototype.SetLayerBlendMode=function(g,l){g&&g.blend_mode!==l&&(g.blend_mode=l,g.compositeOp=cr.effectToCompositeOp(g.blend_mode),this.runtime.gl&&cr.setGLBlend(g,g.blend_mode,this.runtime.gl),this.runtime.redraw=!0)};q.prototype.StopLoop=function(){0>this.runtime.loop_stack_index||(this.runtime.getCurrentLoop().stopped=!0)};q.prototype.GoToLayoutByName=function(g){if(!this.runtime.isloading&&!this.runtime.changelayout)for(var l in this.runtime.layouts)if(this.runtime.layouts.hasOwnProperty(l)&&
cr.equals_nocase(l,g)){this.runtime.changelayout=this.runtime.layouts[l];break}};q.prototype.RestartLayout=function(g){if(!this.runtime.isloading&&!this.runtime.changelayout&&this.runtime.running_layout){this.runtime.changelayout=this.runtime.running_layout;var l;g=0;for(l=this.runtime.allGroups.length;g<l;g++){var u=this.runtime.allGroups[g];u.setGroupActive(u.initially_activated)}}};q.prototype.SnapshotCanvas=function(g,l){this.runtime.doCanvasSnapshot(0===g?"image/png":"image/jpeg",l/100)};q.prototype.SetCanvasSize=
function(g,l){if(!(0>=g||0>=l)){var u=this.runtime.fullscreen_mode;(document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement||document.fullScreen)&&0<this.runtime.fullscreen_scaling&&(u=this.runtime.fullscreen_scaling);0===u?this.runtime.setSize(g,l,!0):(this.runtime.original_width=g,this.runtime.original_height=l,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0))}};q.prototype.SetLayoutEffectEnabled=function(g,l){this.runtime.running_layout&&
this.runtime.glwrap&&(l=this.runtime.running_layout.getEffectByName(l))&&(g=1===g,l.active!=g&&(l.active=g,this.runtime.running_layout.updateActiveEffects(),this.runtime.redraw=!0))};q.prototype.SetLayerEffectEnabled=function(g,l,u){g&&this.runtime.glwrap&&(u=g.getEffectByName(u))&&(l=1===l,u.active!=l&&(u.active=l,g.updateActiveEffects(),this.runtime.redraw=!0))};q.prototype.SetLayoutEffectParam=function(g,l,u){if(this.runtime.running_layout&&this.runtime.glwrap&&(g=this.runtime.running_layout.getEffectByName(g))){var c=
this.runtime.running_layout.effect_params[g.index];l=Math.floor(l);if(!(0>l||l>=c.length)){var y=this.runtime.glwrap.getProgramParameterType(g.shaderindex,l);1===y?u/=100:2===y&&(u=[cr.GetRValue(u),cr.GetGValue(u),cr.GetBValue(u)]);c[l]!==u&&(c[l]=u,g.active&&(this.runtime.redraw=!0))}}};q.prototype.SetLayerEffectParam=function(g,l,u,c){if(g&&this.runtime.glwrap&&(l=g.getEffectByName(l))&&(g=g.effect_params[l.index],u=Math.floor(u),!(0>u||u>=g.length))){var y=this.runtime.glwrap.getProgramParameterType(l.shaderindex,
u);1===y?c/=100:2===y&&(c=[cr.GetRValue(c),cr.GetGValue(c),cr.GetBValue(c)]);g[u]!==c&&(g[u]=c,l.active&&(this.runtime.redraw=!0))}};q.prototype.SaveState=function(g){this.runtime.saveToSlot=g};q.prototype.LoadState=function(g){this.runtime.loadFromSlot=g};q.prototype.LoadStateJSON=function(g){this.runtime.loadFromJson=g};q.prototype.SetHalfFramerateMode=function(g){this.runtime.halfFramerateMode=0!==g};q.prototype.SetFullscreenQuality=function(g){if(document.mozFullScreen||document.webkitIsFullScreen||
document.msFullscreenElement||document.fullScreen||0!==this.runtime.fullscreen_mode)this.runtime.wantFullscreenScalingQuality=0!==g,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0)};q.prototype.ResetPersisted=function(){var g;var l=0;for(g=this.runtime.layouts_by_index.length;l<g;++l)this.runtime.layouts_by_index[l].persist_data={},this.runtime.layouts_by_index[l].first_visit=!0};q.prototype.RecreateInitialObjects=function(g,l,u,c,y){g&&this.runtime.running_layout.recreateInitialObjects(g,
l,u,c,y)};q.prototype.SetPixelRounding=function(g){this.runtime.pixel_rounding=0!==g;this.runtime.redraw=!0};q.prototype.SetMinimumFramerate=function(g){1>g&&(g=1);120<g&&(g=120);this.runtime.minimumFramerate=g};q.prototype.SortZOrderByInstVar=function(g,l){if(g){var u;var c=g.getCurrentSol().getObjects();var y=[],H=[],O=this.runtime.running_layout,U=g.is_family,Y=g.family_index,aa=!1;g=0;for(u=c.length;g<u;++g){var ca=c[g];if(ca.layer){var ha=U?ca.instance_vars[l+ca.type.family_var_map[Y]]:ca.instance_vars[l];
y.push([ca.layer.index,ca.get_zindex()]);H.push([ca,ha])}}if(y.length){y.sort(e);H.sort(a);g=0;for(u=y.length;g<u;++g)ca=H[g][0],l=O.layers[y[g][0]],c=y[g][1],l.instances[c]!==ca&&(l.instances[c]=ca,ca.layer=l,l.setZIndicesStaleFrom(c),aa=!0);aa&&(this.runtime.redraw=!0)}}};r.acts=new q;d.prototype.int=function(g,l){cr.is_string(l)?(g.set_int(parseInt(l,10)),isNaN(g.data)&&(g.data=0)):g.set_int(l)};d.prototype.float=function(g,l){cr.is_string(l)?(g.set_float(parseFloat(l)),isNaN(g.data)&&(g.data=
0)):g.set_float(l)};d.prototype.str=function(g,l){cr.is_string(l)?g.set_string(l):g.set_string(l.toString())};d.prototype.len=function(g,l){g.set_int(l.length||0)};d.prototype.random=function(g,l,u){void 0===u?g.set_float(Math.random()*l):g.set_float(Math.random()*(u-l)+l)};d.prototype.sqrt=function(g,l){g.set_float(Math.sqrt(l))};d.prototype.abs=function(g,l){g.set_float(Math.abs(l))};d.prototype.round=function(g,l){g.set_int(Math.round(l))};d.prototype.floor=function(g,l){g.set_int(Math.floor(l))};
d.prototype.ceil=function(g,l){g.set_int(Math.ceil(l))};d.prototype.sign=function(g,l){g.set_float(Math.sign(l))};d.prototype.sin=function(g,l){g.set_float(Math.sin(cr.to_radians(l)))};d.prototype.cos=function(g,l){g.set_float(Math.cos(cr.to_radians(l)))};d.prototype.tan=function(g,l){g.set_float(Math.tan(cr.to_radians(l)))};d.prototype.asin=function(g,l){g.set_float(cr.to_degrees(Math.asin(l)))};d.prototype.acos=function(g,l){g.set_float(cr.to_degrees(Math.acos(l)))};d.prototype.atan=function(g,
l){g.set_float(cr.to_degrees(Math.atan(l)))};d.prototype.exp=function(g,l){g.set_float(Math.exp(l))};d.prototype.ln=function(g,l){g.set_float(Math.log(l))};d.prototype.log10=function(g,l){g.set_float(Math.log(l)/Math.LN10)};d.prototype.max=function(g){var l=arguments[1];"number"!==typeof l&&(l=0);var u;var c=2;for(u=arguments.length;c<u;c++){var y=arguments[c];"number"===typeof y&&l<y&&(l=y)}g.set_float(l)};d.prototype.min=function(g){var l=arguments[1];"number"!==typeof l&&(l=0);var u;var c=2;for(u=
arguments.length;c<u;c++){var y=arguments[c];"number"===typeof y&&l>y&&(l=y)}g.set_float(l)};d.prototype.dt=function(g){g.set_float(this.runtime.dt)};d.prototype.timescale=function(g){g.set_float(this.runtime.timescale)};d.prototype.wallclocktime=function(g){g.set_float((Date.now()-this.runtime.start_time)/1E3)};d.prototype.unixtime=function(g){g.set_float(Date.now())};d.prototype.time=function(g){g.set_float(this.runtime.kahanTime.sum)};d.prototype.tickcount=function(g){g.set_int(this.runtime.tickcount)};
d.prototype.objectcount=function(g){g.set_int(this.runtime.objectcount)};d.prototype.fps=function(g){g.set_int(this.runtime.fps)};d.prototype.loopindex=function(g,l){var u;if(this.runtime.loop_stack.length)if(l){for(u=this.runtime.loop_stack_index;0<=u;--u){var c=this.runtime.loop_stack[u];if(c.name===l){g.set_int(c.index);return}}g.set_int(0)}else c=this.runtime.getCurrentLoop(),g.set_int(c?c.index:-1);else g.set_int(0)};d.prototype.distance=function(g,l,u,c,y){g.set_float(cr.distanceTo(l,u,c,y))};
d.prototype.angle=function(g,l,u,c,y){g.set_float(cr.to_degrees(cr.angleTo(l,u,c,y)))};d.prototype.scrollx=function(g){g.set_float(this.runtime.running_layout.scrollX)};d.prototype.scrolly=function(g){g.set_float(this.runtime.running_layout.scrollY)};d.prototype.newline=function(g){g.set_string("\n")};d.prototype.lerp=function(g,l,u,c){g.set_float(cr.lerp(l,u,c))};d.prototype.qarp=function(g,l,u,c,y){g.set_float(cr.qarp(l,u,c,y))};d.prototype.cubic=function(g,l,u,c,y,H){g.set_float(cr.cubic(l,u,c,
y,H))};d.prototype.cosp=function(g,l,u,c){g.set_float(cr.cosp(l,u,c))};d.prototype.windowwidth=function(g){g.set_int(this.runtime.width)};d.prototype.windowheight=function(g){g.set_int(this.runtime.height)};d.prototype.uppercase=function(g,l){g.set_string(cr.is_string(l)?l.toUpperCase():"")};d.prototype.lowercase=function(g,l){g.set_string(cr.is_string(l)?l.toLowerCase():"")};d.prototype.clamp=function(g,l,u,c){l<u?g.set_float(u):l>c?g.set_float(c):g.set_float(l)};d.prototype.layerscale=function(g,
l){(l=this.runtime.getLayer(l))?g.set_float(l.scale):g.set_float(0)};d.prototype.layeropacity=function(g,l){(l=this.runtime.getLayer(l))?g.set_float(100*l.opacity):g.set_float(0)};d.prototype.layerscalerate=function(g,l){(l=this.runtime.getLayer(l))?g.set_float(l.zoomRate):g.set_float(0)};d.prototype.layerparallaxx=function(g,l){(l=this.runtime.getLayer(l))?g.set_float(100*l.parallaxX):g.set_float(0)};d.prototype.layerparallaxy=function(g,l){(l=this.runtime.getLayer(l))?g.set_float(100*l.parallaxY):
g.set_float(0)};d.prototype.layerindex=function(g,l){(l=this.runtime.getLayer(l))?g.set_int(l.index):g.set_int(-1)};d.prototype.layoutscale=function(g){this.runtime.running_layout?g.set_float(this.runtime.running_layout.scale):g.set_float(0)};d.prototype.layoutangle=function(g){g.set_float(cr.to_degrees(this.runtime.running_layout.angle))};d.prototype.layerangle=function(g,l){(l=this.runtime.getLayer(l))?g.set_float(cr.to_degrees(l.angle)):g.set_float(0)};d.prototype.layoutwidth=function(g){g.set_int(this.runtime.running_layout.width)};
d.prototype.layoutheight=function(g){g.set_int(this.runtime.running_layout.height)};d.prototype.find=function(g,l,u){cr.is_string(l)&&cr.is_string(u)?g.set_int(l.search(new RegExp(cr.regexp_escape(u),"i"))):g.set_int(-1)};d.prototype.findcase=function(g,l,u){cr.is_string(l)&&cr.is_string(u)?g.set_int(l.search(new RegExp(cr.regexp_escape(u),""))):g.set_int(-1)};d.prototype.left=function(g,l,u){g.set_string(cr.is_string(l)?l.substr(0,u):"")};d.prototype.right=function(g,l,u){g.set_string(cr.is_string(l)?
l.substr(l.length-u):"")};d.prototype.mid=function(g,l,u,c){g.set_string(cr.is_string(l)?l.substr(u,c):"")};d.prototype.tokenat=function(g,l,u,c){cr.is_string(l)&&cr.is_string(c)?(l=l.split(c),u=cr.floor(u),0>u||u>=l.length?g.set_string(""):g.set_string(l[u])):g.set_string("")};d.prototype.tokencount=function(g,l,u){cr.is_string(l)&&l.length?g.set_int(l.split(u).length):g.set_int(0)};d.prototype.replace=function(g,l,u,c){cr.is_string(l)&&cr.is_string(u)&&cr.is_string(c)?g.set_string(l.replace(new RegExp(cr.regexp_escape(u),
"gi"),c)):g.set_string(cr.is_string(l)?l:"")};d.prototype.trim=function(g,l){g.set_string(cr.is_string(l)?l.trim():"")};d.prototype.pi=function(g){g.set_float(cr.PI)};d.prototype.layoutname=function(g){this.runtime.running_layout?g.set_string(this.runtime.running_layout.name):g.set_string("")};d.prototype.renderer=function(g){g.set_string(this.runtime.gl?"webgl":"canvas2d")};d.prototype.rendererdetail=function(g){g.set_string(this.runtime.glUnmaskedRenderer)};d.prototype.anglediff=function(g,l,u){g.set_float(cr.to_degrees(cr.angleDiff(cr.to_radians(l),
cr.to_radians(u))))};d.prototype.choose=function(g){var l=cr.floor(Math.random()*(arguments.length-1));g.set_any(arguments[l+1])};d.prototype.rgb=function(g,l,u,c){g.set_int(cr.RGB(l,u,c))};d.prototype.rgbex=function(g,l,u,c){g.set_float(cr.RGBEx(l/100,u/100,c/100))};d.prototype.projectversion=function(g){g.set_string(this.runtime.versionstr)};d.prototype.projectname=function(g){g.set_string(this.runtime.name)};d.prototype.anglelerp=function(g,l,u,c){l=cr.to_radians(l);u=cr.to_radians(u);var y=cr.angleDiff(l,
u);cr.angleClockwise(u,l)?g.set_float(cr.to_clamped_degrees(l+y*c)):g.set_float(cr.to_clamped_degrees(l-y*c))};d.prototype.anglerotate=function(g,l,u,c){l=cr.to_radians(l);u=cr.to_radians(u);c=cr.to_radians(c);g.set_float(cr.to_clamped_degrees(cr.angleRotate(l,u,c)))};d.prototype.zeropad=function(g,l,u){var c=0>l?"-":"";0>l&&(l=-l);u-=l.toString().length;for(var y=0;y<u;y++)c+="0";g.set_string(c+l.toString())};d.prototype.cpuutilisation=function(g){g.set_float(this.runtime.cpuutilisation/1E3)};d.prototype.gpuutilisation=
function(g){g.set_float(this.runtime.gpuLastUtilisation)};d.prototype.viewportleft=function(g,l){l=this.runtime.getLayer(l);g.set_float(l?l.viewLeft:0)};d.prototype.viewporttop=function(g,l){l=this.runtime.getLayer(l);g.set_float(l?l.viewTop:0)};d.prototype.viewportright=function(g,l){l=this.runtime.getLayer(l);g.set_float(l?l.viewRight:0)};d.prototype.viewportbottom=function(g,l){l=this.runtime.getLayer(l);g.set_float(l?l.viewBottom:0)};d.prototype.loadingprogress=function(g){g.set_float(this.runtime.loadingprogress)};
d.prototype.unlerp=function(g,l,u,c){g.set_float(cr.unlerp(l,u,c))};d.prototype.canvassnapshot=function(g){g.set_string(this.runtime.snapshotData)};d.prototype.urlencode=function(g,l){g.set_string(encodeURIComponent(l))};d.prototype.urldecode=function(g,l){g.set_string(decodeURIComponent(l))};d.prototype.canvastolayerx=function(g,l,u,c){l=this.runtime.getLayer(l);g.set_float(l?l.canvasToLayer(u,c,!0):0)};d.prototype.canvastolayery=function(g,l,u,c){l=this.runtime.getLayer(l);g.set_float(l?l.canvasToLayer(u,
c,!1):0)};d.prototype.layertocanvasx=function(g,l,u,c){l=this.runtime.getLayer(l);g.set_float(l?l.layerToCanvas(u,c,!0):0)};d.prototype.layertocanvasy=function(g,l,u,c){l=this.runtime.getLayer(l);g.set_float(l?l.layerToCanvas(u,c,!1):0)};d.prototype.savestatejson=function(g){g.set_string(this.runtime.lastSaveJson)};d.prototype.imagememoryusage=function(g){this.runtime.glwrap?g.set_float(Math.round(100*this.runtime.glwrap.estimateVRAM()/1048576)/100):g.set_float(0)};d.prototype.regexsearch=function(g,
l,u,c){u=k(u,c);g.set_int(l?l.search(u):-1)};d.prototype.regexreplace=function(g,l,u,c,y){u=k(u,c);g.set_string(l?l.replace(u,y):"")};var S=[],L="",R="",F="";d.prototype.regexmatchcount=function(g,l,u,c){k(u,c);h(l.toString(),u,c);g.set_int(S?S.length:0)};d.prototype.regexmatchat=function(g,l,u,c,y){y=Math.floor(y);k(u,c);h(l.toString(),u,c);!S||0>y||y>=S.length?g.set_string(""):g.set_string(S[y])};d.prototype.infinity=function(g){g.set_float(Infinity)};d.prototype.setbit=function(g,l,u,c){u|=0;g.set_int((l|
0)&~(1<<u)|(0!==c?1:0)<<u)};d.prototype.togglebit=function(g,l,u){g.set_int((l|0)^1<<(u|0))};d.prototype.getbit=function(g,l,u){g.set_int((l|0)&1<<(u|0)?1:0)};d.prototype.originalwindowwidth=function(g){g.set_int(this.runtime.original_width)};d.prototype.originalwindowheight=function(g){g.set_int(this.runtime.original_height)};d.prototype.originalviewportwidth=function(g){g.set_int(this.runtime.original_width)};d.prototype.originalviewportheight=function(g){g.set_int(this.runtime.original_height)};
r.exps=new d;r.runWaits=function(){var g,l=this.runtime.getCurrentEventStack();var u=0;for(g=this.waits.length;u<g;u++){var c=this.waits[u];if(-1===c.time){if(!c.signalled)continue}else if(c.time>this.runtime.kahanTime.sum)continue;l.current_event=c.ev;l.actindex=c.actindex;l.cndindex=0;for(O in c.sols)if(c.sols.hasOwnProperty(O)){var y=this.runtime.types_by_index[parseInt(O,10)].getCurrentSol();var H=c.sols[O];y.select_all=H.sa;cr.shallowAssignArray(y.instances,H.insts);y=H;cr.clearArray(y.insts);
K.push(y)}c.ev.resume_actions_and_subevents();this.runtime.clearSol(c.solModifiers);c.deleteme=!0}var O=u=0;for(g=this.waits.length;u<g;u++)c=this.waits[u],this.waits[O]=c,c.deleteme?(cr.wipe(c.sols),cr.clearArray(c.solModifiers),z.push(c)):O++;cr.truncateArray(this.waits,O)}})();
(function(){cr.add_common_aces=function(f,k){var q=f[1],v=f[3],n=f[4],e=f[5],a=f[6],d=f[7],h=f[8],r=f[10],w=f[11];f=f[12];k.cnds||(k.cnds={});k.acts||(k.acts={});k.exps||(k.exps={});var E=k.cnds,t=k.acts;k=k.exps;v&&(E.CompareX=function(p,x){return cr.do_cmp(this.x,p,x)},E.CompareY=function(p,x){return cr.do_cmp(this.y,p,x)},E.IsOnScreen=function(){var p=this.layer;this.update_bbox();var x=this.bbox;return!(x.right<p.viewLeft||x.bottom<p.viewTop||x.left>p.viewRight||x.top>p.viewBottom)},E.IsOutsideLayout=
function(){this.update_bbox();var p=this.bbox,x=this.runtime.running_layout;return 0>p.right||0>p.bottom||p.left>x.width||p.top>x.height},E.PickDistance=function(p,x,C){var z=this.getCurrentSol(),K=z.getObjects();if(!K.length)return!1;var S=K[0],L=S,R=cr.distanceTo(S.x,S.y,x,C),F;var g=1;for(F=K.length;g<F;g++){S=K[g];var l=cr.distanceTo(S.x,S.y,x,C);if(0===p&&l<R||1===p&&l>R)R=l,L=S}z.pick_one(L);return!0},t.SetX=function(p){this.x!==p&&(this.x=p,this.set_bbox_changed())},t.SetY=function(p){this.y!==
p&&(this.y=p,this.set_bbox_changed())},t.SetPos=function(p,x){if(this.x!==p||this.y!==x)this.x=p,this.y=x,this.set_bbox_changed()},t.SetPosToObject=function(p,x){var C=p.getPairedInstance(this);C&&(C.getImagePoint?(p=C.getImagePoint(x,!0),x=C.getImagePoint(x,!1)):(p=C.x,x=C.y),this.x!==p||this.y!==x)&&(this.x=p,this.y=x,this.set_bbox_changed())},t.MoveForward=function(p){0!==p&&(this.x+=Math.cos(this.angle)*p,this.y+=Math.sin(this.angle)*p,this.set_bbox_changed())},t.MoveAtAngle=function(p,x){0!==
x&&(this.x+=Math.cos(cr.to_radians(p))*x,this.y+=Math.sin(cr.to_radians(p))*x,this.set_bbox_changed())},k.X=function(p){p.set_float(this.x)},k.Y=function(p){p.set_float(this.y)},k.dt=function(p){p.set_float(this.runtime.getDt(this))});n&&(E.CompareWidth=function(p,x){return cr.do_cmp(this.width,p,x)},E.CompareHeight=function(p,x){return cr.do_cmp(this.height,p,x)},t.SetWidth=function(p){this.width!==p&&(this.width=p,this.set_bbox_changed())},t.SetHeight=function(p){this.height!==p&&(this.height=p,
this.set_bbox_changed())},t.SetSize=function(p,x){if(this.width!==p||this.height!==x)this.width=p,this.height=x,this.set_bbox_changed()},k.Width=function(p){p.set_float(this.width)},k.Height=function(p){p.set_float(this.height)},k.BBoxLeft=function(p){this.update_bbox();p.set_float(this.bbox.left)},k.BBoxTop=function(p){this.update_bbox();p.set_float(this.bbox.top)},k.BBoxRight=function(p){this.update_bbox();p.set_float(this.bbox.right)},k.BBoxBottom=function(p){this.update_bbox();p.set_float(this.bbox.bottom)});
e&&(E.AngleWithin=function(p,x){return cr.angleDiff(this.angle,cr.to_radians(x))<=cr.to_radians(p)},E.IsClockwiseFrom=function(p){return cr.angleClockwise(this.angle,cr.to_radians(p))},E.IsBetweenAngles=function(p,x){p=cr.to_clamped_radians(p);x=cr.to_clamped_radians(x);var C=cr.clamp_angle(this.angle);return cr.angleClockwise(x,p)?cr.angleClockwise(C,p)&&!cr.angleClockwise(C,x):!(!cr.angleClockwise(C,p)&&cr.angleClockwise(C,x))},t.SetAngle=function(p){p=cr.to_radians(cr.clamp_angle_degrees(p));isNaN(p)||
this.angle===p||(this.angle=p,this.set_bbox_changed())},t.RotateClockwise=function(p){0===p||isNaN(p)||(this.angle+=cr.to_radians(p),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},t.RotateCounterclockwise=function(p){0===p||isNaN(p)||(this.angle-=cr.to_radians(p),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},t.RotateTowardAngle=function(p,x){p=cr.angleRotate(this.angle,cr.to_radians(x),cr.to_radians(p));isNaN(p)||this.angle===p||(this.angle=p,this.set_bbox_changed())},
t.RotateTowardPosition=function(p,x,C){p=cr.angleRotate(this.angle,Math.atan2(C-this.y,x-this.x),cr.to_radians(p));isNaN(p)||this.angle===p||(this.angle=p,this.set_bbox_changed())},t.SetTowardPosition=function(p,x){p=Math.atan2(x-this.y,p-this.x);isNaN(p)||this.angle===p||(this.angle=p,this.set_bbox_changed())},k.Angle=function(p){p.set_float(cr.to_clamped_degrees(this.angle))});q||(E.CompareInstanceVar=function(p,x,C){return cr.do_cmp(this.instance_vars[p],x,C)},E.IsBoolInstanceVarSet=function(p){return this.instance_vars[p]},
E.PickInstVarHiLow=function(p,x){var C=this.getCurrentSol(),z=C.getObjects();if(!z.length)return!1;var K=z[0],S=K,L=K.instance_vars[x],R;var F=1;for(R=z.length;F<R;F++){K=z[F];var g=K.instance_vars[x];if(0===p&&g<L||1===p&&g>L)L=g,S=K}C.pick_one(S);return!0},E.PickByUID=function(p){var x;if(this.runtime.getCurrentCondition().inverted){var C=this.getCurrentSol();if(C.select_all){C.select_all=!1;cr.clearArray(C.instances);cr.clearArray(C.else_instances);var z=this.instances;var K=0;for(x=z.length;K<
x;K++){var S=z[K];S.uid===p?C.else_instances.push(S):C.instances.push(S)}}else{z=K=0;for(x=C.instances.length;K<x;K++)S=C.instances[K],C.instances[z]=S,S.uid===p?C.else_instances.push(S):z++;cr.truncateArray(C.instances,z)}this.applySolToContainer();return!!C.instances.length}S=this.runtime.getObjectByUID(p);if(!S)return!1;C=this.getCurrentSol();if(!C.select_all&&-1===C.instances.indexOf(S))return!1;if(this.is_family)for(p=S.type.families,K=0,x=p.length;K<x;K++){if(p[K]===this)return C.pick_one(S),
this.applySolToContainer(),!0}else if(S.type===this)return C.pick_one(S),this.applySolToContainer(),!0;return!1},E.OnCreated=function(){return!0},E.OnDestroyed=function(){return!0},t.SetInstanceVar=function(p,x){var C=this.instance_vars;cr.is_number(C[p])?cr.is_number(x)?C[p]=x:C[p]=parseFloat(x):cr.is_string(C[p])&&(cr.is_string(x)?C[p]=x:C[p]=x.toString())},t.AddInstanceVar=function(p,x){var C=this.instance_vars;cr.is_number(C[p])?cr.is_number(x)?C[p]+=x:C[p]+=parseFloat(x):cr.is_string(C[p])&&
(cr.is_string(x)?C[p]+=x:C[p]+=x.toString())},t.SubInstanceVar=function(p,x){var C=this.instance_vars;cr.is_number(C[p])&&(cr.is_number(x)?C[p]-=x:C[p]-=parseFloat(x))},t.SetBoolInstanceVar=function(p,x){this.instance_vars[p]=x?1:0},t.ToggleBoolInstanceVar=function(p){this.instance_vars[p]=1-this.instance_vars[p]},t.Destroy=function(){this.runtime.DestroyInstance(this)},t.LoadFromJsonString||(t.LoadFromJsonString=function(p){try{var x=JSON.parse(p)}catch(z){return}this.runtime.loadInstanceFromJSON(this,
x,!0);this.afterLoad&&this.afterLoad();if(this.behavior_insts)for(p=0,x=this.behavior_insts.length;p<x;++p){var C=this.behavior_insts[p];C.afterLoad&&C.afterLoad()}}),k.Count=function(p){var x=p.object_class.instances.length,C;var z=0;for(C=this.runtime.createRow.length;z<C;z++){var K=this.runtime.createRow[z];p.object_class.is_family?0<=K.type.families.indexOf(p.object_class)&&x++:K.type===p.object_class&&x++}p.set_int(x)},k.PickedCount=function(p){p.set_int(p.object_class.getCurrentSol().getObjects().length)},
k.UID=function(p){p.set_int(this.uid)},k.IID=function(p){p.set_int(this.get_iid())},k.AsJSON||(k.AsJSON=function(p){p.set_string(JSON.stringify(this.runtime.saveInstanceToJSON(this,!0)))}));a&&(E.IsVisible=function(){return this.visible},t.SetVisible=function(p){p=2===p?!this.visible:0!==p;p!==this.visible&&(this.visible=p,this.runtime.redraw=!0)},E.CompareOpacity=function(p,x){return cr.do_cmp(cr.round6dp(100*this.opacity),p,x)},t.SetOpacity=function(p){p/=100;0>p?p=0:1<p&&(p=1);p!==this.opacity&&
(this.opacity=p,this.runtime.redraw=!0)},k.Opacity=function(p){p.set_float(cr.round6dp(100*this.opacity))});d&&(E.IsOnLayer=function(p){return p?this.layer===p:!1},E.PickTopBottom=function(p){var x=this.getCurrentSol(),C=x.getObjects();if(!C.length)return!1;var z=C[0],K=z,S;var L=1;for(S=C.length;L<S;L++)if(z=C[L],0===p){if(z.layer.index>K.layer.index||z.layer.index===K.layer.index&&z.get_zindex()>K.get_zindex())K=z}else if(z.layer.index<K.layer.index||z.layer.index===K.layer.index&&z.get_zindex()<
K.get_zindex())K=z;x.pick_one(K);return!0},t.MoveToTop=function(){var p=this.layer,x=p.instances;x.length&&x[x.length-1]===this||(p.removeFromInstanceList(this,!1),p.appendToInstanceList(this,!1),this.runtime.redraw=!0)},t.MoveToBottom=function(){var p=this.layer,x=p.instances;x.length&&x[0]===this||(p.removeFromInstanceList(this,!1),p.prependToInstanceList(this,!1),this.runtime.redraw=!0)},t.MoveToLayer=function(p){p&&p!=this.layer&&(this.layer.removeFromInstanceList(this,!0),this.layer=p,p.appendToInstanceList(this,
!0),this.runtime.redraw=!0)},t.ZMoveToObject=function(p,x){p=0===p;x&&(x=x.getFirstPicked(this))&&x.uid!==this.uid&&(this.layer.index!==x.layer.index&&(this.layer.removeFromInstanceList(this,!0),this.layer=x.layer,x.layer.appendToInstanceList(this,!0)),this.layer.moveInstanceAdjacent(this,x,p),this.runtime.redraw=!0)},k.LayerNumber=function(p){p.set_int(this.layer.number)},k.LayerName=function(p){p.set_string(this.layer.name)},k.ZIndex=function(p){p.set_int(this.get_zindex())});h&&(t.SetEffectEnabled=
function(p,x){this.runtime.glwrap&&(x=this.type.getEffectIndexByName(x),0>x||(p=1===p,this.active_effect_flags[x]!==p&&(this.active_effect_flags[x]=p,this.updateActiveEffects(),this.runtime.redraw=!0)))},t.SetEffectParam=function(p,x,C){if(this.runtime.glwrap){var z=this.type.getEffectIndexByName(p);if(!(0>z||(p=this.type.effect_types[z],z=this.effect_params[z],x=Math.floor(x),0>x||x>=z.length))){var K=this.runtime.glwrap.getProgramParameterType(p.shaderindex,x);1===K&&(C/=100);if(2===K){K=cr.GetRValue(C);
var S=cr.GetGValue(C);C=cr.GetBValue(C);x=z[x];if(x[0]===K&&x[1]===S&&x[2]===C)return;x[0]=K;x[1]=S;x[2]=C}else{if(z[x]===C)return;z[x]=C}p.active&&(this.runtime.redraw=!0)}}});r&&(t.SetVisible=function(p){this.visible=0!==p},t.SetCSSStyle=function(p,x){this.elem.style[cr.cssToCamelCase(p)]=x});w&&(t.SetFocus=function(){(this.inputElem||this.elem).focus()},t.SetBlur=function(){(this.inputElem||this.elem).blur()});f&&(t.SetEnabled=function(p){(this.inputElem||this.elem).disabled=0===p})};cr.set_bbox_changed=
function(){this.cell_changed=this.bbox_changed=!0;this.type.any_cell_changed=!0;this.runtime.redraw=!0;var f,k=this.bbox_changed_callbacks;var q=0;for(f=k.length;q<f;++q)k[q](this);this.layer.useRenderCells&&this.update_bbox()};cr.add_bbox_changed_callback=function(f){f&&this.bbox_changed_callbacks.push(f)};cr.update_bbox=function(){if(this.bbox_changed){var f=this.bbox,k=this.bquad;f.set(this.x,this.y,this.x+this.width,this.y+this.height);f.offset(-this.hotspotX*this.width,-this.hotspotY*this.height);
this.angle?(f.offset(-this.x,-this.y),k.set_from_rotated_rect(f,this.angle),k.offset(this.x,this.y),k.bounding_box(f)):k.set_from_rect(f);f.normalize();this.bbox_changed=!1;this.update_render_cell()}};var b=new cr.rect(0,0,0,0);cr.update_render_cell=function(){if(this.layer.useRenderCells){var f=this.layer.render_grid,k=this.bbox;b.set(f.XToCell(k.left),f.YToCell(k.top),f.XToCell(k.right),f.YToCell(k.bottom));this.rendercells.equals(b)||(this.rendercells.right<this.rendercells.left?f.update(this,
null,b):f.update(this,this.rendercells,b),this.rendercells.copy(b),this.layer.render_list_stale=!0)}};cr.update_collision_cell=function(){if(this.cell_changed&&this.collisionsEnabled){this.update_bbox();var f=this.type.collision_grid,k=this.bbox;b.set(f.XToCell(k.left),f.YToCell(k.top),f.XToCell(k.right),f.YToCell(k.bottom));this.collcells.equals(b)||(this.collcells.right<this.collcells.left?f.update(this,null,b):f.update(this,this.collcells,b),this.collcells.copy(b),this.cell_changed=!1)}};cr.inst_contains_pt=
function(f,k){return this.bbox.contains_pt(f,k)&&this.bquad.contains_pt(f,k)?this.tilemap_exists?this.testPointOverlapTile(f,k):this.collision_poly&&!this.collision_poly.is_empty()?(this.collision_poly.cache_poly(this.width,this.height,this.angle),this.collision_poly.contains_pt(f-this.x,k-this.y)):!0:!1};cr.inst_get_iid=function(){this.type.updateIIDs();return this.iid};cr.inst_get_zindex=function(){this.layer.updateZIndices();return this.zindex};cr.inst_updateActiveEffects=function(){cr.clearArray(this.active_effect_types);
var f,k=!0;var q=0;for(f=this.active_effect_flags.length;q<f;q++)if(this.active_effect_flags[q]){var v=this.type.effect_types[q];this.active_effect_types.push(v);v.preservesOpaqueness||(k=!1)}this.uses_shaders=!!this.active_effect_types.length;this.shaders_preserve_opaqueness=k};cr.inst_toString=function(){return"Inst"+this.puid};cr.type_getFirstPicked=function(f){if(f&&f.is_contained&&f.type!=this){var k;var q=0;for(k=f.siblings.length;q<k;q++){var v=f.siblings[q];if(v.type==this)return v}}f=this.getCurrentSol().getObjects();
return f.length?f[0]:null};cr.type_getPairedInstance=function(f){var k=this.getCurrentSol().getObjects();return k.length?k[f.get_iid()%k.length]:null};cr.type_updateIIDs=function(){if(this.stale_iids&&!this.is_family){var f;var k=0;for(f=this.instances.length;k<f;k++)this.instances[k].iid=k;var q=k,v=this.runtime.createRow;k=0;for(f=v.length;k<f;++k)v[k].type===this&&(v[k].iid=q++);this.stale_iids=!1}};cr.type_getInstanceByIID=function(f){if(f<this.instances.length)return this.instances[f];f-=this.instances.length;
var k=this.runtime.createRow,q;var v=0;for(q=k.length;v<q;++v)if(k[v].type===this){if(0===f)return k[v];--f}return null};cr.type_getCurrentSol=function(){return this.solstack[this.cur_sol]};cr.type_pushCleanSol=function(){this.cur_sol++;this.cur_sol===this.solstack.length?this.solstack.push(new cr.selection(this)):(this.solstack[this.cur_sol].select_all=!0,cr.clearArray(this.solstack[this.cur_sol].else_instances))};cr.type_pushCopySol=function(){this.cur_sol++;this.cur_sol===this.solstack.length&&
this.solstack.push(new cr.selection(this));var f=this.solstack[this.cur_sol],k=this.solstack[this.cur_sol-1];k.select_all?f.select_all=!0:(f.select_all=!1,cr.shallowAssignArray(f.instances,k.instances));cr.clearArray(f.else_instances)};cr.type_popSol=function(){this.cur_sol--};cr.type_getBehaviorByName=function(f){var k,q,v=0;if(!this.is_family){var n=0;for(k=this.families.length;n<k;n++){var e=this.families[n];var a=0;for(q=e.behaviors.length;a<q;a++){if(f===e.behaviors[a].name)return this.extra.lastBehIndex=
v,e.behaviors[a];v++}}}n=0;for(k=this.behaviors.length;n<k;n++){if(f===this.behaviors[n].name)return this.extra.lastBehIndex=v,this.behaviors[n];v++}return null};cr.type_getBehaviorIndexByName=function(f){return this.getBehaviorByName(f)?this.extra.lastBehIndex:-1};cr.type_getEffectIndexByName=function(f){var k;var q=0;for(k=this.effect_types.length;q<k;q++)if(this.effect_types[q].name===f)return q;return-1};cr.type_applySolToContainer=function(){if(this.is_contained&&!this.is_family){var f,k,q;this.updateIIDs();
var v=this.getCurrentSol();var n=v.select_all,e=(f=this.runtime.getCurrentEventStack())&&f.current_event&&f.current_event.orblock;f=0;for(k=this.container.length;f<k;f++){var a=this.container[f];if(a!==this){a.updateIIDs();var d=a.getCurrentSol();d.select_all=n;if(!n){cr.clearArray(d.instances);var h=0;for(q=v.instances.length;h<q;++h)d.instances[h]=a.getInstanceByIID(v.instances[h].iid);if(e)for(cr.clearArray(d.else_instances),h=0,q=v.else_instances.length;h<q;++h)d.else_instances[h]=a.getInstanceByIID(v.else_instances[h].iid)}}}}};
cr.type_toString=function(){return"Type"+this.sid};cr.do_cmp=function(f,k,q){if("undefined"===typeof f||"undefined"===typeof q)return!1;switch(k){case 0:return f===q;case 1:return f!==q;case 2:return f<q;case 3:return f<=q;case 4:return f>q;case 5:return f>=q;default:return!1}}})();cr.shaders={};
cr.shaders.grayscale={src:"varying mediump vec2 vTex;\nuniform lowp sampler2D samplerFront;\nuniform lowp float intensity;\nvoid main(void)\n{\nlowp vec4 front = texture2D(samplerFront, vTex);\nlowp float gray = front.r * 0.299 + front.g * 0.587 + front.b * 0.114;\ngl_FragColor = mix(front, vec4(gray, gray, gray, front.a), intensity);\n}",extendBoxHorizontal:0,extendBoxVertical:0,crossSampling:!1,mustPreDraw:!1,preservesOpaqueness:!0,animated:!1,parameters:[["intensity",0,1]]};
cr.plugins_.Audio=function(b){this.runtime=b};
(function(){function b(D){-1===za.indexOf(D)&&za.push(D)}function f(D){var P=D.instanceObject;try{var T=P.play()}catch(V){b(D);return}T?T.catch(function(V){b(D)}):Ea&&!m.isInUserInputEvent&&b(D)}function k(){var D,P;Fa||ja||!B||(q(),"running"===B.state&&(Fa=!0));var T=za.slice(0);cr.clearArray(za);if(!W){var V=0;for(D=T.length;V<D;++V){var ea=T[V];ea.stopped||ea.is_paused||(P=ea.instanceObject.play())&&P.catch(function(ia){b(ea)})}}}function q(){"suspended"===B.state&&B.resume&&B.resume();if(B.createBuffer){var D=
B.createBuffer(1,220,22050),P=B.createBufferSource();P.buffer=D;P.connect(B.destination);h(P)}}function v(D){D=Math.pow(10,D/20);isFinite(D)||(D=0);0>D&&(D=0);1<D&&(D=1);return D}function n(D){0>D&&(D=0);1<D&&(D=1);return Math.log(D)/Math.log(10)*20}function e(D){D=D.toLowerCase();return qa.hasOwnProperty(D)&&qa[D].length?qa[D][0].getInputNode():B.destination}function a(){return B.createGain?B.createGain():B.createGainNode()}function d(D){return B.createDelay?B.createDelay(D):B.createDelayNode(D)}
function h(D,P){D.start?D.start(P||0):D.noteOn(P||0)}function r(D,P,T,V){D.start?D.start(V||0,P):D.noteGrainOn(V||0,P,T-P)}function w(D){try{D.stop?D.stop(0):D.noteOff(0)}catch(P){}}function E(D,P,T,V){if(D)if(D.cancelScheduledValues(0),0===V)D.value=P;else{var ea=B.currentTime;V+=ea;switch(T){case 0:D.setValueAtTime(P,V);break;case 1:D.setValueAtTime(D.value,ea);D.linearRampToValueAtTime(P,V);break;case 2:D.setValueAtTime(D.value,ea),D.exponentialRampToValueAtTime(P,V)}}}function t(D,P,T,V,ea,ia){this.type=
"filter";this.params=[D,P,T,V,ea,ia];this.inputNode=a();this.wetNode=a();this.wetNode.gain.value=ia;this.dryNode=a();this.dryNode.gain.value=1-ia;this.filterNode=B.createBiquadFilter();this.filterNode.type="number"===typeof this.filterNode.type?D:Ga[D];this.filterNode.frequency.value=P;this.filterNode.detune&&(this.filterNode.detune.value=T);this.filterNode.Q.value=V;this.filterNode.gain.value=ea;this.inputNode.connect(this.filterNode);this.inputNode.connect(this.dryNode);this.filterNode.connect(this.wetNode)}
function p(D,P,T){this.type="delay";this.params=[D,P,T];this.inputNode=a();this.wetNode=a();this.wetNode.gain.value=T;this.dryNode=a();this.dryNode.gain.value=1-T;this.mainNode=a();this.delayNode=d(D);this.delayNode.delayTime.value=D;this.delayGainNode=a();this.delayGainNode.gain.value=P;this.inputNode.connect(this.mainNode);this.inputNode.connect(this.dryNode);this.mainNode.connect(this.wetNode);this.mainNode.connect(this.delayNode);this.delayNode.connect(this.delayGainNode);this.delayGainNode.connect(this.mainNode)}
function x(D,P,T,V){this.type="convolve";this.params=[P,T,V];this.inputNode=a();this.wetNode=a();this.wetNode.gain.value=T;this.dryNode=a();this.dryNode.gain.value=1-T;this.convolveNode=B.createConvolver();D&&(this.convolveNode.normalize=P,this.convolveNode.buffer=D);this.inputNode.connect(this.convolveNode);this.inputNode.connect(this.dryNode);this.convolveNode.connect(this.wetNode)}function C(D,P,T,V,ea){this.type="flanger";this.params=[D,P,T,V,ea];this.inputNode=a();this.dryNode=a();this.dryNode.gain.value=
1-ea/2;this.wetNode=a();this.wetNode.gain.value=ea/2;this.feedbackNode=a();this.feedbackNode.gain.value=V;this.delayNode=d(D+P);this.delayNode.delayTime.value=D;this.oscNode=B.createOscillator();this.oscNode.frequency.value=T;this.oscGainNode=a();this.oscGainNode.gain.value=P;this.inputNode.connect(this.delayNode);this.inputNode.connect(this.dryNode);this.delayNode.connect(this.wetNode);this.delayNode.connect(this.feedbackNode);this.feedbackNode.connect(this.delayNode);this.oscNode.connect(this.oscGainNode);
this.oscGainNode.connect(this.delayNode.delayTime);h(this.oscNode)}function z(D,P,T,V,ea,ia){this.type="phaser";this.params=[D,P,T,V,ea,ia];this.inputNode=a();this.dryNode=a();this.dryNode.gain.value=1-ia/2;this.wetNode=a();this.wetNode.gain.value=ia/2;this.filterNode=B.createBiquadFilter();this.filterNode.type="number"===typeof this.filterNode.type?7:"allpass";this.filterNode.frequency.value=D;this.filterNode.detune&&(this.filterNode.detune.value=P);this.filterNode.Q.value=T;this.oscNode=B.createOscillator();
this.oscNode.frequency.value=ea;this.oscGainNode=a();this.oscGainNode.gain.value=V;this.inputNode.connect(this.filterNode);this.inputNode.connect(this.dryNode);this.filterNode.connect(this.wetNode);this.oscNode.connect(this.oscGainNode);this.oscGainNode.connect(this.filterNode.frequency);h(this.oscNode)}function K(D){this.type="gain";this.params=[D];this.node=a();this.node.gain.value=D}function S(D,P){this.type="tremolo";this.params=[D,P];this.node=a();this.node.gain.value=1-P/2;this.oscNode=B.createOscillator();
this.oscNode.frequency.value=D;this.oscGainNode=a();this.oscGainNode.gain.value=P/2;this.oscNode.connect(this.oscGainNode);this.oscGainNode.connect(this.node.gain);h(this.oscNode)}function L(D,P){this.type="ringmod";this.params=[D,P];this.inputNode=a();this.wetNode=a();this.wetNode.gain.value=P;this.dryNode=a();this.dryNode.gain.value=1-P;this.ringNode=a();this.ringNode.gain.value=0;this.oscNode=B.createOscillator();this.oscNode.frequency.value=D;this.oscNode.connect(this.ringNode.gain);h(this.oscNode);
this.inputNode.connect(this.ringNode);this.inputNode.connect(this.dryNode);this.ringNode.connect(this.wetNode)}function R(D,P,T,V,ea){this.type="distortion";this.params=[D,P,T,V,ea];this.inputNode=a();this.preGain=a();this.postGain=a();this.setDrive(T,Math.pow(10,V/20));this.wetNode=a();this.wetNode.gain.value=ea;this.dryNode=a();this.dryNode.gain.value=1-ea;this.waveShaper=B.createWaveShaper();this.curve=new Float32Array(65536);this.generateColortouchCurve(D,P);this.waveShaper.curve=this.curve;this.inputNode.connect(this.preGain);
this.inputNode.connect(this.dryNode);this.preGain.connect(this.waveShaper);this.waveShaper.connect(this.postGain);this.postGain.connect(this.wetNode)}function F(D,P,T,V,ea){this.type="compressor";this.params=[D,P,T,V,ea];this.node=B.createDynamicsCompressor();try{this.node.threshold.value=D,this.node.knee.value=P,this.node.ratio.value=T,this.node.attack.value=V,this.node.release.value=ea}catch(ia){}}function g(D,P){this.type="analyser";this.params=[D,P];this.node=B.createAnalyser();this.node.fftSize=
D;this.node.smoothingTimeConstant=P;this.freqBins=new Float32Array(this.node.frequencyBinCount);this.signal=new Uint8Array(D);this.rms=this.peak=0}function l(){this.obj=null;this.loadUid=0}function u(D,P,T){this.src=D;this.type=P;this.myapi=G;this.is_music=T;this.added_end_listener=!1;var V=this;this.mediaSourceNode=this.outNode=null;this.panWhenReady=[];this.seekWhenReady=0;this.failedToLoad=this.supportWebAudioAPI=this.pauseWhenReady=!1;this.needsSoftwareDecode="audio/webm; codecs=opus"===this.type&&
!la;this.wasEverReady=!1;this.is_music&&this.needsSoftwareDecode&&(Ha=!0);1!==G||!T||Aa||this.needsSoftwareDecode||(this.myapi=0,this.outNode=a());this.audioData=this.bufferObject=null;switch(this.myapi){case 0:this.bufferObject=new Audio;this.bufferObject.crossOrigin="anonymous";this.bufferObject.addEventListener("canplaythrough",function(){V.wasEverReady=!0});1===G&&B.createMediaElementSource&&!/wiiu/i.test(navigator.userAgent)&&(this.supportWebAudioAPI=!0,this.bufferObject.addEventListener("canplay",
function(){!V.mediaSourceNode&&V.bufferObject&&(V.mediaSourceNode=B.createMediaElementSource(V.bufferObject),V.mediaSourceNode.connect(V.outNode))}));this.bufferObject.autoplay=!1;this.bufferObject.preload="auto";this.bufferObject.src=D;break;case 1:if(m.isWKWebView)m.fetchLocalFileViaCordovaAsArrayBuffer(D,function(ia){V.audioData=ia;V.decodeAudioBuffer()},function(ia){V.failedToLoad=!0});else{var ea=new XMLHttpRequest;ea.open("GET",D,!0);ea.responseType="arraybuffer";ea.onload=function(){V.audioData=
ea.response;V.decodeAudioBuffer()};ea.onerror=function(){V.failedToLoad=!0};ea.send()}break;case 2:this.bufferObject=!0}}function c(D,P){var T=this;this.tag=P;this.stopped=this.fresh=!0;this.src=D.src;this.buffer=D;this.myapi=G;this.is_music=D.is_music;this.playbackRate=1;this.hasPlaybackEnded=!0;this.is_paused=this.resume_me=!1;this.resume_position=0;this.is_silent=this.is_muted=this.looping=!1;this.volume=1;this.onended_handler=function(ea){if(!T.is_paused&&!T.resume_me){var ia=this;ia||(ia=ea.target);
ia===T.active_buffer&&(T.hasPlaybackEnded=!0,T.stopped=!0,J=T.tag,m.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,A))}};this.active_buffer=null;this.isTimescaled=1===Z&&!this.is_music||2===Z;this.mutevol=1;this.startTime=this.isTimescaled?m.kahanTime.sum:m.wallTime.sum;this.pannerNode=this.gainNode=null;this.pannerEnabled=!1;this.objectTracker=null;this.panConeOuterGain=this.panConeOuter=this.panConeInner=this.panAngle=this.panY=this.panX=0;this.instanceObject=null;var V=!1;1!==this.myapi||0!==
this.buffer.myapi||this.buffer.supportWebAudioAPI||(this.myapi=0);switch(this.myapi){case 0:this.is_music?(this.instanceObject=D.bufferObject,V=!D.added_end_listener,D.added_end_listener=!0):(this.instanceObject=new Audio,this.instanceObject.crossOrigin="anonymous",this.instanceObject.autoplay=!1,this.instanceObject.src=D.bufferObject.src,V=!0);V&&this.instanceObject.addEventListener("ended",function(){J=T.tag;T.stopped=!0;m.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,A)});break;case 1:this.gainNode=
a();this.gainNode.connect(e(P));1===this.buffer.myapi?D.bufferObject&&(this.instanceObject=B.createBufferSource(),this.instanceObject.buffer=D.bufferObject,this.instanceObject.connect(this.gainNode)):(this.instanceObject=this.buffer.bufferObject,this.buffer.outNode.connect(this.gainNode),this.buffer.added_end_listener||(this.buffer.added_end_listener=!0,this.buffer.bufferObject.addEventListener("ended",function(){J=T.tag;T.stopped=!0;m.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,A)})));break;
case 2:this.instanceObject=new window.Media(N+this.src,null,null,function(ea){ea===window.Media.MEDIA_STOPPED&&(T.hasPlaybackEnded=!0,T.stopped=!0,J=T.tag,m.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,A))})}}function y(D,P){D=D.isPlaying()?1:0;P=P.isPlaying()?1:0;return D===P?0:D<P?1:-1}function H(D,P){cr.clearArray(pa);if(D.length){var T;var V=0;for(T=M.length;V<T;V++){var ea=M[V];cr.equals_nocase(D,ea.tag)&&pa.push(ea)}P&&pa.sort(y)}else Q&&!Q.hasEnded()&&(cr.clearArray(pa),pa[0]=Q)}function O(D){var P,
T=B.destination;if(qa.hasOwnProperty(D)){var V=qa[D];if(V.length){T=V[0].getInputNode();var ea=0;for(P=V.length;ea<P;ea++){var ia=V[ea];ea+1===P?ia.connectTo(B.destination):ia.connectTo(V[ea+1].getInputNode())}}}H(D);ea=0;for(P=pa.length;ea<P;ea++)pa[ea].reconnect(T);va&&Da===D&&(va.disconnect(),va.connect(T))}function U(D,P){qa.hasOwnProperty(D)?qa[D].push(P):qa[D]=[P];O(D)}function Y(){}function aa(){}function ca(){}function ha(D,P){var T=null;qa.hasOwnProperty(D)&&(T=qa[D]);return T&&0<=P&&P<T.length&&
T[P].freqBins?T[P]:null}var fa=cr.plugins_.Audio.prototype;fa.Type=function(D){this.plugin=D;this.runtime=D.runtime};fa.Type.prototype.onCreate=function(){};var m=null,A=null,J="",N="",G=0,B=null,I=[],M=[],Q=null,Z=0,W=!1,X=1,ba=0,da=0,ja=!1,la=!!(new Audio).canPlayType("audio/webm; codecs=opus"),na=1,sa=1,wa=10,Ba=1E4,Ia=1,va=null,Da="",Ea=!1,za=[],Aa=!1,Ha=!1,Fa=!1;document.addEventListener("pointerup",k,!0);document.addEventListener("touchend",k,!0);document.addEventListener("click",k,!0);document.addEventListener("keydown",
k,!0);document.addEventListener("gamepadconnected",k,!0);var qa={},Ga="lowpass highpass bandpass lowshelf highshelf peaking notch allpass".split(" ");t.prototype.connectTo=function(D){this.wetNode.disconnect();this.wetNode.connect(D);this.dryNode.disconnect();this.dryNode.connect(D)};t.prototype.remove=function(){this.inputNode.disconnect();this.filterNode.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};t.prototype.getInputNode=function(){return this.inputNode};t.prototype.setParam=
function(D,P,T,V){switch(D){case 0:P/=100;0>P&&(P=0);1<P&&(P=1);this.params[5]=P;E(this.wetNode.gain,P,T,V);E(this.dryNode.gain,1-P,T,V);break;case 1:this.params[1]=P;E(this.filterNode.frequency,P,T,V);break;case 2:this.params[2]=P;E(this.filterNode.detune,P,T,V);break;case 3:this.params[3]=P;E(this.filterNode.Q,P,T,V);break;case 4:this.params[4]=P,E(this.filterNode.gain,P,T,V)}};p.prototype.connectTo=function(D){this.wetNode.disconnect();this.wetNode.connect(D);this.dryNode.disconnect();this.dryNode.connect(D)};
p.prototype.remove=function(){this.inputNode.disconnect();this.mainNode.disconnect();this.delayNode.disconnect();this.delayGainNode.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};p.prototype.getInputNode=function(){return this.inputNode};p.prototype.setParam=function(D,P,T,V){switch(D){case 0:P/=100;0>P&&(P=0);1<P&&(P=1);this.params[2]=P;E(this.wetNode.gain,P,T,V);E(this.dryNode.gain,1-P,T,V);break;case 4:this.params[1]=v(P);E(this.delayGainNode.gain,v(P),T,V);break;case 5:this.params[0]=
P,E(this.delayNode.delayTime,P,T,V)}};x.prototype.connectTo=function(D){this.wetNode.disconnect();this.wetNode.connect(D);this.dryNode.disconnect();this.dryNode.connect(D)};x.prototype.remove=function(){this.inputNode.disconnect();this.convolveNode.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};x.prototype.getInputNode=function(){return this.inputNode};x.prototype.setParam=function(D,P,T,V){switch(D){case 0:P/=100,0>P&&(P=0),1<P&&(P=1),this.params[1]=P,E(this.wetNode.gain,P,T,V),
E(this.dryNode.gain,1-P,T,V)}};C.prototype.connectTo=function(D){this.dryNode.disconnect();this.dryNode.connect(D);this.wetNode.disconnect();this.wetNode.connect(D)};C.prototype.remove=function(){this.inputNode.disconnect();this.delayNode.disconnect();this.oscNode.disconnect();this.oscGainNode.disconnect();this.dryNode.disconnect();this.wetNode.disconnect();this.feedbackNode.disconnect()};C.prototype.getInputNode=function(){return this.inputNode};C.prototype.setParam=function(D,P,T,V){switch(D){case 0:P/=
100;0>P&&(P=0);1<P&&(P=1);this.params[4]=P;E(this.wetNode.gain,P/2,T,V);E(this.dryNode.gain,1-P/2,T,V);break;case 6:this.params[1]=P/1E3;E(this.oscGainNode.gain,P/1E3,T,V);break;case 7:this.params[2]=P;E(this.oscNode.frequency,P,T,V);break;case 8:this.params[3]=P/100,E(this.feedbackNode.gain,P/100,T,V)}};z.prototype.connectTo=function(D){this.dryNode.disconnect();this.dryNode.connect(D);this.wetNode.disconnect();this.wetNode.connect(D)};z.prototype.remove=function(){this.inputNode.disconnect();this.filterNode.disconnect();
this.oscNode.disconnect();this.oscGainNode.disconnect();this.dryNode.disconnect();this.wetNode.disconnect()};z.prototype.getInputNode=function(){return this.inputNode};z.prototype.setParam=function(D,P,T,V){switch(D){case 0:P/=100;0>P&&(P=0);1<P&&(P=1);this.params[5]=P;E(this.wetNode.gain,P/2,T,V);E(this.dryNode.gain,1-P/2,T,V);break;case 1:this.params[0]=P;E(this.filterNode.frequency,P,T,V);break;case 2:this.params[1]=P;E(this.filterNode.detune,P,T,V);break;case 3:this.params[2]=P;E(this.filterNode.Q,
P,T,V);break;case 6:this.params[3]=P;E(this.oscGainNode.gain,P,T,V);break;case 7:this.params[4]=P,E(this.oscNode.frequency,P,T,V)}};K.prototype.connectTo=function(D){this.node.disconnect();this.node.connect(D)};K.prototype.remove=function(){this.node.disconnect()};K.prototype.getInputNode=function(){return this.node};K.prototype.setParam=function(D,P,T,V){switch(D){case 4:this.params[0]=v(P),E(this.node.gain,v(P),T,V)}};S.prototype.connectTo=function(D){this.node.disconnect();this.node.connect(D)};
S.prototype.remove=function(){this.oscNode.disconnect();this.oscGainNode.disconnect();this.node.disconnect()};S.prototype.getInputNode=function(){return this.node};S.prototype.setParam=function(D,P,T,V){switch(D){case 0:P/=100;0>P&&(P=0);1<P&&(P=1);this.params[1]=P;E(this.node.gain.value,1-P/2,T,V);E(this.oscGainNode.gain.value,P/2,T,V);break;case 7:this.params[0]=P,E(this.oscNode.frequency,P,T,V)}};L.prototype.connectTo=function(D){this.wetNode.disconnect();this.wetNode.connect(D);this.dryNode.disconnect();
this.dryNode.connect(D)};L.prototype.remove=function(){this.oscNode.disconnect();this.ringNode.disconnect();this.inputNode.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};L.prototype.getInputNode=function(){return this.inputNode};L.prototype.setParam=function(D,P,T,V){switch(D){case 0:P/=100;0>P&&(P=0);1<P&&(P=1);this.params[1]=P;E(this.wetNode.gain,P,T,V);E(this.dryNode.gain,1-P,T,V);break;case 7:this.params[0]=P,E(this.oscNode.frequency,P,T,V)}};R.prototype.setDrive=function(D,
P){.01>D&&(D=.01);this.preGain.gain.value=D;this.postGain.gain.value=Math.pow(1/D,.6)*P};R.prototype.shape=function(D,P,T){T=1.05*T*P-P;var V=0>D?-D:D;return(V<P?V:P+T*(1-Math.exp(-(1/T)*(V-P))))*(0>D?-1:1)};R.prototype.generateColortouchCurve=function(D,P){D=Math.pow(10,D/20);P=Math.pow(10,P/20);for(var T,V=0;32768>V;++V)T=V/32768,T=this.shape(T,D,P),this.curve[32768+V]=T,this.curve[32768-V-1]=-T};R.prototype.connectTo=function(D){this.wetNode.disconnect();this.wetNode.connect(D);this.dryNode.disconnect();
this.dryNode.connect(D)};R.prototype.remove=function(){this.inputNode.disconnect();this.preGain.disconnect();this.waveShaper.disconnect();this.postGain.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};R.prototype.getInputNode=function(){return this.inputNode};R.prototype.setParam=function(D,P,T,V){switch(D){case 0:P/=100,0>P&&(P=0),1<P&&(P=1),this.params[4]=P,E(this.wetNode.gain,P,T,V),E(this.dryNode.gain,1-P,T,V)}};F.prototype.connectTo=function(D){this.node.disconnect();this.node.connect(D)};
F.prototype.remove=function(){this.node.disconnect()};F.prototype.getInputNode=function(){return this.node};F.prototype.setParam=function(D,P,T,V){};g.prototype.tick=function(){this.node.getFloatFrequencyData(this.freqBins);this.node.getByteTimeDomainData(this.signal);for(var D=this.node.fftSize,P=0,T=this.peak=0,V;P<D;P++)V=(this.signal[P]-128)/128,0>V&&(V=-V),this.peak<V&&(this.peak=V),T+=V*V;this.peak=n(this.peak);this.rms=n(Math.sqrt(T/D))};g.prototype.connectTo=function(D){this.node.disconnect();
this.node.connect(D)};g.prototype.remove=function(){this.node.disconnect()};g.prototype.getInputNode=function(){return this.node};g.prototype.setParam=function(D,P,T,V){};l.prototype.setObject=function(D){this.obj=D};l.prototype.hasObject=function(){return!!this.obj};l.prototype.tick=function(D){};u.prototype.release=function(){var D,P;var T=D=0;for(P=M.length;D<P;++D){var V=M[D];M[T]=V;V.buffer===this?V.stop():++T}M.length=T;this.mediaSourceNode&&(this.mediaSourceNode.disconnect(),this.mediaSourceNode=
null);this.outNode&&(this.outNode.disconnect(),this.outNode=null);this.audioData=this.bufferObject=null};u.prototype.decodeAudioBuffer=function(){if(!this.bufferObject&&this.audioData){var D=this;if(this.needsSoftwareDecode){var P=this.audioData;this.audioData=null;window.OpusDecoder(P,function(T,V){if(T)D.onDecodeError(T);else T=new Float32Array(V),V=B.createBuffer(1,T.length,48E3),V.getChannelData(0).set(T),D.onDecodeComplete(V)})}else B.decodeAudioData(this.audioData,function(T){D.onDecodeComplete(T)},
function(T){D.onDecodeError(T)})}};u.prototype.onDecodeComplete=function(D){this.bufferObject=D;this.audioData=null;var P;if(cr.is_undefined(this.playTagWhenReady)||W)cr.is_undefined(this.convolveWhenReady)||(T=this.convolveWhenReady.convolveNode,T.normalize=this.normalizeWhenReady,T.buffer=D);else if(this.panWhenReady.length){var T=0;for(P=this.panWhenReady.length;T<P;T++){D=this.panWhenReady[T];var V=new c(this,D.thistag);V.setPannerEnabled(!0);if("undefined"!==typeof D.objUid&&(D.obj=m.getObjectByUID(D.objUid),
!D.obj))continue;if(D.obj){var ea=cr.rotatePtAround(D.obj.x,D.obj.y,-D.obj.layer.getAngle(),ba,da,!0),ia=cr.rotatePtAround(D.obj.x,D.obj.y,-D.obj.layer.getAngle(),ba,da,!1);V.setPan(ea,ia,cr.to_degrees(D.obj.angle-D.obj.layer.getAngle()),D.ia,D.oa,D.og);V.setObject(D.obj)}else V.setPan(D.x,D.y,D.a,D.ia,D.oa,D.og);V.play(this.loopWhenReady,this.volumeWhenReady,this.seekWhenReady);this.pauseWhenReady&&V.pause();M.push(V)}cr.clearArray(this.panWhenReady)}else V=new c(this,this.playTagWhenReady||""),
V.play(this.loopWhenReady,this.volumeWhenReady,this.seekWhenReady),this.pauseWhenReady&&V.pause(),M.push(V)};u.prototype.onDecodeError=function(D){self.failedToLoad=!0;console.error("Failed to decode audio '"+this.src+"': "+D)};u.prototype.isLoaded=function(){switch(this.myapi){case 0:var D=4<=this.bufferObject.readyState;D&&(this.wasEverReady=!0);return D||this.wasEverReady;case 1:return!!this.audioData||!!this.bufferObject;case 2:return!0}return!1};u.prototype.isLoadedAndDecoded=function(){switch(this.myapi){case 0:return this.isLoaded();
case 1:return!!this.bufferObject;case 2:return!0}return!1};u.prototype.hasFailedToLoad=function(){switch(this.myapi){case 0:return!!this.bufferObject.error;case 1:return this.failedToLoad}return!1};c.prototype.hasEnded=function(){switch(this.myapi){case 0:return this.instanceObject.ended;case 1:return 1===this.buffer.myapi?!this.fresh&&!this.stopped&&this.instanceObject.loop||this.is_paused?!1:this.hasPlaybackEnded:this.instanceObject.ended;case 2:return this.hasPlaybackEnded}return!0};c.prototype.canBeRecycled=
function(){return this.fresh||this.stopped?!0:this.hasEnded()};c.prototype.setPannerEnabled=function(D){1===G&&(!this.pannerEnabled&&D?this.gainNode&&(this.pannerNode||(this.pannerNode=B.createPanner(),this.pannerNode.panningModel="number"===typeof this.pannerNode.panningModel?na:["equalpower","HRTF","soundfield"][na],this.pannerNode.distanceModel="number"===typeof this.pannerNode.distanceModel?sa:["linear","inverse","exponential"][sa],this.pannerNode.refDistance=wa,this.pannerNode.maxDistance=Ba,
this.pannerNode.rolloffFactor=Ia),this.gainNode.disconnect(),this.gainNode.connect(this.pannerNode),this.pannerNode.connect(e(this.tag)),this.pannerEnabled=!0):this.pannerEnabled&&!D&&this.gainNode&&(this.pannerNode.disconnect(),this.gainNode.disconnect(),this.gainNode.connect(e(this.tag)),this.pannerEnabled=!1))};c.prototype.setPan=function(D,P,T,V,ea,ia){this.pannerEnabled&&1===G&&(this.pannerNode.setPosition(D,P,0),this.pannerNode.setOrientation(Math.cos(cr.to_radians(T)),Math.sin(cr.to_radians(T)),
0),this.pannerNode.coneInnerAngle=V,this.pannerNode.coneOuterAngle=ea,this.pannerNode.coneOuterGain=ia,this.panX=D,this.panY=P,this.panAngle=T,this.panConeInner=V,this.panConeOuter=ea,this.panConeOuterGain=ia)};c.prototype.setObject=function(D){this.pannerEnabled&&1===G&&(this.objectTracker||(this.objectTracker=new l),this.objectTracker.setObject(D))};c.prototype.tick=function(D){if(this.pannerEnabled&&1===G&&this.objectTracker&&this.objectTracker.hasObject()&&this.isPlaying()){this.objectTracker.tick(D);
D=this.objectTracker.obj;var P=cr.rotatePtAround(D.x,D.y,-D.layer.getAngle(),ba,da,!0),T=cr.rotatePtAround(D.x,D.y,-D.layer.getAngle(),ba,da,!1);this.pannerNode.setPosition(P,T,0);"undefined"!==typeof this.objectTracker.obj.angle&&(D=D.angle-D.layer.getAngle(),this.pannerNode.setOrientation(Math.cos(D),Math.sin(D),0))}};c.prototype.play=function(D,P,T,V){var ea=this.instanceObject;this.looping=D;this.volume=P;T=T||0;V=V||0;switch(this.myapi){case 0:1!==ea.playbackRate&&(ea.playbackRate=1);ea.volume!==
P*X&&(ea.volume=P*X);ea.loop!==D&&(ea.loop=D);ea.muted&&(ea.muted=!1);if(ea.currentTime!==T)try{ea.currentTime=T}catch(ia){}f(this);break;case 1:this.muted=!1;this.mutevol=1;if(1===this.buffer.myapi)this.gainNode.gain.value=P*X,this.fresh||(this.instanceObject=B.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode)),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=D,this.hasPlaybackEnded=
!1,0===T?h(this.instanceObject,V):r(this.instanceObject,T,this.getDuration(),V);else{1!==ea.playbackRate&&(ea.playbackRate=1);ea.loop!==D&&(ea.loop=D);ea.volume=P*X;if(ea.currentTime!==T)try{ea.currentTime=T}catch(ia){}f(this)}break;case 2:(!this.fresh&&this.stopped||0!==T)&&ea.seekTo(T),ea.play(),this.hasPlaybackEnded=!1}this.playbackRate=1;this.startTime=(this.isTimescaled?m.kahanTime.sum:m.wallTime.sum)-T;this.is_paused=this.stopped=this.fresh=!1};c.prototype.stop=function(){switch(this.myapi){case 0:this.instanceObject.paused||
this.instanceObject.pause();break;case 1:1===this.buffer.myapi?w(this.instanceObject):this.instanceObject.paused||this.instanceObject.pause();break;case 2:this.instanceObject.stop()}this.stopped=!0;this.is_paused=!1};c.prototype.pause=function(){if(!(this.fresh||this.stopped||this.hasEnded()||this.is_paused)){switch(this.myapi){case 0:this.instanceObject.paused||this.instanceObject.pause();break;case 1:1===this.buffer.myapi?(this.resume_position=this.getPlaybackTime(!0),this.looping&&(this.resume_position%=
this.getDuration()),this.is_paused=!0,w(this.instanceObject)):this.instanceObject.paused||this.instanceObject.pause();break;case 2:this.instanceObject.pause()}this.is_paused=!0}};c.prototype.resume=function(){if(!(this.fresh||this.stopped||this.hasEnded())&&this.is_paused){switch(this.myapi){case 0:f(this);break;case 1:1===this.buffer.myapi?(this.instanceObject=B.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode),this.instanceObject.onended=
this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=this.looping,this.gainNode.gain.value=X*this.volume*this.mutevol,this.updatePlaybackRate(),this.startTime=(this.isTimescaled?m.kahanTime.sum:m.wallTime.sum)-this.resume_position/(this.playbackRate||.001),r(this.instanceObject,this.resume_position,this.getDuration())):f(this);break;case 2:this.instanceObject.play()}this.is_paused=!1}};c.prototype.seek=function(D){if(!(this.fresh||this.stopped||this.hasEnded()))switch(this.myapi){case 0:try{this.instanceObject.currentTime=
D}catch(P){}break;case 1:if(1===this.buffer.myapi)this.is_paused?this.resume_position=D:(this.pause(),this.resume_position=D,this.resume());else try{this.instanceObject.currentTime=D}catch(P){}}};c.prototype.reconnect=function(D){1===this.myapi&&(this.pannerEnabled?(this.pannerNode.disconnect(),this.pannerNode.connect(D)):(this.gainNode.disconnect(),this.gainNode.connect(D)))};c.prototype.getDuration=function(D){var P=0;switch(this.myapi){case 0:"undefined"!==typeof this.instanceObject.duration&&
(P=this.instanceObject.duration);break;case 1:P=this.buffer.bufferObject.duration;break;case 2:P=this.instanceObject.getDuration()}D&&(P/=this.playbackRate||.001);return P};c.prototype.getPlaybackTime=function(D){var P=this.getDuration(),T=0;switch(this.myapi){case 0:"undefined"!==typeof this.instanceObject.currentTime&&(T=this.instanceObject.currentTime);break;case 1:if(1===this.buffer.myapi){if(this.is_paused)return this.resume_position;T=(this.isTimescaled?m.kahanTime.sum:m.wallTime.sum)-this.startTime}else"undefined"!==
typeof this.instanceObject.currentTime&&(T=this.instanceObject.currentTime)}D&&(T*=this.playbackRate);!this.looping&&T>P&&(T=P);return T};c.prototype.isPlaying=function(){return!this.is_paused&&!this.fresh&&!this.stopped&&!this.hasEnded()};c.prototype.shouldSave=function(){return!this.fresh&&!this.stopped&&!this.hasEnded()};c.prototype.setVolume=function(D){this.volume=D;this.updateVolume()};c.prototype.updateVolume=function(){var D=this.volume*X;isFinite(D)||(D=0);switch(this.myapi){case 0:"undefined"!==
typeof this.instanceObject.volume&&this.instanceObject.volume!==D&&(this.instanceObject.volume=D);break;case 1:1===this.buffer.myapi?this.gainNode.gain.value=D*this.mutevol:"undefined"!==typeof this.instanceObject.volume&&this.instanceObject.volume!==D&&(this.instanceObject.volume=D)}};c.prototype.getVolume=function(){return this.volume};c.prototype.doSetMuted=function(D){switch(this.myapi){case 0:this.instanceObject.muted!==!!D&&(this.instanceObject.muted=!!D);break;case 1:1===this.buffer.myapi?
(this.mutevol=D?0:1,this.gainNode.gain.value=X*this.volume*this.mutevol):this.instanceObject.muted!==!!D&&(this.instanceObject.muted=!!D)}};c.prototype.setMuted=function(D){this.is_muted=!!D;this.doSetMuted(this.is_muted||this.is_silent)};c.prototype.setSilent=function(D){this.is_silent=!!D;this.doSetMuted(this.is_muted||this.is_silent)};c.prototype.setLooping=function(D){this.looping=D;switch(this.myapi){case 0:this.instanceObject.loop!==!!D&&(this.instanceObject.loop=!!D);break;case 1:this.instanceObject.loop!==
!!D&&(this.instanceObject.loop=!!D)}};c.prototype.setPlaybackRate=function(D){this.playbackRate=D;this.updatePlaybackRate()};c.prototype.getPlaybackRate=function(D){return this.playbackRate};c.prototype.updatePlaybackRate=function(){var D=this.playbackRate;this.isTimescaled&&(D*=m.timescale);switch(this.myapi){case 0:this.instanceObject.playbackRate!==D&&(this.instanceObject.playbackRate=D);break;case 1:1===this.buffer.myapi?this.instanceObject.playbackRate.value!==D&&(this.instanceObject.playbackRate.value=
D):this.instanceObject.playbackRate!==D&&(this.instanceObject.playbackRate=D)}};c.prototype.setSuspended=function(D){switch(this.myapi){case 0:D?this.isPlaying()?(this.resume_me=!0,this.instanceObject.pause()):this.resume_me=!1:this.resume_me&&(this.instanceObject.play(),this.resume_me=!1);break;case 1:D?this.isPlaying()?(this.resume_me=!0,1===this.buffer.myapi?(this.resume_position=this.getPlaybackTime(!0),this.looping&&(this.resume_position%=this.getDuration()),w(this.instanceObject)):this.instanceObject.pause()):
this.resume_me=!1:this.resume_me&&(1===this.buffer.myapi?(this.instanceObject=B.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=this.looping,this.gainNode.gain.value=X*this.volume*this.mutevol,this.updatePlaybackRate(),this.startTime=(this.isTimescaled?m.kahanTime.sum:m.wallTime.sum)-this.resume_position/(this.playbackRate||
.001),r(this.instanceObject,this.resume_position,this.getDuration())):this.instanceObject.play(),this.resume_me=!1);break;case 2:D?this.isPlaying()?(this.instanceObject.pause(),this.resume_me=!0):this.resume_me=!1:this.resume_me&&(this.resume_me=!1,this.instanceObject.play())}};fa.Instance=function(D){this.type=D;m=this.runtime=D.runtime;A=this;this.listenerTracker=null;this.listenerZ=-600;this.runtime.isWKWebView&&(Aa=!0);!(this.runtime.isiOS||this.runtime.isAndroid&&(this.runtime.isChrome||this.runtime.isAndroidStockBrowser))||
this.runtime.isCrosswalk||this.runtime.isAmazonWebApp||Aa||(Ea=!0);B=null;"undefined"!==typeof AudioContext?(G=1,B=new AudioContext):"undefined"!==typeof webkitAudioContext&&(G=1,B=new webkitAudioContext);this.runtime.isiOS&&B&&(B.close&&B.close(),"undefined"!==typeof AudioContext?B=new AudioContext:"undefined"!==typeof webkitAudioContext&&(B=new webkitAudioContext));1!==G&&this.runtime.isCordova&&"undefined"!==typeof window.Media&&(G=2);2===G&&(N=location.href,D=N.lastIndexOf("/"),-1<D&&(N=N.substr(0,
D+1)),N=N.replace("file://",""));this.runtime.tickMe(this)};var ta=fa.Instance.prototype;ta.onCreate=function(){this.runtime.audioInstance=this;Z=this.properties[0];this.saveload=this.properties[1];this.playinbackground=this.properties[2];this.nextPlayTime=0;na=this.properties[4];sa=this.properties[5];this.listenerZ=-this.properties[6];wa=this.properties[7];Ba=this.properties[8];Ia=this.properties[9];this.listenerTracker=new l;var D=this.runtime.draw_width||this.runtime.width,P=this.runtime.draw_height||
this.runtime.height;1===G&&(B.listener.setPosition(D/2,P/2,this.listenerZ),B.listener.setOrientation(0,0,1,0,-1,0),window.c2OnAudioMicStream=function(V,ea){va&&va.disconnect();Da=ea.toLowerCase();va=B.createMediaStreamSource(V);va.connect(e(Da))});this.runtime.addSuspendCallback(function(V){A.onSuspend(V)});var T=this;this.runtime.addDestroyCallback(function(V){T.onInstanceDestroyed(V)})};ta.onInstanceDestroyed=function(D){var P;var T=0;for(P=M.length;T<P;T++){var V=M[T];V.objectTracker&&V.objectTracker.obj===
D&&(V.objectTracker.obj=null,V.pannerEnabled&&V.isPlaying()&&V.looping&&V.stop())}this.listenerTracker.obj===D&&(this.listenerTracker.obj=null)};ta.saveToJSON=function(){var D={silent:W,masterVolume:X,listenerZ:this.listenerZ,listenerUid:this.listenerTracker.hasObject()?this.listenerTracker.obj.uid:-1,playing:[],effects:{}},P=D.playing,T,V;var ea=0;for(T=M.length;ea<T;ea++){var ia=M[ea];if(ia.shouldSave()&&3!==this.saveload&&(!ia.is_music||1!==this.saveload)&&(ia.is_music||2!==this.saveload)){var ma=
ia.getPlaybackTime();ia.looping&&(ma%=ia.getDuration());ma={tag:ia.tag,buffersrc:ia.buffer.src,buffertype:ia.buffer.type,is_music:ia.is_music,playbackTime:ma,volume:ia.volume,looping:ia.looping,muted:ia.is_muted,playbackRate:ia.playbackRate,paused:ia.is_paused,resume_position:ia.resume_position};if(ia.pannerEnabled){ma.pan={};var oa=ma.pan;ia.objectTracker&&ia.objectTracker.hasObject()?oa.objUid=ia.objectTracker.obj.uid:(oa.x=ia.panX,oa.y=ia.panY,oa.a=ia.panAngle);oa.ia=ia.panConeInner;oa.oa=ia.panConeOuter;
oa.og=ia.panConeOuterGain}P.push(ma)}}P=D.effects;for(V in qa)if(qa.hasOwnProperty(V)){ia=[];ea=0;for(T=qa[V].length;ea<T;ea++)ia.push({type:qa[V][ea].type,params:qa[V][ea].params});P[V]=ia}return D};var xa=[];ta.loadFromJSON=function(D){var P=D.silent;X=D.masterVolume;this.listenerZ=D.listenerZ;this.listenerTracker.setObject(null);var T=D.listenerUid;-1!==T&&(this.listenerTracker.loadUid=T,xa.push(this.listenerTracker));T=D.playing;var V;if(3!==this.saveload){var ea=0;for(V=M.length;ea<V;ea++){var ia=
M[ea];ia.is_music&&1===this.saveload||(ia.is_music||2!==this.saveload)&&ia.stop()}}for(ra in qa)if(qa.hasOwnProperty(ra))for(ea=0,V=qa[ra].length;ea<V;ea++)qa[ra][ea].remove();cr.wipe(qa);for(ra in D.effects)if(D.effects.hasOwnProperty(ra)){var ma=D.effects[ra];ea=0;for(V=ma.length;ea<V;ea++){var oa=ma[ea].type;var ka=ma[ea].params;switch(oa){case "filter":U(ra,new t(ka[0],ka[1],ka[2],ka[3],ka[4],ka[5]));break;case "delay":U(ra,new p(ka[0],ka[1],ka[2]));break;case "convolve":oa=ka[2];ia=this.getAudioBuffer(oa,
!1);ia.bufferObject?oa=new x(ia.bufferObject,ka[0],ka[1],oa):(oa=new x(null,ka[0],ka[1],oa),ia.normalizeWhenReady=ka[0],ia.convolveWhenReady=oa);U(ra,oa);break;case "flanger":U(ra,new C(ka[0],ka[1],ka[2],ka[3],ka[4]));break;case "phaser":U(ra,new z(ka[0],ka[1],ka[2],ka[3],ka[4],ka[5]));break;case "gain":U(ra,new K(ka[0]));break;case "tremolo":U(ra,new S(ka[0],ka[1]));break;case "ringmod":U(ra,new L(ka[0],ka[1]));break;case "distortion":U(ra,new R(ka[0],ka[1],ka[2],ka[3],ka[4]));break;case "compressor":U(ra,
new F(ka[0],ka[1],ka[2],ka[3],ka[4]));break;case "analyser":U(ra,new g(ka[0],ka[1]))}}}ea=0;for(V=T.length;ea<V;ea++)if(3!==this.saveload){D=T[ea];oa=D.buffersrc;ia=D.buffertype||"";var ua=D.is_music;var ra=D.tag;ma=D.playbackTime;var Ja=D.looping;var Ka=D.volume;var Ca=(ka=D.pan)&&ka.hasOwnProperty("objUid")?ka.objUid:-1;if(!ua||1!==this.saveload)if(ua||2!==this.saveload)(ia=this.getAudioInstance({url:oa,type:ia},ra,ua,Ja,Ka))?(ia.resume_position=D.resume_position,ia.setPannerEnabled(!!ka),ia.play(Ja,
Ka,ma),ia.updatePlaybackRate(),ia.updateVolume(),ia.doSetMuted(ia.is_muted||ia.is_silent),D.paused&&ia.pause(),D.muted&&ia.setMuted(!0),ia.doSetMuted(ia.is_muted||ia.is_silent),ka&&(-1!==Ca?(ia.objectTracker=ia.objectTracker||new l,ia.objectTracker.loadUid=Ca,xa.push(ia.objectTracker)):ia.setPan(ka.x,ka.y,ka.a,ka.ia,ka.oa,ka.og))):(ia=this.getAudioBuffer({url:oa,type:""},ua),ia.seekWhenReady=ma,ia.pauseWhenReady=D.paused,ka&&(-1!==Ca?ia.panWhenReady.push({objUid:Ca,ia:ka.ia,oa:ka.oa,og:ka.og,thistag:ra}):
ia.panWhenReady.push({x:ka.x,y:ka.y,a:ka.a,ia:ka.ia,oa:ka.oa,og:ka.og,thistag:ra})))}if(P&&!W){ea=0;for(V=M.length;ea<V;ea++)M[ea].setSilent(!0);W=!0}else if(!P&&W){ea=0;for(V=M.length;ea<V;ea++)M[ea].setSilent(!1);W=!1}};ta.afterLoad=function(){var D;var P=0;for(D=xa.length;P<D;P++){var T=xa[P];var V=this.runtime.getObjectByUID(T.loadUid);T.setObject(V);T.loadUid=-1;V&&(ba=V.x,da=V.y)}cr.clearArray(xa)};ta.onSuspend=function(D){if(!this.playinbackground){!D&&B&&B.resume&&(B.resume(),ja=!1);var P;
var T=0;for(P=M.length;T<P;T++)M[T].setSuspended(D);D&&B&&B.suspend&&(B.suspend(),ja=!0)}};ta.tick=function(){var D=this.runtime.dt,P;var T=0;for(P=M.length;T<P;T++){var V=M[T];V.tick(D);0!==Z&&V.updatePlaybackRate()}var ea;for(ea in qa)if(qa.hasOwnProperty(ea))for(V=qa[ea],T=0,P=V.length;T<P;T++){var ia=V[T];ia.tick&&ia.tick()}1===G&&this.listenerTracker.hasObject()&&(this.listenerTracker.tick(D),ba=this.listenerTracker.obj.x,da=this.listenerTracker.obj.y,B.listener.setPosition(this.listenerTracker.obj.x,
this.listenerTracker.obj.y,this.listenerZ))};var ya=[];ta.setPreloadList=function(D){var P,T=0;var V=0;for(P=D.length;V<P;++V){var ea=D[V];var ia=2*ea.size;ya.push({filename:ea.filename,size:ia,type:ea.type,obj:null});T+=ia}return T};ta.startPreloads=function(){var D;var P=0;for(D=ya.length;P<D;++P){var T=ya[P];var V=this.runtime.getProjectFileUrl(T.filename);T.obj=this.getAudioBuffer({url:V,type:T.type},!1)}};ta.getPreloadedSize=function(){var D=0,P;var T=0;for(P=ya.length;T<P;++T){var V=ya[T];V.obj.isLoadedAndDecoded()||
V.obj.hasFailedToLoad()||this.runtime.isAndroidStockBrowser?D+=V.size:V.obj.isLoaded()&&(D+=Math.floor(V.size/2))}return D};ta.releaseAllMusicBuffers=function(){var D,P;var T=D=0;for(P=I.length;D<P;++D){var V=I[D];I[T]=V;V.is_music?V.release():++T}I.length=T};ta.getAudioBuffer=function(D,P,T){var V,ea=null,ia=D.url;var ma=0;for(V=I.length;ma<V;ma++){var oa=I[ma];if(oa.src===ia){ea=oa;break}}ea||T||((Aa||Ha)&&P&&this.releaseAllMusicBuffers(),ea=new u(ia,D.type,P),I.push(ea));return ea};ta.getAudioInstance=
function(D,P,T,V,ea){var ia,ma=D.url;var oa=0;for(ia=M.length;oa<ia;oa++){var ka=M[oa];if(ka.src===ma&&(ka.canBeRecycled()||T))return ka.tag=P,ka}D=this.getAudioBuffer(D,T);if(!D.bufferObject)return"<preload>"!==P&&(D.playTagWhenReady=P,D.loopWhenReady=V,D.volumeWhenReady=ea),null;ka=new c(D,P);M.push(ka);return ka};var pa=[];Y.prototype.OnEnded=function(D){return cr.equals_nocase(J,D)};Y.prototype.PreloadsComplete=function(){var D;var P=0;for(D=I.length;P<D;P++)if(!I[P].isLoadedAndDecoded()&&!I[P].hasFailedToLoad())return!1;
return!0};Y.prototype.AdvancedAudioSupported=function(){return 1===G};Y.prototype.IsSilent=function(){return W};Y.prototype.IsAnyPlaying=function(){var D;var P=0;for(D=M.length;P<D;P++)if(M[P].isPlaying())return!0;return!1};Y.prototype.IsTagPlaying=function(D){H(D);var P;D=0;for(P=pa.length;D<P;D++)if(pa[D].isPlaying())return!0;return!1};fa.cnds=new Y;aa.prototype.Play=function(D,P,T,V){if(!W){T=v(T);var ea=D[1];if(D=this.runtime.getProjectAudioFileUrl(D[0]))if(Q=this.getAudioInstance(D,V,ea,0!==
P,T))Q.setPannerEnabled(!1),Q.play(0!==P,T,0,this.nextPlayTime),this.nextPlayTime=0}};aa.prototype.PlayAtPosition=function(D,P,T,V,ea,ia,ma,oa,ka,ua){if(!W){T=v(T);var ra=D[1];if(D=this.runtime.getProjectAudioFileUrl(D[0]))(Q=this.getAudioInstance(D,ua,ra,0!==P,T))?(Q.setPannerEnabled(!0),Q.setPan(V,ea,ia,ma,oa,v(ka)),Q.play(0!==P,T,0,this.nextPlayTime),this.nextPlayTime=0):this.getAudioBuffer(D,ra).panWhenReady.push({x:V,y:ea,a:ia,ia:ma,oa,og:v(ka),thistag:ua})}};aa.prototype.PlayAtObject=function(D,
P,T,V,ea,ia,ma,oa){if(!W&&V&&(V=V.getFirstPicked())){T=v(T);var ka=D[1];if(D=this.runtime.getProjectAudioFileUrl(D[0]))(Q=this.getAudioInstance(D,oa,ka,0!==P,T))?(Q.setPannerEnabled(!0),oa=cr.rotatePtAround(V.x,V.y,-V.layer.getAngle(),ba,da,!0),D=cr.rotatePtAround(V.x,V.y,-V.layer.getAngle(),ba,da,!1),Q.setPan(oa,D,cr.to_degrees(V.angle-V.layer.getAngle()),ea,ia,v(ma)),Q.setObject(V),Q.play(0!==P,T,0,this.nextPlayTime),this.nextPlayTime=0):this.getAudioBuffer(D,ka).panWhenReady.push({obj:V,ia:ea,
oa:ia,og:v(ma),thistag:oa})}};aa.prototype.PlayByName=function(D,P,T,V,ea){!W&&(V=v(V),D=1===D,P=this.runtime.getProjectAudioFileUrl(P))&&(Q=this.getAudioInstance(P,ea,D,0!==T,V))&&(Q.setPannerEnabled(!1),Q.play(0!==T,V,0,this.nextPlayTime),this.nextPlayTime=0)};aa.prototype.PlayAtPositionByName=function(D,P,T,V,ea,ia,ma,oa,ka,ua,ra){!W&&(V=v(V),D=1===D,P=this.runtime.getProjectAudioFileUrl(P))&&((Q=this.getAudioInstance(P,ra,D,0!==T,V))?(Q.setPannerEnabled(!0),Q.setPan(ea,ia,ma,oa,ka,v(ua)),Q.play(0!==
T,V,0,this.nextPlayTime),this.nextPlayTime=0):this.getAudioBuffer(P,D).panWhenReady.push({x:ea,y:ia,a:ma,ia:oa,oa:ka,og:v(ua),thistag:ra}))};aa.prototype.PlayAtObjectByName=function(D,P,T,V,ea,ia,ma,oa,ka){!W&&ea&&(ea=ea.getFirstPicked())&&(V=v(V),D=1===D,P=this.runtime.getProjectAudioFileUrl(P))&&((Q=this.getAudioInstance(P,ka,D,0!==T,V))?(Q.setPannerEnabled(!0),ka=cr.rotatePtAround(ea.x,ea.y,-ea.layer.getAngle(),ba,da,!0),P=cr.rotatePtAround(ea.x,ea.y,-ea.layer.getAngle(),ba,da,!1),Q.setPan(ka,
P,cr.to_degrees(ea.angle-ea.layer.getAngle()),ia,ma,v(oa)),Q.setObject(ea),Q.play(0!==T,V,0,this.nextPlayTime),this.nextPlayTime=0):this.getAudioBuffer(P,D).panWhenReady.push({obj:ea,ia,oa:ma,og:v(oa),thistag:ka}))};aa.prototype.SetLooping=function(D,P){H(D);var T;D=0;for(T=pa.length;D<T;D++)pa[D].setLooping(0===P)};aa.prototype.SetMuted=function(D,P){H(D);var T;D=0;for(T=pa.length;D<T;D++)pa[D].setMuted(0===P)};aa.prototype.SetVolume=function(D,P){H(D);D=v(P);var T;P=0;for(T=pa.length;P<T;P++)pa[P].setVolume(D)};
aa.prototype.Preload=function(D){if(!W){var P=D[1];(D=this.runtime.getProjectAudioFileUrl(D[0]))&&2!==G&&this.getAudioInstance(D,"<preload>",P,!1)}};aa.prototype.PreloadByName=function(D,P){W||(D=1===D,(P=this.runtime.getProjectAudioFileUrl(P))&&2!==G&&this.getAudioInstance(P,"<preload>",D,!1))};aa.prototype.SetPlaybackRate=function(D,P){H(D);0>P&&(P=0);var T;D=0;for(T=pa.length;D<T;D++)pa[D].setPlaybackRate(P)};aa.prototype.Stop=function(D){H(D);var P;D=0;for(P=pa.length;D<P;D++)pa[D].stop()};aa.prototype.StopAll=
function(){var D;var P=0;for(D=M.length;P<D;P++)M[P].stop()};aa.prototype.SetPaused=function(D,P){H(D);var T;D=0;for(T=pa.length;D<T;D++)0===P?pa[D].pause():pa[D].resume()};aa.prototype.Seek=function(D,P){H(D);var T;D=0;for(T=pa.length;D<T;D++)pa[D].seek(P)};aa.prototype.SetSilent=function(D){var P;2===D&&(D=W?1:0);if(0===D&&!W){D=0;for(P=M.length;D<P;D++)M[D].setSilent(!0);W=!0}else if(1===D&&W){D=0;for(P=M.length;D<P;D++)M[D].setSilent(!1);W=!1}};aa.prototype.SetMasterVolume=function(D){X=v(D);
var P;D=0;for(P=M.length;D<P;D++)M[D].updateVolume()};aa.prototype.AddFilterEffect=function(D,P,T,V,ea,ia,ma){1!==G||0>P||P>=Ga.length||!B.createBiquadFilter||(D=D.toLowerCase(),ma/=100,0>ma&&(ma=0),1<ma&&(ma=1),U(D,new t(P,T,V,ea,ia,ma)))};aa.prototype.AddDelayEffect=function(D,P,T,V){1===G&&(D=D.toLowerCase(),V/=100,0>V&&(V=0),1<V&&(V=1),U(D,new p(P,v(T),V)))};aa.prototype.AddFlangerEffect=function(D,P,T,V,ea,ia){1===G&&B.createOscillator&&(D=D.toLowerCase(),ia/=100,0>ia&&(ia=0),1<ia&&(ia=1),U(D,
new C(P/1E3,T/1E3,V,ea/100,ia)))};aa.prototype.AddPhaserEffect=function(D,P,T,V,ea,ia,ma){1===G&&B.createOscillator&&(D=D.toLowerCase(),ma/=100,0>ma&&(ma=0),1<ma&&(ma=1),U(D,new z(P,T,V,ea,ia,ma)))};aa.prototype.AddConvolutionEffect=function(D,P,T,V){if(1===G&&B.createConvolver){T=0===T;var ea=this.runtime.getProjectAudioFileUrl(P[0]);ea&&(P=this.getAudioBuffer(ea,!1),D=D.toLowerCase(),V/=100,0>V&&(V=0),1<V&&(V=1),P.bufferObject?V=new x(P.bufferObject,T,V,ea.url):(V=new x(null,T,V,ea.url),P.normalizeWhenReady=
T,P.convolveWhenReady=V),U(D,V))}};aa.prototype.AddGainEffect=function(D,P){1===G&&(D=D.toLowerCase(),U(D,new K(v(P))))};aa.prototype.AddMuteEffect=function(D){1===G&&(D=D.toLowerCase(),U(D,new K(0)))};aa.prototype.AddTremoloEffect=function(D,P,T){1===G&&B.createOscillator&&(D=D.toLowerCase(),T/=100,0>T&&(T=0),1<T&&(T=1),U(D,new S(P,T)))};aa.prototype.AddRingModEffect=function(D,P,T){1===G&&B.createOscillator&&(D=D.toLowerCase(),T/=100,0>T&&(T=0),1<T&&(T=1),U(D,new L(P,T)))};aa.prototype.AddDistortionEffect=
function(D,P,T,V,ea,ia){1===G&&B.createWaveShaper&&(D=D.toLowerCase(),ia/=100,0>ia&&(ia=0),1<ia&&(ia=1),U(D,new R(P,T,V,ea,ia)))};aa.prototype.AddCompressorEffect=function(D,P,T,V,ea,ia){1===G&&B.createDynamicsCompressor&&(D=D.toLowerCase(),U(D,new F(P,T,V,ea/1E3,ia/1E3)))};aa.prototype.AddAnalyserEffect=function(D,P,T){1===G&&(D=D.toLowerCase(),U(D,new g(P,T)))};aa.prototype.RemoveEffects=function(D){if(1===G){D=D.toLowerCase();var P;if(qa.hasOwnProperty(D)){var T=qa[D];if(T.length){var V=0;for(P=
T.length;V<P;V++)T[V].remove();cr.clearArray(T);O(D)}}}};aa.prototype.SetEffectParameter=function(D,P,T,V,ea,ia){1===G&&(D=D.toLowerCase(),P=Math.floor(P),qa.hasOwnProperty(D)&&(D=qa[D],0>P||P>=D.length||D[P].setParam(T,V,ea,ia)))};aa.prototype.SetListenerObject=function(D){D&&1===G&&(D=D.getFirstPicked())&&(this.listenerTracker.setObject(D),ba=D.x,da=D.y)};aa.prototype.SetListenerZ=function(D){this.listenerZ=D};aa.prototype.ScheduleNextPlay=function(D){B&&(this.nextPlayTime=D)};aa.prototype.UnloadAudio=
function(D){var P=D[1];if(D=this.runtime.getProjectAudioFileUrl(D[0]))if(P=this.getAudioBuffer(D,P,!0))P.release(),cr.arrayFindRemove(I,P)};aa.prototype.UnloadAudioByName=function(D,P){D=1===D;if(P=this.runtime.getProjectAudioFileUrl(P))if(P=this.getAudioBuffer(P,D,!0))P.release(),cr.arrayFindRemove(I,P)};aa.prototype.UnloadAll=function(){var D;var P=0;for(D=I.length;P<D;++P)I[P].release();cr.clearArray(I)};fa.acts=new aa;ca.prototype.Duration=function(D,P){H(P,!0);pa.length?D.set_float(pa[0].getDuration()):
D.set_float(0)};ca.prototype.PlaybackTime=function(D,P){H(P,!0);pa.length?D.set_float(pa[0].getPlaybackTime(!0)):D.set_float(0)};ca.prototype.PlaybackRate=function(D,P){H(P,!0);pa.length?D.set_float(pa[0].getPlaybackRate()):D.set_float(0)};ca.prototype.Volume=function(D,P){H(P,!0);pa.length?(P=pa[0].getVolume(),D.set_float(n(P))):D.set_float(0)};ca.prototype.MasterVolume=function(D){D.set_float(n(X))};ca.prototype.EffectCount=function(D,P){P=P.toLowerCase();var T=null;qa.hasOwnProperty(P)&&(T=qa[P]);
D.set_int(T?T.length:0)};ca.prototype.AnalyserFreqBinCount=function(D,P,T){P=P.toLowerCase();T=Math.floor(T);P=ha(P,T);D.set_int(P?P.node.frequencyBinCount:0)};ca.prototype.AnalyserFreqBinAt=function(D,P,T,V){P=P.toLowerCase();T=Math.floor(T);V=Math.floor(V);(P=ha(P,T))?0>V||V>=P.node.frequencyBinCount?D.set_float(0):D.set_float(P.freqBins[V]):D.set_float(0)};ca.prototype.AnalyserPeakLevel=function(D,P,T){P=P.toLowerCase();T=Math.floor(T);(P=ha(P,T))?D.set_float(P.peak):D.set_float(0)};ca.prototype.AnalyserRMSLevel=
function(D,P,T){P=P.toLowerCase();T=Math.floor(T);(P=ha(P,T))?D.set_float(P.rms):D.set_float(0)};ca.prototype.SampleRate=function(D){D.set_int(B?B.sampleRate:0)};ca.prototype.CurrentTime=function(D){D.set_float(B?B.currentTime:cr.performance_now())};fa.exps=new ca})();cr.plugins_.Function=function(b){this.runtime=b};
(function(){function b(){this.name="";this.retVal=0;this.params=[]}function f(){d++;d===a.length&&a.push(new b);return a[d]}function k(){return 0>d?null:a[d]}function q(){}function v(){}function n(){}var e=cr.plugins_.Function.prototype;e.Type=function(h){this.plugin=h;this.runtime=h.runtime};e.Type.prototype.onCreate=function(){};e.Instance=function(h){this.type=h;this.runtime=h.runtime};var a=[],d=-1;e.Instance.prototype.onCreate=function(){var h=this;window.c2_callFunction=function(r,w){var E,
t=f();t.name=r.toLowerCase();t.retVal=0;if(w)for(t.params.length=w.length,r=0,E=w.length;r<E;++r){var p=w[r];t.params[r]="number"===typeof p||"string"===typeof p?p:"boolean"===typeof p?p?1:0:0}else cr.clearArray(t.params);h.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,h,t.name);d--;return t.retVal}};q.prototype.OnFunction=function(h){var r=k();return r?cr.equals_nocase(h,r.name):!1};q.prototype.CompareParam=function(h,r,w){var E=k();if(!E)return!1;h=cr.floor(h);var t=0;0<=h&&h<E.params.length&&
(t=E.params[h]);return cr.do_cmp(t,r,w)};e.cnds=new q;v.prototype.CallFunction=function(h,r){var w=f();w.name=h.toLowerCase();w.retVal=0;cr.shallowAssignArray(w.params,r);this.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,this,w.name);d--};v.prototype.SetReturnValue=function(h){var r=k();r&&(r.retVal=h)};v.prototype.CallExpression=function(h){};e.acts=new v;n.prototype.ReturnValue=function(h){if(a.length){var r=d+1;r>=a.length&&(r=a.length-1);r=a[r]}else r=null;r?h.set_any(r.retVal):
h.set_int(0)};n.prototype.ParamCount=function(h){var r=k();r?h.set_int(r.params.length):h.set_int(0)};n.prototype.Param=function(h,r){r=cr.floor(r);var w=k();w?0<=r&&r<w.params.length?h.set_any(w.params[r]):h.set_int(0):h.set_int(0)};n.prototype.Call=function(h,r){var w=f();w.name=r.toLowerCase();w.retVal=0;cr.clearArray(w.params);var E;var t=2;for(E=arguments.length;t<E;t++)w.params.push(arguments[t]);this.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,this,w.name);d--;h.set_any(w.retVal)};
e.exps=new n})();cr.plugins_.Keyboard=function(b){this.runtime=b};
(function(){function b(){}function f(){}function k(e){e=Math.floor(e);switch(e){case 8:return"backspace";case 9:return"tab";case 13:return"enter";case 16:return"shift";case 17:return"control";case 18:return"alt";case 19:return"pause";case 20:return"capslock";case 27:return"esc";case 33:return"pageup";case 34:return"pagedown";case 35:return"end";case 36:return"home";case 37:return"\u2190";case 38:return"\u2191";case 39:return"\u2192";case 40:return"\u2193";case 45:return"insert";case 46:return"del";
case 91:return"left window key";case 92:return"right window key";case 93:return"select";case 96:return"numpad 0";case 97:return"numpad 1";case 98:return"numpad 2";case 99:return"numpad 3";case 100:return"numpad 4";case 101:return"numpad 5";case 102:return"numpad 6";case 103:return"numpad 7";case 104:return"numpad 8";case 105:return"numpad 9";case 106:return"numpad *";case 107:return"numpad +";case 109:return"numpad -";case 110:return"numpad .";case 111:return"numpad /";case 112:return"F1";case 113:return"F2";
case 114:return"F3";case 115:return"F4";case 116:return"F5";case 117:return"F6";case 118:return"F7";case 119:return"F8";case 120:return"F9";case 121:return"F10";case 122:return"F11";case 123:return"F12";case 144:return"numlock";case 145:return"scroll lock";case 186:return";";case 187:return"=";case 188:return",";case 189:return"-";case 190:return".";case 191:return"/";case 192:return"'";case 219:return"[";case 220:return"\\";case 221:return"]";case 222:return"#";case 223:return"`";default:return String.fromCharCode(e)}}
var q=cr.plugins_.Keyboard.prototype;q.Type=function(e){this.plugin=e;this.runtime=e.runtime};q.Type.prototype.onCreate=function(){};q.Instance=function(e){this.type=e;this.runtime=e.runtime;this.keyMap=Array(256);this.typedKeyMap=Array(256);this.usedKeys=Array(256);this.triggerKey=0};var v=q.Instance.prototype;v.onCreate=function(){var e=this;document.addEventListener("keydown",function(a){e.onKeyDown(a)});document.addEventListener("keyup",function(a){e.onKeyUp(a)})};var n=[32,33,34,35,36,37,38,
39,40,44];v.onKeyDown=function(e){var a=!1;window!=window.top&&-1<n.indexOf(e.which)&&(e.preventDefault(),a=!0,e.stopPropagation());if(this.keyMap[e.which])this.usedKeys[e.which]&&!a&&e.preventDefault();else{var d=e.which;this.typedKeyMap[d]=e.key;this.keyMap[d]=!0;this.triggerKey=d;this.runtime.isInUserInputEvent=!0;this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKey,this);var h=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKey,this),r=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCode,
this);this.runtime.isInUserInputEvent=!1;if(h||r)this.usedKeys[d]=!0,a||e.preventDefault()}};v.onKeyUp=function(e){var a=e.which;this.typedKeyMap[a]=e.key;this.keyMap[a]=!1;this.triggerKey=a;this.runtime.isInUserInputEvent=!0;this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKeyReleased,this);var d=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyReleased,this),h=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCodeReleased,this);this.runtime.isInUserInputEvent=
!1;if(d||h||this.usedKeys[e.which])this.usedKeys[a]=!0,e.preventDefault()};v.onWindowBlur=function(){var e;for(e=0;256>e;++e)if(this.keyMap[e]){this.keyMap[e]=!1;this.triggerKey=e;this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKeyReleased,this);var a=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyReleased,this),d=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCodeReleased,this);if(a||d)this.usedKeys[e]=!0}};v.saveToJSON=function(){return{triggerKey:this.triggerKey}};
v.loadFromJSON=function(e){this.triggerKey=e.triggerKey};b.prototype.IsKeyDown=function(e){return this.keyMap[e]};b.prototype.OnKey=function(e){return e===this.triggerKey};b.prototype.OnAnyKey=function(e){return!0};b.prototype.OnAnyKeyReleased=function(e){return!0};b.prototype.OnKeyReleased=function(e){return e===this.triggerKey};b.prototype.IsKeyCodeDown=function(e){e=Math.floor(e);return 0>e||e>=this.keyMap.length?!1:this.keyMap[e]};b.prototype.OnKeyCode=function(e){return e===this.triggerKey};
b.prototype.OnKeyCodeReleased=function(e){return e===this.triggerKey};q.cnds=new b;q.acts=new function(){};f.prototype.TypedKey=function(e){e.set_string(this.typedKeyMap[this.triggerKey]||"")};f.prototype.LastKeyCode=function(e){e.set_int(this.triggerKey)};f.prototype.StringFromKeyCode=function(e,a){e.set_string(k(a))};q.exps=new f})();cr.plugins_.Mouse=function(b){this.runtime=b};
(function(){function b(){}function f(){}function k(){}var q=cr.plugins_.Mouse.prototype;q.Type=function(e){this.plugin=e;this.runtime=e.runtime};q.Type.prototype.onCreate=function(){};q.Instance=function(e){this.type=e;this.runtime=e.runtime;this.buttonMap=Array(4);this.triggerDir=this.triggerType=this.triggerButton=this.mouseYcanvas=this.mouseXcanvas=0;this.handled=!1};var v=q.Instance.prototype;v.onCreate=function(){var e=this;document.addEventListener("mousemove",function(d){e.onMouseMove(d)});
document.addEventListener("mousedown",function(d){e.onMouseDown(d)});document.addEventListener("mouseup",function(d){e.onMouseUp(d)});document.addEventListener("dblclick",function(d){e.onDoubleClick(d)});var a=function(d){e.onWheel(d)};document.addEventListener("mousewheel",a,!1);document.addEventListener("DOMMouseScroll",a,!1)};v.onMouseMove=function(e){this.mouseXcanvas=e.pageX-this.runtime.canvas.offsetLeft;this.mouseYcanvas=e.pageY-this.runtime.canvas.offsetTop};v.mouseInGame=function(){return 0<
this.runtime.fullscreen_mode?!0:0<=this.mouseXcanvas&&0<=this.mouseYcanvas&&this.mouseXcanvas<this.runtime.width&&this.mouseYcanvas<this.runtime.height};v.onMouseDown=function(e){this.mouseInGame()&&(this.buttonMap[e.which]=!0,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnAnyClick,this),this.triggerButton=e.which-1,this.triggerType=0,this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnClick,this),this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnObjectClicked,
this),this.runtime.isInUserInputEvent=!1)};v.onMouseUp=function(e){this.buttonMap[e.which]&&(this.runtime.had_a_click&&!this.runtime.isMobile&&e.preventDefault(),this.runtime.had_a_click=!0,this.buttonMap[e.which]=!1,this.runtime.isInUserInputEvent=!0,this.triggerButton=e.which-1,this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnRelease,this),this.runtime.isInUserInputEvent=!1)};v.onDoubleClick=function(e){this.mouseInGame()&&(e.preventDefault(),this.runtime.isInUserInputEvent=!0,this.triggerButton=
e.which-1,this.triggerType=1,this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnClick,this),this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnObjectClicked,this),this.runtime.isInUserInputEvent=!1)};v.onWheel=function(e){this.triggerDir=0>(e.wheelDelta?e.wheelDelta:e.detail?-e.detail:0)?0:1;this.handled=!1;this.runtime.isInUserInputEvent=!0;this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnWheel,this);this.runtime.isInUserInputEvent=!1;this.handled&&cr.isCanvasInputEvent(e)&&e.preventDefault()};
v.onWindowBlur=function(){var e;var a=0;for(e=this.buttonMap.length;a<e;++a)this.buttonMap[a]&&(this.buttonMap[a]=!1,this.triggerButton=a-1,this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnRelease,this))};v.isMouseOverCanvas=function(){return 0<=this.mouseXcanvas&&0<=this.mouseYcanvas&&this.mouseXcanvas<this.runtime.width&&this.mouseYcanvas<this.runtime.height};b.prototype.OnClick=function(e,a){return e===this.triggerButton&&a===this.triggerType};b.prototype.OnAnyClick=function(){return!0};
b.prototype.IsButtonDown=function(e){return this.buttonMap[e+1]};b.prototype.OnRelease=function(e){return e===this.triggerButton};b.prototype.IsOverObject=function(e){if(this.isMouseOverCanvas()){var a=this.runtime.getCurrentCondition();return cr.xor(this.runtime.testAndSelectCanvasPointOverlap(e,this.mouseXcanvas,this.mouseYcanvas,a.inverted),a.inverted)}};b.prototype.OnObjectClicked=function(e,a,d){if(e!==this.triggerButton||a!==this.triggerType)return!1;if(this.isMouseOverCanvas())return this.runtime.testAndSelectCanvasPointOverlap(d,
this.mouseXcanvas,this.mouseYcanvas,!1)};b.prototype.OnWheel=function(e){this.handled=!0;return e===this.triggerDir};q.cnds=new b;var n=null;f.prototype.SetCursor=function(e){e="auto pointer text crosshair move help wait none".split(" ")[e];n!==e&&(n=e,document.body.style.cursor=e)};f.prototype.SetCursorSprite=function(e){!this.runtime.isMobile&&e&&(e=e.getFirstPicked())&&e.curFrame&&(e=e.curFrame,n!==e&&(n=e,e="url("+e.getDataUri()+") "+Math.round(e.hotspotX*e.width)+" "+Math.round(e.hotspotY*e.height)+
", auto",document.body.style.cursor="",document.body.style.cursor=e))};q.acts=new f;k.prototype.X=function(e,a){if(cr.is_undefined(a)){a=this.runtime.getLayerByNumber(0);var d=a.scale;var h=a.zoomRate;var r=a.parallaxX;var w=a.angle;a.scale=1;a.zoomRate=1;a.parallaxX=1;a.angle=0;e.set_float(a.canvasToLayer(this.mouseXcanvas,this.mouseYcanvas,!0));a.scale=d;a.zoomRate=h;a.parallaxX=r;a.angle=w}else(a=cr.is_number(a)?this.runtime.getLayerByNumber(a):this.runtime.getLayerByName(a))?e.set_float(a.canvasToLayer(this.mouseXcanvas,
this.mouseYcanvas,!0)):e.set_float(0)};k.prototype.Y=function(e,a){if(cr.is_undefined(a)){a=this.runtime.getLayerByNumber(0);var d=a.scale;var h=a.zoomRate;var r=a.parallaxY;var w=a.angle;a.scale=1;a.zoomRate=1;a.parallaxY=1;a.angle=0;e.set_float(a.canvasToLayer(this.mouseXcanvas,this.mouseYcanvas,!1));a.scale=d;a.zoomRate=h;a.parallaxY=r;a.angle=w}else(a=cr.is_number(a)?this.runtime.getLayerByNumber(a):this.runtime.getLayerByName(a))?e.set_float(a.canvasToLayer(this.mouseXcanvas,this.mouseYcanvas,
!1)):e.set_float(0)};k.prototype.AbsoluteX=function(e){e.set_float(this.mouseXcanvas)};k.prototype.AbsoluteY=function(e){e.set_float(this.mouseYcanvas)};q.exps=new k})();cr.plugins_.Sprite=function(b){this.runtime=b};
(function(){function b(){if(0===this.datauri.length){var F=document.createElement("canvas");F.width=this.width;F.height=this.height;var g=F.getContext("2d");this.spritesheeted?g.drawImage(this.texture_img,this.offx,this.offy,this.width,this.height,0,0,this.width,this.height):g.drawImage(this.texture_img,0,0,this.width,this.height);this.datauri=F.toDataURL("image/png")}return this.datauri}function f(){}function k(F){F[0]=0;F[1]=0;F[2]=0;p.push(F)}function q(F,g){return F<g?""+F+","+g:""+g+","+F}function v(F,
g,l,u){g=g.uid;l=l.uid;var c=q(g,l);if(F.hasOwnProperty(c))F[c][2]=u;else{var y=p.length?p.pop():[0,0,0];y[0]=g;y[1]=l;y[2]=u;F[c]=y}}function n(F,g,l){g=q(g.uid,l.uid);F.hasOwnProperty(g)&&(k(F[g]),delete F[g])}function e(F,g,l){g=q(g.uid,l.uid);if(F.hasOwnProperty(g))return x=F[g][2],!0;x=-2;return!1}function a(F,g,l){if(!F)return!1;var u=0!==g||0!==l,c=!1,y=this.runtime.getCurrentCondition(),H=y.type;y=y.inverted;var O=F.getCurrentSol();var U=this.runtime.getCurrentEventStack().current_event.orblock;
O.select_all?(this.update_bbox(),R.copy(this.bbox),R.offset(g,l),this.runtime.getCollisionCandidates(this.layer,F,R,L),O=L):O=U?this.runtime.isCurrentConditionFirst()&&!O.else_instances.length&&O.instances.length?O.instances:O.else_instances:O.instances;z=F;S=H!==F&&!y;if(u){var Y=this.x;var aa=this.y;this.x+=g;this.y+=l;this.set_bbox_changed()}g=0;for(l=O.length;g<l;g++)if(U=O[g],this.runtime.testOverlap(this,U)){c=!0;if(y)break;H!==F&&K.add(U)}u&&(this.x=Y,this.y=aa,this.set_bbox_changed());cr.clearArray(L);
return c}function d(){}function h(){}var r=cr.plugins_.Sprite.prototype;r.Type=function(F){this.plugin=F;this.runtime=F.runtime};var w=r.Type.prototype;w.onCreate=function(){if(!this.is_family){var F,g;this.all_frames=[];this.has_loaded_textures=!1;var l=0;for(F=this.animations.length;l<F;l++){var u=this.animations[l];var c={};c.name=u[0];c.speed=u[1];c.loop=u[2];c.repeatcount=u[3];c.repeatto=u[4];c.pingpong=u[5];c.sid=u[6];c.frames=[];var y=0;for(g=u[7].length;y<g;y++){var H=u[7][y];var O={};O.texture_file=
H[0];O.texture_filesize=H[1];O.offx=H[2];O.offy=H[3];O.width=H[4];O.height=H[5];O.duration=H[6];O.hotspotX=H[7];O.hotspotY=H[8];O.image_points=H[9];O.poly_pts=H[10];O.pixelformat=H[11];O.spritesheeted=0!==O.width;O.datauri="";O.getDataUri=b;var U={left:0,top:0,right:1,bottom:1};O.sheetTex=U;O.webGL_texture=null;(U=this.runtime.findWaitingTexture(H[0]))?O.texture_img=U:(O.texture_img=new Image,O.texture_img.cr_src=H[0],O.texture_img.cr_filesize=H[1],O.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(O.texture_img,
H[0]));cr.seal(O);c.frames.push(O);this.all_frames.push(O)}cr.seal(c);this.animations[l]=c}}};w.updateAllCurrentTexture=function(){var F;var g=0;for(F=this.instances.length;g<F;g++){var l=this.instances[g];l.curWebGLTexture=l.curFrame.webGL_texture}};w.onLostWebGLContext=function(){if(!this.is_family){var F;var g=0;for(F=this.all_frames.length;g<F;++g){var l=this.all_frames[g];l.texture_img.c2webGL_texture=null;l.webGL_texture=null}this.has_loaded_textures=!1;this.updateAllCurrentTexture()}};w.onRestoreWebGLContext=
function(){if(!this.is_family&&this.instances.length){var F;var g=0;for(F=this.all_frames.length;g<F;++g){var l=this.all_frames[g];l.webGL_texture=this.runtime.glwrap.loadTexture(l.texture_img,!1,this.runtime.linearSampling,l.pixelformat)}this.updateAllCurrentTexture()}};w.loadTextures=function(){if(!this.is_family&&!this.has_loaded_textures&&this.runtime.glwrap){var F;var g=0;for(F=this.all_frames.length;g<F;++g){var l=this.all_frames[g];l.webGL_texture=this.runtime.glwrap.loadTexture(l.texture_img,
!1,this.runtime.linearSampling,l.pixelformat)}this.has_loaded_textures=!0}};w.unloadTextures=function(){if(!this.is_family&&!this.instances.length&&this.has_loaded_textures){var F;var g=0;for(F=this.all_frames.length;g<F;++g){var l=this.all_frames[g];this.runtime.glwrap.deleteTexture(l.webGL_texture);l.webGL_texture=null}this.has_loaded_textures=!1}};var E=[];w.preloadCanvas2D=function(F){var g;cr.clearArray(E);var l=0;for(g=this.all_frames.length;l<g;++l){var u=this.all_frames[l].texture_img;-1===
E.indexOf(u)&&(F.drawImage(u,0,0),E.push(u))}};r.Instance=function(F){this.type=F;this.runtime=F.runtime;F=this.type.animations[0].frames[0].poly_pts;this.recycled?this.collision_poly.set_pts(F):this.collision_poly=new cr.CollisionPoly(F)};var t=r.Instance.prototype;t.onCreate=function(){this.visible=this.properties[0];this.inAnimTrigger=this.isTicking=!1;this.collisionsEnabled=this.properties[3];this.cur_animation=this.getAnimationByName(this.properties[1])||this.type.animations[0];this.cur_frame=
this.properties[2];0>this.cur_frame&&(this.cur_frame=0);this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1);var F=this.cur_animation.frames[this.cur_frame];this.collision_poly.set_pts(F.poly_pts);this.hotspotX=F.hotspotX;this.hotspotY=F.hotspotY;this.animForwards=0<=this.cur_animation.speed;this.cur_anim_speed=Math.abs(this.cur_animation.speed);this.cur_anim_repeatto=this.cur_animation.repeatto;1===this.type.animations.length&&1===this.type.animations[0].frames.length||
0===this.cur_anim_speed||(this.runtime.tickMe(this),this.isTicking=!0);this.recycled?this.animTimer.reset():this.animTimer=new cr.KahanAdder;this.frameStart=this.getNowTime();this.animPlaying=!0;this.animRepeats=0;this.changeAnimName=this.animTriggerName="";this.changeAnimFrom=0;this.changeAnimFrame=-1;this.type.loadTextures();var g,l;F=0;for(g=this.type.animations.length;F<g;F++){var u=this.type.animations[F];var c=0;for(l=u.frames.length;c<l;c++){var y=u.frames[c];0===y.width&&(y.width=y.texture_img.width,
y.height=y.texture_img.height);if(y.spritesheeted){var H=y.texture_img;var O=y.sheetTex;O.left=y.offx/H.width;O.top=y.offy/H.height;O.right=(y.offx+y.width)/H.width;O.bottom=(y.offy+y.height)/H.height;0===y.offx&&0===y.offy&&y.width===H.width&&y.height===H.height&&(y.spritesheeted=!1)}}}this.curFrame=this.cur_animation.frames[this.cur_frame];this.curWebGLTexture=this.curFrame.webGL_texture};t.saveToJSON=function(){var F={a:this.cur_animation.sid,f:this.cur_frame,cas:this.cur_anim_speed,fs:this.frameStart,
ar:this.animRepeats,at:this.animTimer.sum,rt:this.cur_anim_repeatto};this.animPlaying||(F.ap=this.animPlaying);this.animForwards||(F.af=this.animForwards);return F};t.loadFromJSON=function(F){var g=this.getAnimationBySid(F.a);g&&(this.cur_animation=g);this.cur_frame=F.f;0>this.cur_frame&&(this.cur_frame=0);this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1);this.cur_anim_speed=F.cas;this.frameStart=F.fs;this.animRepeats=F.ar;this.animTimer.reset();
this.animTimer.sum=F.at;this.animPlaying=F.hasOwnProperty("ap")?F.ap:!0;this.animForwards=F.hasOwnProperty("af")?F.af:!0;F.hasOwnProperty("rt")?this.cur_anim_repeatto=F.rt:this.cur_anim_repeatto=this.cur_animation.repeatto;this.curFrame=this.cur_animation.frames[this.cur_frame];this.curWebGLTexture=this.curFrame.webGL_texture;this.collision_poly.set_pts(this.curFrame.poly_pts);this.hotspotX=this.curFrame.hotspotX;this.hotspotY=this.curFrame.hotspotY};t.animationFinish=function(F){this.cur_frame=F?
0:this.cur_animation.frames.length-1;this.animPlaying=!1;this.animTriggerName=this.cur_animation.name;this.inAnimTrigger=!0;this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnyAnimFinished,this);this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnimFinished,this);this.inAnimTrigger=!1;this.animRepeats=0};t.getNowTime=function(){return this.animTimer.sum};t.tick=function(){this.animTimer.add(this.runtime.getDt(this));this.changeAnimName.length&&this.doChangeAnim();0<=this.changeAnimFrame&&
this.doChangeAnimFrame();var F=this.getNowTime(),g=this.cur_animation,l=g.frames[this.cur_frame],u=l.duration/this.cur_anim_speed;this.animPlaying&&F>=this.frameStart+u&&(this.animForwards?this.cur_frame++:this.cur_frame--,this.frameStart+=u,this.cur_frame>=g.frames.length&&(g.pingpong?(this.animForwards=!1,this.cur_frame=g.frames.length-2):g.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=g.repeatcount?this.animationFinish(!1):this.cur_frame=this.cur_anim_repeatto)),
0>this.cur_frame&&(g.pingpong?(this.cur_frame=1,this.animForwards=!0,g.loop||(this.animRepeats++,this.animRepeats>=g.repeatcount&&this.animationFinish(!0))):g.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=g.repeatcount?this.animationFinish(!0):this.cur_frame=this.cur_anim_repeatto)),0>this.cur_frame?this.cur_frame=0:this.cur_frame>=g.frames.length&&(this.cur_frame=g.frames.length-1),F>this.frameStart+g.frames[this.cur_frame].duration/this.cur_anim_speed&&(this.frameStart=
F),F=g.frames[this.cur_frame],this.OnFrameChanged(l,F),this.runtime.redraw=!0)};t.getAnimationByName=function(F){var g;var l=0;for(g=this.type.animations.length;l<g;l++){var u=this.type.animations[l];if(cr.equals_nocase(u.name,F))return u}return null};t.getAnimationBySid=function(F){var g;var l=0;for(g=this.type.animations.length;l<g;l++){var u=this.type.animations[l];if(u.sid===F)return u}return null};t.doChangeAnim=function(){var F=this.cur_animation.frames[this.cur_frame],g=this.getAnimationByName(this.changeAnimName);
this.changeAnimName="";!g||cr.equals_nocase(g.name,this.cur_animation.name)&&this.animPlaying||(this.cur_animation=g,this.animForwards=0<=g.speed,this.cur_anim_speed=Math.abs(g.speed),this.cur_anim_repeatto=g.repeatto,0>this.cur_frame&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),1===this.changeAnimFrom&&(this.cur_frame=0),this.animPlaying=!0,this.frameStart=this.getNowTime(),this.OnFrameChanged(F,this.cur_animation.frames[this.cur_frame]),
this.runtime.redraw=!0)};t.doChangeAnimFrame=function(){var F=this.cur_animation.frames[this.cur_frame],g=this.cur_frame;this.cur_frame=cr.floor(this.changeAnimFrame);0>this.cur_frame&&(this.cur_frame=0);this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1);g!==this.cur_frame&&(this.OnFrameChanged(F,this.cur_animation.frames[this.cur_frame]),this.frameStart=this.getNowTime(),this.runtime.redraw=!0);this.changeAnimFrame=-1};t.OnFrameChanged=function(F,
g){var l=F.width,u=F.height,c=g.width,y=g.height;l!=c&&(this.width*=c/l);u!=y&&(this.height*=y/u);this.hotspotX=g.hotspotX;this.hotspotY=g.hotspotY;this.collision_poly.set_pts(g.poly_pts);this.set_bbox_changed();this.curFrame=g;this.curWebGLTexture=g.webGL_texture;l=0;for(u=this.behavior_insts.length;l<u;l++)if(c=this.behavior_insts[l],c.onSpriteFrameChanged)c.onSpriteFrameChanged(F,g);this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnFrameChanged,this)};t.draw=function(F){F.globalAlpha=this.opacity;
var g=this.curFrame,l=g.spritesheeted,u=g.texture_img,c=this.x,y=this.y,H=this.width,O=this.height;if(0===this.angle&&0<=H&&0<=O)c-=this.hotspotX*H,y-=this.hotspotY*O,this.runtime.pixel_rounding&&(c=Math.round(c),y=Math.round(y)),l?F.drawImage(u,g.offx,g.offy,g.width,g.height,c,y,H,O):F.drawImage(u,c,y,H,O);else{this.runtime.pixel_rounding&&(c=Math.round(c),y=Math.round(y));F.save();var U=0<H?1:-1,Y=0<O?1:-1;F.translate(c,y);1===U&&1===Y||F.scale(U,Y);F.rotate(this.angle*U*Y);c=-(this.hotspotX*cr.abs(H));
y=-(this.hotspotY*cr.abs(O));l?F.drawImage(u,g.offx,g.offy,g.width,g.height,c,y,cr.abs(H),cr.abs(O)):F.drawImage(u,c,y,cr.abs(H),cr.abs(O));F.restore()}};t.drawGL_earlyZPass=function(F){this.drawGL(F)};t.drawGL=function(F){F.setTexture(this.curWebGLTexture);F.setOpacity(this.opacity);var g=this.curFrame,l=this.bquad;if(this.runtime.pixel_rounding){var u=Math.round(this.x)-this.x,c=Math.round(this.y)-this.y;g.spritesheeted?F.quadTex(l.tlx+u,l.tly+c,l.trx+u,l.try_+c,l.brx+u,l.bry+c,l.blx+u,l.bly+c,
g.sheetTex):F.quad(l.tlx+u,l.tly+c,l.trx+u,l.try_+c,l.brx+u,l.bry+c,l.blx+u,l.bly+c)}else g.spritesheeted?F.quadTex(l.tlx,l.tly,l.trx,l.try_,l.brx,l.bry,l.blx,l.bly,g.sheetTex):F.quad(l.tlx,l.tly,l.trx,l.try_,l.brx,l.bry,l.blx,l.bly)};t.getImagePointIndexByName=function(F){var g=this.curFrame,l;var u=0;for(l=g.image_points.length;u<l;u++)if(cr.equals_nocase(F,g.image_points[u][0]))return u;return-1};t.getImagePoint=function(F,g){var l=this.curFrame,u=l.image_points;var c=cr.is_string(F)?this.getImagePointIndexByName(F):
F-1;c=cr.floor(c);if(0>c||c>=u.length)return g?this.x:this.y;F=(u[c][1]-l.hotspotX)*this.width;u=u[c][2];u=(u-l.hotspotY)*this.height;l=Math.cos(this.angle);c=Math.sin(this.angle);var y=F*l-u*c;u=u*l+F*c;F=y+this.x;u+=this.y;return g?F:u};var p=[],x=-2,C=[];f.prototype.OnCollision=function(F){if(!F)return!1;var g=this.runtime,l=g.getCurrentCondition(),u=l.type,c=null;l.extra.collmemory?c=l.extra.collmemory:(c={},l.extra.collmemory=c);l.extra.spriteCreatedDestroyCallback||(l.extra.spriteCreatedDestroyCallback=
!0,g.addDestroyCallback(function(N){var G=l.extra.collmemory;N=N.uid;var B;for(B in G)if(G.hasOwnProperty(B)){var I=G[B];if(I[0]===N||I[1]===N)k(G[B]),delete G[B]}}));var y=u.getCurrentSol(),H=F.getCurrentSol();y=y.getObjects();var O,U,Y=this.runtime.tickcount,aa=Y-1,ca=g.getCurrentEventStack().current_event;for(O=0;O<y.length;O++){var ha=y[O];if(H.select_all){ha.update_bbox();this.runtime.getCollisionCandidates(ha.layer,F,ha.bbox,C);var fa=C;this.runtime.addRegisteredCollisionCandidates(ha,F,fa)}else fa=
H.getObjects();for(U=0;U<fa.length;U++){var m=fa[U];if(g.testOverlap(ha,m)||g.checkRegisteredCollision(ha,m)){var A=e(c,ha,m);A=!A||x<aa;v(c,ha,m,Y);if(A){g.pushCopySol(ca.solModifiers);A=u.getCurrentSol();var J=F.getCurrentSol();A.select_all=!1;J.select_all=!1;u===F?(A.instances.length=2,A.instances[0]=ha,A.instances[1]=m,u.applySolToContainer()):(A.instances.length=1,J.instances.length=1,A.instances[0]=ha,J.instances[0]=m,u.applySolToContainer(),F.applySolToContainer());ca.retrigger();g.popSol(ca.solModifiers)}}else n(c,
ha,m)}cr.clearArray(C)}return!1};var z=null,K=new cr.ObjectSet,S=!1,L=[],R=new cr.rect(0,0,0,0);w.finish=function(F){if(S){if(F){var g=this.runtime.getCurrentEventStack().current_event.orblock;F=z.getCurrentSol();var l=K.valuesRef(),u;if(F.select_all){F.select_all=!1;cr.clearArray(F.instances);var c=0;for(u=l.length;c<u;++c)F.instances[c]=l[c];if(g)for(cr.clearArray(F.else_instances),c=0,u=z.instances.length;c<u;++c)l=z.instances[c],K.contains(l)||F.else_instances.push(l)}else if(g)for(g=F.instances.length,
c=0,u=l.length;c<u;++c)F.instances[g+c]=l[c],cr.arrayFindRemove(F.else_instances,l[c]);else cr.shallowAssignArray(F.instances,l);z.applySolToContainer()}K.clear();S=!1}};f.prototype.IsOverlapping=function(F){return a.call(this,F,0,0)};f.prototype.IsOverlappingOffset=function(F,g,l){return a.call(this,F,g,l)};f.prototype.IsAnimPlaying=function(F){return this.changeAnimName.length?cr.equals_nocase(this.changeAnimName,F):cr.equals_nocase(this.cur_animation.name,F)};f.prototype.CompareFrame=function(F,
g){return cr.do_cmp(this.cur_frame,F,g)};f.prototype.CompareAnimSpeed=function(F,g){return cr.do_cmp(this.animForwards?this.cur_anim_speed:-this.cur_anim_speed,F,g)};f.prototype.OnAnimFinished=function(F){return cr.equals_nocase(this.animTriggerName,F)};f.prototype.OnAnyAnimFinished=function(){return!0};f.prototype.OnFrameChanged=function(){return!0};f.prototype.IsMirrored=function(){return 0>this.width};f.prototype.IsFlipped=function(){return 0>this.height};f.prototype.OnURLLoaded=function(){return!0};
f.prototype.IsCollisionEnabled=function(){return this.collisionsEnabled};r.cnds=new f;d.prototype.Spawn=function(F,g,l){if(F&&g&&(g=this.runtime.createInstance(F,g,this.getImagePoint(l,!0),this.getImagePoint(l,!1)))){"undefined"!==typeof g.angle&&(g.angle=this.angle,g.set_bbox_changed());this.runtime.isInOnDestroy++;var u;this.runtime.trigger(Object.getPrototypeOf(F.plugin).cnds.OnCreated,g);if(g.is_contained){var c=0;for(u=g.siblings.length;c<u;c++){var y=g.siblings[c];this.runtime.trigger(Object.getPrototypeOf(y.type.plugin).cnds.OnCreated,
y)}}this.runtime.isInOnDestroy--;c=this.runtime.getCurrentAction();l=!1;if(cr.is_undefined(c.extra.Spawn_LastExec)||c.extra.Spawn_LastExec<this.runtime.execcount)l=!0,c.extra.Spawn_LastExec=this.runtime.execcount;if(F!=this.type&&(F=F.getCurrentSol(),F.select_all=!1,l?(cr.clearArray(F.instances),F.instances[0]=g):F.instances.push(g),g.is_contained))for(c=0,u=g.siblings.length;c<u;c++)y=g.siblings[c],F=y.type.getCurrentSol(),F.select_all=!1,l?(cr.clearArray(F.instances),F.instances[0]=y):F.instances.push(y)}};
d.prototype.SetEffect=function(F){this.blend_mode=F;this.compositeOp=cr.effectToCompositeOp(F);cr.setGLBlend(this,F,this.runtime.gl);this.runtime.redraw=!0};d.prototype.StopAnim=function(){this.animPlaying=!1};d.prototype.StartAnim=function(F){this.animPlaying=!0;this.frameStart=this.getNowTime();1===F&&0!==this.cur_frame&&(this.changeAnimFrame=0,this.inAnimTrigger||this.doChangeAnimFrame());this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)};d.prototype.SetAnim=function(F,g){this.changeAnimName=
F;this.changeAnimFrom=g;this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0);this.inAnimTrigger||this.doChangeAnim()};d.prototype.SetAnimFrame=function(F){this.changeAnimFrame=F;this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0);this.inAnimTrigger||this.doChangeAnimFrame()};d.prototype.SetAnimSpeed=function(F){this.cur_anim_speed=cr.abs(F);this.animForwards=0<=F;this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)};d.prototype.SetAnimRepeatToFrame=function(F){F=Math.floor(F);
0>F&&(F=0);F>=this.cur_animation.frames.length&&(F=this.cur_animation.frames.length-1);this.cur_anim_repeatto=F};d.prototype.SetMirrored=function(F){F=cr.abs(this.width)*(0===F?-1:1);this.width!==F&&(this.width=F,this.set_bbox_changed())};d.prototype.SetFlipped=function(F){F=cr.abs(this.height)*(0===F?-1:1);this.height!==F&&(this.height=F,this.set_bbox_changed())};d.prototype.SetScale=function(F){var g=this.curFrame,l=g.width*F*(0>this.width?-1:1);F=g.height*F*(0>this.height?-1:1);if(this.width!==
l||this.height!==F)this.width=l,this.height=F,this.set_bbox_changed()};d.prototype.LoadURL=function(F,g,l){var u=new Image,c=this,y=this.curFrame;u.onload=function(){y.texture_img.src===u.src?c.runtime.glwrap&&c.curFrame===y&&(c.curWebGLTexture=y.webGL_texture):(y.texture_img=u,y.offx=0,y.offy=0,y.width=u.width,y.height=u.height,y.spritesheeted=!1,y.datauri="",y.pixelformat=0,c.runtime.glwrap&&(y.webGL_texture&&c.runtime.glwrap.deleteTexture(y.webGL_texture),y.webGL_texture=c.runtime.glwrap.loadTexture(u,
!1,c.runtime.linearSampling),c.curFrame===y&&(c.curWebGLTexture=y.webGL_texture),c.type.updateAllCurrentTexture()));0===g&&(c.width=u.width,c.height=u.height,c.set_bbox_changed());c.runtime.redraw=!0;c.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded,c)};"data:"!==F.substr(0,5)&&0===l&&(u.crossOrigin="anonymous");this.runtime.setImageSrc(u,F)};d.prototype.SetCollisions=function(F){this.collisionsEnabled!==(0!==F)&&((this.collisionsEnabled=0!==F)?this.set_bbox_changed():(this.collcells.right>=
this.collcells.left&&this.type.collision_grid.update(this,this.collcells,null),this.collcells.set(0,0,-1,-1)))};r.acts=new d;h.prototype.AnimationFrame=function(F){F.set_int(this.cur_frame)};h.prototype.AnimationFrameCount=function(F){F.set_int(this.cur_animation.frames.length)};h.prototype.AnimationName=function(F){F.set_string(this.cur_animation.name)};h.prototype.AnimationSpeed=function(F){F.set_float(this.animForwards?this.cur_anim_speed:-this.cur_anim_speed)};h.prototype.ImagePointX=function(F,
g){F.set_float(this.getImagePoint(g,!0))};h.prototype.ImagePointY=function(F,g){F.set_float(this.getImagePoint(g,!1))};h.prototype.ImagePointCount=function(F){F.set_int(this.curFrame.image_points.length)};h.prototype.ImageWidth=function(F){F.set_float(this.curFrame.width)};h.prototype.ImageHeight=function(F){F.set_float(this.curFrame.height)};r.exps=new h})();cr.plugins_.Arr=function(b){this.runtime=b};
(function(){function b(){return d.length?d.pop():[]}function f(h){var r;var w=0;for(r=h.length;w<r;w++)Array.isArray(h[w])&&f(h[w]);cr.clearArray(h);d.push(h)}function k(){}function q(){}function v(h,r){if(cr.is_number(h)&&cr.is_number(r))return h-r;h=""+h;r=""+r;return h<r?-1:h>r?1:0}function n(){}var e=cr.plugins_.Arr.prototype;e.Type=function(h){this.plugin=h;this.runtime=h.runtime};e.Type.prototype.onCreate=function(){};e.Instance=function(h){this.type=h;this.runtime=h.runtime};var a=e.Instance.prototype,
d=[];Array.isArray||(Array.isArray=function(h){return"[object Array]"===Object.prototype.toString.call(h)});a.onCreate=function(){this.cx=this.properties[0];this.cy=this.properties[1];this.cz=this.properties[2];this.recycled||(this.arr=b());var h=this.arr;h.length=this.cx;var r,w,E;for(r=0;r<this.cx;r++)for(h[r]||(h[r]=b()),h[r].length=this.cy,w=0;w<this.cy;w++)for(h[r][w]||(h[r][w]=b()),h[r][w].length=this.cz,E=0;E<this.cz;E++)h[r][w][E]=0;this.forX=[];this.forY=[];this.forZ=[];this.forDepth=-1};
a.onDestroy=function(){var h;for(h=0;h<this.cx;h++)f(this.arr[h]);cr.clearArray(this.arr)};a.at=function(h,r,w){h=Math.floor(h);r=Math.floor(r);w=Math.floor(w);return isNaN(h)||0>h||h>this.cx-1||isNaN(r)||0>r||r>this.cy-1||isNaN(w)||0>w||w>this.cz-1?0:this.arr[h][r][w]};a.set=function(h,r,w,E){h=Math.floor(h);r=Math.floor(r);w=Math.floor(w);isNaN(h)||0>h||h>this.cx-1||isNaN(r)||0>r||r>this.cy-1||isNaN(w)||0>w||w>this.cz-1||(this.arr[h][r][w]=E)};a.getAsJSON=function(){return JSON.stringify({c2array:!0,
size:[this.cx,this.cy,this.cz],data:this.arr})};a.saveToJSON=function(){return{size:[this.cx,this.cy,this.cz],data:this.arr}};a.loadFromJSON=function(h){var r=h.size;this.cx=r[0];this.cy=r[1];this.cz=r[2];this.arr=h.data};a.setSize=function(h,r,w){0>h&&(h=0);0>r&&(r=0);0>w&&(w=0);if(this.cx!==h||this.cy!==r||this.cz!==w){this.cx=h;this.cy=r;this.cz=w;var E,t,p=this.arr;p.length=h;for(h=0;h<this.cx;h++)for(cr.is_undefined(p[h])&&(p[h]=b()),p[h].length=r,E=0;E<this.cy;E++)for(cr.is_undefined(p[h][E])&&
(p[h][E]=b()),p[h][E].length=w,t=0;t<this.cz;t++)cr.is_undefined(p[h][E][t])&&(p[h][E][t]=0)}};a.getForX=function(){return 0<=this.forDepth&&this.forDepth<this.forX.length?this.forX[this.forDepth]:0};a.getForY=function(){return 0<=this.forDepth&&this.forDepth<this.forY.length?this.forY[this.forDepth]:0};a.getForZ=function(){return 0<=this.forDepth&&this.forDepth<this.forZ.length?this.forZ[this.forDepth]:0};k.prototype.CompareX=function(h,r,w){return cr.do_cmp(this.at(h,0,0),r,w)};k.prototype.CompareXY=
function(h,r,w,E){return cr.do_cmp(this.at(h,r,0),w,E)};k.prototype.CompareXYZ=function(h,r,w,E,t){return cr.do_cmp(this.at(h,r,w),E,t)};a.doForEachTrigger=function(h){this.runtime.pushCopySol(h.solModifiers);h.retrigger();this.runtime.popSol(h.solModifiers)};k.prototype.ArrForEach=function(h){var r=this.runtime.getCurrentEventStack().current_event;this.forDepth++;var w=this.forDepth;w===this.forX.length?(this.forX.push(0),this.forY.push(0),this.forZ.push(0)):(this.forX[w]=0,this.forY[w]=0,this.forZ[w]=
0);switch(h){case 0:for(this.forX[w]=0;this.forX[w]<this.cx;this.forX[w]++)for(this.forY[w]=0;this.forY[w]<this.cy;this.forY[w]++)for(this.forZ[w]=0;this.forZ[w]<this.cz;this.forZ[w]++)this.doForEachTrigger(r);break;case 1:for(this.forX[w]=0;this.forX[w]<this.cx;this.forX[w]++)for(this.forY[w]=0;this.forY[w]<this.cy;this.forY[w]++)this.doForEachTrigger(r);break;case 2:for(this.forX[w]=0;this.forX[w]<this.cx;this.forX[w]++)this.doForEachTrigger(r)}this.forDepth--;return!1};k.prototype.CompareCurrent=
function(h,r){return cr.do_cmp(this.at(this.getForX(),this.getForY(),this.getForZ()),h,r)};k.prototype.Contains=function(h){var r,w,E;for(r=0;r<this.cx;r++)for(w=0;w<this.cy;w++)for(E=0;E<this.cz;E++)if(this.arr[r][w][E]===h)return!0;return!1};k.prototype.IsEmpty=function(){return 0===this.cx||0===this.cy||0===this.cz};k.prototype.CompareSize=function(h,r,w){var E=0;switch(h){case 0:E=this.cx;break;case 1:E=this.cy;break;case 2:E=this.cz}return cr.do_cmp(E,r,w)};e.cnds=new k;q.prototype.Clear=function(h){var r,
w,E;for(r=0;r<this.cx;r++)for(w=0;w<this.cy;w++)for(E=0;E<this.cz;E++)this.arr[r][w][E]=h};q.prototype.SetSize=function(h,r,w){this.setSize(h,r,w)};q.prototype.SetX=function(h,r){this.set(h,0,0,r)};q.prototype.SetXY=function(h,r,w){this.set(h,r,0,w)};q.prototype.SetXYZ=function(h,r,w,E){this.set(h,r,w,E)};q.prototype.Push=function(h,r,w){var E=0,t=0,p=this.arr;switch(w){case 0:0===h?(E=p.length,p.push(b())):(E=0,p.unshift(b()));for(p[E].length=this.cy;t<this.cy;t++)for(p[E][t]=b(),p[E][t].length=
this.cz,w=0;w<this.cz;w++)p[E][t][w]=r;this.cx++;break;case 1:for(;E<this.cx;E++)for(0===h?(t=p[E].length,p[E].push(b())):(t=0,p[E].unshift(b())),p[E][t].length=this.cz,w=0;w<this.cz;w++)p[E][t][w]=r;this.cy++;break;case 2:for(;E<this.cx;E++)for(t=0;t<this.cy;t++)0===h?p[E][t].push(r):p[E][t].unshift(r);this.cz++}};q.prototype.Pop=function(h,r){var w=0,E=this.arr;switch(r){case 0:if(0===this.cx)break;0===h?f(E.pop()):f(E.shift());this.cx--;break;case 1:if(0===this.cy)break;for(;w<this.cx;w++)0===
h?f(E[w].pop()):f(E[w].shift());this.cy--;break;case 2:if(0!==this.cz){for(;w<this.cx;w++)for(r=0;r<this.cy;r++)0===h?E[w][r].pop():E[w][r].shift();this.cz--}}};q.prototype.Reverse=function(h){var r=0,w=this.arr;if(0!==this.cx&&0!==this.cy&&0!==this.cz)switch(h){case 0:w.reverse();break;case 1:for(;r<this.cx;r++)w[r].reverse();break;case 2:for(;r<this.cx;r++)for(h=0;h<this.cy;h++)w[r][h].reverse()}};q.prototype.Sort=function(h){var r=0,w=0,E=this.arr;if(0!==this.cx&&0!==this.cy&&0!==this.cz)switch(h){case 0:E.sort(function(t,
p){return v(t[0][0],p[0][0])});break;case 1:for(;r<this.cx;r++)E[r].sort(function(t,p){return v(t[0],p[0])});break;case 2:for(;r<this.cx;r++)for(w=0;w<this.cy;w++)E[r][w].sort(v)}};q.prototype.Delete=function(h,r){var w=0;h=Math.floor(h);var E=this.arr;if(!(0>h))switch(r){case 0:if(h>=this.cx)break;f(E[h]);E.splice(h,1);this.cx--;break;case 1:if(h>=this.cy)break;for(;w<this.cx;w++)f(E[w][h]),E[w].splice(h,1);this.cy--;break;case 2:if(!(h>=this.cz)){for(;w<this.cx;w++)for(r=0;r<this.cy;r++)E[w][r].splice(h,
1);this.cz--}}};q.prototype.Insert=function(h,r,w){var E=0,t=0;r=Math.floor(r);var p=this.arr;if(!(0>r))switch(w){case 0:if(r>this.cx)break;E=r;p.splice(E,0,b());for(p[E].length=this.cy;t<this.cy;t++)for(p[E][t]=b(),p[E][t].length=this.cz,w=0;w<this.cz;w++)p[E][t][w]=h;this.cx++;break;case 1:if(r>this.cy)break;for(;E<this.cx;E++)for(t=r,p[E].splice(t,0,b()),p[E][t].length=this.cz,w=0;w<this.cz;w++)p[E][t][w]=h;this.cy++;break;case 2:if(!(r>this.cz)){for(;E<this.cx;E++)for(t=0;t<this.cy;t++)p[E][t].splice(r,
0,h);this.cz++}}};q.prototype.JSONLoad=function(h){try{var r=JSON.parse(h)}catch(w){return}r.c2array&&(h=r.size,this.cx=h[0],this.cy=h[1],this.cz=h[2],this.arr=r.data)};q.prototype.JSONDownload=function(h){var r=document.createElement("a");if("undefined"===typeof r.download)h="data:text/html,"+encodeURIComponent("<p><a download='"+h+"' href=\"data:application/json,"+encodeURIComponent(this.getAsJSON())+'">Download link</a></p>'),window.open(h);else{var w=document.getElementsByTagName("body")[0];r.textContent=
h;r.href="data:application/json,"+encodeURIComponent(this.getAsJSON());r.download=h;w.appendChild(r);r.click();w.removeChild(r)}};e.acts=new q;n.prototype.At=function(h,r,w,E){h.set_any(this.at(r,w||0,E||0))};n.prototype.Width=function(h){h.set_int(this.cx)};n.prototype.Height=function(h){h.set_int(this.cy)};n.prototype.Depth=function(h){h.set_int(this.cz)};n.prototype.CurX=function(h){h.set_int(this.getForX())};n.prototype.CurY=function(h){h.set_int(this.getForY())};n.prototype.CurZ=function(h){h.set_int(this.getForZ())};
n.prototype.CurValue=function(h){h.set_any(this.at(this.getForX(),this.getForY(),this.getForZ()))};n.prototype.Front=function(h){h.set_any(this.at(0,0,0))};n.prototype.Back=function(h){h.set_any(this.at(this.cx-1,0,0))};n.prototype.IndexOf=function(h,r){for(var w=0;w<this.cx;w++)if(this.arr[w][0][0]===r){h.set_int(w);return}h.set_int(-1)};n.prototype.LastIndexOf=function(h,r){for(var w=this.cx-1;0<=w;w--)if(this.arr[w][0][0]===r){h.set_int(w);return}h.set_int(-1)};n.prototype.AsJSON=function(h){h.set_string(this.getAsJSON())};
e.exps=new n})();var localForageInitFailed=!1;
try{!function(b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define([],b):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).localforage=b()}(function(){return function v(f,k,q){function n(d,h){if(!k[d]){if(!f[d]){var r="function"==typeof require&&require;if(!h&&r)return r(d,!0);if(e)return e(d,!0);h=Error("Cannot find module '"+d+"'");throw h.code="MODULE_NOT_FOUND",h;}h=k[d]={exports:{}};
f[d][0].call(h.exports,function(w){var E=f[d][1][w];return n(E?E:w)},h,h.exports,v,f,k,q)}return k[d].exports}for(var e="function"==typeof require&&require,a=0;a<q.length;a++)n(q[a]);return n}({1:[function(f,k,q){function v(B,I){B=B||[];I=I||{};try{return new Blob(B,I)}catch(Z){if("TypeError"!==Z.name)throw Z;for(var M=new ("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),Q=0;Q<B.length;Q+=
1)M.append(B[Q]);return M.getBlob(I.type)}}function n(B,I){I&&B.then(function(M){I(null,M)},function(M){I(M)})}function e(B,I,M){"function"==typeof I&&B.then(I);"function"==typeof M&&B["catch"](M)}function a(B){return(new l(function(I){var M=B.transaction(u,"readwrite"),Q=v([""]);M.objectStore(u).put(Q,"key");M.onabort=function(Z){Z.preventDefault();Z.stopPropagation();I(!1)};M.oncomplete=function(){var Z=navigator.userAgent.match(/Chrome\/(\d+)/),W=navigator.userAgent.match(/Edge\//);I(W||!Z||43<=
parseInt(Z[1],10))}}))["catch"](function(){return!1})}function d(B){return"boolean"==typeof F?l.resolve(F):a(B).then(function(I){return F=I})}function h(B){B=g[B.name];var I={};I.promise=new l(function(M){I.resolve=M});B.deferredOperations.push(I);B.dbReady?B.dbReady=B.dbReady.then(function(){return I.promise}):B.dbReady=I.promise}function r(B,I){return new l(function(M,Q){if(B.db){if(!I)return M(B.db);h(B);B.db.close()}var Z=[B.name];I&&Z.push(B.version);var W=R.open.apply(R,Z);I&&(W.onupgradeneeded=
function(X){var ba=W.result;try{ba.createObjectStore(B.storeName),1>=X.oldVersion&&ba.createObjectStore(u)}catch(da){if("ConstraintError"!==da.name)throw da;console.warn('The database "'+B.name+'" has been upgraded from version '+X.oldVersion+" to version "+X.newVersion+', but the storage "'+B.storeName+'" already exists.')}});W.onerror=function(X){X.preventDefault();Q(W.error)};W.onsuccess=function(){M(W.result);var X=g[B.name].deferredOperations.pop();X&&X.resolve()}})}function w(B){return new l(function(I,
M){var Q=new FileReader;Q.onerror=M;Q.onloadend=function(Z){Z=btoa(Z.target.result||"");I({__local_forage_encoded_blob:!0,data:Z,type:B.type})};Q.readAsBinaryString(B)})}function E(B){for(var I=atob(B.data),M=I.length,Q=new ArrayBuffer(M),Z=new Uint8Array(Q),W=0;M>W;W++)Z[W]=I.charCodeAt(W);return v([Q],{type:B.type})}function t(B){var I=this,M=I._initReady().then(function(){var Q=g[I._dbInfo.name];return Q&&Q.dbReady?Q.dbReady:void 0});return e(M,B,B),M}function p(B){var I=.75*B.length;var M=B.length,
Q=0;"="===B[B.length-1]&&(I--,"="===B[B.length-2]&&I--);var Z=new ArrayBuffer(I),W=new Uint8Array(Z);for(I=0;M>I;I+=4){var X=H.indexOf(B[I]);var ba=H.indexOf(B[I+1]);var da=H.indexOf(B[I+2]);var ja=H.indexOf(B[I+3]);W[Q++]=X<<2|ba>>4;W[Q++]=(15&ba)<<4|da>>2;W[Q++]=(3&da)<<6|63&ja}return Z}function x(B){var I=new Uint8Array(B),M="";for(B=0;B<I.length;B+=3)M+=H[I[B]>>2],M+=H[(3&I[B])<<4|I[B+1]>>4],M+=H[(15&I[B+1])<<2|I[B+2]>>6],M+=H[63&I[B+2]];return 2===I.length%3?M=M.substring(0,M.length-1)+"=":1===
I.length%3&&(M=M.substring(0,M.length-2)+"=="),M}function C(B,I,M,Q){var Z=this;"string"!=typeof B&&(console.warn(B+" used as a key, but it is not a string."),B=String(B));var W=new l(function(X,ba){Z.ready().then(function(){void 0===I&&(I=null);var da=I,ja=Z._dbInfo;ja.serializer.serialize(I,function(la,na){na?ba(na):ja.db.transaction(function(sa){sa.executeSql("INSERT OR REPLACE INTO "+ja.storeName+" (key, value) VALUES (?, ?)",[B,la],function(){X(da)},function(wa,Ba){ba(Ba)})},function(sa){if(sa.code===
sa.QUOTA_ERR){if(0<Q)return void X(C.apply(Z,[B,da,M,Q-1]));ba(sa)}})})})["catch"](ba)});return n(W,M),W}function z(B,I){B[I]=function(){var M=arguments;return B.ready().then(function(){return B[I].apply(B,M)})}}function K(){for(var B=1;B<arguments.length;B++){var I=arguments[B];if(I)for(var M in I)I.hasOwnProperty(M)&&(G(I[M])?arguments[0][M]=I[M].slice():arguments[0][M]=I[M])}return arguments[0]}function S(B){for(var I in fa)if(fa.hasOwnProperty(I)&&fa[I]===B)return!0;return!1}var L="function"==
typeof Symbol&&"symbol"==typeof Symbol.iterator?function(B){return typeof B}:function(B){return B&&"function"==typeof Symbol&&B.constructor===Symbol?"symbol":typeof B},R=function(){if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}();"undefined"==typeof Promise&&f("lie/polyfill");
var F,g,l=Promise,u="local-forage-detect-blob-support",c=Object.prototype.toString,y={_driver:"asyncStorage",_initStorage:function(B){function I(){return l.resolve()}var M=this,Q={db:null};if(B)for(var Z in B)Q[Z]=B[Z];g||(g={});var W=g[Q.name];W||(W={forages:[],db:null,dbReady:null,deferredOperations:[]},g[Q.name]=W);W.forages.push(M);M._initReady||(M._initReady=M.ready,M.ready=t);B=[];for(Z=0;Z<W.forages.length;Z++){var X=W.forages[Z];X!==M&&B.push(X._initReady()["catch"](I))}var ba=W.forages.slice(0);
return l.all(B).then(function(){return Q.db=W.db,r(Q,!1)}).then(function(da){Q.db=da;var ja=M._defaultConfig.version;if(Q.db){var la=!Q.db.objectStoreNames.contains(Q.storeName),na=Q.version>Q.db.version;(Q.version<Q.db.version&&(Q.version!==ja&&console.warn('The database "'+Q.name+"\" can't be downgraded from version "+Q.db.version+" to version "+Q.version+"."),Q.version=Q.db.version),na||la)?(la&&(ja=Q.db.version+1,ja>Q.version&&(Q.version=ja)),ja=!0):ja=!1}else ja=!0;return ja?r(Q,!0):da}).then(function(da){Q.db=
W.db=da;M._dbInfo=Q;for(da=0;da<ba.length;da++){var ja=ba[da];ja!==M&&(ja._dbInfo.db=Q.db,ja._dbInfo.version=Q.version)}})},iterate:function(B,I){var M=this,Q=new l(function(Z,W){M.ready().then(function(){var X=M._dbInfo,ba=X.db.transaction(X.storeName,"readonly").objectStore(X.storeName).openCursor(),da=1;ba.onsuccess=function(){var ja=ba.result;if(ja){var la=ja.value;la&&la.__local_forage_encoded_blob&&(la=E(la));la=B(la,ja.key,da++);void 0!==la?Z(la):ja["continue"]()}else Z()};ba.onerror=function(){W(ba.error)}})["catch"](W)});
return n(Q,I),Q},getItem:function(B,I){var M=this;"string"!=typeof B&&(console.warn(B+" used as a key, but it is not a string."),B=String(B));var Q=new l(function(Z,W){M.ready().then(function(){var X=M._dbInfo,ba=X.db.transaction(X.storeName,"readonly").objectStore(X.storeName).get(B);ba.onsuccess=function(){var da=ba.result;void 0===da&&(da=null);da&&da.__local_forage_encoded_blob&&(da=E(da));Z(da)};ba.onerror=function(){W(ba.error)}})["catch"](W)});return n(Q,I),Q},setItem:function(B,I,M){var Q=
this;"string"!=typeof B&&(console.warn(B+" used as a key, but it is not a string."),B=String(B));var Z=new l(function(W,X){var ba;Q.ready().then(function(){return ba=Q._dbInfo,"[object Blob]"===c.call(I)?d(ba.db).then(function(da){return da?I:w(I)}):I}).then(function(da){var ja=ba.db.transaction(ba.storeName,"readwrite"),la=ja.objectStore(ba.storeName).put(da,B);null===da&&(da=void 0);ja.oncomplete=function(){void 0===da&&(da=null);W(da)};ja.onabort=ja.onerror=function(){X(la.error?la.error:la.transaction.error)}})["catch"](X)});
return n(Z,M),Z},removeItem:function(B,I){var M=this;"string"!=typeof B&&(console.warn(B+" used as a key, but it is not a string."),B=String(B));var Q=new l(function(Z,W){M.ready().then(function(){var X=M._dbInfo,ba=X.db.transaction(X.storeName,"readwrite"),da=ba.objectStore(X.storeName)["delete"](B);ba.oncomplete=function(){Z()};ba.onerror=function(){W(da.error)};ba.onabort=function(){W(da.error?da.error:da.transaction.error)}})["catch"](W)});return n(Q,I),Q},clear:function(B){var I=this,M=new l(function(Q,
Z){I.ready().then(function(){var W=I._dbInfo,X=W.db.transaction(W.storeName,"readwrite"),ba=X.objectStore(W.storeName).clear();X.oncomplete=function(){Q()};X.onabort=X.onerror=function(){Z(ba.error?ba.error:ba.transaction.error)}})["catch"](Z)});return n(M,B),M},length:function(B){var I=this,M=new l(function(Q,Z){I.ready().then(function(){var W=I._dbInfo,X=W.db.transaction(W.storeName,"readonly").objectStore(W.storeName).count();X.onsuccess=function(){Q(X.result)};X.onerror=function(){Z(X.error)}})["catch"](Z)});
return n(M,B),M},key:function(B,I){var M=this,Q=new l(function(Z,W){return 0>B?void Z(null):void M.ready().then(function(){var X=M._dbInfo,ba=!1,da=X.db.transaction(X.storeName,"readonly").objectStore(X.storeName).openCursor();da.onsuccess=function(){var ja=da.result;return ja?void(0===B?Z(ja.key):ba?Z(ja.key):(ba=!0,ja.advance(B))):void Z(null)};da.onerror=function(){W(da.error)}})["catch"](W)});return n(Q,I),Q},keys:function(B){var I=this,M=new l(function(Q,Z){I.ready().then(function(){var W=I._dbInfo,
X=W.db.transaction(W.storeName,"readonly").objectStore(W.storeName).openCursor(),ba=[];X.onsuccess=function(){var da=X.result;return da?(ba.push(da.key),void da["continue"]()):void Q(ba)};X.onerror=function(){Z(X.error)}})["catch"](Z)});return n(M,B),M}},H="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",O=/^~~local_forage_type~([^~]+)~/,U=Object.prototype.toString,Y={serialize:function(B,I){var M="";if(B&&(M=U.call(B)),B&&("[object ArrayBuffer]"===M||B.buffer&&"[object ArrayBuffer]"===
U.call(B.buffer))){var Q,Z="__lfsc__:";B instanceof ArrayBuffer?(Q=B,Z+="arbf"):(Q=B.buffer,"[object Int8Array]"===M?Z+="si08":"[object Uint8Array]"===M?Z+="ui08":"[object Uint8ClampedArray]"===M?Z+="uic8":"[object Int16Array]"===M?Z+="si16":"[object Uint16Array]"===M?Z+="ur16":"[object Int32Array]"===M?Z+="si32":"[object Uint32Array]"===M?Z+="ui32":"[object Float32Array]"===M?Z+="fl32":"[object Float64Array]"===M?Z+="fl64":I(Error("Failed to get type for BinaryArray")));I(Z+x(Q))}else if("[object Blob]"===
M)M=new FileReader,M.onload=function(){var W="~~local_forage_type~"+B.type+"~"+x(this.result);I("__lfsc__:blob"+W)},M.readAsArrayBuffer(B);else try{I(JSON.stringify(B))}catch(W){console.error("Couldn't convert value into a JSON string: ",B),I(null,W)}},deserialize:function(B){if("__lfsc__:"!==B.substring(0,9))return JSON.parse(B);var I=B.substring(13);B=B.substring(9,13);if("blob"===B&&O.test(I)){var M=I.match(O);var Q=M[1];I=I.substring(M[0].length)}I=p(I);switch(B){case "arbf":return I;case "blob":return v([I],
{type:Q});case "si08":return new Int8Array(I);case "ui08":return new Uint8Array(I);case "uic8":return new Uint8ClampedArray(I);case "si16":return new Int16Array(I);case "ur16":return new Uint16Array(I);case "si32":return new Int32Array(I);case "ui32":return new Uint32Array(I);case "fl32":return new Float32Array(I);case "fl64":return new Float64Array(I);default:throw Error("Unkown type: "+B);}},stringToBuffer:p,bufferToString:x},aa={_driver:"webSQLStorage",_initStorage:function(B){var I=this,M={db:null};
if(B)for(var Q in B)M[Q]="string"!=typeof B[Q]?B[Q].toString():B[Q];B=new l(function(Z,W){try{M.db=openDatabase(M.name,String(M.version),M.description,M.size)}catch(X){return W(X)}M.db.transaction(function(X){X.executeSql("CREATE TABLE IF NOT EXISTS "+M.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){I._dbInfo=M;Z()},function(ba,da){W(da)})})});return M.serializer=Y,B},iterate:function(B,I){var M=this,Q=new l(function(Z,W){M.ready().then(function(){var X=M._dbInfo;X.db.transaction(function(ba){ba.executeSql("SELECT * FROM "+
X.storeName,[],function(da,ja){da=ja.rows;ja=da.length;for(var la=0;ja>la;la++){var na=da.item(la),sa=na.value;if(sa&&(sa=X.serializer.deserialize(sa)),sa=B(sa,na.key,la+1),void 0!==sa)return void Z(sa)}Z()},function(da,ja){W(ja)})})})["catch"](W)});return n(Q,I),Q},getItem:function(B,I){var M=this;"string"!=typeof B&&(console.warn(B+" used as a key, but it is not a string."),B=String(B));var Q=new l(function(Z,W){M.ready().then(function(){var X=M._dbInfo;X.db.transaction(function(ba){ba.executeSql("SELECT * FROM "+
X.storeName+" WHERE key = ? LIMIT 1",[B],function(da,ja){(da=ja.rows.length?ja.rows.item(0).value:null)&&(da=X.serializer.deserialize(da));Z(da)},function(da,ja){W(ja)})})})["catch"](W)});return n(Q,I),Q},setItem:function(B,I,M){return C.apply(this,[B,I,M,1])},removeItem:function(B,I){var M=this;"string"!=typeof B&&(console.warn(B+" used as a key, but it is not a string."),B=String(B));var Q=new l(function(Z,W){M.ready().then(function(){var X=M._dbInfo;X.db.transaction(function(ba){ba.executeSql("DELETE FROM "+
X.storeName+" WHERE key = ?",[B],function(){Z()},function(da,ja){W(ja)})})})["catch"](W)});return n(Q,I),Q},clear:function(B){var I=this,M=new l(function(Q,Z){I.ready().then(function(){var W=I._dbInfo;W.db.transaction(function(X){X.executeSql("DELETE FROM "+W.storeName,[],function(){Q()},function(ba,da){Z(da)})})})["catch"](Z)});return n(M,B),M},length:function(B){var I=this,M=new l(function(Q,Z){I.ready().then(function(){var W=I._dbInfo;W.db.transaction(function(X){X.executeSql("SELECT COUNT(key) as c FROM "+
W.storeName,[],function(ba,da){ba=da.rows.item(0).c;Q(ba)},function(ba,da){Z(da)})})})["catch"](Z)});return n(M,B),M},key:function(B,I){var M=this,Q=new l(function(Z,W){M.ready().then(function(){var X=M._dbInfo;X.db.transaction(function(ba){ba.executeSql("SELECT key FROM "+X.storeName+" WHERE id = ? LIMIT 1",[B+1],function(da,ja){da=ja.rows.length?ja.rows.item(0).key:null;Z(da)},function(da,ja){W(ja)})})})["catch"](W)});return n(Q,I),Q},keys:function(B){var I=this,M=new l(function(Q,Z){I.ready().then(function(){var W=
I._dbInfo;W.db.transaction(function(X){X.executeSql("SELECT key FROM "+W.storeName,[],function(ba,da){ba=[];for(var ja=0;ja<da.rows.length;ja++)ba.push(da.rows.item(ja).key);Q(ba)},function(ba,da){Z(da)})})})["catch"](Z)});return n(M,B),M}},ca={_driver:"localStorageWrapper",_initStorage:function(B){var I={};if(B)for(var M in B)I[M]=B[M];return I.keyPrefix=I.name+"/",I.storeName!==this._defaultConfig.storeName&&(I.keyPrefix+=I.storeName+"/"),this._dbInfo=I,I.serializer=Y,l.resolve()},iterate:function(B,
I){var M=this,Q=M.ready().then(function(){for(var Z=M._dbInfo,W=Z.keyPrefix,X=W.length,ba=localStorage.length,da=1,ja=0;ba>ja;ja++){var la=localStorage.key(ja);if(0===la.indexOf(W)){var na=localStorage.getItem(la);if(na&&(na=Z.serializer.deserialize(na)),na=B(na,la.substring(X),da++),void 0!==na)return na}}});return n(Q,I),Q},getItem:function(B,I){var M=this;"string"!=typeof B&&(console.warn(B+" used as a key, but it is not a string."),B=String(B));var Q=M.ready().then(function(){var Z=M._dbInfo,
W=localStorage.getItem(Z.keyPrefix+B);return W&&(W=Z.serializer.deserialize(W)),W});return n(Q,I),Q},setItem:function(B,I,M){var Q=this;"string"!=typeof B&&(console.warn(B+" used as a key, but it is not a string."),B=String(B));var Z=Q.ready().then(function(){void 0===I&&(I=null);var W=I;return new l(function(X,ba){var da=Q._dbInfo;da.serializer.serialize(I,function(ja,la){if(la)ba(la);else try{localStorage.setItem(da.keyPrefix+B,ja),X(W)}catch(na){"QuotaExceededError"!==na.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==
na.name||ba(na),ba(na)}})})});return n(Z,M),Z},removeItem:function(B,I){var M=this;"string"!=typeof B&&(console.warn(B+" used as a key, but it is not a string."),B=String(B));var Q=M.ready().then(function(){localStorage.removeItem(M._dbInfo.keyPrefix+B)});return n(Q,I),Q},clear:function(B){var I=this,M=I.ready().then(function(){for(var Q=I._dbInfo.keyPrefix,Z=localStorage.length-1;0<=Z;Z--){var W=localStorage.key(Z);0===W.indexOf(Q)&&localStorage.removeItem(W)}});return n(M,B),M},length:function(B){var I=
this.keys().then(function(M){return M.length});return n(I,B),I},key:function(B,I){var M=this,Q=M.ready().then(function(){var Z=M._dbInfo;try{var W=localStorage.key(B)}catch(X){W=null}return W&&(W=W.substring(Z.keyPrefix.length)),W});return n(Q,I),Q},keys:function(B){var I=this,M=I.ready().then(function(){for(var Q=I._dbInfo,Z=localStorage.length,W=[],X=0;Z>X;X++)0===localStorage.key(X).indexOf(Q.keyPrefix)&&W.push(localStorage.key(X).substring(Q.keyPrefix.length));return W});return n(M,B),M}},ha=
{},fa={INDEXEDDB:"asyncStorage",LOCALSTORAGE:"localStorageWrapper",WEBSQL:"webSQLStorage"},m="clear getItem iterate key keys length removeItem setItem".split(" "),A={description:"",driver:[fa.INDEXEDDB,fa.WEBSQL,fa.LOCALSTORAGE].slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},J={};J[fa.INDEXEDDB]=function(){try{if(!R)return!1;var B="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),
I="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!B||I)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(M){return!1}}();J[fa.WEBSQL]="function"==typeof openDatabase;f=fa.LOCALSTORAGE;try{var N="undefined"!=typeof localStorage&&"setItem"in localStorage&&localStorage.setItem}catch(B){N=!1}J[f]=N;var G=Array.isArray||function(B){return"[object Array]"===Object.prototype.toString.call(B)};N=new (function(){function B(I){if(!(this instanceof B))throw new TypeError("Cannot call a class as a function");
this.INDEXEDDB=fa.INDEXEDDB;this.LOCALSTORAGE=fa.LOCALSTORAGE;this.WEBSQL=fa.WEBSQL;this._defaultConfig=K({},A);this._config=K({},this._defaultConfig,I);this._initDriver=this._driverSet=null;this._ready=!1;this._dbInfo=null;this._wrapLibraryMethodsWithReady();this.setDriver(this._config.driver)["catch"](function(){})}return B.prototype.config=function(I){if("object"===("undefined"==typeof I?"undefined":L(I))){if(this._ready)return Error("Can't call config() after localforage has been used.");for(var M in I){if("storeName"===
M&&(I[M]=I[M].replace(/\W/g,"_")),"version"===M&&"number"!=typeof I[M])return Error("Database version must be a number.");this._config[M]=I[M]}return"driver"in I&&I.driver?this.setDriver(this._config.driver):!0}return"string"==typeof I?this._config[I]:this._config},B.prototype.defineDriver=function(I,M,Q){var Z=new l(function(W,X){try{var ba=I._driver,da=Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver"),ja=Error("Custom driver name already in use: "+I._driver);
if(!I._driver)return void X(da);if(S(I._driver))return void X(ja);var la=m.concat("_initStorage");for(ja=0;ja<la.length;ja++){var na=la[ja];if(!na||!I[na]||"function"!=typeof I[na])return void X(da)}var sa=l.resolve(!0);"_support"in I&&(sa=I._support&&"function"==typeof I._support?I._support():l.resolve(!!I._support));sa.then(function(wa){J[ba]=wa;ha[ba]=I;W()},X)}catch(wa){X(wa)}});return e(Z,M,Q),Z},B.prototype.driver=function(){return this._driver||null},B.prototype.getDriver=function(I,M,Q){var Z=
this,W=l.resolve().then(function(){if(!S(I)){if(ha[I])return ha[I];throw Error("Driver not found.");}switch(I){case Z.INDEXEDDB:return y;case Z.LOCALSTORAGE:return ca;case Z.WEBSQL:return aa}});return e(W,M,Q),W},B.prototype.getSerializer=function(I){var M=l.resolve(Y);return e(M,I),M},B.prototype.ready=function(I){var M=this,Q=M._driverSet.then(function(){return null===M._ready&&(M._ready=M._initDriver()),M._ready});return e(Q,I,I),Q},B.prototype.setDriver=function(I,M,Q){function Z(){ba._config.driver=
ba.driver()}function W(ja){return ba._extend(ja),Z(),ba._ready=ba._initStorage(ba._config),ba._ready}function X(ja){return function(){function la(){for(;na<ja.length;){var sa=ja[na];return na++,ba._dbInfo=null,ba._ready=null,ba.getDriver(sa).then(W)["catch"](la)}Z();return ba._driverSet=l.reject(Error("No available storage method found.")),ba._driverSet}var na=0;return la()}}var ba=this;G(I)||(I=[I]);var da=this._getSupportedDrivers(I);return this._driverSet=(null!==this._driverSet?this._driverSet["catch"](function(){return l.resolve()}):
l.resolve()).then(function(){var ja=da[0];return ba._dbInfo=null,ba._ready=null,ba.getDriver(ja).then(function(la){ba._driver=la._driver;Z();ba._wrapLibraryMethodsWithReady();ba._initDriver=X(da)})})["catch"](function(){Z();return ba._driverSet=l.reject(Error("No available storage method found.")),ba._driverSet}),e(this._driverSet,M,Q),this._driverSet},B.prototype.supports=function(I){return!!J[I]},B.prototype._extend=function(I){K(this,I)},B.prototype._getSupportedDrivers=function(I){for(var M=[],
Q=0,Z=I.length;Z>Q;Q++){var W=I[Q];this.supports(W)&&M.push(W)}return M},B.prototype._wrapLibraryMethodsWithReady=function(){for(var I=0;I<m.length;I++)z(this,m[I])},B.prototype.createInstance=function(I){return new B(I)},B}());k.exports=N},{undefined:void 0}]},{},[1])(1)})}catch(b){localForageInitFailed=!0}cr.plugins_.LocalStorage=function(b){this.runtime=b};
(function(){function b(p){return p?"string"===typeof p?p:"string"===typeof p.message?p.message:"string"===typeof p.name?p.name:"string"===typeof p.data?p.data:"unknown error":"unknown error"}function f(p,x){h=x;p.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,p)}function k(p){if(!r)return p;if(r?p.substr(0,r.length)===r:1)return p.substr(r.length)}function q(){}function v(){}function n(){}var e="",a="",d=[],h="",r="",w="undefined"!==typeof window.is_scirra_arcade;w&&(r="sa"+window.scirra_arcade_id+
"_");var E=cr.plugins_.LocalStorage.prototype;E.Type=function(p){this.plugin=p;this.runtime=p.runtime};E.Type.prototype.onCreate=function(){};E.Instance=function(p){this.type=p;this.runtime=p.runtime};var t=E.Instance.prototype;t.onCreate=function(){this.pendingGets=this.pendingSets=0};t.onDestroy=function(){};t.saveToJSON=function(){return{}};t.loadFromJSON=function(p){};q.prototype.OnItemSet=function(p){return e===p};q.prototype.OnAnyItemSet=function(){return!0};q.prototype.OnItemGet=function(p){return e===
p};q.prototype.OnAnyItemGet=function(){return!0};q.prototype.OnItemRemoved=function(p){return e===p};q.prototype.OnAnyItemRemoved=function(){return!0};q.prototype.OnCleared=function(){return!0};q.prototype.OnAllKeyNamesLoaded=function(){return!0};q.prototype.OnError=function(){return!0};q.prototype.OnItemExists=function(p){return e===p};q.prototype.OnItemMissing=function(p){return e===p};q.prototype.CompareKey=function(p,x){return cr.do_cmp(e,p,x)};q.prototype.CompareValue=function(p,x){return cr.do_cmp(a,
p,x)};q.prototype.IsProcessingSets=function(){return 0<this.pendingSets};q.prototype.IsProcessingGets=function(){return 0<this.pendingGets};q.prototype.OnAllSetsComplete=function(){return!0};q.prototype.OnAllGetsComplete=function(){return!0};E.cnds=new q;v.prototype.SetItem=function(p,x){if(localForageInitFailed)f(this,"storage failed to initialise - may be disabled in browser settings");else{var C=r+p;this.pendingSets++;var z=this;localforage.setItem(C,x,function(K,S){z.pendingSets--;K?(h=b(K),z.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,
z)):(e=p,a=S,z.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAnyItemSet,z),z.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemSet,z),a=e="");0===z.pendingSets&&z.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAllSetsComplete,z)})}};v.prototype.GetItem=function(p){if(localForageInitFailed)f(this,"storage failed to initialise - may be disabled in browser settings");else{var x=r+p;this.pendingGets++;var C=this;localforage.getItem(x,function(z,K){C.pendingGets--;if(z)h=
b(z),C.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,C);else{e=p;a=K;if("undefined"===typeof a||null===a)a="";C.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAnyItemGet,C);C.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemGet,C);a=e=""}0===C.pendingGets&&C.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAllGetsComplete,C)})}};v.prototype.CheckItemExists=function(p){if(localForageInitFailed)f(this,"storage failed to initialise - may be disabled in browser settings");
else{var x=this;localforage.getItem(r+p,function(C,z){C?(h=b(C),x.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,x)):(e=p,null===z?(a="",x.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemMissing,x)):(a=z,x.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemExists,x)),a=e="")})}};v.prototype.RemoveItem=function(p){if(localForageInitFailed)f(this,"storage failed to initialise - may be disabled in browser settings");else{var x=this;localforage.removeItem(r+p,
function(C){C?(h=b(C),x.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,x)):(e=p,a="",x.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAnyItemRemoved,x),x.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemRemoved,x),e="")})}};v.prototype.ClearStorage=function(){if(localForageInitFailed)f(this,"storage failed to initialise - may be disabled in browser settings");else if(!w){var p=this;localforage.clear(function(x){x?(h=b(x),p.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,
p)):(a=e="",cr.clearArray(d),p.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnCleared,p))})}};v.prototype.GetAllKeyNames=function(){if(localForageInitFailed)f(this,"storage failed to initialise - may be disabled in browser settings");else{var p=this;localforage.keys(function(x,C){var z;if(x)h=b(x),p.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,p);else{cr.clearArray(d);x=0;for(z=C.length;x<z;++x){var K=C[x];(r?K.substr(0,r.length)===r:1)&&d.push(k(K))}p.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAllKeyNamesLoaded,
p)}})}};E.acts=new v;n.prototype.ItemValue=function(p){p.set_any(a)};n.prototype.Key=function(p){p.set_string(e)};n.prototype.KeyCount=function(p){p.set_int(d.length)};n.prototype.KeyAt=function(p,x){x=Math.floor(x);0>x||x>=d.length?p.set_string(""):p.set_string(d[x])};n.prototype.ErrorMessage=function(p){p.set_string(h)};E.exps=new n})();cr.plugins_.Browser=function(b){this.runtime=b};
(function(){function b(){d&&h&&window.OfflineClientInfo&&window.OfflineClientInfo.SetMessageCallback(function(C){r.onSWMessage(C)})}function f(){if(!E&&navigator.getBattery){var C=navigator.getBattery();E=!0;C&&C.then(function(z){w=z})}}function k(){}function q(){}function v(C){console&&console.warn&&console.warn("Fullscreen request failed: ",C);p.setSize(window.innerWidth,window.innerHeight)}function n(){}var e=cr.plugins_.Browser.prototype;e.Type=function(C){this.plugin=C;this.runtime=C.runtime};
var a=e.Type.prototype;a.onCreate=function(){};var d=!1,h=!1;document.addEventListener("DOMContentLoaded",function(){if(window.C3_RegisterSW&&navigator.serviceWorker){var C=document.createElement("script");C.onload=function(){d=!0;b()};C.src="offlineclient.js";document.head.appendChild(C)}});var r=null;a.onAppBegin=function(){h=!0;b()};e.Instance=function(C){this.type=C;this.runtime=C.runtime};a=e.Instance.prototype;a.onCreate=function(){var C=this;window.addEventListener("resize",function(){C.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnResize,
C)});r=this;"undefined"!==typeof navigator.onLine&&(window.addEventListener("online",function(){C.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOnline,C)}),window.addEventListener("offline",function(){C.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOffline,C)}));document.addEventListener("backbutton",function(){C.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,C)});document.addEventListener("menubutton",function(){C.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,
C)});document.addEventListener("searchbutton",function(){C.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnSearchButton,C)});document.addEventListener("tizenhwkey",function(z){switch(z.keyName){case "back":var K=C.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,C);!K&&window.tizen&&window.tizen.application.getCurrentApplication().exit();break;case "menu":(K=C.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,C))||z.preventDefault()}});this.runtime.isWindows10&&"undefined"!==
typeof Windows?Windows.UI.Core.SystemNavigationManager.getForCurrentView().addEventListener("backrequested",function(z){C.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,C)&&(z.handled=!0)}):this.runtime.isWinJS&&WinJS.Application&&(WinJS.Application.onbackclick=function(z){return!!C.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,C)});this.runtime.addSuspendCallback(function(z){z?C.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageHidden,C):C.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageVisible,
C)});this.is_arcade="undefined"!==typeof window.is_scirra_arcade};a.onSWMessage=function(C){C=C.data.type;"downloading-update"===C?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateFound,this):"update-ready"===C||"update-pending"===C?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,this):"offline-ready"===C&&this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOfflineReady,this)};var w=null,E=!1;k.prototype.CookiesEnabled=function(){return navigator?navigator.cookieEnabled:
!1};k.prototype.IsOnline=function(){return navigator?navigator.onLine:!1};k.prototype.HasJava=function(){return navigator?navigator.javaEnabled():!1};k.prototype.OnOnline=function(){return!0};k.prototype.OnOffline=function(){return!0};k.prototype.IsDownloadingUpdate=function(){return!1};k.prototype.PageVisible=function(){return!this.runtime.isSuspended};k.prototype.OnPageVisible=function(){return!0};k.prototype.OnPageHidden=function(){return!0};k.prototype.OnResize=function(){return!0};k.prototype.IsFullscreen=
function(){return!!(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen)};k.prototype.OnBackButton=function(){return!0};k.prototype.OnMenuButton=function(){return!0};k.prototype.OnSearchButton=function(){return!0};k.prototype.IsMetered=function(){var C=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return C?!!C.metered:!1};k.prototype.IsCharging=function(){var C=navigator.battery||navigator.mozBattery||navigator.webkitBattery;if(C)return!!C.charging;
f();return w?!!w.charging:!0};k.prototype.IsPortraitLandscape=function(C){return(window.innerWidth<=window.innerHeight?0:1)===C};k.prototype.SupportsFullscreen=function(){if(this.runtime.isNWjs)return!0;var C=this.runtime.canvas;return!!(C.requestFullscreen||C.mozRequestFullScreen||C.msRequestFullscreen||C.webkitRequestFullScreen)};k.prototype.OnUpdateFound=function(){return!0};k.prototype.OnUpdateReady=function(){return!0};k.prototype.OnOfflineReady=function(){return!0};e.cnds=new k;q.prototype.Alert=
function(C){alert(C.toString())};q.prototype.Close=function(){window.tizen?window.tizen.application.getCurrentApplication().exit():navigator.app&&navigator.app.exitApp?navigator.app.exitApp():navigator.device&&navigator.device.exitApp?navigator.device.exitApp():this.is_arcade||window.close()};q.prototype.Focus=function(){this.runtime.isNWjs?nw.Window.get().focus():this.is_arcade||window.focus()};q.prototype.Blur=function(){this.runtime.isNWjs?nw.Window.get().blur():this.is_arcade||window.blur()};
q.prototype.GoBack=function(){navigator.app&&navigator.app.backHistory?navigator.app.backHistory():!this.is_arcade&&window.back&&window.back()};q.prototype.GoForward=function(){!this.is_arcade&&window.forward&&window.forward()};q.prototype.GoHome=function(){!this.is_arcade&&window.home&&window.home()};q.prototype.GoToURL=function(C,z){this.runtime.isWinJS?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(C)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(C,{openExternal:!0}):
this.runtime.isCordova?window.open(C,"_system"):this.runtime.isPreview?window.open(C,"_blank"):this.is_arcade||(2!==z||this.is_arcade?1!==z||this.is_arcade?window.location=C:window.parent.location=C:window.top.location=C)};q.prototype.GoToURLWindow=function(C,z){this.runtime.isWinJS?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(C)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(C,{openExternal:!0}):this.runtime.isCordova?window.open(C,"_system"):this.is_arcade||window.open(C,
z)};q.prototype.Reload=function(){this.is_arcade||window.location.reload()};var t=!0,p=null;q.prototype.RequestFullScreen=function(C,z){2<=C&&(C+=1);6===C&&(C=2);document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement||document.fullScreen||document.fullScreenElement||(this.runtime.fullscreen_scaling=2<=C?C:0,C={navigationUI:"auto"},1===z?C.navigationUI="hide":2===z&&(C.navigationUI="show"),z=document.documentElement,t&&(t=!1,p=this.runtime,z.addEventListener("mozfullscreenerror",
v),z.addEventListener("webkitfullscreenerror",v),z.addEventListener("MSFullscreenError",v),z.addEventListener("fullscreenerror",v)),z.requestFullscreen?z.requestFullscreen(C):z.mozRequestFullScreen?z.mozRequestFullScreen(C):z.msRequestFullscreen?z.msRequestFullscreen(C):z.webkitRequestFullScreen&&("undefined"!==typeof Element&&"undefined"!==typeof Element.ALLOW_KEYBOARD_INPUT?z.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):z.webkitRequestFullScreen()))};q.prototype.CancelFullScreen=function(){document.exitFullscreen?
document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()};q.prototype.Vibrate=function(C){try{var z=C.split(","),K;var S=0;for(K=z.length;S<K;S++)z[S]=parseInt(z[S],10);navigator.vibrate?navigator.vibrate(z):navigator.mozVibrate?navigator.mozVibrate(z):navigator.webkitVibrate?navigator.webkitVibrate(z):navigator.msVibrate&&navigator.msVibrate(z)}catch(L){}};
q.prototype.InvokeDownload=function(C,z){if(z){var K=document.createElement("a");if("undefined"===typeof K.download)window.open(C);else{var S=document.getElementsByTagName("body")[0];K.textContent=z;K.href=C;K.download=z;S.appendChild(K);C=new MouseEvent("click");K.dispatchEvent(C);S.removeChild(K)}}};q.prototype.InvokeDownloadString=function(C,z,K){if(K){var S="data:"+z+","+encodeURIComponent(C);C=document.createElement("a");"undefined"===typeof C.download?window.open(S):(z=document.getElementsByTagName("body")[0],
C.textContent=K,C.href=S,C.download=K,z.appendChild(C),K=new MouseEvent("click"),C.dispatchEvent(K),z.removeChild(C))}};q.prototype.ConsoleLog=function(C,z){"undefined"!==typeof console&&(0===C&&console.log&&console.log(z.toString()),1===C&&console.warn&&console.warn(z.toString()),2===C&&console.error&&console.error(z.toString()))};q.prototype.ConsoleGroup=function(C){console&&console.group&&console.group(C)};q.prototype.ConsoleGroupEnd=function(){console&&console.groupEnd&&console.groupEnd()};q.prototype.ExecJs=
function(C){try{eval&&eval(C)}catch(z){console&&console.error&&console.error("Error executing Javascript: ",z)}};var x="portrait landscape portrait-primary portrait-secondary landscape-primary landscape-secondary".split(" ");q.prototype.LockOrientation=function(C){C=Math.floor(C);0>C||C>=x.length||(this.runtime.autoLockOrientation=!1,C=x[C],screen.orientation&&screen.orientation.lock?screen.orientation.lock(C):screen.lockOrientation?screen.lockOrientation(C):screen.webkitLockOrientation?screen.webkitLockOrientation(C):
screen.mozLockOrientation?screen.mozLockOrientation(C):screen.msLockOrientation&&screen.msLockOrientation(C))};q.prototype.UnlockOrientation=function(){this.runtime.autoLockOrientation=!1;screen.orientation&&screen.orientation.unlock?screen.orientation.unlock():screen.unlockOrientation?screen.unlockOrientation():screen.webkitUnlockOrientation?screen.webkitUnlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():screen.msUnlockOrientation&&screen.msUnlockOrientation()};e.acts=
new q;n.prototype.URL=function(C){C.set_string(window.location.toString())};n.prototype.Protocol=function(C){C.set_string(window.location.protocol)};n.prototype.Domain=function(C){C.set_string(window.location.hostname)};n.prototype.PathName=function(C){C.set_string(window.location.pathname)};n.prototype.Hash=function(C){C.set_string(window.location.hash)};n.prototype.Referrer=function(C){C.set_string(document.referrer)};n.prototype.Title=function(C){C.set_string(document.title)};n.prototype.Name=
function(C){C.set_string(navigator.appName)};n.prototype.Version=function(C){C.set_string(navigator.appVersion)};n.prototype.Language=function(C){navigator&&navigator.language?C.set_string(navigator.language):C.set_string("")};n.prototype.Platform=function(C){C.set_string(navigator.platform)};n.prototype.Product=function(C){navigator&&navigator.product?C.set_string(navigator.product):C.set_string("")};n.prototype.Vendor=function(C){navigator&&navigator.vendor?C.set_string(navigator.vendor):C.set_string("")};
n.prototype.UserAgent=function(C){C.set_string(navigator.userAgent)};n.prototype.QueryString=function(C){C.set_string(window.location.search)};n.prototype.QueryParam=function(C,z){(z=RegExp("[?&]"+z+"=([^&]*)").exec(window.location.search))?C.set_string(decodeURIComponent(z[1].replace(/\+/g," "))):C.set_string("")};n.prototype.Bandwidth=function(C){var z=navigator.connection||navigator.mozConnection||navigator.webkitConnection;z?"undefined"!==typeof z.bandwidth?C.set_float(z.bandwidth):"undefined"!==
typeof z.downlinkMax?C.set_float(z.downlinkMax):C.set_float(Number.POSITIVE_INFINITY):C.set_float(Number.POSITIVE_INFINITY)};n.prototype.ConnectionType=function(C){var z=navigator.connection||navigator.mozConnection||navigator.webkitConnection;z?C.set_string(z.type||"unknown"):C.set_string("unknown")};n.prototype.BatteryLevel=function(C){var z=navigator.battery||navigator.mozBattery||navigator.webkitBattery;z?C.set_float(z.level):(f(),w?C.set_float(w.level):C.set_float(1))};n.prototype.BatteryTimeLeft=
function(C){var z=navigator.battery||navigator.mozBattery||navigator.webkitBattery;z?C.set_float(z.dischargingTime):(f(),w?C.set_float(w.dischargingTime):C.set_float(Number.POSITIVE_INFINITY))};n.prototype.ExecJS=function(C,z){if(eval){var K=0;try{K=eval(z)}catch(S){console&&console.error&&console.error("Error executing Javascript: ",S)}"number"===typeof K?C.set_any(K):"string"===typeof K?C.set_any(K):"boolean"===typeof K?C.set_any(K?1:0):C.set_any(0)}else C.set_any(0)};n.prototype.ScreenWidth=function(C){C.set_int(screen.width)};
n.prototype.ScreenHeight=function(C){C.set_int(screen.height)};n.prototype.DevicePixelRatio=function(C){C.set_float(this.runtime.devicePixelRatio)};n.prototype.WindowInnerWidth=function(C){C.set_int(window.innerWidth)};n.prototype.WindowInnerHeight=function(C){C.set_int(window.innerHeight)};n.prototype.WindowOuterWidth=function(C){C.set_int(window.outerWidth)};n.prototype.WindowOuterHeight=function(C){C.set_int(window.outerHeight)};e.exps=new n})();cr.plugins_.gamepad=function(b){this.runtime=b};
(function(){function b(u){var c;if(!p[u])for(p[u]=Array(20),c=0;20>c;++c)p[u][c]=0;return p[u]}function f(u){var c;if(!x[u])for(x[u]=Array(20),c=0;20>c;++c)x[u][c]=0;return x[u]}function k(u,c,y,H){return c?u>=H.length?-1:cr.is_number(H[u])?H[u]+16:H[u]:u>=y.length?-1:y[u]}function q(u,c){return c?4<=u?-1:u+16:16<=u?-1:u}function v(u){t[u.gamepad.index]=u.gamepad;w.trigger(cr.plugins_.gamepad.prototype.cnds.OnGamepadConnected,E)}function n(u){w.trigger(cr.plugins_.gamepad.prototype.cnds.OnGamepadDisconnected,
E);t[u.gamepad.index]=null}function e(){}function a(){}function d(){}var h=cr.plugins_.gamepad.prototype,r=!1;h.Type=function(u){this.plugin=u;this.runtime=u.runtime;r=!!(navigator.getGamepads||navigator.webkitGetGamepads||navigator.mozGetGamepads||navigator.gamepads||navigator.webkitGamepads||navigator.MozGamepads)};h.Type.prototype.onCreate=function(){};var w=null,E=null,t=Array(16),p=Array(16),x=Array(16),C="",z="",K=null,S={windows:{}};S.windows.firefox={};var L=[0,1,2,3,4,5,8,9,10,11],R=[0,1,
[7,6],2,3,[14,15],[12,13]];S.windows.firefox.xbox360=function(u,c){return k(u,c,L,R)};var F=[2,0,1,3,4,6,5,7,8,9],g=[0,1,2,3,[14,15],[12,13]];S.windows.firefox.logitechdualaction=function(u,c){return k(u,c,F,g)};h.Instance=function(u){this.type=u;w=this.runtime=u.runtime;E=this};var l=h.Instance.prototype;l.onCreate=function(){this.deadzone=this.properties[0];this.lastButton=0;var u=navigator.userAgent;C="windows";/mac/i.test(u)&&(C="mac");K=S[C];z="chrome";/firefox/i.test(u)&&(z="firefox");K&&(K=
K[z]);window.addEventListener("webkitgamepadconnected",v,!1);window.addEventListener("webkitgamepaddisconnected",n,!1);window.addEventListener("MozGamepadConnected",v,!1);window.addEventListener("MozGamepadDisconnected",n,!1);window.addEventListener("gamepadconnected",v,!1);window.addEventListener("gamepaddisconnected",n,!1);this.runtime.tickMe(this);this.activeControllers=[]};l.tick=function(){this.activeControllers.length=0;var u;if(u=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?
navigator.webkitGetGamepads():navigator.mozGetGamepads?navigator.mozGetGamepads():navigator.msGetGamepads?navigator.msGetGamepads():navigator.gamepads||navigator.webkitGamepads||navigator.MozGamepads||t){var c;var y=0;for(c=u.length;y<c;y++){var H=u[y];if(H){var O=b(y),U=f(y);var Y=y;var aa=b(Y);var ca=f(Y);for(Y=0;20>Y;++Y)ca[Y]=aa[Y];K?(aa="",Y=H.id.toLowerCase(),-1<Y.indexOf("xbox 360")?aa="xbox360":-1<Y.indexOf("logitech dual action")&&(aa="logitechdualaction"),ca=K[aa]||q):ca=q;aa=0;for(Y=H.buttons.length;aa<
Y;aa++){var ha="undefined"!==typeof H.buttons[aa].value?H.buttons[aa].value:H.buttons[aa];var fa=ca(aa,!1,ha);0<=fa&&20>fa&&(O[fa]=100*ha,50<=O[fa]&&50>U[fa]&&(this.lastButton=fa))}aa=0;for(Y=H.axes.length;aa<Y;aa++)ha=H.axes[aa],fa=ca(aa,!0,ha),cr.is_number(fa)?0<=fa&&20>fa&&(O[fa]=100*ha):(O[fa[0]]=0,O[fa[1]]=0,0>=ha?O[fa[0]]=Math.abs(100*ha):O[fa[1]]=Math.abs(100*ha));this.activeControllers.push(H)}else H=y,p[H]=null,x[H]=null}for(;20>y;++y)u=y,p[u]=null,x[u]=null}};l.saveToJSON=function(){return{lastButton:this.lastButton}};
l.loadFromJSON=function(u){this.lastButton=u.lastButton};e.prototype.SupportsGamepad=function(){return r};e.prototype.OnGamepadConnected=function(){return!0};e.prototype.OnGamepadDisconnected=function(){return!0};e.prototype.IsButtonDown=function(u,c){u=Math.floor(u);if(0>u||u>=this.activeControllers.length)return!1;u=b(u);if(!u)return!1;if(u=50<=u[c])this.lastButton=c;return u};e.prototype.OnButtonDown=function(u,c){u=Math.floor(u);if(0>u||u>=this.activeControllers.length)return!1;var y=b(u);u=f(u);
if(!y||!u)return!1;if(y=50<=y[c]&&50>u[c])this.lastButton=c;return y};e.prototype.OnButtonUp=function(u,c){u=Math.floor(u);if(0>u||u>=this.activeControllers.length)return!1;var y=b(u);u=f(u);if(!y||!u)return!1;if(y=50>y[c]&&50<=u[c])this.lastButton=c;return y};e.prototype.HasGamepads=function(){return 0<this.activeControllers.length};e.prototype.CompareAxis=function(u,c,y,H){u=Math.floor(u);c=Math.floor(c);if(0>u||u>=this.activeControllers.length)return!1;var O=b(u);if(O)return u=O[c+16],c=0===c%
2?O[c+16+1]:O[c+16-1],Math.sqrt(u*u+c*c)<=this.deadzone&&(u=0),cr.do_cmp(u,y,H)};e.prototype.OnAnyButtonDown=function(u){u=Math.floor(u);if(0>u||u>=this.activeControllers.length)return!1;var c=b(u);u=f(u);if(!c||!u)return!1;var y;var H=0;for(y=c.length;H<y;H++)if(50<=c[H]&&50>u[H])return this.lastButton=H,!0;return!1};e.prototype.OnAnyButtonUp=function(u){u=Math.floor(u);if(0>u||u>=this.activeControllers.length)return!1;var c=b(u);u=f(u);if(!c||!u)return!1;var y;var H=0;for(y=c.length;H<y;H++)if(50>
c[H]&&50<=u[H])return this.lastButton=H,!0;return!1};e.prototype.IsButtonIndexDown=function(u,c){u=Math.floor(u);if(0>u||u>=this.activeControllers.length)return!1;u=b(u);if(!u)return!1;c=Math.floor(c);if(0>c||c>=u.length)return!1;if(u=50<=u[c])this.lastButton=c;return u};e.prototype.OnButtonIndexDown=function(u,c){u=Math.floor(u);if(0>u||u>=this.activeControllers.length)return!1;var y=b(u);u=f(u);if(!y||!u)return!1;c=Math.floor(c);if(0>c||c>=y.length)return!1;if(y=50<=y[c]&&50>u[c])this.lastButton=
c;return y};e.prototype.OnButtonIndexUp=function(u,c){u=Math.floor(u);if(0>u||u>=this.activeControllers.length)return!1;var y=b(u);u=f(u);if(!y||!u)return!1;c=Math.floor(c);if(0>c||c>=y.length)return!1;if(y=50>y[c]&&50<=u[c])this.lastButton=c;return y};h.cnds=new e;a.prototype.Vibrate=function(u,c,y,H){u=Math.floor(u);0>u||u>=this.activeControllers.length||(u=this.activeControllers[u].vibrationActuator)&&u.playEffect&&u.playEffect("dual-rumble",{duration:c,startDelay:0,weakMagnitude:cr.clamp(y/100,
0,1),strongMagnitude:cr.clamp(H/100,0,1)}).catch(function(O){console.warn("[Gamepad] Failed to vibrate gamepad: ",O)})};a.prototype.ResetVibrate=function(u){u=Math.floor(u);0>u||u>=this.activeControllers.length||(u=this.activeControllers[u].vibrationActuator)&&u.reset&&u.reset()};h.acts=new a;d.prototype.GamepadCount=function(u){u.set_int(this.activeControllers.length)};d.prototype.GamepadID=function(u,c){0>c||c>=this.activeControllers.length?u.set_string(""):u.set_string(this.activeControllers[c].id)};
d.prototype.GamepadAxes=function(u,c){if(0>c||c>=this.activeControllers.length)u.set_string("");else{c=this.activeControllers[c].axes;var y="",H;var O=0;for(H=c.length;O<H;O++)y+="Axis "+O+": "+Math.round(100*c[O])+"\n";u.set_string(y)}};d.prototype.GamepadButtons=function(u,c){if(0>c||c>=this.activeControllers.length)u.set_string("");else{c=this.activeControllers[c].buttons;var y="",H;var O=0;for(H=c.length;O<H;O++){var U="undefined"!==typeof c[O].value?c[O].value:c[O];y+="Button "+O+": "+Math.round(100*
U)+"\n"}u.set_string(y)}};d.prototype.RawButton=function(u,c,y){c=Math.floor(c);y=Math.floor(y);0>c||c>=this.activeControllers.length?u.set_float(0):(c=this.activeControllers[c].buttons,!c||0>y||y>=c.length?u.set_float(0):"undefined"!==typeof c[y].value?u.set_float(c[y].value):u.set_float(c[y]))};d.prototype.RawAxis=function(u,c,y){c=Math.floor(c);y=Math.floor(y);0>c||c>=this.activeControllers.length?u.set_float(0):(c=this.activeControllers[c].axes,!c||0>y||y>=c.length?u.set_float(0):u.set_float(c[y]))};
d.prototype.RawButtonCount=function(u,c){c=Math.floor(c);0>c||c>=this.activeControllers.length?u.set_int(0):u.set_int(this.activeControllers[c].buttons.length)};d.prototype.RawAxisCount=function(u,c){c=Math.floor(c);0>c||c>=this.activeControllers.length?u.set_int(0):u.set_int(this.activeControllers[c].axes.length)};d.prototype.Button=function(u,c,y){c=Math.floor(c);y=Math.floor(y);0>c||c>=this.activeControllers.length?u.set_float(0):(c=b(c),!c||0>y||16<=y?u.set_float(0):u.set_float(c[y]))};d.prototype.Axis=
function(u,c,y){c=Math.floor(c);y=Math.floor(y);if(0>c||c>=this.activeControllers.length)u.set_float(0);else{var H=b(c);!H||0>y||4<=y?u.set_float(0):(c=H[y+16],y=0===y%2?H[y+16+1]:H[y+16-1],Math.sqrt(c*c+y*y)<=this.deadzone&&(c=0),u.set_float(c))}};d.prototype.LastButton=function(u){u.set_int(this.lastButton)};h.exps=new d})();cr.plugins_.TiledBg=function(b){this.runtime=b};
(function(){function b(){}function f(){}function k(){}var q=cr.plugins_.TiledBg.prototype;q.Type=function(n){this.plugin=n;this.runtime=n.runtime};var v=q.Type.prototype;v.onCreate=function(){this.is_family||(this.texture_img=this.runtime.findWaitingTexture(this.texture_file),this.texture_img||(this.texture_img=new Image,this.texture_img.cr_src=this.texture_file,this.texture_img.cr_filesize=this.texture_filesize,this.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(this.texture_img,
this.texture_file)),this.webGL_texture=this.pattern=null)};v.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)};v.onRestoreWebGLContext=function(){if(!this.is_family&&this.instances.length){this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat));var n;var e=0;for(n=this.instances.length;e<n;e++)this.instances[e].webGL_texture=this.webGL_texture}};v.loadTextures=function(){this.is_family||
this.webGL_texture||!this.runtime.glwrap||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat))};v.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)};v.preloadCanvas2D=function(n){n.drawImage(this.texture_img,0,0)};q.Instance=function(n){this.type=n;this.runtime=n.runtime};v=q.Instance.prototype;v.onCreate=function(){this.visible=
this.properties[0];this.rcTex=new cr.rect(0,0,0,0);this.has_own_texture=!1;this.texture_img=this.type.texture_img;this.runtime.glwrap?(this.type.loadTextures(),this.webGL_texture=this.type.webGL_texture):(this.type.pattern||(this.type.pattern=this.runtime.ctx.createPattern(this.type.texture_img,"repeat")),this.pattern=this.type.pattern)};v.afterLoad=function(){this.has_own_texture=!1;this.texture_img=this.type.texture_img};v.onDestroy=function(){this.runtime.glwrap&&this.has_own_texture&&this.webGL_texture&&
(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)};v.draw=function(n){n.globalAlpha=this.opacity;n.save();n.fillStyle=this.pattern;var e=this.x,a=this.y;this.runtime.pixel_rounding&&(e=Math.round(e),a=Math.round(a));var d=-(this.hotspotX*this.width),h=-(this.hotspotY*this.height),r=d%this.texture_img.width,w=h%this.texture_img.height;0>r&&(r+=this.texture_img.width);0>w&&(w+=this.texture_img.height);n.translate(e,a);n.rotate(this.angle);n.translate(r,w);n.fillRect(d-
r,h-w,this.width,this.height);n.restore()};v.drawGL_earlyZPass=function(n){this.drawGL(n)};v.drawGL=function(n){n.setTexture(this.webGL_texture);n.setOpacity(this.opacity);var e=this.rcTex;e.right=this.width/this.texture_img.width;e.bottom=this.height/this.texture_img.height;var a=this.bquad;if(this.runtime.pixel_rounding){var d=Math.round(this.x)-this.x,h=Math.round(this.y)-this.y;n.quadTex(a.tlx+d,a.tly+h,a.trx+d,a.try_+h,a.brx+d,a.bry+h,a.blx+d,a.bly+h,e)}else n.quadTex(a.tlx,a.tly,a.trx,a.try_,
a.brx,a.bry,a.blx,a.bly,e)};b.prototype.OnURLLoaded=function(){return!0};q.cnds=new b;f.prototype.SetEffect=function(n){this.blend_mode=n;this.compositeOp=cr.effectToCompositeOp(n);cr.setGLBlend(this,n,this.runtime.gl);this.runtime.redraw=!0};f.prototype.LoadURL=function(n,e){var a=new Image,d=this;a.onload=function(){d.texture_img=a;d.runtime.glwrap?(d.has_own_texture&&d.webGL_texture&&d.runtime.glwrap.deleteTexture(d.webGL_texture),d.webGL_texture=d.runtime.glwrap.loadTexture(a,!0,d.runtime.linearSampling)):
d.pattern=d.runtime.ctx.createPattern(a,"repeat");d.has_own_texture=!0;d.runtime.redraw=!0;d.runtime.trigger(cr.plugins_.TiledBg.prototype.cnds.OnURLLoaded,d)};"data:"!==n.substr(0,5)&&0===e&&(a.crossOrigin="anonymous");this.runtime.setImageSrc(a,n)};q.acts=new f;k.prototype.ImageWidth=function(n){n.set_float(this.texture_img.width)};k.prototype.ImageHeight=function(n){n.set_float(this.texture_img.height)};q.exps=new k})();cr.plugins_.NinePatch=function(b){this.runtime=b};
(function(){function b(n,e,a,d,h,r,w,E,t,p){n.save();n.fillStyle=e;e=h%a;var x=r%d;0>e&&(e+=a);0>x&&(x+=d);n.translate(e+t,x+p);n.fillRect(h-e-t,r-x-p,w,E);n.restore()}function f(){}function k(){}var q=cr.plugins_.NinePatch.prototype;q.Type=function(n){this.plugin=n;this.runtime=n.runtime};var v=q.Type.prototype;v.onCreate=function(){this.is_family||(this.texture_img=this.runtime.findWaitingTexture(this.texture_file),this.texture_img||(this.texture_img=new Image,this.texture_img.cr_src=this.texture_file,
this.texture_img.cr_filesize=this.texture_filesize,this.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(this.texture_img,this.texture_file)),this.webGL_bottomTexture=this.webGL_topTexture=this.webGL_rightTexture=this.webGL_leftTexture=this.webGL_fillTexture=this.webGL_texture=this.bottomPattern=this.topPattern=this.rightPattern=this.leftPattern=this.fillPattern=null)};v.onLostWebGLContext=function(){this.is_family||(this.webGL_bottomTexture=this.webGL_topTexture=this.webGL_rightTexture=
this.webGL_leftTexture=this.webGL_fillTexture=this.webGL_texture=null)};v.onRestoreWebGLContext=function(){this.is_family||!this.instances.length||this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat))};v.unloadTextures=function(){this.is_family||this.instances.length||!this.runtime.glwrap||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.runtime.glwrap.deleteTexture(this.webGL_fillTexture),this.runtime.glwrap.deleteTexture(this.webGL_leftTexture),
this.runtime.glwrap.deleteTexture(this.webGL_rightTexture),this.runtime.glwrap.deleteTexture(this.webGL_topTexture),this.runtime.glwrap.deleteTexture(this.webGL_bottomTexture),this.webGL_bottomTexture=this.webGL_topTexture=this.webGL_rightTexture=this.webGL_leftTexture=this.webGL_fillTexture=this.webGL_texture=null)};v.slicePatch=function(n,e,a,d){var h=this.texture_data[3],r=this.texture_data[4],w=document.createElement("canvas");a-=n;d-=e;w.width=a;w.height=d;w.getContext("2d").drawImage(this.texture_img,
n+h,e+r,a,d,0,0,a,d);return w};v.createPatch=function(n,e,a,d){var h=this.texture_data[5],r=this.texture_data[6],w=h-e,E=r-d;if(this.runtime.glwrap){if(!this.webGL_fillTexture){var t=this.runtime.glwrap,p=this.runtime.linearSampling,x=this.texture_pixelformat;w>n&&E>a&&(this.webGL_fillTexture=t.loadTexture(this.slicePatch(n,a,w,E),!0,p,x));0<n&&E>a&&(this.webGL_leftTexture=t.loadTexture(this.slicePatch(0,a,n,E),!0,p,x,"repeat-y"));0<e&&E>a&&(this.webGL_rightTexture=t.loadTexture(this.slicePatch(w,
a,h,E),!0,p,x,"repeat-y"));0<a&&w>n&&(this.webGL_topTexture=t.loadTexture(this.slicePatch(n,0,w,a),!0,p,x,"repeat-x"));0<d&&w>n&&(this.webGL_bottomTexture=t.loadTexture(this.slicePatch(n,E,w,r),!0,p,x,"repeat-x"))}}else this.fillPattern||(t=this.runtime.ctx,w>n&&E>a&&(this.fillPattern=t.createPattern(this.slicePatch(n,a,w,E),"repeat")),0<n&&E>a&&(this.leftPattern=t.createPattern(this.slicePatch(0,a,n,E),"repeat")),0<e&&E>a&&(this.rightPattern=t.createPattern(this.slicePatch(w,a,h,E),"repeat")),0<
a&&w>n&&(this.topPattern=t.createPattern(this.slicePatch(n,0,w,a),"repeat")),0<d&&w>n&&(this.bottomPattern=t.createPattern(this.slicePatch(n,E,w,r),"repeat")))};q.Instance=function(n){this.type=n;this.runtime=n.runtime};v=q.Instance.prototype;v.onCreate=function(){this.leftMargin=this.properties[0];this.rightMargin=this.properties[1];this.topMargin=this.properties[2];this.bottomMargin=this.properties[3];this.edges=this.properties[4];this.fill=this.properties[5];this.visible=this.properties[6];this.seamless=
0!==this.properties[8];this.recycled?this.rcTex.set(0,0,0,0):this.rcTex=new cr.rect(0,0,0,0);this.runtime.glwrap&&!this.type.webGL_texture&&(this.type.webGL_texture=this.runtime.glwrap.loadTexture(this.type.texture_img,!1,this.runtime.linearSampling,this.type.texture_pixelformat));this.type.createPatch(this.leftMargin,this.rightMargin,this.topMargin,this.bottomMargin)};v.draw=function(n){var e=this.type.texture_img,a=this.leftMargin,d=this.rightMargin,h=this.topMargin,r=this.bottomMargin,w=this.type.texture_data[5],
E=this.type.texture_data[6],t=this.type.texture_data[3],p=this.type.texture_data[4],x=w-d,C=E-r;n.globalAlpha=this.opacity;n.save();var z=this.x,K=this.y,S=this.width,L=this.height;this.runtime.pixel_rounding&&(z=Math.round(z),K=Math.round(K));var R=-(this.hotspotX*this.width),F=-(this.hotspotY*this.height),g=R%w,l=F%E;0>g&&(g+=w);0>l&&(l+=E);n.translate(z+g,K+l);w=R-g;F-=l;l=this.seamless?1:0;0<a&&0<h&&n.drawImage(e,t,p,a+l,h+l,w,F,a+l,h+l);0<d&&0<h&&n.drawImage(e,t+x-l,p,d+l,h+l,w+S-d-l,F,d+l,h+
l);0<d&&0<r&&n.drawImage(e,t+x-l,p+C-l,d+l,r+l,w+S-d-l,F+L-r-l,d+l,r+l);0<a&&0<r&&n.drawImage(e,t,p+C-l,a+l,r+l,w,F+L-r-l,a+l,r+l);0===this.edges?(l=2===this.fill?0:l,0<a&&C>h&&b(n,this.type.leftPattern,a,C-h,w,F+h,a+l,L-h-r,0,0),0<d&&C>h&&b(n,this.type.rightPattern,d,C-h,w+S-d-l,F+h,d+l,L-h-r,l,0),0<h&&x>a&&b(n,this.type.topPattern,x-a,h,w+a,F,S-a-d,h+l,0,0),0<r&&x>a&&b(n,this.type.bottomPattern,x-a,r,w+a,F+L-r-l,S-a-d,r+l,0,l)):1===this.edges&&(0<a&&C>h&&0<L-h-r&&n.drawImage(e,t,p+h,a,C-h,w,F+h,
a,L-h-r),0<d&&C>h&&0<L-h-r&&n.drawImage(e,t+x,p+h,d,C-h,w+S-d,F+h,d,L-h-r),0<h&&x>a&&0<S-a-d&&n.drawImage(e,t+a,p,x-a,h,w+a,F,S-a-d,h),0<r&&x>a&&0<S-a-d&&n.drawImage(e,t+a,p+C,x-a,r,w+a,F+L-r,S-a-d,r));C>h&&x>a&&(0===this.fill?b(n,this.type.fillPattern,x-a,C-h,w+a,F+h,S-a-d,L-h-r,0,0):1===this.fill&&0<S-a-d&&0<L-h-r&&n.drawImage(e,t+a,p+h,x-a,C-h,w+a,F+h,S-a-d,L-h-r));n.restore()};v.drawPatch=function(n,e,a,d,h,r,w,E,t,p){n.setTexture(e);var x=this.rcTex;x.left=a/e.c2width;x.top=d/e.c2height;x.right=
(a+h)/e.c2width;x.bottom=(d+r)/e.c2height;n.quadTex(w,E,w+t,E,w+t,E+p,w,E+p,x)};v.tilePatch=function(n,e,a,d,h,r,w,E){n.setTexture(e);var t=this.rcTex;t.left=-w/e.c2width;t.top=-E/e.c2height;t.right=(h-w)/e.c2width;t.bottom=(r-E)/e.c2height;n.quadTex(a,d,a+h,d,a+h,d+r,a,d+r,t)};v.drawGL_earlyZPass=function(n){this.drawGL(n)};v.drawGL=function(n){var e=this.leftMargin,a=this.rightMargin,d=this.topMargin,h=this.bottomMargin,r=this.type.texture_data[3],w=this.type.texture_data[4],E=this.type.texture_data[5]-
a,t=this.type.texture_data[6]-h;n.setOpacity(this.opacity);var p=this.bquad,x=p.tlx;p=p.tly;var C=this.width,z=this.height;this.runtime.pixel_rounding&&(x=Math.round(x),p=Math.round(p));var K=this.seamless?1:0;0<e&&0<d&&this.drawPatch(n,this.type.webGL_texture,r,w,e+K,d+K,x,p,e+K,d+K);0<a&&0<d&&this.drawPatch(n,this.type.webGL_texture,r+E-K,w,a+K,d+K,x+C-a-K,p,a+K,d+K);0<a&&0<h&&this.drawPatch(n,this.type.webGL_texture,r+E-K,w+t-K,a+K,h+K,x+C-a-K,p+z-h-K,a+K,h+K);0<e&&0<h&&this.drawPatch(n,this.type.webGL_texture,
r,w+t-K,e+K,h+K,x,p+z-h-K,e+K,h+K);0===this.edges?(K=2===this.fill?0:K,0<e&&t>d&&this.tilePatch(n,this.type.webGL_leftTexture,x,p+d,e+K,z-d-h,0,0),0<a&&t>d&&this.tilePatch(n,this.type.webGL_rightTexture,x+C-a-K,p+d,a+K,z-d-h,K,0),0<d&&E>e&&this.tilePatch(n,this.type.webGL_topTexture,x+e,p,C-e-a,d+K,0,0),0<h&&E>e&&this.tilePatch(n,this.type.webGL_bottomTexture,x+e,p+z-h-K,C-e-a,h+K,0,K)):1===this.edges&&(0<e&&t>d&&this.drawPatch(n,this.type.webGL_texture,r,w+d,e,t-d,x,p+d,e,z-d-h),0<a&&t>d&&this.drawPatch(n,
this.type.webGL_texture,r+E,w+d,a,t-d,x+C-a,p+d,a,z-d-h),0<d&&E>e&&this.drawPatch(n,this.type.webGL_texture,r+e,w,E-e,d,x+e,p,C-e-a,d),0<h&&E>e&&this.drawPatch(n,this.type.webGL_texture,r+e,w+t,E-e,h,x+e,p+z-h,C-e-a,h));t>d&&E>e&&(0===this.fill?this.tilePatch(n,this.type.webGL_fillTexture,x+e,p+d,C-e-a,z-d-h,0,0):1===this.fill&&this.drawPatch(n,this.type.webGL_texture,r+e,w+d,E-e,t-d,x+e,p+d,C-e-a,z-d-h))};f.prototype.OnURLLoaded=function(){return!0};q.cnds=new f;k.prototype.SetEffect=function(n){this.blend_mode=
n;this.compositeOp=cr.effectToCompositeOp(n);cr.setGLBlend(this,n,this.runtime.gl);this.runtime.redraw=!0};q.acts=new k;q.exps=new function(){}})();cr.plugins_.Spritefont2=function(b){this.runtime=b};
(function(){function b(p,x){return p.length?p.pop():new x}function f(p,x,C){if(C){var z;C=0;for(z=x.length;C<z;C++)p.length<d&&p.push(x[C]);cr.clearArray(x)}else for(z in x)Object.prototype.hasOwnProperty.call(x,z)&&(p.length<d&&p.push(x[z]),delete x[z])}function k(p,x,C){var z=p.lines;C=C.replace(/\s\s*$/,"");x>=z.length&&z.push(b(h,Object));x=z[x];x.text=C;x.width=p.measureWidth(C);p.textWidth=cr.max(p.textWidth,x.width)}function q(){}function v(){}function n(){}var e=cr.plugins_.Spritefont2.prototype;
e.onCreate=function(){};e.Type=function(p){this.plugin=p;this.runtime=p.runtime};var a=e.Type.prototype;a.onCreate=function(){this.is_family||(this.texture_img=this.runtime.findWaitingTexture(this.texture_file),this.texture_img||(this.texture_img=new Image,this.texture_img.cr_src=this.texture_file,this.texture_img.cr_filesize=this.texture_filesize,this.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(this.texture_img,this.texture_file)),this.spriteX=this.texture_data[3],this.spriteY=
this.texture_data[4],this.spriteWidth=this.texture_data[5],this.spriteHeight=this.texture_data[6],this.webGL_texture=null)};a.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)};a.onRestoreWebGLContext=function(){if(!this.is_family&&this.instances.length){this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!1,this.runtime.linearSampling,this.texture_pixelformat));var p;var x=0;for(p=this.instances.length;x<p;x++)this.instances[x].webGL_texture=
this.webGL_texture}};a.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)};a.preloadCanvas2D=function(p){p.drawImage(this.texture_img,0,0)};e.Instance=function(p){this.type=p;this.runtime=p.runtime};a=e.Instance.prototype;a.onDestroy=function(){f(h,this.lines,!0);f(r,this.clipList,!1);f(w,this.clipUV,!1);cr.wipe(this.characterWidthList)};a.onCreate=function(){this.texture_img=this.type.texture_img;
this.text=this.properties[0];this.characterWidth=this.properties[2];this.characterHeight=this.properties[3];this.characterSet=this.properties[4];var p=this.properties[5];this.characterScale=this.properties[6];this.characterSpacing=this.properties[7];this.lineHeight=this.properties[8];this.halign=this.properties[9]/2;this.valign=this.properties[10]/2;this.wrapbyword=0===this.properties[11];this.visible=this.properties[12];this.textHeight=this.textWidth=0;this.recycled?(cr.clearArray(this.lines),cr.wipe(this.clipList),
cr.wipe(this.clipUV),cr.wipe(this.characterWidthList)):(this.lines=[],this.clipList={},this.clipUV={},this.characterWidthList={});this.text_changed=!0;this.lastwrapwidth=this.width;this.runtime.glwrap&&(this.type.webGL_texture||(this.type.webGL_texture=this.runtime.glwrap.loadTexture(this.type.texture_img,!1,this.runtime.linearSampling,this.type.texture_pixelformat)),this.webGL_texture=this.type.webGL_texture);this.LoadCharacterSpacingData(p);this.SplitSheet()};a.saveToJSON=function(){var p={t:this.text,
csc:this.characterScale,csp:this.characterSpacing,lh:this.lineHeight,tw:this.textWidth,th:this.textHeight,lrt:this.last_render_tick,ha:this.halign,va:this.valign,cw:{}},x;for(x in this.characterWidthList)p.cw[x]=this.characterWidthList[x];return p};a.loadFromJSON=function(p){this.text=p.t;this.characterScale=p.csc;this.characterSpacing=p.csp;this.lineHeight=p.lh;this.textWidth=p.tw;this.textHeight=p.th;this.last_render_tick=p.lrt;p.hasOwnProperty("ha")&&(this.halign=p.ha);p.hasOwnProperty("va")&&
(this.valign=p.va);for(var x in p.cw)this.characterWidthList[x]=p.cw[x];this.text_changed=!0;this.lastwrapwidth=this.width};var d=1E3,h=[],r=[],w=[];a.SplitSheet=function(){var p=this.texture_img.width,x=this.texture_img.height,C=this.type.spriteX,z=this.type.spriteY,K=this.characterWidth,S=this.characterHeight,L=C/p,R=z/x;p=K/p;x=S/x;for(var F=this.characterSet,g=Math.floor(this.type.spriteWidth/K),l=Math.floor(this.type.spriteHeight/S),u=0;u<F.length&&!(u>=g*l);u++){var c=u%g,y=Math.floor(u/g),
H=F.charAt(u);if(this.runtime.glwrap){var O=this.clipUV,U=c*p+L,Y=y*x+R;c=(c+1)*p+L;y=(y+1)*x+R;void 0===O[H]&&(O[H]=b(w,cr.rect));O[H].left=U;O[H].top=Y;O[H].right=c;O[H].bottom=y}else O=this.clipList,c=c*K+C,y=y*S+z,U=K,Y=S,void 0===O[H]&&(O[H]=b(r,Object)),O[H].x=c,O[H].y=y,O[H].w=U,O[H].h=Y}};var E=[];e.TokeniseWords=function(p){cr.clearArray(E);for(var x="",C,z=0;z<p.length;)if(C=p.charAt(z),"\n"===C)x.length&&(E.push(x),x=""),E.push("\n"),++z;else if(" "===C||"\t"===C||"-"===C){do x+=p.charAt(z),
z++;while(z<p.length&&(" "===p.charAt(z)||"\t"===p.charAt(z)));E.push(x);x=""}else z<p.length&&(x+=C,z++);x.length&&E.push(x)};e.WordWrap=function(p){var x=p.text,C=p.lines;if(x&&x.length){var z=p.width;if(2>=z)f(h,C,!0);else{var K=p.characterScale,S=p.characterSpacing;if(x.length*(p.characterWidth*K+S)-S<=z&&-1===x.indexOf("\n")&&(S=p.measureWidth(x),S<=z)){f(h,C,!0);C.push(b(h,Object));C[0].text=x;C[0].width=S;p.textWidth=S;p.textHeight=p.characterHeight*K+p.lineHeight;return}this.WrapText(p);p.textHeight=
C.length*(p.characterHeight*K+p.lineHeight)}}else f(h,C,!0)};e.WrapText=function(p){var x=p.wrapbyword,C=p.text,z=p.lines,K=p.width;x&&(this.TokeniseWords(C),C=E);var S="",L,R=0,F=!1;for(L=0;L<C.length;L++)if("\n"===C[L])!0===F?F=!1:(k(p,R,S),R++),S="";else{F=!1;var g=S;S+=C[L];var l=p.measureWidth(S.replace(/\s\s*$/,""));l>K&&(""===g?(k(p,R,S),S="",F=!0):(k(p,R,g),S=C[L]),R++,x||" "!==S||(S=""))}S.replace(/\s\s*$/,"").length&&(k(p,R,S),R++);for(L=R;L<z.length;L++)h.length<d&&h.push(z[L]);z.length=
R};a.measureWidth=function(p){for(var x=this.characterSpacing,C=p.length,z=0,K=0;K<C;K++)z+=this.getCharacterWidth(p.charAt(K))*this.characterScale+x;return z-(0<z?x:0)};a.getCharacterWidth=function(p){var x=this.characterWidthList;return void 0!==x[p]?x[p]:this.characterWidth};a.rebuildText=function(){if(this.text_changed||this.width!==this.lastwrapwidth)this.textHeight=this.textWidth=0,this.type.plugin.WordWrap(this),this.text_changed=!1,this.lastwrapwidth=this.width};a.draw=function(p,x){x=this.texture_img;
if(""!==this.text&&null!=x&&(this.rebuildText(),!(this.height<this.characterHeight*this.characterScale+this.lineHeight))){p.globalAlpha=this.opacity;x=this.x;var C=this.y;this.runtime.pixel_rounding&&(x=Math.round(x),C=Math.round(C));var z=this.layer.viewLeft,K=this.layer.viewTop,S=this.layer.viewRight,L=this.layer.viewBottom;p.save();p.translate(x,C);p.rotate(this.angle);var R=this.angle,F=this.halign,g=this.characterScale,l=this.characterHeight*g,u=this.lineHeight,c=this.characterSpacing,y=this.lines,
H=this.valign*cr.max(0,this.height-this.textHeight),O=-(this.hotspotX*this.width);H=-(this.hotspotY*this.height)+H;for(var U,Y,aa=0;aa<y.length;aa++){var ca=y[aa].text;var ha=F*cr.max(0,this.width-y[aa].width);var fa=O+ha;H+=u;if(0===R&&C+H+l<K)H+=l;else{for(var m=0;m<ca.length;m++){U=ca.charAt(m);ha=this.getCharacterWidth(U);var A=this.clipList[U];if(0===R&&x+fa+ha*g+c<z)fa+=ha*g+c;else{if(fa+ha*g>this.width+1E-5)break;void 0!==A&&(U=fa,Y=H,0===R&&1===g&&(U=Math.round(U),Y=Math.round(Y)),p.drawImage(this.texture_img,
A.x,A.y,A.w,A.h,U,Y,A.w*g,A.h*g));fa+=ha*g+c;if(0===R&&x+fa>S)break}}H+=l;if(0===R&&(H+l+u>this.height||C+H>L))break}}p.restore()}};var t=new cr.quad;a.drawGL=function(p){p.setTexture(this.webGL_texture);p.setOpacity(this.opacity);if(this.text&&(this.rebuildText(),!(this.height<this.characterHeight*this.characterScale+this.lineHeight))){this.update_bbox();var x=this.bquad,C=0,z=0;this.runtime.pixel_rounding&&(C=Math.round(this.x)-this.x,z=Math.round(this.y)-this.y);var K=this.layer.viewLeft,S=this.layer.viewTop,
L=this.layer.viewRight,R=this.layer.viewBottom,F=this.angle,g=this.halign,l=this.valign,u=this.characterScale,c=this.characterHeight*u,y=this.lineHeight,H=this.characterSpacing,O=this.lines,U=this.textHeight,Y;if(0!==F){var aa=Math.cos(F);var ca=Math.sin(F)}l*=cr.max(0,this.height-U);C=x.tlx+C;x=x.tly+z;z=l;for(l=0;l<O.length;l++){U=O[l].text;var ha=Y=g*cr.max(0,this.width-O[l].width);z+=y;if(0===F&&x+z+c<S)z+=c;else{for(var fa=0;fa<U.length;fa++){var m=U.charAt(fa);Y=this.getCharacterWidth(m);m=
this.clipUV[m];if(0===F&&C+ha+Y*u+H<K)ha+=Y*u+H;else{if(ha+Y*u>this.width+1E-5)break;if(void 0!==m){var A=this.characterWidth*u,J=this.characterHeight*u;var N=ha;var G=z;0===F&&1===u&&(N=Math.round(N),G=Math.round(G));t.tlx=N;t.tly=G;t.trx=N+A;t.try_=G;t.blx=N;t.bly=G+J;t.brx=N+A;t.bry=G+J;0!==F&&(G=t,A=aa,J=ca,N=G.tlx*A-G.tly*J,G.tly=G.tly*A+G.tlx*J,G.tlx=N,N=G.trx*A-G.try_*J,G.try_=G.try_*A+G.trx*J,G.trx=N,N=G.blx*A-G.bly*J,G.bly=G.bly*A+G.blx*J,G.blx=N,N=G.brx*A-G.bry*J,G.bry=G.bry*A+G.brx*J,G.brx=
N);t.offset(C,x);p.quadTex(t.tlx,t.tly,t.trx,t.try_,t.brx,t.bry,t.blx,t.bly,m)}ha+=Y*u+H;if(0===F&&C+ha>L)break}}z+=c;if(0===F&&(z+c+y>this.height||x+z>R))break}}}};q.prototype.CompareText=function(p,x){return x?this.text==p:cr.equals_nocase(this.text,p)};e.cnds=new q;v.prototype.SetText=function(p){cr.is_number(p)&&1E9>p&&(p=Math.round(1E10*p)/1E10);p=p.toString();this.text!==p&&(this.text=p,this.text_changed=!0,this.runtime.redraw=!0)};v.prototype.AppendText=function(p){cr.is_number(p)&&(p=Math.round(1E10*
p)/1E10);if(p=p.toString())this.text+=p,this.text_changed=!0,this.runtime.redraw=!0};v.prototype.SetScale=function(p){p!==this.characterScale&&(this.characterScale=p,this.text_changed=!0,this.runtime.redraw=!0)};v.prototype.SetCharacterSpacing=function(p){p!==this.CharacterSpacing&&(this.characterSpacing=p,this.text_changed=!0,this.runtime.redraw=!0)};v.prototype.SetLineHeight=function(p){p!==this.lineHeight&&(this.lineHeight=p,this.text_changed=!0,this.runtime.redraw=!0)};a.SetCharWidth=function(p,
x){x=parseInt(x,10);this.characterWidthList[p]!==x&&(this.characterWidthList[p]=x,this.text_changed=!0,this.runtime.redraw=!0)};a.LoadCharacterSpacingData=function(p){var x,C;if(p){try{var z=JSON.parse(p)}catch(R){return}if(Array.isArray(z))for(p=0,x=z.length;p<x;++p){var K=z[p];if(Array.isArray(K)&&2===K.length&&"number"===typeof K[0]&&"string"===typeof K[1]){var S=K[0];K=K[1];var L=0;for(C=K.length;L<C;++L)this.SetCharWidth(K.charAt(L),S)}}}};v.prototype.SetCharacterWidth=function(p,x){if(""!==
p)for(var C=0;C<p.length;C++)this.SetCharWidth(p.charAt(C),x)};v.prototype.SetEffect=function(p){this.blend_mode=p;this.compositeOp=cr.effectToCompositeOp(p);cr.setGLBlend(this,p,this.runtime.gl);this.runtime.redraw=!0};v.prototype.SetHAlign=function(p){this.halign=p/2;this.text_changed=!0;this.runtime.redraw=!0};v.prototype.SetVAlign=function(p){this.valign=p/2;this.text_changed=!0;this.runtime.redraw=!0};e.acts=new v;n.prototype.CharacterWidth=function(p,x){p.set_int(this.getCharacterWidth(x))};
n.prototype.CharacterHeight=function(p){p.set_int(this.characterHeight)};n.prototype.CharacterScale=function(p){p.set_float(this.characterScale)};n.prototype.CharacterSpacing=function(p){p.set_int(this.characterSpacing)};n.prototype.LineHeight=function(p){p.set_int(this.lineHeight)};n.prototype.Text=function(p){p.set_string(this.text)};n.prototype.TextWidth=function(p){this.rebuildText();p.set_float(this.textWidth)};n.prototype.TextHeight=function(p){this.rebuildText();p.set_float(this.textHeight)};
e.exps=new n})();cr.plugins_.Tilemap=function(b){this.runtime=b};
(function(){function b(){this.tileid=this.id=-1;this.any_flip=this.diag_flip=this.vert_flip=this.horiz_flip=!1;this.rc=new cr.rect(0,0,0,0)}function f(L){1E4>C.length&&C.push(L)}function k(){this.id=-1;this.rc=new cr.rect(0,0,0,0);this.poly=null}function q(L){1E4>z.length&&z.push(L)}function v(L,R,F){if(K.length){var g=K.pop();g.inst=L;g.x=R;g.y=F;g.left=g.x*g.inst.cellwidth*g.inst.tilewidth;g.top=g.y*g.inst.cellheight*g.inst.tileheight;g.clear();g.quadmap_valid=!1;return g}return new n(L,R,F)}function n(L,
R,F){this.inst=L;this.x=R;this.y=F;this.left=this.x*this.inst.cellwidth*this.inst.tilewidth;this.top=this.y*this.inst.cellheight*this.inst.tileheight;this.tiles=[];this.quads=[];this.collision_rects=[];this.quadmap_valid=!1;var g;L=0;for(R=this.inst.cellheight;L<R;++L){var l=[];F=0;for(g=this.inst.cellwidth;F<g;++F)l.push(-1);this.tiles.push(l)}}function e(){}function a(L){switch(L){case 0:return 0;case 1:return E;case 2:return t;case 3:return E|p;case 4:return E|t;case 5:return t|p;case 6:return E|
t|p;case 7:return p;default:return 0}}function d(){}function h(){}var r=cr.plugins_.Tilemap.prototype;r.Type=function(L){this.plugin=L;this.runtime=L.runtime};var w=r.Type.prototype;w.onCreate=function(){var L,R;if(!this.is_family&&(this.texture_img=this.runtime.findWaitingTexture(this.texture_file),this.texture_img||(this.texture_img=new Image,this.texture_img.cr_src=this.texture_file,this.texture_img.cr_filesize=this.texture_filesize,this.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(this.texture_img,
this.texture_file)),this.spriteX=this.texture_data[3],this.spriteY=this.texture_data[4],this.spriteWidth=this.texture_data[5],this.spriteHeight=this.texture_data[6],this.cut_tiles=[],this.cut_tiles_valid=!1,this.tile_polys=[],this.tile_polys_cached=!1,this.tile_poly_data&&this.tile_poly_data.length)){var F=0;for(L=this.tile_poly_data.length;F<L;++F)(R=this.tile_poly_data[F])?this.tile_polys.push({poly:R[0],use:!!R[1],flipmap:[[[null,null],[null,null]],[[null,null],[null,null]]]}):this.tile_polys.push(null)}};
w.cacheTilePoly=function(L,R,F,g,l,u){if(!(0>L||L>=this.tile_polys.length)&&this.tile_polys[L]){var c=this.tile_polys[L].flipmap;L=new cr.CollisionPoly(this.tile_polys[L].poly,this.tile_polys[L].use);L.cache_poly(R,F,0);u&&L.diag();g&&L.mirror(R/2);l&&L.flip(F/2);c[g?1:0][l?1:0][u?1:0]=L}};w.getTilePoly=function(L){if(-1===L)return null;var R=L&x;return 0>R||R>=this.tile_polys.length||!this.tile_polys[R]?null:this.tile_polys[R].flipmap[L&E?1:0][L&t?1:0][L&p?1:0]};w.isTilePolyEnabled=function(L){return(L=
this.getTilePoly(L))?L.is_enabled():!0};w.freeCutTiles=function(){var L,R=this.runtime.glwrap;if(R){var F=0;for(L=this.cut_tiles.length;F<L;++F)R.deleteTexture(this.cut_tiles[F])}cr.clearArray(this.cut_tiles);this.cut_tiles_valid=!1};w.maybeCutTiles=function(L,R,F,g,l,u,c){if(!(this.cut_tiles_valid||0>=L||0>=R)){this.freeCutTiles();var y=this.spriteWidth,H=this.spriteHeight,O;for(O=g;O+R<=H;O+=R+u)for(g=F;g+L<=y;g+=L+l)this.cut_tiles.push(this.CutTileImage(g,O,L,R,c));this.cut_tiles_valid=!0}};w.CutTileImage=
function(L,R,F,g,l){if(this.runtime.glwrap)return this.DoCutTileImage(L,R,F,g,!1,!1,!1,l);var u=[[[null,null],[null,null]],[[null,null],[null,null]]];u[0][0][0]=this.DoCutTileImage(L,R,F,g,!1,!1,!1,l);return{flipmap:u,x:L,y:R,w:F,h:g}};w.GetFlippedTileImage=function(L,R,F,g,l){if(0>L||L>=this.cut_tiles.length)return null;L=this.cut_tiles[L];var u=L.flipmap;R=R?1:0;F=F?1:0;g=g?1:0;var c=u[R][F][g];c||(c=this.DoCutTileImage(L.x,L.y,L.w,L.h,0!==R,0!==F,0!==g,l),u[R][F][g]=c);return c};w.DoCutTileImage=
function(L,R,F,g,l,u,c,y){var H=F,O=g;this.runtime.glwrap&&!y&&(cr.isPOT(H)||(H=cr.nextHighestPowerOfTwo(H)),cr.isPOT(O)||(O=cr.nextHighestPowerOfTwo(O)));var U=document.createElement("canvas");U.width=H;U.height=O;var Y=U.getContext("2d");if(this.runtime.ctx)return l?u?(c?(Y.rotate(Math.PI/2),Y.scale(-1,1)):Y.scale(-1,-1),Y.translate(-H,-O)):c?(Y.rotate(Math.PI/2),Y.translate(0,-O)):(Y.scale(-1,1),Y.translate(-H,0)):u?c?(Y.rotate(-Math.PI/2),Y.translate(-H,0)):(Y.scale(1,-1),Y.translate(0,-O)):c&&
(Y.scale(-1,1),Y.rotate(Math.PI/2)),Y.drawImage(this.texture_img,this.spriteX+L,this.spriteY+R,F,g,0,0,H,O),y?U:this.runtime.ctx.createPattern(U,"repeat");Y.drawImage(this.texture_img,this.spriteX+L,this.spriteY+R,F,g,0,0,H,O);L=this.runtime.glwrap.createEmptyTexture(H,O,this.runtime.linearSampling,!1,!y);this.runtime.glwrap.videoToTexture(U,L);return L};w.onLostWebGLContext=function(){this.is_family||this.freeCutTiles()};w.onRestoreWebGLContext=function(){};w.loadTextures=function(){};w.unloadTextures=
function(){this.is_family||this.instances.length||this.freeCutTiles()};w.preloadCanvas2D=function(L){};r.Instance=function(L){this.type=L;this.runtime=L.runtime};w=r.Instance.prototype;var E=-2147483648,t=1073741824,p=536870912,x=536870911,C=[],z=[],K=[];n.prototype.clear=function(){var L,R;this.tiles.length=this.inst.cellheight;var F=0;for(L=this.tiles.length;F<L;++F){var g=this.tiles[F];g||(g=[],this.tiles[F]=g);g.length=this.inst.cellwidth;var l=0;for(R=g.length;l<R;++l)g[l]=-1}};n.prototype.maybeBuildQuadMap=
function(){if(!this.quadmap_valid){var L=this.inst.tilewidth,R=this.inst.tileheight;if(!(0>=L||0>=R)){var F,g;var l=0;for(F=this.quads.length;l<F;++l)f(this.quads[l]);l=0;for(F=this.collision_rects.length;l<F;++l)q(this.collision_rects[l]);cr.clearArray(this.quads);cr.clearArray(this.collision_rects);var u=Math.min(this.inst.mapwidth,Math.floor(this.inst.width/L)),c=Math.min(this.inst.mapheight,Math.floor(this.inst.height/R));u-=this.left/L;c-=this.top/R;u>this.inst.cellwidth&&(u=this.inst.cellwidth);
c>this.inst.cellheight&&(c=this.inst.cellheight);var y=this.inst.seamless,H=null;l=0;for(F=c;l<F;++l){var O=this.tiles[l];var U=0;for(g=u;U<g;++U){var Y=O[U];-1===Y?H&&(this.quads.push(H),H=null):y||!H||Y!==H.id?(H&&this.quads.push(H),H=C.length?C.pop():new b,H.id=Y,H.tileid=Y&x,H.horiz_flip=0!==(Y&E),H.vert_flip=0!==(Y&t),H.diag_flip=0!==(Y&p),H.any_flip=H.horiz_flip||H.vert_flip||H.diag_flip,H.rc.left=U*L+this.left,H.rc.top=l*R+this.top,H.rc.right=H.rc.left+L,H.rc.bottom=H.rc.top+R):H.rc.right+=
L}H&&(this.quads.push(H),H=null)}H=null;var aa=!1;l=0;for(F=c;l<F;++l){O=this.tiles[l];U=0;for(g=u;U<g;++U)Y=O[U],c=this.inst.type.isTilePolyEnabled(Y),-1!==Y&&c?(c=this.inst.type.getTilePoly(Y),!H||c||aa?(H&&this.collision_rects.push(H),H=z.length?z.pop():new k,H.id=Y,H.poly=c?c:null,Y=H.rc,Y.left=U*L+this.left,Y.top=l*R+this.top,Y.right=Y.left+L,Y.bottom=Y.top+R,aa=!!c):H.rc.right+=L):H&&(this.collision_rects.push(H),H=null,aa=!1);H&&(this.collision_rects.push(H),H=null,aa=!1)}if(!y)for(F=this.quads.length,
l=0;l<F;++l)for(g=this.quads[l],L=l+1;L<F;++L)if(U=this.quads[L],!(U.rc.top<g.rc.bottom)){if(U.rc.top>g.rc.bottom)break;if(U.rc.right>g.rc.right||U.rc.left>g.rc.left)break;U.id===g.id&&U.rc.left===g.rc.left&&U.rc.right===g.rc.right&&(f(this.quads[L]),this.quads.splice(L,1),--F,g.rc.bottom+=R,--L)}F=this.collision_rects.length;for(l=0;l<F;++l)if(g=this.collision_rects[l],!g.poly)for(O=g.rc,L=l+1;L<F;++L)if(U=this.collision_rects[L],g=U.rc,!(g.top<O.bottom)){if(g.top>O.bottom)break;if(g.right>O.right||
g.left>O.left)break;U.poly||g.left!==O.left||g.right!==O.right||(q(this.collision_rects[L]),this.collision_rects.splice(L,1),--F,O.bottom+=R,--L)}this.quadmap_valid=!0}}};n.prototype.setTileAt=function(L,R,F){this.tiles[R][L]!==F&&(this.tiles[R][L]=F,this.quadmap_valid=!1,this.inst.any_quadmap_changed=!0,this.inst.physics_changed=!0,this.inst.runtime.redraw=!0)};w.onCreate=function(){var L,R;this.visible=this.properties[0];this.tilewidth=this.properties[1];this.tileheight=this.properties[2];this.tilexoffset=
this.properties[3];this.tileyoffset=this.properties[4];this.tilexspacing=this.properties[5];this.tileyspacing=this.properties[6];this.seamless=!0;this.mapwidth=this.tilemap_width;this.mapheight=this.tilemap_height;this.lastwidth=this.width;this.lastheight=this.height;var F=this.tilewidth,g=this.tileheight;0===F&&(F=1);0===g&&(g=1);this.cellwidth=Math.ceil(this.runtime.original_width/F);this.cellheight=Math.ceil(this.runtime.original_height/g);if(!this.type.tile_polys_cached){this.type.tile_polys_cached=
!0;var l=0;for(L=this.type.tile_polys.length;l<L;++l)if(R=this.type.tile_polys[l])this.type.cacheTilePoly(l,F,g,!1,!1,!1),this.type.cacheTilePoly(l,F,g,!1,!1,!0),this.type.cacheTilePoly(l,F,g,!1,!0,!1),this.type.cacheTilePoly(l,F,g,!1,!0,!0),this.type.cacheTilePoly(l,F,g,!0,!1,!1),this.type.cacheTilePoly(l,F,g,!0,!1,!0),this.type.cacheTilePoly(l,F,g,!0,!0,!1),this.type.cacheTilePoly(l,F,g,!0,!0,!0)}this.recycled||(this.tilecells=[]);this.maybeResizeTilemap(!0);this.setTilesFromRLECSV(this.tilemap_data);
this.type.maybeCutTiles(this.tilewidth,this.tileheight,this.tilexoffset,this.tileyoffset,this.tilexspacing,this.tileyspacing,this.seamless);this.physics_changed=!1;this.any_quadmap_changed=!0;this.maybeBuildAllQuadMap()};w.maybeBuildAllQuadMap=function(){if(this.any_quadmap_changed){var L,R;var F=0;for(L=this.tilecells.length;F<L;++F){var g=this.tilecells[F];var l=0;for(R=g.length;l<R;++l)g[l].maybeBuildQuadMap()}this.any_quadmap_changed=!1}};w.setAllQuadMapChanged=function(){var L,R;var F=0;for(L=
this.tilecells.length;F<L;++F){var g=this.tilecells[F];var l=0;for(R=g.length;l<R;++l)g[l].quadmap_valid=!1}this.any_quadmap_changed=!0};w.maybeResizeTilemap=function(L){var R=cr.floor(this.width/this.tilewidth),F=cr.floor(this.height/this.tileheight);if(!(R<=this.mapwidth&&F<=this.mapheight)||L){if(L){L=Math.ceil(this.mapheight/this.cellheight);var g=Math.ceil(this.mapwidth/this.cellwidth)}else L=this.tilecells.length,g=Math.ceil(this.mapwidth/this.cellwidth),F>this.mapheight&&(this.mapheight=F,
L=Math.ceil(this.mapheight/this.cellheight)),R>this.mapwidth&&(this.mapwidth=R,g=Math.ceil(this.mapwidth/this.cellwidth)),this.setAllQuadMapChanged(),this.physics_changed=!0,this.runtime.redraw=!0;var l;for(R=0;R<L;++R)if(l=this.tilecells[R])for(F=l.length;F<g;++F)l.push(v(this,F,R));else{l=[];for(F=0;F<g;++F)l.push(v(this,F,R));this.tilecells[R]=l}}};w.cellAt=function(L,R){if(0>L||0>R)return null;R=cr.floor(R/this.cellheight);if(R>=this.tilecells.length)return null;R=this.tilecells[R];L=cr.floor(L/
this.cellwidth);return L>=R.length?null:R[L]};w.cellAtIndex=function(L,R){if(0>L||0>R||R>=this.tilecells.length)return null;R=this.tilecells[R];return L>=R.length?null:R[L]};w.setTilesFromRLECSV=function(L){var R=[];L=L.split(",");var F;var g=0;for(F=L.length;g<F;++g){var l=L[g];var u=l.indexOf("x");if(-1<u){var c=parseInt(l.substring(0,u),10);l=l.substring(u+1);u=parseInt(l,10);-1<l.indexOf("h")&&(u|=E);-1<l.indexOf("v")&&(u|=t);for(-1<l.indexOf("d")&&(u|=p);0<c;--c)R.push(u)}else u=parseInt(l,10),
-1<l.indexOf("h")&&(u|=E),-1<l.indexOf("v")&&(u|=t),-1<l.indexOf("d")&&(u|=p),R.push(u)}for(g=L=0;g<this.mapheight;++g)for(F=0;F<this.mapwidth;++F)c=R[L++],(l=this.cellAt(F,g))&&l.setTileAt(F%this.cellwidth,g%this.cellheight,c)};w.getTilesAsRLECSV=function(){var L="";if(0>=this.mapwidth||0>=this.mapheight)return L;var R=1,F=this.getTileAt(0,0),g,l,u,c;var y=cr.floor(this.width/this.tilewidth);var H=cr.floor(this.height/this.tileheight);for(g=0;g<H;++g)for(l=0===g?1:0;l<y;++l){var O=this.getTileAt(l,
g);if(O===F)++R;else{if(-1===F){var U=-1;F=c=u=!1}else U=F&x,u=0!==(F&E),c=0!==(F&t),F=0!==(F&p);L=1===R?L+(""+U):L+(""+R+"x"+U);u&&(L+="h");c&&(L+="v");F&&(L+="d");L+=",";R=1;F=O}}-1===F?(U=-1,F=c=u=!1):(U=F&x,u=0!==(F&E),c=0!==(F&t),F=0!==(F&p));L=1===R?L+(""+U):L+(""+R+"x"+U);u&&(L+="h");c&&(L+="v");F&&(L+="d");return L};w.getTileAt=function(L,R){L=Math.floor(L);R=Math.floor(R);if(0>L||0>R||L>=this.mapwidth||R>=this.mapheight)return-1;var F=this.cellAt(L,R);return F?F.tiles[R%this.cellheight][L%
this.cellwidth]:-1};w.setTileAt=function(L,R,F){L=Math.floor(L);R=Math.floor(R);if(0>L||0>R||L>=this.mapwidth||R>=this.mapheight)return-1;var g=this.cellAt(L,R);if(!g)return-1;g.setTileAt(L%this.cellwidth,R%this.cellheight,F)};w.worldToCellX=function(L){return Math.floor((L-this.x)/(this.cellwidth*this.tilewidth))};w.worldToCellY=function(L){return Math.floor((L-this.y)/(this.cellheight*this.tileheight))};w.worldToTileX=function(L){return Math.floor((L-this.x)/this.tilewidth)};w.worldToTileY=function(L){return Math.floor((L-
this.y)/this.tileheight)};w.getCollisionRectCandidates=function(L,R){var F=this.worldToCellX(L.left),g=this.worldToCellY(L.top),l=this.worldToCellX(L.right);L=this.worldToCellY(L.bottom);for(var u,c;F<=l;++F)for(u=g;u<=L;++u)if(c=this.cellAtIndex(F,u))c.maybeBuildQuadMap(),cr.appendArray(R,c.collision_rects)};w.testPointOverlapTile=function(L,R){var F=this.worldToTileX(L),g=this.worldToTileY(R);F=this.getTileAt(F,g);return-1===F?!1:(F=this.type.getTilePoly(F))?this.type.isTilePolyEnabled(F)?F.contains_pt(L-
(Math.floor((L-this.x)/this.tilewidth)*this.tilewidth+this.x),R-(Math.floor((R-this.y)/this.tileheight)*this.tileheight+this.y)):!1:!0};w.getAllCollisionRects=function(L){var R,F;var g=0;for(R=this.tilecells.length;g<R;++g){var l=this.tilecells[g];var u=0;for(F=l.length;u<F;++u){var c=l[u];c.maybeBuildQuadMap();cr.appendArray(L,c.collision_rects)}}};w.onDestroy=function(){var L,R;var F=0;for(L=this.tilecells.length;F<L;++F){var g=this.tilecells[F];var l=0;for(R=g.length;l<R;++l){var u,c=g[l];var y=
0;for(u=c.quads.length;y<u;++y)f(c.quads[y]);cr.clearArray(c.quads);y=0;for(u=c.collision_rects.length;y<u;++y)q(c.collision_rects[y]);cr.clearArray(c.collision_rects);1E3>K.length&&K.push(c)}cr.clearArray(g)}cr.clearArray(this.tilecells)};w.saveToJSON=function(){this.maybeResizeTilemap();var L=cr.floor(this.width/this.tilewidth),R=cr.floor(this.height/this.tileheight);return{w:L,h:R,d:this.getTilesAsRLECSV()}};w.loadFromJSON=function(L){this.mapwidth=L.w;this.mapheight=L.h;this.maybeResizeTilemap(!0);
this.setTilesFromRLECSV(L.d);this.physics_changed=!0;this.setAllQuadMapChanged()};w.draw=function(L){if(!(0>=this.tilewidth||0>=this.tileheight)){this.type.maybeCutTiles(this.tilewidth,this.tileheight,this.tilexoffset,this.tileyoffset,this.tilexspacing,this.tileyspacing,this.seamless);if(this.width!==this.lastwidth||this.height!==this.lastheight)this.physics_changed=!0,this.setAllQuadMapChanged(),this.maybeBuildAllQuadMap(),this.lastwidth=this.width,this.lastheight=this.height;L.globalAlpha=this.opacity;
var R=this.layer,F=R.viewLeft,g=R.viewTop,l=R.viewRight;R=R.viewBottom;var u=this.x,c=this.y,y=this.seamless;this.runtime.pixel_rounding&&(u=Math.round(u),c=Math.round(c));var H=this.cellwidth*this.tilewidth,O=this.cellheight*this.tileheight,U=Math.floor((F-u)/H);H=Math.floor((l-u)/H);var Y=Math.floor((g-c)/O);O=Math.floor((R-c)/O);var aa=u%this.tilewidth,ca=c%this.tileheight;this.seamless&&(ca=aa=0);if(0!==aa||0!==ca)L.save(),L.translate(aa,ca),u-=aa,c-=ca,F-=aa,g-=ca,l-=aa,R-=ca;for(var ha,fa,m,
A,J,N,G,B,I;U<=H;++U)for(ha=Y;ha<=O;++ha)if(fa=this.cellAtIndex(U,ha))for(fa.maybeBuildQuadMap(),m=0,A=fa.quads.length;m<A;++m)if(J=fa.quads[m],-1!==J.id){var M=J.rc;N=M.left+u;G=M.top+c;B=M.right+u;M=M.bottom+c;N>l||B<F||G>R||M<g||(I=this.type.GetFlippedTileImage(J.tileid,J.horiz_flip,J.vert_flip,J.diag_flip,this.seamless),y?L.drawImage(I,N,G):(L.fillStyle=this.type.GetFlippedTileImage(J.tileid,J.horiz_flip,J.vert_flip,J.diag_flip,this.seamless),L.fillRect(N,G,B-N,M-G)))}0===aa&&0===ca||L.restore()}};
var S=new cr.rect(0,0,1,1);w.drawGL_earlyZPass=function(L){this.drawGL(L)};w.drawGL=function(L){if(!(0>=this.tilewidth||0>=this.tileheight)){this.type.maybeCutTiles(this.tilewidth,this.tileheight,this.tilexoffset,this.tileyoffset,this.tilexspacing,this.tileyspacing,this.seamless);if(this.width!==this.lastwidth||this.height!==this.lastheight)this.physics_changed=!0,this.setAllQuadMapChanged(),this.maybeBuildAllQuadMap(),this.lastwidth=this.width,this.lastheight=this.height;L.setOpacity(this.opacity);
var R=this.type.cut_tiles,F=this.layer,g=F.viewLeft,l=F.viewTop,u=F.viewRight;F=F.viewBottom;var c=this.x,y=this.y;this.runtime.pixel_rounding&&(c=Math.round(c),y=Math.round(y));var H=this.cellwidth*this.tilewidth,O=this.cellheight*this.tileheight,U=Math.floor((u-c)/H),Y=Math.floor((l-y)/O);O=Math.floor((F-y)/O);var aa,ca,ha,fa,m;for(ha=Math.floor((g-c)/H);ha<=U;++ha)for(fa=Y;fa<=O;++fa)if(m=this.cellAtIndex(ha,fa))for(m.maybeBuildQuadMap(),H=0,aa=m.quads.length;H<aa;++H){var A=m.quads[H];if(-1!==
A.id){var J=A.rc;var N=J.left+c;var G=J.top+y;var B=J.right+c;J=J.bottom+y;if(!(N>u||B<g||G>F||J<l))if(L.setTexture(R[A.tileid]),S.right=(B-N)/this.tilewidth,S.bottom=(J-G)/this.tileheight,A.any_flip){if(A.diag_flip){var I=S.right;S.right=S.bottom;S.bottom=I}var M=ca=0;var Q=S.right;var Z=0;var W=S.right;var X=S.bottom;var ba=0;var da=S.bottom;A.diag_flip&&(I=ba,ba=Q,Q=I,I=da,da=Z,Z=I);A.horiz_flip&&(I=ca,ca=Q,Q=I,I=M,M=Z,Z=I,I=ba,ba=W,W=I,I=da,da=X,X=I);A.vert_flip&&(I=ca,ca=ba,ba=I,I=M,M=da,da=
I,I=Q,Q=W,W=I,I=Z,Z=X,X=I);L.quadTexUV(N,G,B,G,B,J,N,J,ca,M,Q,Z,W,X,ba,da)}else L.quadTex(N,G,B,G,B,J,N,J,S)}}}};e.prototype.CompareTileAt=function(L,R,F,g){L=this.getTileAt(L,R);-1!==L&&(L&=x);return cr.do_cmp(L,F,g)};e.prototype.CompareTileStateAt=function(L,R,F){L=this.getTileAt(L,R);R=0;-1!==L&&(R=L&3758096384);return R===a(F)};e.prototype.OnURLLoaded=function(){return!0};r.cnds=new e;d.prototype.EraseTile=function(L,R){this.maybeResizeTilemap();this.setTileAt(L,R,-1)};d.prototype.SetTile=function(L,
R,F,g){this.maybeResizeTilemap();this.setTileAt(L,R,F&x|a(g))};d.prototype.SetTileState=function(L,R,F){var g=this.getTileAt(L,R);-1!==g&&(this.maybeResizeTilemap(),this.setTileAt(L,R,g&x|a(F)))};d.prototype.EraseTileRange=function(L,R,F,g){var l=Math.floor(cr.max(L,0)),u=Math.floor(cr.max(R,0));L=Math.floor(cr.min(L+F,this.mapwidth));R=Math.floor(cr.min(R+g,this.mapheight));for(g=u;g<R;++g)for(u=l;u<L;++u)this.setTileAt(u,g,-1)};d.prototype.SetTileRange=function(L,R,F,g,l,u){this.maybeResizeTilemap();
var c=Math.floor(cr.max(L,0)),y=Math.floor(cr.max(R,0));L=Math.floor(cr.min(L+F,this.mapwidth));R=Math.floor(cr.min(R+g,this.mapheight));l=l&x|a(u);for(u=y;u<R;++u)for(y=c;y<L;++y)this.setTileAt(y,u,l)};d.prototype.SetTileStateRange=function(L,R,F,g,l){this.maybeResizeTilemap();var u=Math.floor(cr.max(L,0)),c=Math.floor(cr.max(R,0));L=Math.floor(cr.min(L+F,this.mapwidth));R=Math.floor(cr.min(R+g,this.mapheight));l=a(l);for(g=c;g<R;++g)for(c=u;c<L;++c)F=this.getTileAt(c,g),-1!==F&&this.setTileAt(c,
g,F&x|l)};d.prototype.LoadFromJSON=function(L){try{var R=JSON.parse(L)}catch(F){return}R.c2tilemap&&(this.mapwidth=R.width,this.mapheight=R.height,this.maybeResizeTilemap(!0),this.setTilesFromRLECSV(R.data),this.setAllQuadMapChanged(),this.physics_changed=!0)};d.prototype.JSONDownload=function(L){var R=document.createElement("a"),F={c2tilemap:!0,width:this.mapwidth,height:this.mapheight,data:this.getTilesAsRLECSV()};if("undefined"===typeof R.download)L="data:text/html,"+encodeURIComponent("<p><a download='data.json' href=\"data:application/json,"+
encodeURIComponent(JSON.stringify(F))+'">Download link</a></p>'),window.open(L);else{var g=document.getElementsByTagName("body")[0];R.textContent=L;R.href="data:application/json,"+encodeURIComponent(JSON.stringify(F));R.download=L;g.appendChild(R);R.click();g.removeChild(R)}};d.prototype.LoadURL=function(L,R){var F=new Image,g=this;F.onload=function(){var l=g.type;l.freeCutTiles();l.texture_img=F;l.spriteX=0;l.spriteY=0;l.spriteWidth=F.width;l.spriteHeight=F.height;g.runtime.redraw=!0;g.runtime.trigger(cr.plugins_.Tilemap.prototype.cnds.OnURLLoaded,
g)};"data:"!==L.substr(0,5)&&0===R&&(F.crossOrigin="anonymous");this.runtime.setImageSrc(F,L)};r.acts=new d;h.prototype.TileAt=function(L,R,F){R=this.getTileAt(R,F);L.set_int(-1===R?-1:R&x)};h.prototype.PositionToTileX=function(L,R){L.set_float(this.worldToTileX(R))};h.prototype.PositionToTileY=function(L,R){L.set_float(this.worldToTileY(R))};h.prototype.TileToPositionX=function(L,R){L.set_float(R*this.tilewidth+this.x+this.tilewidth/2)};h.prototype.TileToPositionY=function(L,R){L.set_float(R*this.tileheight+
this.y+this.tileheight/2)};h.prototype.SnapX=function(L,R){L.set_float(Math.floor((R-this.x)/this.tilewidth)*this.tilewidth+this.x+this.tilewidth/2)};h.prototype.SnapY=function(L,R){L.set_float(Math.floor((R-this.y)/this.tileheight)*this.tileheight+this.y+this.tileheight/2)};h.prototype.TilesJSON=function(L){this.maybeResizeTilemap();var R=cr.floor(this.width/this.tilewidth),F=cr.floor(this.height/this.tileheight);L.set_string(JSON.stringify({c2tilemap:!0,width:R,height:F,data:this.getTilesAsRLECSV()}))};
r.exps=new h})();cr.behaviors.scrollto=function(b){this.runtime=b;this.shakeMode=this.shakeEnd=this.shakeStart=this.shakeMag=0};
(function(){function b(){}function f(){}var k=cr.behaviors.scrollto.prototype;k.Type=function(v,n){this.behavior=v;this.objtype=n;this.runtime=v.runtime};k.Type.prototype.onCreate=function(){};k.Instance=function(v,n){this.type=v;this.behavior=v.behavior;this.inst=n;this.runtime=v.runtime};var q=k.Instance.prototype;q.onCreate=function(){this.enabled=this.properties[0]};q.saveToJSON=function(){return{smg:this.behavior.shakeMag,ss:this.behavior.shakeStart,se:this.behavior.shakeEnd,smd:this.behavior.shakeMode}};
q.loadFromJSON=function(v){this.behavior.shakeMag=v.smg;this.behavior.shakeStart=v.ss;this.behavior.shakeEnd=v.se;this.behavior.shakeMode=v.smd};q.tick=function(){};q.tick2=function(){if(this.enabled){var v=this.behavior.my_instances.valuesRef(),n=0,e=0,a,d=0;var h=0;for(a=v.length;h<a;h++){a:{var r,w=v[h];var E=0;for(r=w.behavior_insts.length;E<r;++E){var t=w.behavior_insts[E];if(t.behavior instanceof cr.behaviors.scrollto)break a}t=null}t&&t.enabled&&(n+=v[h].x,e+=v[h].y,++d)}v=this.inst.layer.layout;
a=this.runtime.kahanTime.sum;t=h=0;a>=this.behavior.shakeStart&&a<this.behavior.shakeEnd&&(h=this.behavior.shakeMag*Math.min(this.runtime.timescale,1),0===this.behavior.shakeMode&&(h*=1-(a-this.behavior.shakeStart)/(this.behavior.shakeEnd-this.behavior.shakeStart)),a=Math.random()*Math.PI*2,t=Math.random()*h,h=Math.cos(a)*t,t*=Math.sin(a));v.scrollToX(n/d+h);v.scrollToY(e/d+t)}};b.prototype.IsEnabled=function(){return this.enabled};k.cnds=new b;f.prototype.Shake=function(v,n,e){this.behavior.shakeMag=
v;this.behavior.shakeStart=this.runtime.kahanTime.sum;this.behavior.shakeEnd=this.behavior.shakeStart+n;this.behavior.shakeMode=e};f.prototype.SetEnabled=function(v){this.enabled=0!==v};k.acts=new f})();var easeOutBounceArray=[],easeInElasticArray=[],easeOutElasticArray=[],easeInOutElasticArray=[],easeInCircle=[],easeOutCircle=[],easeInOutCircle=[],easeInBack=[],easeOutBack=[],easeInOutBack=[],litetween_precision=1E4,updateLimit=0;
function easeOutBouncefunc(b){return result=(b/=1)<1/2.75?7.5625*b*b:b<2/2.75?7.5625*(b-=1.5/2.75)*b+.75:b<2.5/2.75?7.5625*(b-=2.25/2.75)*b+.9375:7.5625*(b-=2.625/2.75)*b+.984375}function integerize(b,f){return Math.round(b/f*litetween_precision)}
function easeFunc(b,f,k,q,v,n,e){var a=0;switch(b){case 0:a=q*f/v+k;break;case 1:a=q*(f/=v)*f+k;break;case 2:a=-q*(f/=v)*(f-2)+k;break;case 3:a=1>(f/=v/2)?q/2*f*f+k:-q/2*(--f*(f-2)-1)+k;break;case 4:a=q*(f/=v)*f*f+k;break;case 5:a=q*((f=f/v-1)*f*f+1)+k;break;case 6:a=1>(f/=v/2)?q/2*f*f*f+k:q/2*((f-=2)*f*f+2)+k;break;case 7:a=q*(f/=v)*f*f*f+k;break;case 8:a=-q*((f=f/v-1)*f*f*f-1)+k;break;case 9:a=1>(f/=v/2)?q/2*f*f*f*f+k:-q/2*((f-=2)*f*f*f-2)+k;break;case 10:a=q*(f/=v)*f*f*f*f+k;break;case 11:a=q*
((f=f/v-1)*f*f*f*f+1)+k;break;case 12:a=1>(f/=v/2)?q/2*f*f*f*f*f+k:q/2*((f-=2)*f*f*f*f+2)+k;break;case 13:a=e.optimized?easeInCircle[integerize(f,v)]:-(Math.sqrt(1-f*f)-1);break;case 14:a=e.optimized?easeOutCircle[integerize(f,v)]:Math.sqrt(1-(f-1)*(f-1));break;case 15:a=e.optimized?easeInOutCircle[integerize(f,v)]:1>(f/=v/2)?-q/2*(Math.sqrt(1-f*f)-1)+k:q/2*(Math.sqrt(1-(f-=2)*f)+1)+k;break;case 16:e.optimized?a=easeInBack[integerize(f,v)]:(e=e.s,a=q*(f/=v)*f*((e+1)*f-e)+k);break;case 17:e.optimized?
a=easeOutBack[integerize(f,v)]:(e=e.s,a=q*((f=f/v-1)*f*((e+1)*f+e)+1)+k);break;case 18:e.optimized?a=easeInOutBack[integerize(f,v)]:(e=e.s,a=1>(f/=v/2)?q/2*f*f*(((e*=1.525)+1)*f-e)+k:q/2*((f-=2)*f*(((e*=1.525)+1)*f+e)+2)+k);break;case 19:e.optimized?a=easeInElasticArray[integerize(f,v)]:(a=e.a,b=e.p,f/=v,0==b&&(b=.3*v),0==a||a<Math.abs(q)?(a=q,e=b/4):e=b/(2*Math.PI)*Math.asin(q/a),a=-(a*Math.pow(2,10*--f)*Math.sin(2*(f*v-e)*Math.PI/b))+k);break;case 20:e.optimized?a=easeOutElasticArray[integerize(f,
v)]:(a=e.a,b=e.p,f/=v,0==b&&(b=.3*v),0==a||a<Math.abs(q)?(a=q,e=b/4):e=b/(2*Math.PI)*Math.asin(q/a),a=a*Math.pow(2,-10*f)*Math.sin(2*(f*v-e)*Math.PI/b)+q+k);break;case 21:e.optimized?a=easeInOutElasticArray[integerize(f,v)]:(a=e.a,b=e.p,f/=v/2,0==b&&(b=.3*v*1.5),0==a||a<Math.abs(q)?(a=q,e=b/4):e=b/(2*Math.PI)*Math.asin(q/a),a=1>f?-.5*a*Math.pow(2,10*--f)*Math.sin(2*(f*v-e)*Math.PI/b)+k:a*Math.pow(2,-10*--f)*Math.sin(2*(f*v-e)*Math.PI/b)*.5+q+k);break;case 22:a=e.optimized?q-easeOutBounceArray[integerize(v-
f,v)]+k:q-easeOutBouncefunc(v-f/v)+k;break;case 23:a=e.optimized?easeOutBounceArray[integerize(f,v)]:easeOutBouncefunc(f/v);break;case 24:a=e.optimized?f<v/2?.5*(q-easeOutBounceArray[integerize(v-2*f,v)]+k)+k:.5*easeOutBounceArray[integerize(2*f-v,v)]+.5*q+k:f<v/2?.5*(q-easeOutBouncefunc(v-2*f)+k)+k:.5*easeOutBouncefunc((2*f-v)/v)+.5*q+k;break;case 25:f=f/v/2;a=2*f*f*(3-2*f);break;case 26:f=(f/v+1)/2;a=2*f*f*(3-2*f)-1;break;case 27:f/=v,a=f*f*(3-2*f)}return n?q-k-a:a}
(function(){for(var b,f,k,q,v=0;v<=litetween_precision;v++)k=v/litetween_precision,b=(k/=1)<1/2.75?7.5625*k*k:k<2/2.75?7.5625*(k-=1.5/2.75)*k+.75:k<2.5/2.75?7.5625*(k-=2.25/2.75)*k+.9375:7.5625*(k-=2.625/2.75)*k+.984375,easeOutBounceArray[v]=b,k=v/litetween_precision,f=b=0,k/=1,0==f&&(f=.3),0==b||1>b?(b=1,q=f/4):q=f/(2*Math.PI)*Math.asin(1/b),b=-(b*Math.pow(2,10*--k)*Math.sin(2*(1*k-q)*Math.PI/f)),easeInElasticArray[v]=b,k=v/litetween_precision,f=b=0,k/=1,0==f&&(f=.3),0==b||1>b?(b=1,q=f/4):q=f/(2*
Math.PI)*Math.asin(1/b),b=b*Math.pow(2,-10*k)*Math.sin(2*(1*k-q)*Math.PI/f)+1,easeOutElasticArray[v]=b,k=v/litetween_precision,f=b=0,k/=.5,0==f&&(f=.3*1.5),0==b||1>b?(b=1,q=f/4):q=f/(2*Math.PI)*Math.asin(1/b),b=1>k?-.5*b*Math.pow(2,10*--k)*Math.sin(2*(1*k-q)*Math.PI/f):b*Math.pow(2,-10*--k)*Math.sin(2*(1*k-q)*Math.PI/f)*.5+1,easeInOutElasticArray[v]=b,k=v/litetween_precision,easeInCircle[v]=-(Math.sqrt(1-k*k)-1),k=v/litetween_precision,easeOutCircle[v]=Math.sqrt(1-(k-1)*(k-1)),k=v/litetween_precision,
b=1>(k/=.5)?-.5*(Math.sqrt(1-k*k)-1):.5*(Math.sqrt(1-(k-=2)*k)+1),easeInOutCircle[v]=b,k=v/litetween_precision,q=0,0==q&&(q=1.70158),b=(k/=1)*k*((q+1)*k-q),easeInBack[v]=b,k=v/litetween_precision,q=0,0==q&&(q=1.70158),b=(k=k/1-1)*k*((q+1)*k+q)+1,easeOutBack[v]=b,k=v/litetween_precision,q=0,0==q&&(q=1.70158),b=1>(k/=.5)?.5*k*k*(((q*=1.525)+1)*k-q):.5*((k-=2)*k*(((q*=1.525)+1)*k+q)+2),easeInOutBack[v]=b})();
var TweenObject=function(){return function(b,f,k,q,v,n,e){this.name=b;this.value=0;this.setInitial(q);this.setTarget(v);this.easefunc=k;this.tweened=f;this.duration=n;this.state=this.progress=0;this.onReverseEnd=this.onReverseStart=this.onEnd=this.onStart=!1;this.lastKnownValue2=this.lastKnownValue=0;this.enforce=e;this.pingpong=1;this.flipEase=!1;this.easingparam=[];this.lastState=1;for(b=0;28>b;b++)this.easingparam[b]={},this.easingparam[b].a=0,this.easingparam[b].p=0,this.easingparam[b].t=0,this.easingparam[b].s=
0,this.easingparam[b].optimized=!0}}();
(function(){TweenObject.prototype={};TweenObject.prototype.flipTarget=function(){var b=this.initialparam1,f=this.initialparam2;this.initialparam1=this.targetparam1;this.initialparam2=this.targetparam2;this.targetparam1=b;this.targetparam2=f;this.lastKnownValue2=this.lastKnownValue=0};TweenObject.prototype.setInitial=function(b){this.initialparam1=parseFloat(b.split(",")[0]);this.initialparam2=parseFloat(b.split(",")[1]);this.lastKnownValue2=this.lastKnownValue=0};TweenObject.prototype.setTarget=function(b){this.targetparam1=
parseFloat(b.split(",")[0]);this.targetparam2=parseFloat(b.split(",")[1]);isNaN(this.targetparam2)&&(this.targetparam2=this.targetparam1)};TweenObject.prototype.OnTick=function(b){if(0===this.state)return-1;1===this.state&&(this.progress+=b);2===this.state&&(this.progress-=b);3===this.state&&(this.state=0);if(4===this.state||6===this.state)this.progress+=b*this.pingpong;5===this.state&&(this.progress+=b*this.pingpong);return 0>this.progress?(this.progress=0,4===this.state?this.pingpong=1:6===this.state?
(this.pingpong=1,this.flipEase=!1):this.state=0,this.onReverseEnd=!0,0):this.progress>this.duration?(this.progress=this.duration,4===this.state?this.pingpong=-1:6===this.state?(this.pingpong=-1,this.flipEase=!0):5===this.state?this.progress=0:this.state=0,this.onEnd=!0,1):this.flipEase?easeFunc(this.easefunc,this.duration-this.progress,0,1,this.duration,this.flipEase,this.easingparam[this.easefunc]):easeFunc(this.easefunc,this.progress,0,1,this.duration,this.flipEase,this.easingparam[this.easefunc])}})();
function trim(b){return b.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}cr.behaviors.lunarray_LiteTween=function(b){this.runtime=b};
(function(){var b=cr.behaviors.lunarray_LiteTween.prototype;b.Type=function(k,q){this.behavior=k;this.objtype=q;this.runtime=k.runtime};b.Type.prototype.onCreate=function(){};b.Instance=function(k,q){this.type=k;this.behavior=k.behavior;this.inst=q;this.runtime=k.runtime;this.i=0};var f=b.Instance.prototype;f.onCreate=function(){this.playmode=this.properties[0];this.active=1==this.playmode||2==this.playmode||3==this.playmode||4==this.playmode;this.tweened=this.properties[1];this.easing=this.properties[2];
this.target=this.properties[3];this.targetmode=this.properties[4];this.useCurrent=!1;1===this.targetmode&&(this.target="relative("+this.target+")");this.duration=this.properties[5];this.enforce=1===this.properties[6];this.value=0;this.tween_list={};this.addToTweenList("default",this.tweened,this.easing,"current",this.target,this.duration,this.enforce);1===this.properties[0]&&this.startTween(0);2===this.properties[0]&&this.startTween(2);3===this.properties[0]&&this.startTween(3);4===this.properties[0]&&
this.startTween(4)};f.parseCurrent=function(k,q){void 0===q&&(q="current");var v=trim(q);q=trim(q);var n=this.value;if("current"===q)switch(k){case 0:v=this.inst.x+","+this.inst.y;break;case 1:v=this.inst.width+","+this.inst.height;break;case 2:v=this.inst.width+","+this.inst.height;break;case 3:v=this.inst.width+","+this.inst.height;break;case 4:v=cr.to_degrees(this.inst.angle)+","+cr.to_degrees(this.inst.angle);break;case 5:v=100*this.inst.opacity+","+100*this.inst.opacity;break;case 6:v=n+","+
n;break;case 7:v=this.inst.x+","+this.inst.y;break;case 8:v=this.inst.x+","+this.inst.y;break;case 9:v=void 0!==this.inst.curFrame?this.inst.width/this.inst.curFrame.width+","+this.inst.height/this.inst.curFrame.height:"1,1"}if("relative"===q.substring(0,8)){if(q=q.match(/\((.*?)\)/))var e=parseFloat(q[1].split(",")[0]),a=parseFloat(q[1].split(",")[1]);isNaN(e)&&(e=0);isNaN(a)&&(a=0);switch(k){case 0:v=this.inst.x+e+","+(this.inst.y+a);break;case 1:v=this.inst.width+e+","+(this.inst.height+a);break;
case 2:v=this.inst.width+e+","+(this.inst.height+a);break;case 3:v=this.inst.width+e+","+(this.inst.height+a);break;case 4:v=cr.to_degrees(this.inst.angle)+e+","+(cr.to_degrees(this.inst.angle)+a);break;case 5:v=100*this.inst.opacity+e+","+(100*this.inst.opacity+a);break;case 6:v=n+e+","+n+e;break;case 7:v=this.inst.x+e+","+this.inst.y;break;case 8:v=this.inst.x+","+(this.inst.y+e);break;case 9:v=e+","+a}}return v};f.addToTweenList=function(k,q,v,n,e,a,d){n=this.parseCurrent(q,n);e=this.parseCurrent(q,
e);void 0!==this.tween_list[k]&&delete this.tween_list[k];this.tween_list[k]=new TweenObject(k,q,v,n,e,a,d);this.tween_list[k].dt=0};f.saveToJSON=function(){JSON.stringify(this.tween_list["default"]);return{playmode:this.playmode,active:this.active,tweened:this.tweened,easing:this.easing,target:this.target,targetmode:this.targetmode,useCurrent:this.useCurrent,duration:this.duration,enforce:this.enforce,value:this.value,tweenlist:JSON.stringify(this.tween_list["default"])}};TweenObject.Load=function(k,
q,v,n,e,a,d,h){q=new TweenObject(q,v,n,e,a,d,h);for(var r in k)q[r]=k[r];return q};f.loadFromJSON=function(k){var q=JSON.parse(k.tweenlist);q=TweenObject.Load(q,q.name,q.tweened,q.easefunc,q.initialparam1+","+q.initialparam2,q.targetparam1+","+q.targetparam2,q.duration,q.enforce);this.tween_list["default"]=q;this.playmode=k.playmode;this.active=k.active;this.movement=k.tweened;this.easing=k.easing;this.target=k.target;this.targetmode=k.targetmode;this.useCurrent=k.useCurrent;this.duration=k.duration;
this.enforce=k.enforce;this.value=k.value};f.setProgressTo=function(k){1<k&&(k=1);0>k&&(k=0);for(var q in this.tween_list){var v=this.tween_list[q];v.lastKnownValue=0;v.lastKnownValue2=0;v.state=3;v.progress=k*v.duration;var n=v.OnTick(0);this.updateTween(v,n)}};f.startTween=function(k){for(var q in this.tween_list){var v=this.tween_list[q];if(this.useCurrent){var n=this.parseCurrent(v.tweened,"current"),e=this.parseCurrent(v.tweened,this.target);v.setInitial(n);v.setTarget(e)}0===k&&(v.progress=
1E-6,v.lastKnownValue=0,v.lastKnownValue2=0,v.onStart=!0,v.state=1);1===k&&(v.state=v.lastState);if(2===k||4===k)v.progress=1E-6,v.lastKnownValue=0,v.lastKnownValue2=0,v.onStart=!0,2==k&&(v.state=4),4==k&&(v.state=6);3===k&&(v.progress=1E-6,v.lastKnownValue=0,v.lastKnownValue2=0,v.onStart=!0,v.state=5)}};f.stopTween=function(k){for(var q in this.tween_list){var v=this.tween_list[q];3!=v.state&&0!=v.state&&(v.lastState=v.state);1===k&&(v.progress=0);2===k&&(v.progress=v.duration);v.state=3;var n=v.OnTick(0);
this.updateTween(v,n)}};f.reverseTween=function(k){for(var q in this.tween_list){var v=this.tween_list[q];1===k&&(v.progress=v.duration,v.lastKnownValue=0,v.lastKnownValue2=0,v.onReverseStart=!0);v.state=2}};f.updateTween=function(k,q){if(0===k.tweened)k.enforce?(this.inst.x=k.initialparam1+(k.targetparam1-k.initialparam1)*q,this.inst.y=k.initialparam2+(k.targetparam2-k.initialparam2)*q):(this.inst.x+=(k.targetparam1-k.initialparam1)*q-k.lastKnownValue,this.inst.y+=(k.targetparam2-k.initialparam2)*
q-k.lastKnownValue2,k.lastKnownValue=(k.targetparam1-k.initialparam1)*q,k.lastKnownValue2=(k.targetparam2-k.initialparam2)*q);else if(1===k.tweened)k.enforce?(this.inst.width=k.initialparam1+(k.targetparam1-k.initialparam1)*q,this.inst.height=k.initialparam2+(k.targetparam2-k.initialparam2)*q):(this.inst.width+=(k.targetparam1-k.initialparam1)*q-k.lastKnownValue,this.inst.height+=(k.targetparam2-k.initialparam2)*q-k.lastKnownValue2,k.lastKnownValue=(k.targetparam1-k.initialparam1)*q,k.lastKnownValue2=
(k.targetparam2-k.initialparam2)*q);else if(2===k.tweened)k.enforce?this.inst.width=k.initialparam1+(k.targetparam1-k.initialparam1)*q:(this.inst.width+=(k.targetparam1-k.initialparam1)*q-k.lastKnownValue,k.lastKnownValue=(k.targetparam1-k.initialparam1)*q);else if(3===k.tweened)k.enforce?this.inst.height=k.initialparam2+(k.targetparam2-k.initialparam2)*q:(this.inst.height+=(k.targetparam2-k.initialparam2)*q-k.lastKnownValue2,k.lastKnownValue2=(k.targetparam2-k.initialparam2)*q);else if(4===k.tweened)if(k.enforce){var v=
k.initialparam1+(k.targetparam1-k.initialparam1)*q;this.inst.angle=cr.clamp_angle(cr.to_radians(v))}else v=(k.targetparam1-k.initialparam1)*q-k.lastKnownValue,this.inst.angle=cr.clamp_angle(this.inst.angle+cr.to_radians(v)),k.lastKnownValue=(k.targetparam1-k.initialparam1)*q;else if(5===k.tweened)k.enforce?this.inst.opacity=(k.initialparam1+(k.targetparam1-k.initialparam1)*q)/100:(this.inst.opacity+=((k.targetparam1-k.initialparam1)*q-k.lastKnownValue)/100,k.lastKnownValue=(k.targetparam1-k.initialparam1)*
q);else if(6===k.tweened)k.enforce?this.value=k.initialparam1+(k.targetparam1-k.initialparam1)*q:(this.value+=(k.targetparam1-k.initialparam1)*q-k.lastKnownValue,k.lastKnownValue=(k.targetparam1-k.initialparam1)*q);else if(7===k.tweened)k.enforce?this.inst.x=k.initialparam1+(k.targetparam1-k.initialparam1)*q:(this.inst.x+=(k.targetparam1-k.initialparam1)*q-k.lastKnownValue,k.lastKnownValue=(k.targetparam1-k.initialparam1)*q);else if(8===k.tweened)k.enforce?this.inst.y=k.initialparam2+(k.targetparam2-
k.initialparam2)*q:(this.inst.y+=(k.targetparam2-k.initialparam2)*q-k.lastKnownValue2,k.lastKnownValue2=(k.targetparam2-k.initialparam2)*q);else if(9===k.tweened){v=k.initialparam1+(k.targetparam1-k.initialparam1)*q;var n=k.initialparam2+(k.targetparam2-k.initialparam2)*q;0>this.inst.width&&(v=k.initialparam1+(k.targetparam1+k.initialparam1)*-q);0>this.inst.height&&(n=k.initialparam2+(k.targetparam2+k.initialparam2)*-q);k.enforce?(this.inst.width=this.inst.curFrame.width*v,this.inst.height=this.inst.curFrame.height*
n):(0>this.inst.width?(this.inst.width=this.inst.width/(-1+k.lastKnownValue)*v,k.lastKnownValue=v+1):(this.inst.width=this.inst.width/(1+k.lastKnownValue)*v,k.lastKnownValue=v-1),0>this.inst.height?(this.inst.height=this.inst.height/(-1+k.lastKnownValue2)*n,k.lastKnownValue2=n+1):(this.inst.height=this.inst.height/(1+k.lastKnownValue2)*n,k.lastKnownValue2=n-1))}this.inst.set_bbox_changed()};f.tick=function(){var k=this.runtime.getDt(this.inst),q=this.tween_list["default"];0!==q.state&&(q.onStart&&
(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnStart,this.inst),q.onStart=!1),q.onReverseStart&&(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnReverseStart,this.inst),q.onReverseStart=!1),this.active=1==q.state||2==q.state||4==q.state||5==q.state||6==q.state,k=q.OnTick(k),this.updateTween(q,k),q.onEnd&&(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnEnd,this.inst),q.onEnd=!1),q.onReverseEnd&&(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnReverseEnd,
this.inst),q.onReverseEnd=!1))};b.cnds={};f=b.cnds;f.IsActive=function(){return 0!==this.tween_list["default"].state};f.IsReversing=function(){return 2==this.tween_list["default"].state};f.CompareProgress=function(k,q){var v=this.tween_list["default"];return cr.do_cmp(v.progress/v.duration,k,q)};f.OnThreshold=function(k,q){var v=this.tween_list["default"];this.threshold=cr.do_cmp(v.progress/v.duration,k,q);if(k=this.oldthreshold!=this.threshold&&this.threshold)this.oldthreshold=this.threshold;return k};
f.OnStart=function(){return void 0===this.tween_list["default"]?!1:this.tween_list["default"].onStart};f.OnReverseStart=function(){return void 0===this.tween_list["default"]?!1:this.tween_list["default"].onReverseStart};f.OnEnd=function(){return void 0===this.tween_list["default"]?!1:this.tween_list["default"].onEnd};f.OnReverseEnd=function(){return void 0===this.tween_list["default"]?!1:this.tween_list["default"].onReverseEnd};b.acts={};f=b.acts;f.Start=function(k,q){this.oldthreshold=this.threshold=
!1;this.useCurrent=1==q;this.startTween(k)};f.Stop=function(k){this.stopTween(k)};f.Reverse=function(k){this.oldthreshold=this.threshold=!1;this.reverseTween(k)};f.ProgressTo=function(k){this.setProgressTo(k)};f.SetDuration=function(k){isNaN(k)||0>k||void 0===this.tween_list["default"]||(this.tween_list["default"].duration=k)};f.SetEnforce=function(k){void 0!==this.tween_list["default"]&&(this.tween_list["default"].enforce=1===k)};f.SetInitial=function(k){void 0!==this.tween_list["default"]&&(k=this.parseCurrent(this.tween_list["default"].tweened,
k),this.tween_list["default"].setInitial(k))};f.SetTarget=function(k,q,v){if(void 0!==this.tween_list["default"]&&!isNaN(v)){var n=this.tween_list["default"],e=v+"";this.targetmode=q;var a="",d="";if(1===q){this.target="relative("+e+")";switch(k){case 0:a=this.inst.x+v;d=n.targetparam2;break;case 1:a=n.targetparam1;d=this.inst.y+v;break;case 2:d=a=""+cr.to_degrees(this.inst.angle+cr.to_radians(v));break;case 3:d=a=""+100*this.inst.opacity+v;break;case 4:a=this.inst.width+v;d=n.targetparam2;break;
case 5:a=n.targetparam1;d=this.inst.height+v;break;case 6:d=a=v}e=a+","+d}else{switch(k){case 0:a=v;d=n.targetparam2;break;case 1:a=n.targetparam1;d=v;break;case 2:d=a=v;break;case 3:d=a=v;break;case 4:a=v;d=n.targetparam2;break;case 5:a=n.targetparam1;d=v;break;case 6:d=a=v}this.target=e=a+","+d}k=this.parseCurrent(this.tween_list["default"].tweened,"current");e=this.parseCurrent(this.tween_list["default"].tweened,e);n.setInitial(k);n.setTarget(e)}};f.SetTweenedProperty=function(k){void 0!==this.tween_list["default"]&&
(this.tween_list["default"].tweened=k)};f.SetEasing=function(k){void 0!==this.tween_list["default"]&&(this.tween_list["default"].easefunc=k)};f.SetEasingParam=function(k,q,v,n,e){void 0!==this.tween_list["default"]&&(this.tween_list["default"].easingparam[k].optimized=!1,this.tween_list["default"].easingparam[k].a=q,this.tween_list["default"].easingparam[k].p=v,this.tween_list["default"].easingparam[k].t=n,this.tween_list["default"].easingparam[k].s=e)};f.ResetEasingParam=function(){void 0!==this.tween_list["default"]&&
(this.tween_list["default"].optimized=!0)};f.SetValue=function(k){var q=this.tween_list["default"];this.value=k;6===q.tweened&&q.setInitial(this.parseCurrent(q.tweened,"current"))};f.SetParameter=function(k,q,v,n,e){if(void 0===this.tween_list["default"])this.addToTweenList("default",k,q,initial,v,n,e,0);else{var a=this.tween_list["default"];a.tweened=k;a.easefunc=q;a.setInitial(this.parseCurrent(k,"current"));a.setTarget(this.parseCurrent(k,v));a.duration=n;a.enforce=1===e}};b.exps={};b=b.exps;b.State=
function(k){var q="N/A";switch(this.tween_list["default"].state){case 0:q="paused";break;case 1:q="playing";break;case 2:q="reversing";break;case 3:q="seeking"}k.set_string(q)};b.Progress=function(k){k.set_float(this.tween_list["default"].progress/this.tween_list["default"].duration)};b.Duration=function(k){k.set_float(this.tween_list["default"].duration)};b.Target=function(k){var q=this.tween_list["default"],v="N/A";switch(q.tweened){case 0:v=q.targetparam1;break;case 1:v=q.targetparam2;break;case 2:v=
q.targetparam1;break;case 3:v=q.targetparam1;break;case 4:v=q.targetparam1;break;case 5:v=q.targetparam2;break;case 6:v=q.targetparam1}k.set_float(v)};b.Value=function(k){k.set_float(this.value)};b.Tween=function(k,q,v,n,e){n=1<n?1:n;e=easeFunc(e,0>n?0:n,0,1,1,!1,!1);k.set_float(q+e*(v-q))}})();cr.behaviors.Persist=function(b){this.runtime=b};
(function(){var b=cr.behaviors.Persist.prototype;b.Type=function(k,q){this.behavior=k;this.objtype=q;this.runtime=k.runtime};b.Type.prototype.onCreate=function(){};b.Instance=function(k,q){this.type=k;this.behavior=k.behavior;this.inst=q;this.runtime=k.runtime};var f=b.Instance.prototype;f.onCreate=function(){this.myProperty=this.properties[0]};f.onDestroy=function(){};f.tick=function(){this.runtime.getDt(this.inst)};b.cnds=new function(){};b.acts=new function(){};b.exps=new function(){}})();
cr.behaviors.Pin=function(b){this.runtime=b};
(function(){function b(){}function f(){}function k(){}var q=cr.behaviors.Pin.prototype;q.Type=function(n,e){this.behavior=n;this.objtype=e;this.runtime=n.runtime};q.Type.prototype.onCreate=function(){};q.Instance=function(n,e){this.type=n;this.behavior=n.behavior;this.inst=e;this.runtime=n.runtime};var v=q.Instance.prototype;v.onCreate=function(){this.pinObject=null;this.pinObjectUid=-1;this.mode=this.lastKnownAngle=this.theirStartAngle=this.myStartAngle=this.pinDist=this.pinAngle=0;var n=this;this.recycled||
(this.myDestroyCallback=function(e){n.onInstanceDestroyed(e)});this.runtime.addDestroyCallback(this.myDestroyCallback)};v.saveToJSON=function(){return{uid:this.pinObject?this.pinObject.uid:-1,pa:this.pinAngle,pd:this.pinDist,msa:this.myStartAngle,tsa:this.theirStartAngle,lka:this.lastKnownAngle,m:this.mode}};v.loadFromJSON=function(n){this.pinObjectUid=n.uid;this.pinAngle=n.pa;this.pinDist=n.pd;this.myStartAngle=n.msa;this.theirStartAngle=n.tsa;this.lastKnownAngle=n.lka;this.mode=n.m};v.afterLoad=
function(){this.pinObject=-1===this.pinObjectUid?null:this.runtime.getObjectByUID(this.pinObjectUid);this.pinObjectUid=-1};v.onInstanceDestroyed=function(n){this.pinObject==n&&(this.pinObject=null)};v.onDestroy=function(){this.pinObject=null;this.runtime.removeDestroyCallback(this.myDestroyCallback)};v.tick=function(){};v.tick2=function(){if(this.pinObject){this.lastKnownAngle!==this.inst.angle&&(this.myStartAngle=cr.clamp_angle(this.myStartAngle+(this.inst.angle-this.lastKnownAngle)));var n=this.inst.x,
e=this.inst.y;if(3===this.mode||4===this.mode){var a=cr.distanceTo(this.inst.x,this.inst.y,this.pinObject.x,this.pinObject.y);if(a>this.pinDist||4===this.mode&&a<this.pinDist)e=cr.angleTo(this.pinObject.x,this.pinObject.y,this.inst.x,this.inst.y),n=this.pinObject.x+Math.cos(e)*this.pinDist,e=this.pinObject.y+Math.sin(e)*this.pinDist}else n=this.pinObject.x+Math.cos(this.pinObject.angle+this.pinAngle)*this.pinDist,e=this.pinObject.y+Math.sin(this.pinObject.angle+this.pinAngle)*this.pinDist;this.lastKnownAngle=
a=cr.clamp_angle(this.myStartAngle+(this.pinObject.angle-this.theirStartAngle));0!==this.mode&&1!==this.mode&&3!==this.mode&&4!==this.mode||this.inst.x===n&&this.inst.y===e||(this.inst.x=n,this.inst.y=e,this.inst.set_bbox_changed());0!==this.mode&&2!==this.mode||this.inst.angle===a||(this.inst.angle=a,this.inst.set_bbox_changed())}};b.prototype.IsPinned=function(){return!!this.pinObject};q.cnds=new b;f.prototype.Pin=function(n,e){n&&(n=n.getFirstPicked(this.inst))&&(this.pinObject=n,this.pinAngle=
cr.angleTo(n.x,n.y,this.inst.x,this.inst.y)-n.angle,this.pinDist=cr.distanceTo(n.x,n.y,this.inst.x,this.inst.y),this.lastKnownAngle=this.myStartAngle=this.inst.angle,this.theirStartAngle=n.angle,this.mode=e)};f.prototype.Unpin=function(){this.pinObject=null};q.acts=new f;k.prototype.PinnedUID=function(n){n.set_int(this.pinObject?this.pinObject.uid:-1)};q.exps=new k})();cr.behaviors.EightDir=function(b){this.runtime=b};
(function(){function b(){}function f(){}function k(){}var q=cr.behaviors.EightDir.prototype;q.Type=function(n,e){this.behavior=n;this.objtype=e;this.runtime=n.runtime};q.Type.prototype.onCreate=function(){};q.Instance=function(n,e){this.type=n;this.behavior=n.behavior;this.inst=e;this.runtime=n.runtime;this.simright=this.simleft=this.simdown=this.simup=this.ignoreInput=this.rightkey=this.leftkey=this.downkey=this.upkey=!1;this.lastrighttick=this.lastlefttick=this.lastdowntick=this.lastuptick=-1;this.dy=
this.dx=0};var v=q.Instance.prototype;v.onCreate=function(){this.maxspeed=this.properties[0];this.acc=this.properties[1];this.dec=this.properties[2];this.directions=this.properties[3];this.angleMode=this.properties[4];this.defaultControls=this.properties[5];this.enabled=this.properties[6];var n=this;this.defaultControls&&(document.addEventListener("keydown",function(e){n.onKeyDown(e)}),document.addEventListener("keyup",function(e){n.onKeyUp(e)}))};v.saveToJSON=function(){return{dx:this.dx,dy:this.dy,
enabled:this.enabled,maxspeed:this.maxspeed,acc:this.acc,dec:this.dec,ignoreInput:this.ignoreInput}};v.loadFromJSON=function(n){this.dx=n.dx;this.dy=n.dy;this.enabled=n.enabled;this.maxspeed=n.maxspeed;this.acc=n.acc;this.dec=n.dec;this.ignoreInput=n.ignoreInput;this.simright=this.simleft=this.simdown=this.simup=this.rightkey=this.leftkey=this.downkey=this.upkey=!1;this.lastrighttick=this.lastlefttick=this.lastdowntick=this.lastuptick=-1};v.onKeyDown=function(n){var e=this.runtime.tickcount;switch(n.which){case 37:n.preventDefault();
this.lastlefttick<e&&(this.leftkey=!0);break;case 38:n.preventDefault();this.lastuptick<e&&(this.upkey=!0);break;case 39:n.preventDefault();this.lastrighttick<e&&(this.rightkey=!0);break;case 40:n.preventDefault(),this.lastdowntick<e&&(this.downkey=!0)}};v.onKeyUp=function(n){var e=this.runtime.tickcount;switch(n.which){case 37:n.preventDefault();this.leftkey=!1;this.lastlefttick=e;break;case 38:n.preventDefault();this.upkey=!1;this.lastuptick=e;break;case 39:n.preventDefault();this.rightkey=!1;this.lastrighttick=
e;break;case 40:n.preventDefault(),this.downkey=!1,this.lastdowntick=e}};v.onWindowBlur=function(){this.rightkey=this.leftkey=this.downkey=this.upkey=!1};v.tick=function(){var n=this.runtime.getDt(this.inst),e=this.leftkey||this.simleft,a=this.rightkey||this.simright,d=this.upkey||this.simup,h=this.downkey||this.simdown;this.simdown=this.simup=this.simright=this.simleft=!1;if(this.enabled){var r=this.runtime.testOverlapSolid(this.inst);if(r&&(this.runtime.registerCollision(this.inst,r),!this.runtime.pushOutSolidNearest(this.inst)))return;
this.ignoreInput&&(h=d=a=e=!1);0===this.directions?a=e=!1:1===this.directions&&(h=d=!1);2===this.directions&&(d||h)&&(a=e=!1);e==a&&(0>this.dx?(this.dx+=this.dec*n,0<this.dx&&(this.dx=0)):0<this.dx&&(this.dx-=this.dec*n,0>this.dx&&(this.dx=0)));d==h&&(0>this.dy?(this.dy+=this.dec*n,0<this.dy&&(this.dy=0)):0<this.dy&&(this.dy-=this.dec*n,0>this.dy&&(this.dy=0)));var w=r=0;e&&!a&&(r=0<this.dx?-(this.acc+this.dec):-this.acc);a&&!e&&(r=0>this.dx?this.acc+this.dec:this.acc);d&&!h&&(w=0<this.dy?-(this.acc+
this.dec):-this.acc);h&&!d&&(w=0>this.dy?this.acc+this.dec:this.acc);this.dx+=r*n;this.dy+=w*n;if(0!==this.dx||0!==this.dy){e=Math.atan2(this.dy,this.dx);a=this.maxspeed*Math.cos(e);d=this.maxspeed*Math.sin(e);Math.sqrt(this.dx*this.dx+this.dy*this.dy)>this.maxspeed&&(this.dx=a,this.dy=d);a=Math.abs(a);d=Math.abs(d);h=this.inst.x;var E=this.inst.y;e=this.inst.angle;this.inst.x+=this.runtime.accelerate(this.dx,-a,a,r,n);this.inst.set_bbox_changed();if(r=this.runtime.testOverlapSolid(this.inst))this.runtime.pushOutSolid(this.inst,
0>this.dx?1:-1,0,Math.abs(Math.floor(this.dx*n)))||(this.inst.x=h,this.inst.set_bbox_changed()),this.dx=0,this.runtime.registerCollision(this.inst,r);this.inst.y+=this.runtime.accelerate(this.dy,-d,d,w,n);this.inst.set_bbox_changed();if(r=this.runtime.testOverlapSolid(this.inst))this.runtime.pushOutSolid(this.inst,0,0>this.dy?1:-1,Math.abs(Math.floor(this.dy*n)))||(this.inst.y=E,this.inst.set_bbox_changed()),this.dy=0,this.runtime.registerCollision(this.inst,r);n=cr.round6dp(this.dx);w=cr.round6dp(this.dy);
0===n&&0===w||!this.inst.type.plugin.is_rotatable||(1===this.angleMode?this.inst.angle=cr.to_clamped_radians(90*Math.round(cr.to_degrees(Math.atan2(w,n))/90)):2===this.angleMode?this.inst.angle=cr.to_clamped_radians(45*Math.round(cr.to_degrees(Math.atan2(w,n))/45)):3===this.angleMode&&(this.inst.angle=Math.atan2(w,n)));this.inst.set_bbox_changed();this.inst.angle!=e&&(r=this.runtime.testOverlapSolid(this.inst))&&(this.inst.angle=e,this.inst.set_bbox_changed(),this.runtime.registerCollision(this.inst,
r))}}};b.prototype.IsMoving=function(){return 1E-10<Math.sqrt(this.dx*this.dx+this.dy*this.dy)};b.prototype.CompareSpeed=function(n,e){return cr.do_cmp(Math.sqrt(this.dx*this.dx+this.dy*this.dy),n,e)};b.prototype.IsEnabled=function(){return this.enabled};q.cnds=new b;f.prototype.Stop=function(){this.dy=this.dx=0};f.prototype.Reverse=function(){this.dx*=-1;this.dy*=-1};f.prototype.SetIgnoreInput=function(n){this.ignoreInput=n};f.prototype.SetSpeed=function(n){0>n&&(n=0);n>this.maxspeed&&(n=this.maxspeed);
var e=Math.atan2(this.dy,this.dx);this.dx=n*Math.cos(e);this.dy=n*Math.sin(e)};f.prototype.SetMaxSpeed=function(n){this.maxspeed=n;0>this.maxspeed&&(this.maxspeed=0)};f.prototype.SetAcceleration=function(n){this.acc=n;0>this.acc&&(this.acc=0)};f.prototype.SetDeceleration=function(n){this.dec=n;0>this.dec&&(this.dec=0)};f.prototype.SimulateControl=function(n){switch(n){case 0:this.simleft=!0;break;case 1:this.simright=!0;break;case 2:this.simup=!0;break;case 3:this.simdown=!0}};f.prototype.SetEnabled=
function(n){this.enabled=1===n};f.prototype.SetVectorX=function(n){this.dx=n};f.prototype.SetVectorY=function(n){this.dy=n};q.acts=new f;k.prototype.Speed=function(n){n.set_float(Math.sqrt(this.dx*this.dx+this.dy*this.dy))};k.prototype.MaxSpeed=function(n){n.set_float(this.maxspeed)};k.prototype.Acceleration=function(n){n.set_float(this.acc)};k.prototype.Deceleration=function(n){n.set_float(this.dec)};k.prototype.MovingAngle=function(n){n.set_float(cr.to_degrees(Math.atan2(this.dy,this.dx)))};k.prototype.VectorX=
function(n){n.set_float(this.dx)};k.prototype.VectorY=function(n){n.set_float(this.dy)};q.exps=new k})();cr.behaviors.Sin=function(b){this.runtime=b};
(function(){function b(){}function f(){}function k(){}var q=cr.behaviors.Sin.prototype;q.Type=function(h,r){this.behavior=h;this.objtype=r;this.runtime=h.runtime};q.Type.prototype.onCreate=function(){};q.Instance=function(h,r){this.type=h;this.behavior=h.behavior;this.inst=r;this.runtime=h.runtime;this.i=0};var v=q.Instance.prototype,n=2*Math.PI,e=Math.PI/2,a=3*Math.PI/2,d=[0,1,8,3,4,2,5,6,7];v.onCreate=function(){this.movement=d[this.properties[0]];this.wave=this.properties[1];this.period=this.properties[2];
this.period+=Math.random()*this.properties[3];0===this.period?this.i=0:(this.i=this.properties[4]/this.period*n,this.i+=Math.random()*this.properties[5]/this.period*n);this.mag=this.properties[6];this.mag+=Math.random()*this.properties[7];this.isEnabled=this.properties[8];this.ratio=this.initialValue2=this.initialValue=0;5===this.movement&&(this.mag=cr.to_radians(this.mag));this.init()};v.saveToJSON=function(){return{i:this.i,a:this.isEnabled,mv:this.movement,w:this.wave,p:this.period,mag:this.mag,
iv:this.initialValue,iv2:this.initialValue2,r:this.ratio,lkv:this.lastKnownValue,lkv2:this.lastKnownValue2}};v.loadFromJSON=function(h){this.i=h.i;this.isEnabled=h.a;this.movement=h.mv;this.wave=h.w;this.period=h.p;this.mag=h.mag;this.initialValue=h.iv;this.initialValue2=h.iv2||0;this.ratio=h.r;this.lastKnownValue=h.lkv;this.lastKnownValue2=h.lkv2||0};v.init=function(){switch(this.movement){case 0:this.initialValue=this.inst.x;break;case 1:this.initialValue=this.inst.y;break;case 2:this.initialValue=
this.inst.width;this.ratio=this.inst.height/this.inst.width;break;case 3:this.initialValue=this.inst.width;break;case 4:this.initialValue=this.inst.height;break;case 5:this.initialValue=this.inst.angle;break;case 6:this.initialValue=this.inst.opacity;break;case 7:this.initialValue=0;break;case 8:this.initialValue=this.inst.x,this.initialValue2=this.inst.y}this.lastKnownValue=this.initialValue;this.lastKnownValue2=this.initialValue2};v.waveFunc=function(h){h%=n;switch(this.wave){case 0:return Math.sin(h);
case 1:return h<=e?h/e:h<=a?1-2*(h-e)/Math.PI:(h-a)/e-1;case 2:return 2*h/n-1;case 3:return-2*h/n+1;case 4:return h<Math.PI?-1:1}return 0};v.tick=function(){var h=this.runtime.getDt(this.inst);this.isEnabled&&0!==h&&(0===this.period?this.i=0:(this.i+=h/this.period*n,this.i%=n),this.updateFromPhase())};v.updateFromPhase=function(){switch(this.movement){case 0:this.inst.x!==this.lastKnownValue&&(this.initialValue+=this.inst.x-this.lastKnownValue);this.inst.x=this.initialValue+this.waveFunc(this.i)*
this.mag;this.lastKnownValue=this.inst.x;break;case 1:this.inst.y!==this.lastKnownValue&&(this.initialValue+=this.inst.y-this.lastKnownValue);this.inst.y=this.initialValue+this.waveFunc(this.i)*this.mag;this.lastKnownValue=this.inst.y;break;case 2:this.inst.width=this.initialValue+this.waveFunc(this.i)*this.mag;this.inst.height=this.inst.width*this.ratio;break;case 3:this.inst.width=this.initialValue+this.waveFunc(this.i)*this.mag;break;case 4:this.inst.height=this.initialValue+this.waveFunc(this.i)*
this.mag;break;case 5:this.inst.angle!==this.lastKnownValue&&(this.initialValue=cr.clamp_angle(this.initialValue+(this.inst.angle-this.lastKnownValue)));this.inst.angle=cr.clamp_angle(this.initialValue+this.waveFunc(this.i)*this.mag);this.lastKnownValue=this.inst.angle;break;case 6:this.inst.opacity=this.initialValue+this.waveFunc(this.i)*this.mag/100;0>this.inst.opacity?this.inst.opacity=0:1<this.inst.opacity&&(this.inst.opacity=1);break;case 8:this.inst.x!==this.lastKnownValue&&(this.initialValue+=
this.inst.x-this.lastKnownValue),this.inst.y!==this.lastKnownValue2&&(this.initialValue2+=this.inst.y-this.lastKnownValue2),this.inst.x=this.initialValue+Math.cos(this.inst.angle)*this.waveFunc(this.i)*this.mag,this.inst.y=this.initialValue2+Math.sin(this.inst.angle)*this.waveFunc(this.i)*this.mag,this.lastKnownValue=this.inst.x,this.lastKnownValue2=this.inst.y}this.inst.set_bbox_changed()};v.onSpriteFrameChanged=function(h,r){switch(this.movement){case 2:this.initialValue*=r.width/h.width;this.ratio=
r.height/r.width;break;case 3:this.initialValue*=r.width/h.width;break;case 4:this.initialValue*=r.height/h.height}};b.prototype.IsEnabled=function(){return this.isEnabled};b.prototype.CompareMovement=function(h){return this.movement===h};b.prototype.ComparePeriod=function(h,r){return cr.do_cmp(this.period,h,r)};b.prototype.CompareMagnitude=function(h,r){return 5===this.movement?cr.do_cmp(this.mag,h,cr.to_radians(r)):cr.do_cmp(this.mag,h,r)};b.prototype.CompareWave=function(h){return this.wave===
h};q.cnds=new b;f.prototype.SetEnabled=function(h){this.isEnabled=1===h};f.prototype.SetPeriod=function(h){this.period=h};f.prototype.SetMagnitude=function(h){this.mag=h;5===this.movement&&(this.mag=cr.to_radians(this.mag))};f.prototype.SetMovement=function(h){5===this.movement&&5!==h&&(this.mag=cr.to_degrees(this.mag));this.movement=h;this.init()};f.prototype.SetWave=function(h){this.wave=h};f.prototype.SetPhase=function(h){this.i=h*n%n;this.updateFromPhase()};f.prototype.UpdateInitialState=function(){this.init()};
q.acts=new f;k.prototype.CyclePosition=function(h){h.set_float(this.i/n)};k.prototype.Period=function(h){h.set_float(this.period)};k.prototype.Magnitude=function(h){5===this.movement?h.set_float(cr.to_degrees(this.mag)):h.set_float(this.mag)};k.prototype.Value=function(h){h.set_float(this.waveFunc(this.i)*this.mag)};q.exps=new k})();cr.behaviors.Platform=function(b){this.runtime=b};
(function(){function b(){}function f(){}function k(){}var q=cr.behaviors.Platform.prototype;q.Type=function(n,e){this.behavior=n;this.objtype=e;this.runtime=n.runtime};q.Type.prototype.onCreate=function(){};q.Instance=function(n,e){this.type=n;this.behavior=n.behavior;this.inst=e;this.runtime=n.runtime;this.simjump=this.simright=this.simleft=this.ignoreInput=this.canDoubleJump=this.doubleJumped=this.jumped=this.jumpkey=this.rightkey=this.leftkey=!1;this.lastFloorObject=null;this.loadFloorObject=-1;
this.lastFloorY=this.lastFloorX=0;this.floorIsJumpthru=!1;this.fallthrough=this.animMode=this.ceilingCollisionMode=0;this.firstTick=!0;this.dy=this.dx=0};var v=q.Instance.prototype;v.updateGravity=function(){this.downx=Math.cos(this.ga);this.downy=Math.sin(this.ga);this.rightx=Math.cos(this.ga-Math.PI/2);this.righty=Math.sin(this.ga-Math.PI/2);this.downx=cr.round6dp(this.downx);this.downy=cr.round6dp(this.downy);this.rightx=cr.round6dp(this.rightx);this.righty=cr.round6dp(this.righty);this.g1=this.g;
0>this.g&&(this.downx*=-1,this.downy*=-1,this.g=Math.abs(this.g))};v.onCreate=function(){this.maxspeed=this.properties[0];this.acc=this.properties[1];this.dec=this.properties[2];this.jumpStrength=this.properties[3];this.g1=this.g=this.properties[4];this.maxFall=this.properties[5];this.enableDoubleJump=this.properties[6];this.jumpSustain=this.properties[7]/1E3;this.defaultControls=this.properties[8];this.enabled=this.properties[9];this.wasOnFloor=!1;this.wasOverJumpthru=this.runtime.testOverlapJumpThru(this.inst);
this.loadOverJumpthru=-1;this.sustainTime=0;this.ga=cr.to_radians(90);this.updateGravity();var n=this;this.defaultControls&&(document.addEventListener("keydown",function(e){n.onKeyDown(e)}),document.addEventListener("keyup",function(e){n.onKeyUp(e)}));this.recycled||(this.myDestroyCallback=function(e){n.onInstanceDestroyed(e)});this.runtime.addDestroyCallback(this.myDestroyCallback);this.inst.extra.isPlatformBehavior=!0};v.saveToJSON=function(){return{ii:this.ignoreInput,lfx:this.lastFloorX,lfy:this.lastFloorY,
lfo:this.lastFloorObject?this.lastFloorObject.uid:-1,am:this.animMode,en:this.enabled,fall:this.fallthrough,ft:this.firstTick,dx:this.dx,dy:this.dy,ms:this.maxspeed,acc:this.acc,dec:this.dec,js:this.jumpStrength,g:this.g,g1:this.g1,mf:this.maxFall,wof:this.wasOnFloor,woj:this.wasOverJumpthru?this.wasOverJumpthru.uid:-1,ga:this.ga,edj:this.enableDoubleJump,cdj:this.canDoubleJump,dj:this.doubleJumped,sus:this.jumpSustain,cc:this.ceilingCollisionMode}};v.loadFromJSON=function(n){this.ignoreInput=n.ii;
this.lastFloorX=n.lfx;this.lastFloorY=n.lfy;this.loadFloorObject=n.lfo;this.animMode=n.am;this.enabled=n.en;this.fallthrough=n.fall;this.firstTick=n.ft;this.dx=n.dx;this.dy=n.dy;this.maxspeed=n.ms;this.acc=n.acc;this.dec=n.dec;this.jumpStrength=n.js;this.g=n.g;this.g1=n.g1;this.maxFall=n.mf;this.wasOnFloor=n.wof;this.loadOverJumpthru=n.woj;this.ga=n.ga;this.enableDoubleJump=n.edj;this.canDoubleJump=n.cdj;this.doubleJumped=n.dj;this.jumpSustain=n.sus;this.ceilingCollisionMode=n.cc||0;this.simjump=
this.simright=this.simleft=this.jumped=this.jumpkey=this.rightkey=this.leftkey=!1;this.sustainTime=0;this.updateGravity()};v.afterLoad=function(){this.lastFloorObject=-1===this.loadFloorObject?null:this.runtime.getObjectByUID(this.loadFloorObject);this.wasOverJumpthru=-1===this.loadOverJumpthru?null:this.runtime.getObjectByUID(this.loadOverJumpthru)};v.onInstanceDestroyed=function(n){this.lastFloorObject==n&&(this.lastFloorObject=null)};v.onDestroy=function(){this.lastFloorObject=null;this.runtime.removeDestroyCallback(this.myDestroyCallback)};
v.onKeyDown=function(n){switch(n.which){case 38:n.preventDefault();this.jumpkey=!0;break;case 37:n.preventDefault();this.leftkey=!0;break;case 39:n.preventDefault(),this.rightkey=!0}};v.onKeyUp=function(n){switch(n.which){case 38:n.preventDefault();this.jumped=this.jumpkey=!1;break;case 37:n.preventDefault();this.leftkey=!1;break;case 39:n.preventDefault(),this.rightkey=!1}};v.onWindowBlur=function(){this.jumpkey=this.rightkey=this.leftkey=!1};v.getGDir=function(){return 0>this.g?-1:1};v.isOnFloor=
function(){var n,e=null;var a=this.inst.x;var d=this.inst.y;this.inst.x+=this.downx;this.inst.y+=this.downy;this.inst.set_bbox_changed();if(this.lastFloorObject&&this.runtime.testOverlap(this.inst,this.lastFloorObject)&&(!this.runtime.typeHasBehavior(this.lastFloorObject.type,cr.behaviors.solid)||this.lastFloorObject.extra.solidEnabled))return this.inst.x=a,this.inst.y=d,this.inst.set_bbox_changed(),this.lastFloorObject;(n=this.runtime.testOverlapSolid(this.inst))||0!==this.fallthrough||(e=this.runtime.testOverlapJumpThru(this.inst,
!0));this.inst.x=a;this.inst.y=d;this.inst.set_bbox_changed();if(n){if(this.runtime.testOverlap(this.inst,n))return null;this.floorIsJumpthru=!1;return n}if(e&&e.length){d=n=0;for(a=e.length;n<a;n++)e[d]=e[n],this.runtime.testOverlap(this.inst,e[n])||d++;if(1<=d)return this.floorIsJumpthru=!0,e[0]}return null};v.tick=function(){};v.posttick=function(){var n=this.runtime.getDt(this.inst),e;this.jumpkey||this.simjump||(this.jumped=!1);var a=this.leftkey||this.simleft;var d=this.rightkey||this.simright;
var h=(e=this.jumpkey||this.simjump)&&!this.jumped;this.simjump=this.simright=this.simleft=!1;if(this.enabled){this.ignoreInput&&(h=e=d=a=!1);e||(this.sustainTime=0);var r=this.lastFloorObject;var w=!1;this.firstTick&&((this.runtime.testOverlapSolid(this.inst)||this.runtime.testOverlapJumpThru(this.inst))&&this.runtime.pushOutSolid(this.inst,-this.downx,-this.downy,4,!0),this.firstTick=!1);if(r&&0===this.dy&&(r.y!==this.lastFloorY||r.x!==this.lastFloorX)){var E=r.x-this.lastFloorX;var t=r.y-this.lastFloorY;
this.inst.x+=E;this.inst.y+=t;this.inst.set_bbox_changed();this.lastFloorX=r.x;this.lastFloorY=r.y;w=!0;this.runtime.testOverlapSolid(this.inst)&&this.runtime.pushOutSolid(this.inst,-E,-t,2.5*Math.sqrt(E*E+t*t))}var p=this.isOnFloor();if(t=this.runtime.testOverlapSolid(this.inst)){var x=Math.abs(this.inst.width);var C=Math.abs(this.inst.height);if(this.inst.extra.inputPredicted)this.runtime.pushOutSolid(this.inst,-this.downx,-this.downy,10,!1);else if(this.runtime.pushOutSolidAxis(this.inst,-this.downx,
-this.downy,C/8))this.runtime.registerCollision(this.inst,t);else if(this.runtime.pushOutSolidAxis(this.inst,this.rightx,this.righty,x/2))this.runtime.registerCollision(this.inst,t);else if(this.runtime.pushOutSolidAxis(this.inst,this.downx,this.downy,C/2))this.runtime.registerCollision(this.inst,t);else if(this.runtime.pushOutSolidNearest(this.inst,Math.max(x,C)/2))this.runtime.registerCollision(this.inst,t);else return}p?(this.canDoubleJump=this.doubleJumped=!1,0<this.dy&&(this.wasOnFloor||(this.runtime.pushInFractional(this.inst,
-this.downx,-this.downy,p,16),this.wasOnFloor=!0),this.dy=0),r!=p)?(this.lastFloorObject=p,this.lastFloorX=p.x,this.lastFloorY=p.y,this.runtime.registerCollision(this.inst,p)):w&&(t=this.runtime.testOverlapSolid(this.inst))&&(this.runtime.registerCollision(this.inst,t),0!==E&&(0<E?this.runtime.pushOutSolid(this.inst,-this.rightx,-this.righty):this.runtime.pushOutSolid(this.inst,this.rightx,this.righty)),this.runtime.pushOutSolid(this.inst,-this.downx,-this.downy)):e||(this.canDoubleJump=!0);if(p&&
h||!p&&this.enableDoubleJump&&e&&this.canDoubleJump&&!this.doubleJumped)r=this.inst.x,w=this.inst.y,this.inst.x-=this.downx,this.inst.y-=this.downy,this.inst.set_bbox_changed(),this.runtime.testOverlapSolid(this.inst)?h=!1:(this.sustainTime=this.jumpSustain,this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnJump,this.inst),this.animMode=2,this.dy=-this.jumpStrength,h=!0,p?this.jumped=!0:this.doubleJumped=!0),this.inst.x=r,this.inst.y=w,this.inst.set_bbox_changed();p||(e&&0<this.sustainTime?
(this.dy=-this.jumpStrength,this.sustainTime-=n):(this.lastFloorObject=null,this.dy+=this.g*n,this.dy>this.maxFall&&(this.dy=this.maxFall)),h&&(this.jumped=!0));this.wasOnFloor=!!p;a==d&&(0>this.dx?(this.dx+=this.dec*n,0<this.dx&&(this.dx=0)):0<this.dx&&(this.dx-=this.dec*n,0>this.dx&&(this.dx=0)));t=0;a&&!d&&(t=0<this.dx?-(this.acc+this.dec):-this.acc);d&&!a&&(t=0>this.dx?this.acc+this.dec:this.acc);this.dx+=t*n;this.dx>this.maxspeed?this.dx=this.maxspeed:this.dx<-this.maxspeed&&(this.dx=-this.maxspeed);
a=!1;0!==this.dx&&(r=this.inst.x,w=this.inst.y,E=this.runtime.accelerate(this.dx,-this.maxspeed,this.maxspeed,t,n)*this.rightx,t=this.runtime.accelerate(this.dx,-this.maxspeed,this.maxspeed,t,n)*this.righty,this.inst.x+=this.rightx*(1<this.dx?1:-1)-this.downx,this.inst.y+=this.righty*(1<this.dx?1:-1)-this.downy,this.inst.set_bbox_changed(),e=!1,x=this.runtime.testOverlapSolid(this.inst),this.inst.x=r+E,this.inst.y=w+t,this.inst.set_bbox_changed(),d=this.runtime.testOverlapSolid(this.inst),!d&&p&&
(d=this.runtime.testOverlapJumpThru(this.inst))&&(this.inst.x=r,this.inst.y=w,this.inst.set_bbox_changed(),this.runtime.testOverlap(this.inst,d)?(d=null,e=!1):e=!0,this.inst.x=r+E,this.inst.y=w+t,this.inst.set_bbox_changed()),d?(E=Math.abs(this.dx*n)+2,x||!this.runtime.pushOutSolid(this.inst,-this.downx,-this.downy,E,e,d))?(this.runtime.registerCollision(this.inst,d),E=Math.max(Math.abs(this.dx*n*2.5),30),this.runtime.pushOutSolid(this.inst,this.rightx*(0>this.dx?1:-1),this.righty*(0>this.dx?1:-1),
E,!1)?!p||e||this.floorIsJumpthru||(r=this.inst.x,w=this.inst.y,this.inst.x+=this.downx,this.inst.y+=this.downy,this.runtime.testOverlapSolid(this.inst)?this.runtime.pushOutSolid(this.inst,-this.downx,-this.downy,3,!1)||(this.inst.x=r,this.inst.y=w,this.inst.set_bbox_changed()):(this.inst.x=r,this.inst.y=w,this.inst.set_bbox_changed())):(this.inst.x=r,this.inst.y=w,this.inst.set_bbox_changed()),e||(this.dx=0)):!x&&!h&&Math.abs(this.dy)<Math.abs(this.jumpStrength/4)&&(this.dy=0,p||(a=!0)):(r=this.isOnFloor(),
p&&!r?(t=Math.ceil(Math.abs(this.dx*n))+2,r=this.inst.x,w=this.inst.y,this.inst.x+=this.downx*t,this.inst.y+=this.downy*t,this.inst.set_bbox_changed(),this.runtime.testOverlapSolid(this.inst)||this.runtime.testOverlapJumpThru(this.inst)?this.runtime.pushOutSolid(this.inst,-this.downx,-this.downy,t+2,!0):(this.inst.x=r,this.inst.y=w,this.inst.set_bbox_changed())):r&&(!p&&this.floorIsJumpthru&&(this.lastFloorObject=r,this.lastFloorX=r.x,this.lastFloorY=r.y,this.dy=0,a=!0),0===this.dy&&this.runtime.pushInFractional(this.inst,
-this.downx,-this.downy,r,16))));if(0!==this.dy){r=this.inst.x;w=this.inst.y;this.inst.x+=this.runtime.accelerate(this.dy,-Infinity,this.maxFall,this.g,n)*this.downx;this.inst.y+=this.runtime.accelerate(this.dy,-Infinity,this.maxFall,this.g,n)*this.downy;E=this.inst.x;d=this.inst.y;this.inst.set_bbox_changed();t=this.runtime.testOverlapSolid(this.inst);e=!1;if(!t&&0<this.dy&&!p){if((e=0<this.fallthrough?null:this.runtime.testOverlapJumpThru(this.inst,!0))&&e.length){if(this.wasOverJumpthru){this.inst.x=
r;this.inst.y=w;this.inst.set_bbox_changed();var z=x=0;for(C=e.length;x<C;x++)e[z]=e[x],this.runtime.testOverlap(this.inst,e[x])||z++;e.length=z;this.inst.x=E;this.inst.y=d;this.inst.set_bbox_changed()}1<=e.length&&(t=e[0])}e=!!t}if(t)if(this.runtime.registerCollision(this.inst,t),this.sustainTime=0,E=e?Math.abs(this.dy*n*2.5+10):Math.max(Math.abs(this.dy*n*2.5+10),30),this.runtime.pushOutSolid(this.inst,this.downx*(0>this.dy?1:-1),this.downy*(0>this.dy?1:-1),E,e,t)){this.lastFloorObject=t;this.lastFloorX=
t.x;this.lastFloorY=t.y;(this.floorIsJumpthru=e)&&(a=!0);if(0<this.dy||0===this.ceilingCollisionMode)this.dy=0;0>this.dy&&1===this.ceilingCollisionMode&&this.runtime.pushInFractional(this.inst,this.downx,this.downy,t,32)}else this.inst.x=r,this.inst.y=w,this.inst.set_bbox_changed(),this.wasOnFloor=!0,e||(this.dy=0)}3!==this.animMode&&0<this.dy&&!p&&(this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnFall,this.inst),this.animMode=3);(p||a)&&0<=this.dy&&(3===this.animMode||a||h&&0===this.dy?
(this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnLand,this.inst),this.animMode=0===this.dx&&0===this.dy?0:1):(0!==this.animMode&&0===this.dx&&0===this.dy&&(this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnStop,this.inst),this.animMode=0),1===this.animMode||0===this.dx&&0===this.dy||h||(this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnMove,this.inst),this.animMode=1)));0<this.fallthrough&&this.fallthrough--;this.wasOverJumpthru=this.runtime.testOverlapJumpThru(this.inst)}};
b.prototype.IsMoving=function(){return 0!==this.dx||0!==this.dy};b.prototype.CompareSpeed=function(n,e){return cr.do_cmp(Math.sqrt(this.dx*this.dx+this.dy*this.dy),n,e)};b.prototype.IsOnFloor=function(){if(0!==this.dy)return!1;var n,e=null;var a=this.inst.x;var d=this.inst.y;this.inst.x+=this.downx;this.inst.y+=this.downy;this.inst.set_bbox_changed();(n=this.runtime.testOverlapSolid(this.inst))||0!==this.fallthrough||(e=this.runtime.testOverlapJumpThru(this.inst,!0));this.inst.x=a;this.inst.y=d;this.inst.set_bbox_changed();
if(n)return!this.runtime.testOverlap(this.inst,n);if(e&&e.length){d=n=0;for(a=e.length;n<a;n++)e[d]=e[n],this.runtime.testOverlap(this.inst,e[n])||d++;if(1<=d)return!0}return!1};b.prototype.IsByWall=function(n){var e=this.inst.x,a=this.inst.y;0===n?(this.inst.x-=2*this.rightx,this.inst.y-=2*this.righty):(this.inst.x+=2*this.rightx,this.inst.y+=2*this.righty);this.inst.set_bbox_changed();if(!this.runtime.testOverlapSolid(this.inst))return this.inst.x=e,this.inst.y=a,this.inst.set_bbox_changed(),!1;
this.inst.x-=3*this.downx;this.inst.y-=3*this.downy;this.inst.set_bbox_changed();n=this.runtime.testOverlapSolid(this.inst);this.inst.x=e;this.inst.y=a;this.inst.set_bbox_changed();return n};b.prototype.IsJumping=function(){return 0>this.dy};b.prototype.IsFalling=function(){return 0<this.dy};b.prototype.OnJump=function(){return!0};b.prototype.OnFall=function(){return!0};b.prototype.OnStop=function(){return!0};b.prototype.OnMove=function(){return!0};b.prototype.OnLand=function(){return!0};b.prototype.IsDoubleJumpEnabled=
function(){return this.enableDoubleJump};b.prototype.IsEnabled=function(){return this.enabled};q.cnds=new b;f.prototype.SetIgnoreInput=function(n){this.ignoreInput=n};f.prototype.SetMaxSpeed=function(n){this.maxspeed=n;0>this.maxspeed&&(this.maxspeed=0)};f.prototype.SetAcceleration=function(n){this.acc=n;0>this.acc&&(this.acc=0)};f.prototype.SetDeceleration=function(n){this.dec=n;0>this.dec&&(this.dec=0)};f.prototype.SetJumpStrength=function(n){this.jumpStrength=n;0>this.jumpStrength&&(this.jumpStrength=
0)};f.prototype.SetGravity=function(n){this.g1!==n&&(this.g=n,this.updateGravity(),this.runtime.testOverlapSolid(this.inst)&&(this.runtime.pushOutSolid(this.inst,this.downx,this.downy,10),this.inst.x+=2*this.downx,this.inst.y+=2*this.downy,this.inst.set_bbox_changed()),this.lastFloorObject=null)};f.prototype.SetMaxFallSpeed=function(n){this.maxFall=n;0>this.maxFall&&(this.maxFall=0)};f.prototype.SimulateControl=function(n){switch(n){case 0:this.simleft=!0;break;case 1:this.simright=!0;break;case 2:this.simjump=
!0}};f.prototype.SetVectorX=function(n){this.dx=n};f.prototype.SetVectorY=function(n){this.dy=n};f.prototype.SetGravityAngle=function(n){n=cr.to_radians(n);n=cr.clamp_angle(n);this.ga!==n&&(this.ga=n,this.updateGravity(),this.lastFloorObject=null)};f.prototype.SetEnabled=function(n){this.enabled!==(1===n)&&(this.enabled=1===n,this.enabled||(this.lastFloorObject=null))};f.prototype.FallThrough=function(){var n=this.inst.x,e=this.inst.y;this.inst.x+=this.downx;this.inst.y+=this.downy;this.inst.set_bbox_changed();
var a=this.runtime.testOverlapJumpThru(this.inst,!1);this.inst.x=n;this.inst.y=e;this.inst.set_bbox_changed();a&&(this.fallthrough=3,this.lastFloorObject=null)};f.prototype.SetDoubleJumpEnabled=function(n){this.enableDoubleJump=0!==n};f.prototype.SetJumpSustain=function(n){this.jumpSustain=n/1E3};f.prototype.SetCeilingCollision=function(n){this.ceilingCollisionMode=n};q.acts=new f;k.prototype.Speed=function(n){n.set_float(Math.sqrt(this.dx*this.dx+this.dy*this.dy))};k.prototype.MaxSpeed=function(n){n.set_float(this.maxspeed)};
k.prototype.Acceleration=function(n){n.set_float(this.acc)};k.prototype.Deceleration=function(n){n.set_float(this.dec)};k.prototype.JumpStrength=function(n){n.set_float(this.jumpStrength)};k.prototype.Gravity=function(n){n.set_float(this.g)};k.prototype.GravityAngle=function(n){n.set_float(cr.to_degrees(this.ga))};k.prototype.MaxFallSpeed=function(n){n.set_float(this.maxFall)};k.prototype.MovingAngle=function(n){n.set_float(cr.to_degrees(Math.atan2(this.dy,this.dx)))};k.prototype.VectorX=function(n){n.set_float(this.dx)};
k.prototype.VectorY=function(n){n.set_float(this.dy)};k.prototype.JumpSustain=function(n){n.set_float(1E3*this.jumpSustain)};q.exps=new k})();var Box2D=window.Box2DFn(),b2Vec2=Box2D.b2Vec2;function createPolygonShape(b){for(var f=new Box2D.b2PolygonShape,k=Box2D._malloc(8*b.length),q=0,v=0;v<b.length;v++)Box2D.HEAPF32[k+q>>2]=b[v].get_x(),Box2D.HEAPF32[k+(q+4)>>2]=b[v].get_y(),q+=8;q=Box2D.wrapPointer(k,Box2D.b2Vec2);f.Set(q,b.length);Box2D._free(k);return f}b2Vec2._freeCache=[];
b2Vec2.Get=function(b,f){if(b2Vec2._freeCache.length){var k=b2Vec2._freeCache.pop();k.set_x(b);k.set_y(f);return k}return new b2Vec2(b,f)};b2Vec2.Free=function(b){b2Vec2._freeCache.push(b)};b2Vec2.Clone=function(b){return b2Vec2.Get(b.get_x(),b.get_y())};var tmpvec2a=b2Vec2.Get(0,0),tmpvec2b=b2Vec2.Get(0,0);function getTempVec2a(b,f){tmpvec2a.set_x(b);tmpvec2a.set_y(f);return tmpvec2a}function getTempVec2b(b,f){tmpvec2b.set_x(b);tmpvec2b.set_y(f);return tmpvec2b}cr.b2Separator=function(){};
cr.b2Separator.det=function(b,f,k,q,v,n){return b*q+k*n+v*f-f*k-q*v-n*b};cr.b2Separator.hitRay=function(b,f,k,q,v,n,e,a){var d=k-b,h=q-f,r=e-v,w=a-n;r=(r*(n-f)-w*(v-b))/(h*r-d*w);d=b+r*d;h=f+r*h;b=cr.b2Separator.isOnSegment(k,q,b,f,d,h);v=cr.b2Separator.isOnSegment(d,h,v,n,e,a);return b&&v?b2Vec2.Get(d,h):null};cr.b2Separator.isOnSegment=function(b,f,k,q,v,n){return(k+.1>=b&&b>=v-.1||k-.1<=b&&b<=v+.1)&&(q+.1>=f&&f>=n-.1||q-.1<=f&&f<=n+.1)&&cr.b2Separator.isOnLine(b,f,k,q,v,n)};
cr.b2Separator.isOnLine=function(b,f,k,q,v,n){return.1<Math.abs(v-k)?.1>Math.abs((n-q)/(v-k)*(b-k)+q-f):.1>Math.abs(b-k)};cr.b2Separator.pointsMatch=function(b,f,k,q){return.1>Math.abs(k-b)&&.1>Math.abs(q-f)};
cr.b2Separator.Separate=function(b,f){b=cr.b2Separator.calcShapes(b);var k=[],q,v,n;var e=0;for(q=b.length;e<q;e++){var a=b[e];var d=[];d.length=a.length;var h=n=0;for(v=a.length;h<v;h++){var r=a[h];var w=a[(h+1)%v];n+=r.get_x()*w.get_y()-r.get_y()*w.get_x();d[h]=b2Vec2.Get(r.get_x(),r.get_y())}n=Math.abs(n/2);if(n>=.001*f)k.push(d);else for(h=0,v=d.length;h<v;h++)b2Vec2.Free(d[h])}return k=SplitConvexPolysOver8Points(k)};
cr.b2Separator.calcShapes=function(b){var f,k,q=0,v=0,n=[],e=[];for(e.push(b);e.length;){b=e[0];var a=b.length;var d=!0;for(f=0;f<a;f++){var h=f;var r=f<a-1?f+1:f+1-a;var w=f<a-2?f+2:f+2-a;var E=b[h];var t=b[r];w=b[w];w=cr.b2Separator.det(E.get_x(),E.get_y(),t.get_x(),t.get_y(),w.get_x(),w.get_y());if(0>w){d=!1;var p=1E9;for(k=0;k<a;k++)if(k!==h&&k!==r){f=k;w=k<a-1?k+1:0;var x=b[f];var C=b[w];if(x=cr.b2Separator.hitRay(E.get_x(),E.get_y(),t.get_x(),t.get_y(),x.get_x(),x.get_y(),C.get_x(),C.get_y())){C=
t.get_x()-x.get_x();var z=t.get_y()-x.get_y();C=C*C+z*z;if(C<p){v=f;q=w;var K=x;p=C}else b2Vec2.Free(x)}}if(1E9===p)return[];k=[];p=[];f=v;w=q;x=b[f];C=b[w];q=!1;cr.b2Separator.pointsMatch(K.get_x(),K.get_y(),C.get_x(),C.get_y())||(k.push(K),q=!0);cr.b2Separator.pointsMatch(K.get_x(),K.get_y(),x.get_x(),x.get_y())||(p.push(K),q=!0);q||b2Vec2.Free(K);v=-1;for(q=h;;){if(q!==w)k.push(b[q]);else{if(0>v||v>=a)return[];cr.b2Separator.isOnSegment(C.get_x(),C.get_y(),b[v].get_x(),b[v].get_y(),E.get_x(),E.get_y())||
k.push(b[q]);break}v=q;0>q-1?q=a-1:q--}k.reverse();v=-1;for(q=r;;){if(q!==f)p.push(b[q]);else{if(0>v||v>=a)return[];q!==f||cr.b2Separator.isOnSegment(x.get_x(),x.get_y(),b[v].get_x(),b[v].get_y(),t.get_x(),t.get_y())||p.push(b[q]);break}v=q;q+1>a-1?q=0:q++}e.push(k,p);e.shift();break}}d&&n.push(e.shift())}return n};function SplitConvexPolysOver8Points(b){var f=[],k;var q=0;for(k=b.length;q<k;++q){var v=b[q];8>=v.length?f.push(v):f.push.apply(f,SplitConvexPoly(v))}return f}
function SplitConvexPoly(b){var f=[];f.push(b.splice(0,8));for(var k=f[0][0],q=f[0][7];b.length;){var v=b.splice(0,Math.min(b.length,6));var n=v[v.length-1];v.push(b2Vec2.Clone(k));v.push(b2Vec2.Clone(q));f.push(v);q=n}return f}
cr.behaviors.Physics=function(b){this.runtime=b;this.world=new Box2D.b2World(getTempVec2a(0,10),!0);this.worldG=10;this.lastUpdateTick=-1;var f=new Box2D.JSContactListener;f.BeginContact=function(q){var v=Box2D.wrapPointer(q,Box2D.b2Contact);q=v.GetFixtureA().GetBody().c2userdata;v=v.GetFixtureB().GetBody().c2userdata;b.registerCollision(q.inst,v.inst)};f.EndContact=function(){};f.PreSolve=function(){};f.PostSolve=function(){};this.world.SetContactListener(f);f=new Box2D.JSContactFilter;var k=this;
f.ShouldCollide=function(q,v){if(k.allCollisionsEnabled)return!0;q=Box2D.wrapPointer(q,Box2D.b2Fixture);var n=Box2D.wrapPointer(v,Box2D.b2Fixture);v=q.GetBody().c2userdata.inst.type;q=n.GetBody().c2userdata.inst.type;return(n=v.extra.Physics_DisabledCollisions)&&n.contains(q)?!1:(n=q.extra.Physics_DisabledCollisions)&&n.contains(v)?!1:!0};this.world.SetContactFilter(f);this.steppingMode=0;this.velocityIterations=8;this.positionIterations=3;this.allCollisionsEnabled=!0};
(function(){function b(){}function f(){}function k(t,p,x){x?((x=t.extra.Physics_DisabledCollisions)&&x.remove(p),(x=p.extra.Physics_DisabledCollisions)&&x.remove(t)):(t.extra.Physics_DisabledCollisions||(t.extra.Physics_DisabledCollisions=new cr.ObjectSet),t.extra.Physics_DisabledCollisions.add(p),p.extra.Physics_DisabledCollisions||(p.extra.Physics_DisabledCollisions=new cr.ObjectSet),p.extra.Physics_DisabledCollisions.add(t))}function q(){}var v=Box2D.b2BodyDef,n=Box2D.b2FixtureDef,e=Box2D.b2PolygonShape,
a=Box2D.b2CircleShape,d=Box2D.b2DistanceJointDef,h=Box2D.b2RevoluteJointDef,r=cr.behaviors.Physics.prototype;r.Type=function(t,p){this.behavior=t;this.objtype=p;this.runtime=t.runtime};r.Type.prototype.onCreate=function(){};r.Instance=function(t,p){this.type=t;this.behavior=t.behavior;this.inst=p;this.runtime=t.runtime;this.world=this.behavior.world};var w=r.Instance.prototype;w.onCreate=function(){this.immovable=this.properties[0];this.collisionmask=this.properties[1];this.preventRotation=this.properties[2];
this.density=this.properties[3];this.friction=this.properties[4];this.restitution=this.properties[5];this.linearDamping=this.properties[6];this.angularDamping=this.properties[7];this.bullet=this.properties[8];this.enabled=this.properties[9];this.body=null;this.fixtures=[];this.inst.update_bbox();this.lastKnownX=this.inst.x;this.lastKnownY=this.inst.y;this.lastKnownAngle=this.inst.angle;this.lastHeight=this.lastWidth=0;this.recreateBody=this.lastTickOverride=!1;this.lastAnimation=null;this.lastAnimationFrame=
-1;this.myJoints?(cr.clearArray(this.myJoints),cr.clearArray(this.myCreatedJoints),this.joiningMe.clear()):(this.myJoints=[],this.myCreatedJoints=[],this.joiningMe=new cr.ObjectSet);var t=this;this.recycled||(this.myDestroyCallback=function(p){t.onInstanceDestroyed(p)});this.runtime.addDestroyCallback(this.myDestroyCallback)};w.postCreate=function(){this.inst.update_bbox();this.createBody();this.lastAnimation=this.inst.cur_animation;this.lastAnimationFrame=this.inst.cur_frame};w.onDestroy=function(){this.destroyBody();
cr.clearArray(this.myCreatedJoints);this.joiningMe.clear();this.runtime.removeDestroyCallback(this.myDestroyCallback)};w.saveToJSON=function(){var t={e:this.enabled,im:this.immovable,pr:this.preventRotation,d:this.density,fr:this.friction,re:this.restitution,ld:this.linearDamping,ad:this.angularDamping,b:this.bullet,mcj:this.myCreatedJoints};if(this.enabled){var p=this.body.GetLinearVelocity();t.vx=p.get_x();t.vy=p.get_y();t.om=this.body.GetAngularVelocity()}return t};w.loadFromJSON=function(t){this.destroyBody();
cr.clearArray(this.myCreatedJoints);this.joiningMe.clear();this.enabled=t.e;this.immovable=t.im;this.preventRotation=t.pr;this.density=t.d;this.friction=t.fr;this.restitution=t.re;this.linearDamping=t.ld;this.angularDamping=t.ad;this.bullet=t.b;this.lastKnownX=this.inst.x;this.lastKnownY=this.inst.y;this.lastKnownAngle=this.inst.angle;this.lastWidth=this.inst.width;this.lastHeight=this.inst.height;this.enabled&&(this.createBody(),this.body.SetLinearVelocity(getTempVec2a(t.vx,t.vy)),this.body.SetAngularVelocity(t.om),
0===t.vx&&0===t.vy&&0===t.om||this.body.SetAwake(!0),this.myCreatedJoints=t.mcj)};w.afterLoad=function(){this.enabled&&this.recreateMyJoints()};w.onInstanceDestroyed=function(t){var p,x,C=t.uid;var z=p=0;for(x=this.myCreatedJoints.length;p<x;p++)this.myCreatedJoints[z]=this.myCreatedJoints[p],z<this.myJoints.length&&(this.myJoints[z]=this.myJoints[p]),this.myCreatedJoints[p].params[1]==C?p<this.myJoints.length&&this.world.DestroyJoint(this.myJoints[p]):z++;this.myCreatedJoints.length=z;z<this.myJoints.length&&
(this.myJoints.length=z);this.joiningMe.remove(t)};w.destroyMyJoints=function(){var t;var p=0;for(t=this.myJoints.length;p<t;p++)this.world.DestroyJoint(this.myJoints[p]);cr.clearArray(this.myJoints)};w.recreateMyJoints=function(){var t;var p=0;for(t=this.myCreatedJoints.length;p<t;p++){var x=this.myCreatedJoints[p];switch(x.type){case 0:this.doCreateDistanceJoint(x.params[0],x.params[1],x.params[2],x.params[3],x.params[4]);break;case 1:this.doCreateRevoluteJoint(x.params[0],x.params[1]);break;case 2:this.doCreateLimitedRevoluteJoint(x.params[0],
x.params[1],x.params[2],x.params[3])}}};w.createFixture=function(t){if(this.body)return t=this.body.CreateFixture(t),this.fixtures.push(t),t};w.destroyFixtures=function(){if(this.body){var t;var p=0;for(t=this.fixtures.length;p<t;++p)this.body.DestroyFixture(this.fixtures[p]);cr.clearArray(this.fixtures)}};w.destroyBody=function(){this.body&&(this.destroyMyJoints(),this.destroyFixtures(),this.world.DestroyBody(this.body),this.body=null,this.inst.extra.box2dbody=null)};var E=[];w.createBody=function(){if(this.enabled){var t=
this.inst;t.update_bbox();var p;if(!this.body){var x=new v;x.set_type(this.immovable?0:2);x.set_position(getTempVec2b(.02*t.bquad.midX(),.02*t.bquad.midY()));x.set_angle(t.angle);x.set_fixedRotation(this.preventRotation);x.set_linearDamping(this.linearDamping);x.set_angularDamping(this.angularDamping);x.set_bullet(this.bullet);this.body=this.world.CreateBody(x);this.body.c2userdata=this;t.extra.box2dbody=this.body;Box2D.destroy(x)}this.destroyFixtures();x=new n;x.set_density(this.density);x.set_friction(this.friction);
x.set_restitution(this.restitution);var C=this.inst.collision_poly&&!this.inst.collision_poly.is_empty();var z=this.collisionmask;C||this.inst.tilemap_exists||0!==this.collisionmask||(z=1);var K=Math.max(Math.abs(t.width),1);var S=Math.max(Math.abs(t.height),1);var L=0>t.width;var R=0>t.height;if(0===z)if(t.tilemap_exists){var F=t.bquad.midX()-t.x;var g=t.bquad.midY()-t.y;t.getAllCollisionRects(E);C=[];z=0;for(K=E.length;z<K;++z){L=E[z];R=L.rc;if(L.poly){if(!L.poly.convexpolys){var l=L.poly.pts_cache;
var u=L.poly.pts_count;for(S=0;S<u;++S)C.push(b2Vec2.Get(l[2*S],l[2*S+1]));S=L.id&3758096384;(-2147483648===S||1073741824===S||536870912===S||S&-2147483648&&S&1073741824&&S&536870912)&&C.reverse();L.poly.convexpolys=cr.b2Separator.Separate(C,(R.right-R.left)*(R.bottom-R.top));S=0;for(u=C.length;S<u;++S)b2Vec2.Free(C[S]);cr.clearArray(C)}S=0;for(u=L.poly.convexpolys.length;S<u;++S){var c=L.poly.convexpolys[S];l=0;for(p=c.length;l<p;++l)C.push(b2Vec2.Get(.02*(R.left+c[l].get_x()-F),.02*(R.top+c[l].get_y()-
g)));l=createPolygonShape(C);x.set_shape(l);this.createFixture(x);Box2D.destroy(l);l=0;for(p=C.length;l<p;++l)b2Vec2.Free(C[l]);cr.clearArray(C)}}else C.push(b2Vec2.Get(.02*(R.left-F),.02*(R.top-g))),C.push(b2Vec2.Get(.02*(R.right-F),.02*(R.top-g))),C.push(b2Vec2.Get(.02*(R.right-F),.02*(R.bottom-g))),C.push(b2Vec2.Get(.02*(R.left-F),.02*(R.bottom-g))),l=createPolygonShape(C),x.set_shape(l),this.createFixture(x),Box2D.destroy(l);S=0;for(u=C.length;S<u;++S)b2Vec2.Free(C[S]);cr.clearArray(C)}}else{z=
t.angle;t.angle=0;t.set_bbox_changed();t.update_bbox();F=t.bquad.midX()-t.x;g=t.bquad.midY()-t.y;t.angle=z;t.set_bbox_changed();t.collision_poly.cache_poly(L?-K:K,R?-S:S,0);l=t.collision_poly.pts_cache;u=t.collision_poly.pts_count;C=[];C.length=u;for(z=0;z<u;z++)C[z]=b2Vec2.Get(l[2*z]-F,l[2*z+1]-g);L!==R&&C.reverse();F=cr.b2Separator.Separate(C,K*S);for(z=0;z<u;z++)b2Vec2.Free(C[z]);if(F.length)for(z=0,K=F.length;z<K;z++){C=F[z];S=0;for(u=C.length;S<u;S++)g=C[S],g.set_x(.02*g.get_x()),g.set_y(.02*
g.get_y());l=createPolygonShape(C);x.set_shape(l);this.createFixture(x);Box2D.destroy(l);S=0;for(u=C.length;S<u;S++)b2Vec2.Free(C[S])}else l=new e,l.SetAsBox(.01*K,.01*S),x.set_shape(l),this.createFixture(x),Box2D.destroy(l)}else 1===z?(l=new e,l.SetAsBox(.01*K,.01*S)):(l=new a,l.set_m_radius(.01*Math.min(K,S))),x.set_shape(l),this.createFixture(x),Box2D.destroy(l);this.lastWidth=t.width;this.lastHeight=t.height;Box2D.destroy(x);cr.clearArray(E)}};w.tick=function(){if(this.enabled){var t=this.inst;
if(0===this.behavior.steppingMode)var p=this.runtime.timescale/60;else p=this.runtime.getDt(this.inst),p>1/30&&(p=1/30);this.runtime.tickcount_nosave>this.behavior.lastUpdateTick&&0<this.runtime.timescale&&(0!==p&&this.world.Step(p,this.behavior.velocityIterations,this.behavior.positionIterations),this.world.ClearForces(),this.behavior.lastUpdateTick=this.runtime.tickcount_nosave);if(this.recreateBody||t.width!==this.lastWidth||t.height!==this.lastHeight||t.cur_animation!==this.lastAnimation||t.cur_frame!==
this.lastAnimationFrame||t.tilemap_exists&&t.physics_changed)this.createBody(),this.recreateBody=!1,this.lastAnimation=t.cur_animation,this.lastAnimationFrame=t.cur_frame,t.tilemap_exists&&t.physics_changed&&(t.physics_changed=!1);p=t.x!==this.lastKnownX||t.y!==this.lastKnownY;var x=t.angle!==this.lastKnownAngle;if(p){t.update_bbox();var C=t.bquad.midX(),z=t.bquad.midY(),K=C-this.lastKnownX,S=z-this.lastKnownY;x?this.body.SetTransform(getTempVec2a(.02*C,.02*z),t.angle):this.body.SetTransform(getTempVec2a(.02*
C,.02*z),this.body.GetAngle());this.body.SetLinearVelocity(getTempVec2a(K,S));this.lastTickOverride=!0;this.body.SetAwake(!0)}else this.lastTickOverride&&(this.lastTickOverride=!1,this.body.SetLinearVelocity(getTempVec2a(0,0)),this.body.SetTransform(getTempVec2a(.02*t.bquad.midX(),.02*t.bquad.midY()),this.body.GetAngle()));!p&&x&&(this.body.SetTransform(this.body.GetPosition(),t.angle),this.body.SetAwake(!0));x=this.body.GetPosition();p=x.get_x()/.02;x=x.get_y()/.02;C=this.body.GetAngle();if(p!==
t.x||x!==t.y||C!==t.angle)if(t.x=p,t.y=x,t.angle=C,t.set_bbox_changed(),t.update_bbox(),p=t.bquad.midX()-t.x,x=t.bquad.midY()-t.y,0!==p||0!==x)t.x-=p,t.y-=x,t.set_bbox_changed();this.lastKnownX=t.x;this.lastKnownY=t.y;this.lastKnownAngle=t.angle}};w.getInstImgPointX=function(t){return-1!==t&&this.inst.getImagePoint?0===t&&this.body?(this.body.GetPosition().get_x()+this.body.GetLocalCenter().get_x())/.02:this.inst.getImagePoint(t,!0):this.inst.x};w.getInstImgPointY=function(t){return-1!==t&&this.inst.getImagePoint?
0===t&&this.body?(this.body.GetPosition().get_y()+this.body.GetLocalCenter().get_y())/.02:this.inst.getImagePoint(t,!1):this.inst.y};b.prototype.IsSleeping=function(){return this.enabled?!this.body.IsAwake():!1};b.prototype.CompareVelocity=function(t,p,x){if(!this.enabled)return!1;var C=this.body.GetLinearVelocity();0===t?C=C.get_x()/.02:1===t?C=C.get_y()/.02:(t=C.get_x()/.02,C=C.get_y()/.02,C=cr.distanceTo(0,0,t,C));return cr.do_cmp(C,p,x)};b.prototype.CompareAngularVelocity=function(t,p){if(!this.enabled)return!1;
var x=cr.to_degrees(this.body.GetAngularVelocity());return cr.do_cmp(x,t,p)};b.prototype.CompareMass=function(t,p){if(!this.enabled)return!1;var x=this.body.GetMass()/.02;return cr.do_cmp(x,t,p)};b.prototype.IsEnabled=function(){return this.enabled};r.cnds=new b;f.prototype.ApplyForce=function(t,p,x){if(this.enabled){var C=this.getInstImgPointX(x);x=this.getInstImgPointY(x);this.body.ApplyForce(getTempVec2a(t,p),getTempVec2b(.02*C,.02*x),!0)}};f.prototype.ApplyForceToward=function(t,p,x,C){if(this.enabled){var z=
this.getInstImgPointX(C);C=this.getInstImgPointY(C);p=cr.angleTo(z,C,p,x);this.body.ApplyForce(getTempVec2a(Math.cos(p)*t,Math.sin(p)*t),getTempVec2b(.02*z,.02*C),!0)}};f.prototype.ApplyForceAtAngle=function(t,p,x){if(this.enabled){p=cr.to_radians(p);var C=this.getInstImgPointX(x);x=this.getInstImgPointY(x);this.body.ApplyForce(getTempVec2a(Math.cos(p)*t,Math.sin(p)*t),getTempVec2b(.02*C,.02*x),!0)}};f.prototype.ApplyImpulse=function(t,p,x){if(this.enabled){var C=this.getInstImgPointX(x);x=this.getInstImgPointY(x);
this.body.ApplyLinearImpulse(getTempVec2a(t,p),getTempVec2b(.02*C,.02*x),!0);this.lastTickOverride=!1;this.lastKnownX=this.inst.x;this.lastKnownY=this.inst.y}};f.prototype.ApplyImpulseToward=function(t,p,x,C){if(this.enabled){var z=this.getInstImgPointX(C);C=this.getInstImgPointY(C);p=cr.angleTo(z,C,p,x);this.body.ApplyLinearImpulse(getTempVec2a(Math.cos(p)*t,Math.sin(p)*t),getTempVec2b(.02*z,.02*C),!0);this.lastTickOverride=!1;this.lastKnownX=this.inst.x;this.lastKnownY=this.inst.y}};f.prototype.ApplyImpulseAtAngle=
function(t,p,x){if(this.enabled){p=cr.to_radians(p);var C=this.getInstImgPointX(x);x=this.getInstImgPointY(x);this.body.ApplyLinearImpulse(getTempVec2a(Math.cos(p)*t,Math.sin(p)*t),getTempVec2b(.02*C,.02*x),!0);this.lastTickOverride=!1;this.lastKnownX=this.inst.x;this.lastKnownY=this.inst.y}};f.prototype.ApplyTorque=function(t){this.enabled&&this.body.ApplyTorque(cr.to_radians(t),!0)};f.prototype.ApplyTorqueToAngle=function(t,p){this.enabled&&(t=cr.to_radians(t),p=cr.to_radians(p),cr.angleClockwise(this.inst.angle,
p)?this.body.ApplyTorque(-t,!0):this.body.ApplyTorque(t,!0))};f.prototype.ApplyTorqueToPosition=function(t,p,x){this.enabled&&(t=cr.to_radians(t),p=cr.angleTo(this.inst.x,this.inst.y,p,x),cr.angleClockwise(this.inst.angle,p)?this.body.ApplyTorque(-t,!0):this.body.ApplyTorque(t,!0))};f.prototype.SetAngularVelocity=function(t){this.enabled&&(this.body.SetAngularVelocity(cr.to_radians(t)),this.body.SetAwake(!0))};f.prototype.CreateDistanceJoint=function(t,p,x,C,z){p&&this.enabled&&(p=p.getFirstPicked(this.inst))&&
p!=this.inst&&p.extra.box2dbody&&(this.myCreatedJoints.push({type:0,params:[t,p.uid,x,C,z]}),this.doCreateDistanceJoint(t,p.uid,x,C,z))};w.doCreateDistanceJoint=function(t,p,x,C,z){if(this.enabled&&(p=this.runtime.getObjectByUID(p))&&p!=this.inst&&p.extra.box2dbody){p.extra.box2dbody.c2userdata.joiningMe.add(this.inst);var K=this.getInstImgPointX(t);t=this.getInstImgPointY(t);if(p.getImagePoint){var S=p.getImagePoint(x,!0);x=p.getImagePoint(x,!1)}else S=p.x,x=p.y;var L=K-S,R=t-x,F=new d;F.Initialize(this.body,
p.extra.box2dbody,getTempVec2a(.02*K,.02*t),getTempVec2b(.02*S,.02*x));F.set_length(.02*Math.sqrt(L*L+R*R));F.set_dampingRatio(C);F.set_frequencyHz(z);this.myJoints.push(this.world.CreateJoint(F));Box2D.destroy(F)}};f.prototype.CreateRevoluteJoint=function(t,p){p&&this.enabled&&(p=p.getFirstPicked(this.inst))&&p!=this.inst&&p.extra.box2dbody&&(this.myCreatedJoints.push({type:1,params:[t,p.uid]}),this.doCreateRevoluteJoint(t,p.uid))};w.doCreateRevoluteJoint=function(t,p){if(this.enabled&&(p=this.runtime.getObjectByUID(p))&&
p!=this.inst&&p.extra.box2dbody){p.extra.box2dbody.c2userdata.joiningMe.add(this.inst);var x=this.getInstImgPointX(t);t=this.getInstImgPointY(t);var C=new h;C.Initialize(this.body,p.extra.box2dbody,getTempVec2a(.02*x,.02*t));this.myJoints.push(this.world.CreateJoint(C));Box2D.destroy(C)}};f.prototype.CreateLimitedRevoluteJoint=function(t,p,x,C){p&&this.enabled&&(p=p.getFirstPicked(this.inst))&&p!=this.inst&&p.extra.box2dbody&&(this.myCreatedJoints.push({type:2,params:[t,p.uid,x,C]}),this.doCreateLimitedRevoluteJoint(t,
p.uid,x,C))};w.doCreateLimitedRevoluteJoint=function(t,p,x,C){if(this.enabled&&(p=this.runtime.getObjectByUID(p))&&p!=this.inst&&p.extra.box2dbody){p.extra.box2dbody.c2userdata.joiningMe.add(this.inst);var z=this.getInstImgPointX(t);t=this.getInstImgPointY(t);var K=new h;K.Initialize(this.body,p.extra.box2dbody,getTempVec2a(.02*z,.02*t));K.set_enableLimit(!0);K.set_lowerAngle(cr.to_radians(x));K.set_upperAngle(cr.to_radians(C));this.myJoints.push(this.world.CreateJoint(K));Box2D.destroy(K)}};f.prototype.SetWorldGravity=
function(t){if(t!==this.behavior.worldG){this.world.SetGravity(getTempVec2a(0,t));this.behavior.worldG=t;var p,x=this.behavior.my_instances.valuesRef();t=0;for(p=x.length;t<p;t++)x[t].extra.box2dbody&&x[t].extra.box2dbody.SetAwake(!0)}};f.prototype.SetSteppingMode=function(t){this.behavior.steppingMode=t};f.prototype.SetIterations=function(t,p){1>t&&(t=1);1>p&&(p=1);this.behavior.velocityIterations=t;this.behavior.positionIterations=p};f.prototype.SetVelocity=function(t,p){this.enabled&&(this.body.SetLinearVelocity(getTempVec2a(.02*
t,.02*p)),this.body.SetAwake(!0),this.lastTickOverride=!1,this.lastKnownX=this.inst.x,this.lastKnownY=this.inst.y)};f.prototype.SetDensity=function(t){if(this.enabled&&this.density!==t){this.density=t;var p;var x=0;for(p=this.fixtures.length;x<p;++x)this.fixtures[x].SetDensity(t);this.body.ResetMassData()}};f.prototype.SetFriction=function(t){if(this.enabled&&this.friction!==t){this.friction=t;var p;var x=0;for(p=this.fixtures.length;x<p;++x)this.fixtures[x].SetFriction(t);for(t=this.body.GetContactList();Box2D.getPointer(t);t=
t.get_next())(x=t.get_contact())&&x.ResetFriction()}};f.prototype.SetElasticity=function(t){if(this.enabled&&this.restitution!==t){this.restitution=t;var p;var x=0;for(p=this.fixtures.length;x<p;++x)this.fixtures[x].SetRestitution(t)}};f.prototype.SetLinearDamping=function(t){this.enabled&&this.linearDamping!==t&&(this.linearDamping=t,this.body.SetLinearDamping(t))};f.prototype.SetAngularDamping=function(t){this.enabled&&this.angularDamping!==t&&(this.angularDamping=t,this.body.SetAngularDamping(t))};
f.prototype.SetImmovable=function(t){this.enabled&&this.immovable!==(0!==t)&&(this.immovable=0!==t,this.body.SetType(this.immovable?0:2),this.body.SetAwake(!0))};f.prototype.EnableCollisions=function(t,p){if(t&&this.enabled){var x;if(t.is_family){var C=0;for(x=t.members.length;C<x;C++)k(this.inst.type,t.members[C],0!==p)}else k(this.inst.type,t,0!==p);this.behavior.allCollisionsEnabled=!1}};f.prototype.SetPreventRotate=function(t){this.enabled&&this.preventRotation!==(0!==t)&&(this.preventRotation=
0!==t,this.body.SetFixedRotation(this.preventRotation),this.body.SetAngularVelocity(0),this.body.SetAwake(!0))};f.prototype.SetBullet=function(t){this.enabled&&this.bullet!==(0!==t)&&(this.bullet=0!==t,this.body.SetBullet(this.bullet),this.body.SetAwake(!0))};f.prototype.RemoveJoints=function(){this.enabled&&(this.destroyMyJoints(),cr.clearArray(this.myCreatedJoints),this.joiningMe.clear())};f.prototype.SetEnabled=function(t){this.enabled&&0===t?(this.destroyBody(),this.enabled=!1):this.enabled||
1!==t||(this.enabled=!0,this.createBody())};r.acts=new f;q.prototype.VelocityX=function(t){t.set_float(this.enabled?this.body.GetLinearVelocity().get_x()/.02:0)};q.prototype.VelocityY=function(t){t.set_float(this.enabled?this.body.GetLinearVelocity().get_y()/.02:0)};q.prototype.AngularVelocity=function(t){t.set_float(this.enabled?cr.to_degrees(this.body.GetAngularVelocity()):0)};q.prototype.Mass=function(t){t.set_float(this.enabled?this.body.GetMass()/.02:0)};q.prototype.CenterOfMassX=function(t){t.set_float(this.enabled?
(this.body.GetPosition().get_x()+this.body.GetLocalCenter().get_x())/.02:0)};q.prototype.CenterOfMassY=function(t){t.set_float(this.enabled?(this.body.GetPosition().get_y()+this.body.GetLocalCenter().get_y())/.02:0)};q.prototype.Density=function(t){t.set_float(this.enabled?this.density:0)};q.prototype.Friction=function(t){t.set_float(this.enabled?this.friction:0)};q.prototype.Elasticity=function(t){t.set_float(this.enabled?this.restitution:0)};q.prototype.LinearDamping=function(t){t.set_float(this.enabled?
this.linearDamping:0)};q.prototype.AngularDamping=function(t){t.set_float(this.enabled?this.angularDamping:0)};r.exps=new q})();cr.behaviors.Bullet=function(b){this.runtime=b};
(function(){function b(){}function f(){}function k(){}var q=cr.behaviors.Bullet.prototype;q.Type=function(n,e){this.behavior=n;this.objtype=e;this.runtime=n.runtime};q.Type.prototype.onCreate=function(){};q.Instance=function(n,e){this.type=n;this.behavior=n.behavior;this.inst=e;this.runtime=n.runtime};var v=q.Instance.prototype;v.onCreate=function(){var n=this.properties[0];this.acc=this.properties[1];this.g=this.properties[2];this.bounceOffSolid=this.properties[3];this.setAngle=this.properties[4];
this.step=this.properties[5];this.stepSize=Math.abs(Math.min(this.inst.width,this.inst.height)/2);this.stopStepping=!1;this.dx=Math.cos(this.inst.angle)*n;this.dy=Math.sin(this.inst.angle)*n;this.lastx=this.inst.x;this.lasty=this.inst.y;this.lastKnownAngle=this.inst.angle;this.travelled=0;this.enabled=this.properties[6]};v.saveToJSON=function(){return{acc:this.acc,g:this.g,dx:this.dx,dy:this.dy,lx:this.lastx,ly:this.lasty,lka:this.lastKnownAngle,t:this.travelled,st:this.step,e:this.enabled}};v.loadFromJSON=
function(n){this.acc=n.acc;this.g=n.g;this.dx=n.dx;this.dy=n.dy;this.lastx=n.lx;this.lasty=n.ly;this.lastKnownAngle=n.lka;this.travelled=n.t;this.step=!!n.st;this.enabled=n.e};v.tick=function(){if(this.enabled){var n=this.runtime.getDt(this.inst);if(this.inst.angle!==this.lastKnownAngle){if(this.setAngle){var e=cr.distanceTo(0,0,this.dx,this.dy);this.dx=Math.cos(this.inst.angle)*e;this.dy=Math.sin(this.inst.angle)*e}this.lastKnownAngle=this.inst.angle}var a=0;var d=0;if(0!==this.acc){e=cr.distanceTo(0,
0,this.dx,this.dy);var h=0===this.dx&&0===this.dy?this.inst.angle:cr.angleTo(0,0,this.dx,this.dy);e+=this.acc*n;a=Math.cos(h)*this.acc;d=Math.sin(h)*this.acc;0>e&&(d=a=e=0);this.dx=Math.cos(h)*e;this.dy=Math.sin(h)*e}0!==this.g&&(this.dy+=this.g*n,d+=this.g);this.lastx=this.inst.x;this.lasty=this.inst.y;if(0!==this.dx||0!==this.dy)if(e=this.runtime.accelerate(this.dx,-Infinity,Infinity,a,n),d=this.runtime.accelerate(this.dy,-Infinity,Infinity,d,n),this.moveBy(e,d),this.travelled+=cr.distanceTo(this.lastx,
this.lasty,this.inst.x,this.inst.y),!this.setAngle||0===e&&0===d||(this.inst.angle=cr.angleTo(0,0,e,d),this.inst.set_bbox_changed(),this.lastKnownAngle=this.inst.angle),this.bounceOffSolid&&(e=this.runtime.testOverlapSolid(this.inst)))this.runtime.registerCollision(this.inst,e),e=cr.distanceTo(0,0,this.dx,this.dy),d=this.runtime.calculateSolidBounceAngle(this.inst,this.lastx,this.lasty),this.dx=Math.cos(d)*e,this.dy=Math.sin(d)*e,this.inst.x+=this.dx*n,this.inst.y+=this.dy*n,this.inst.set_bbox_changed(),
this.setAngle&&(this.lastKnownAngle=this.inst.angle=d,this.inst.set_bbox_changed()),this.runtime.pushOutSolid(this.inst,this.dx/e,this.dy/e,Math.max(2.5*e*n,30))||this.runtime.pushOutSolidNearest(this.inst,100)}};v.moveBy=function(n,e){var a=cr.distanceTo(0,0,n,e);if(!this.step||a<=this.stepSize)this.inst.x+=n,this.inst.y+=e,this.inst.set_bbox_changed(),this.step&&this.runtime.trigger(cr.behaviors.Bullet.prototype.cnds.OnStep,this.inst);else{this.stopStepping=!1;var d=this.inst.x,h=this.inst.y,r=
d+n,w=h+e;e=cr.angleTo(0,0,n,e);n=Math.cos(e)*this.stepSize;e=Math.sin(e)*this.stepSize;a=Math.floor(a/this.stepSize);for(var E=1;E<=a;++E)if(this.inst.x=d+n*E,this.inst.y=h+e*E,this.inst.set_bbox_changed(),this.runtime.trigger(cr.behaviors.Bullet.prototype.cnds.OnStep,this.inst),this.inst.isDestroyed||this.stopStepping)return;this.inst.x=r;this.inst.y=w;this.inst.set_bbox_changed();this.runtime.trigger(cr.behaviors.Bullet.prototype.cnds.OnStep,this.inst)}};b.prototype.CompareSpeed=function(n,e){return cr.do_cmp(cr.distanceTo(0,
0,this.dx,this.dy),n,e)};b.prototype.CompareTravelled=function(n,e){return cr.do_cmp(this.travelled,n,e)};b.prototype.OnStep=function(){return!0};b.prototype.IsEnabled=function(){return this.enabled};q.cnds=new b;f.prototype.SetSpeed=function(n){var e=cr.angleTo(0,0,this.dx,this.dy);this.dx=Math.cos(e)*n;this.dy=Math.sin(e)*n};f.prototype.SetAcceleration=function(n){this.acc=n};f.prototype.SetGravity=function(n){this.g=n};f.prototype.SetAngleOfMotion=function(n){n=cr.to_radians(n);var e=cr.distanceTo(0,
0,this.dx,this.dy);this.dx=Math.cos(n)*e;this.dy=Math.sin(n)*e};f.prototype.Bounce=function(n){if(n&&(n=n.getFirstPicked(this.inst))){var e=this.runtime.getDt(this.inst),a=cr.distanceTo(0,0,this.dx,this.dy),d=this.runtime.calculateSolidBounceAngle(this.inst,this.lastx,this.lasty,n);this.dx=Math.cos(d)*a;this.dy=Math.sin(d)*a;this.inst.x+=this.dx*e;this.inst.y+=this.dy*e;this.inst.set_bbox_changed();this.setAngle&&(this.lastKnownAngle=this.inst.angle=d,this.inst.set_bbox_changed());0!==a&&(this.bounceOffSolid?
this.runtime.pushOutSolid(this.inst,this.dx/a,this.dy/a,Math.max(2.5*a*e,30))||this.runtime.pushOutSolidNearest(this.inst,100):this.runtime.pushOut(this.inst,this.dx/a,this.dy/a,Math.max(2.5*a*e,30),n))}};f.prototype.SetBounceOffSolids=function(n){this.bounceOffSolid=n};f.prototype.SetDistanceTravelled=function(n){this.travelled=n};f.prototype.SetEnabled=function(n){this.enabled=1===n};f.prototype.StopStepping=function(){this.stopStepping=!0};q.acts=new f;k.prototype.Speed=function(n){var e=cr.distanceTo(0,
0,this.dx,this.dy);e=cr.round6dp(e);n.set_float(e)};k.prototype.Acceleration=function(n){n.set_float(this.acc)};k.prototype.AngleOfMotion=function(n){n.set_float(cr.to_degrees(cr.angleTo(0,0,this.dx,this.dy)))};k.prototype.DistanceTravelled=function(n){n.set_float(this.travelled)};k.prototype.Gravity=function(n){n.set_float(this.g)};q.exps=new k})();cr.behaviors.Rotate=function(b){this.runtime=b};
(function(){function b(){}function f(){}function k(){}var q=cr.behaviors.Rotate.prototype;q.Type=function(n,e){this.behavior=n;this.objtype=e;this.runtime=n.runtime};q.Type.prototype.onCreate=function(){};q.Instance=function(n,e){this.type=n;this.behavior=n.behavior;this.inst=e;this.runtime=n.runtime};var v=q.Instance.prototype;v.onCreate=function(){this.speed=cr.to_radians(this.properties[0]);this.acc=cr.to_radians(this.properties[1]);this.enabled=this.properties[2]};v.saveToJSON=function(){return{speed:this.speed,
acc:this.acc,e:this.enabled}};v.loadFromJSON=function(n){this.speed=n.speed;this.acc=n.acc;n.hasOwnProperty("e")?this.enabled=n.e:this.enabled=!0};v.tick=function(){if(this.enabled){var n=this.runtime.getDt(this.inst);0!==n&&(0!==this.acc&&(this.speed+=this.acc*n),0!==this.speed&&(this.inst.angle=cr.clamp_angle(this.inst.angle+this.speed*n),this.inst.set_bbox_changed()))}};b.prototype.IsEnabled=function(){return this.enabled};q.cnds=new b;f.prototype.SetSpeed=function(n){this.speed=cr.to_radians(n)};
f.prototype.SetAcceleration=function(n){this.acc=cr.to_radians(n)};f.prototype.SetEnabled=function(n){this.enabled=1===n};q.acts=new f;k.prototype.Speed=function(n){n.set_float(cr.to_degrees(this.speed))};k.prototype.Acceleration=function(n){n.set_float(cr.to_degrees(this.acc))};q.exps=new k})();cr.behaviors.jumpthru=function(b){this.runtime=b};
(function(){function b(){}function f(){}var k=cr.behaviors.jumpthru.prototype;k.Type=function(v,n){this.behavior=v;this.objtype=n;this.runtime=v.runtime};k.Type.prototype.onCreate=function(){};k.Instance=function(v,n){this.type=v;this.behavior=v.behavior;this.inst=n;this.runtime=v.runtime};var q=k.Instance.prototype;q.onCreate=function(){this.inst.extra.jumpthruEnabled=this.properties[0]};q.tick=function(){};b.prototype.IsEnabled=function(){return this.inst.extra.jumpthruEnabled};k.cnds=new b;f.prototype.SetEnabled=
function(v){this.inst.extra.jumpthruEnabled=!!v};k.acts=new f})();cr.behaviors.destroy=function(b){this.runtime=b};
(function(){var b=cr.behaviors.destroy.prototype;b.Type=function(f,k){this.behavior=f;this.objtype=k;this.runtime=f.runtime};b.Type.prototype.onCreate=function(){};b.Instance=function(f,k){this.type=f;this.behavior=f.behavior;this.inst=k;this.runtime=f.runtime};b=b.Instance.prototype;b.onCreate=function(){};b.tick=function(){this.inst.update_bbox();var f=this.inst.bbox,k=this.inst.layer.layout;(0>f.right||0>f.bottom||f.left>k.width||f.top>k.height)&&this.runtime.DestroyInstance(this.inst)}})();
cr.behaviors.Flash=function(b){this.runtime=b};
(function(){function b(){}function f(){}var k=cr.behaviors.Flash.prototype;k.Type=function(v,n){this.behavior=v;this.objtype=n;this.runtime=v.runtime};k.Type.prototype.onCreate=function(){};k.Instance=function(v,n){this.type=v;this.behavior=v.behavior;this.inst=n;this.runtime=v.runtime};var q=k.Instance.prototype;q.onCreate=function(){this.timeleft=this.stagetimeleft=this.stage=this.offtime=this.ontime=0};q.saveToJSON=function(){return{ontime:this.ontime,offtime:this.offtime,stage:this.stage,stagetimeleft:this.stagetimeleft,
timeleft:this.timeleft}};q.loadFromJSON=function(v){this.ontime=v.ontime;this.offtime=v.offtime;this.stage=v.stage;this.stagetimeleft=v.stagetimeleft;this.timeleft=v.timeleft;null===this.timeleft&&(this.timeleft=Infinity)};q.tick=function(){if(!(0>=this.timeleft)){var v=this.runtime.getDt(this.inst);this.timeleft-=v;0>=this.timeleft?(this.timeleft=0,this.inst.visible=!0,this.runtime.redraw=!0,this.runtime.trigger(cr.behaviors.Flash.prototype.cnds.OnFlashEnded,this.inst)):(this.stagetimeleft-=v,0>=
this.stagetimeleft&&(0===this.stage?(this.inst.visible=!1,this.stage=1,this.stagetimeleft+=this.offtime):(this.inst.visible=!0,this.stage=0,this.stagetimeleft+=this.ontime),this.runtime.redraw=!0))}};b.prototype.IsFlashing=function(){return 0<this.timeleft};b.prototype.OnFlashEnded=function(){return!0};k.cnds=new b;f.prototype.Flash=function(v,n,e){this.ontime=v;this.offtime=n;this.stage=1;this.stagetimeleft=n;this.timeleft=e;this.inst.visible=!1;this.runtime.redraw=!0};f.prototype.StopFlashing=function(){this.timeleft=
0;this.inst.visible=!0;this.runtime.redraw=!0};k.acts=new f;k.exps=new function(){}})();cr.behaviors.solid=function(b){this.runtime=b};
(function(){function b(){}function f(){}var k=cr.behaviors.solid.prototype;k.Type=function(v,n){this.behavior=v;this.objtype=n;this.runtime=v.runtime};k.Type.prototype.onCreate=function(){};k.Instance=function(v,n){this.type=v;this.behavior=v.behavior;this.inst=n;this.runtime=v.runtime};var q=k.Instance.prototype;q.onCreate=function(){this.inst.extra.solidEnabled=this.properties[0]};q.tick=function(){};b.prototype.IsEnabled=function(){return this.inst.extra.solidEnabled};k.cnds=new b;f.prototype.SetEnabled=
function(v){this.inst.extra.solidEnabled=!!v};k.acts=new f})();
cr.getObjectRefTable=function(){return[cr.plugins_.Audio,cr.plugins_.Function,cr.plugins_.Keyboard,cr.plugins_.Mouse,cr.plugins_.Sprite,cr.plugins_.Arr,cr.plugins_.LocalStorage,cr.plugins_.Browser,cr.plugins_.gamepad,cr.behaviors.scrollto,cr.behaviors.lunarray_LiteTween,cr.behaviors.Persist,cr.behaviors.Pin,cr.behaviors.EightDir,cr.plugins_.TiledBg,cr.behaviors.Sin,cr.behaviors.Platform,cr.behaviors.Physics,cr.behaviors.Bullet,cr.plugins_.NinePatch,cr.behaviors.Rotate,cr.behaviors.jumpthru,cr.behaviors.destroy,
cr.behaviors.Flash,cr.behaviors.solid,cr.plugins_.Spritefont2,cr.plugins_.Tilemap,cr.system_object.prototype.cnds.OnLayoutStart,cr.plugins_.Audio.prototype.acts.PreloadByName,cr.system_object.prototype.acts.SetLayerVisible,cr.plugins_.Audio.prototype.acts.Stop,cr.system_object.prototype.acts.SetBoolVar,cr.behaviors.Bullet.prototype.acts.SetAngleOfMotion,cr.plugins_.Sprite.prototype.acts.SetEffectEnabled,cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,cr.plugins_.Sprite.prototype.cnds.IsBoolInstanceVarSet,
cr.plugins_.Audio.prototype.acts.PlayByName,cr.system_object.prototype.cnds.Else,cr.plugins_.Audio.prototype.cnds.OnEnded,cr.system_object.prototype.acts.CreateObject,cr.system_object.prototype.acts.SetGroupActive,cr.plugins_.Function.prototype.acts.CallFunction,cr.system_object.prototype.cnds.CompareVar,cr.plugins_.Sprite.prototype.acts.MoveToLayer,cr.plugins_.Sprite.prototype.acts.SetAnim,cr.plugins_.Sprite.prototype.cnds.OnCollision,cr.system_object.prototype.acts.Wait,cr.system_object.prototype.acts.SetVar,
cr.plugins_.Sprite.prototype.acts.SetInstanceVar,cr.plugins_.Sprite.prototype.acts.SetCollisions,cr.behaviors.Platform.prototype.acts.SetVectorY,cr.behaviors.Platform.prototype.acts.SetVectorX,cr.plugins_.Function.prototype.cnds.OnFunction,cr.plugins_.Function.prototype.acts.SetReturnValue,cr.plugins_.Sprite.prototype.cnds.IsOverlapping,cr.plugins_.Sprite.prototype.cnds.PickByUID,cr.plugins_.Function.prototype.exps.Param,cr.plugins_.TiledBg.prototype.cnds.PickByUID,cr.plugins_.NinePatch.prototype.cnds.PickByUID,
cr.plugins_.Tilemap.prototype.cnds.PickByUID,cr.plugins_.Sprite.prototype.acts.SetPosToObject,cr.plugins_.Sprite.prototype.acts.Spawn,cr.plugins_.Sprite.prototype.exps.LayerName,cr.plugins_.Sprite.prototype.exps.ImagePointX,cr.plugins_.Sprite.prototype.exps.ImagePointY,cr.plugins_.Audio.prototype.acts.Play,cr.behaviors.Platform.prototype.acts.SetGravity,cr.plugins_.Sprite.prototype.acts.SetMirrored,cr.behaviors.Platform.prototype.acts.SetAcceleration,cr.behaviors.Platform.prototype.acts.SetDeceleration,
cr.system_object.prototype.cnds.IsGroupActive,cr.plugins_.Sprite.prototype.cnds.IsVisible,cr.system_object.prototype.cnds.LayerVisible,cr.system_object.prototype.cnds.Compare,cr.system_object.prototype.exps.layoutname,cr.system_object.prototype.acts.SetObjectTimescale,cr.system_object.prototype.exps.timescale,cr.plugins_.Sprite.prototype.acts.SetVisible,cr.plugins_.Audio.prototype.acts.SetPaused,cr.system_object.prototype.acts.SetTimescale,cr.system_object.prototype.acts.GoToLayout,cr.plugins_.Sprite.prototype.acts.SubInstanceVar,
cr.plugins_.Sprite.prototype.acts.AddInstanceVar,cr.plugins_.Sprite.prototype.acts.SetY,cr.behaviors.lunarray_LiteTween.prototype.cnds.OnEnd,cr.system_object.prototype.cnds.EveryTick,cr.plugins_.Keyboard.prototype.exps.LastKeyCode,cr.system_object.prototype.exps.uppercase,cr.plugins_.Keyboard.prototype.exps.StringFromKeyCode,cr.plugins_.Keyboard.prototype.cnds.OnKey,cr.plugins_.Keyboard.prototype.cnds.OnAnyKey,cr.plugins_.Sprite.prototype.acts.SetBoolInstanceVar,cr.system_object.prototype.cnds.Every,
cr.plugins_.Sprite.prototype.exps.X,cr.system_object.prototype.exps.random,cr.plugins_.Sprite.prototype.exps.Y,cr.plugins_.Sprite.prototype.cnds.IsOverlappingOffset,cr.plugins_.Sprite.prototype.cnds.CompareX,cr.plugins_.Sprite.prototype.cnds.OnCreated,cr.plugins_.Sprite.prototype.acts.MoveToTop,cr.behaviors.Platform.prototype.cnds.IsOnFloor,cr.system_object.prototype.exps.dt,cr.behaviors.Platform.prototype.acts.SetMaxSpeed,cr.plugins_.Sprite.prototype.cnds.IsAnimPlaying,cr.behaviors.Platform.prototype.exps.VectorX,
cr.system_object.prototype.exps.abs,cr.behaviors.Platform.prototype.acts.SimulateControl,cr.behaviors.Platform.prototype.cnds.IsJumping,cr.behaviors.Platform.prototype.exps.VectorY,cr.behaviors.Platform.prototype.acts.SetJumpStrength,cr.behaviors.Platform.prototype.exps.JumpStrength,cr.system_object.prototype.cnds.TriggerOnce,cr.plugins_.Sprite.prototype.acts.SetX,cr.plugins_.Sprite.prototype.acts.SetAnimSpeed,cr.plugins_.Sprite.prototype.cnds.CompareFrame,cr.behaviors.Platform.prototype.cnds.IsMoving,
cr.behaviors.EightDir.prototype.acts.SetEnabled,cr.behaviors.EightDir.prototype.acts.SimulateControl,cr.behaviors.EightDir.prototype.acts.SetMaxSpeed,cr.behaviors.Platform.prototype.acts.SetMaxFallSpeed,cr.behaviors.Platform.prototype.cnds.IsFalling,cr.plugins_.Sprite.prototype.acts.Destroy,cr.plugins_.Keyboard.prototype.cnds.OnKeyCode,cr.plugins_.Sprite.prototype.cnds.IsMirrored,cr.behaviors.Platform.prototype.cnds.CompareSpeed,cr.plugins_.Audio.prototype.cnds.IsTagPlaying,cr.plugins_.Sprite.prototype.cnds.OnAnimFinished,
cr.system_object.prototype.acts.AddVar,cr.system_object.prototype.acts.SubVar,cr.behaviors.scrollto.prototype.acts.SetEnabled,cr.behaviors.Flash.prototype.acts.StopFlashing,cr.behaviors.Flash.prototype.acts.Flash,cr.behaviors.Platform.prototype.acts.SetEnabled,cr.system_object.prototype.acts.RestoreObjectTimescale,cr.plugins_.Sprite.prototype.exps.dt,cr.plugins_.Sprite.prototype.cnds.IsCollisionEnabled,cr.plugins_.TiledBg.prototype.cnds.IsBoolInstanceVarSet,cr.plugins_.TiledBg.prototype.exps.Y,cr.behaviors.lunarray_LiteTween.prototype.acts.Start,
cr.system_object.prototype.exps.min,cr.system_object.prototype.exps.max,cr.behaviors.EightDir.prototype.cnds.IsEnabled,cr.behaviors.Pin.prototype.acts.Pin,cr.system_object.prototype.acts.GoToLayoutByName,cr.plugins_.NinePatch.prototype.cnds.CompareInstanceVar,cr.plugins_.NinePatch.prototype.cnds.CompareX,cr.plugins_.NinePatch.prototype.exps.UID,cr.plugins_.Sprite.prototype.exps.BBoxBottom,cr.plugins_.NinePatch.prototype.exps.BBoxTop,cr.plugins_.NinePatch.prototype.exps.BBoxBottom,cr.plugins_.NinePatch.prototype.cnds.CompareY,
cr.plugins_.NinePatch.prototype.exps.X,cr.plugins_.Sprite.prototype.acts.StopAnim,cr.plugins_.Sprite.prototype.acts.SetFlipped,cr.plugins_.Sprite.prototype.cnds.IsOnScreen,cr.system_object.prototype.cnds.ForEach,cr.plugins_.Sprite.prototype.acts.SetSize,cr.plugins_.Function.prototype.exps.Call,cr.plugins_.Sprite.prototype.exps.UID,cr.system_object.prototype.cnds.CompareBoolVar,cr.plugins_.Arr.prototype.exps.At,cr.behaviors.Platform.prototype.exps.MaxSpeed,cr.plugins_.Sprite.prototype.cnds.CompareY,
cr.plugins_.Sprite.prototype.acts.SetAngle,cr.plugins_.Sprite.prototype.cnds.OnDestroyed,cr.plugins_.Sprite.prototype.exps.Count,cr.system_object.prototype.exps.lerp,cr.behaviors.Sin.prototype.acts.SetEnabled,cr.system_object.prototype.exps.choose,cr.behaviors.lunarray_LiteTween.prototype.acts.SetTarget,cr.plugins_.Sprite.prototype.acts.SetAnimFrame,cr.system_object.prototype.exps.angle,cr.behaviors.jumpthru.prototype.acts.SetEnabled,cr.system_object.prototype.exps.round,cr.plugins_.Sprite.prototype.exps.AnimationSpeed,
cr.plugins_.Sprite.prototype.acts.ZMoveToObject,cr.behaviors.Rotate.prototype.acts.SetSpeed,cr.plugins_.Sprite.prototype.acts.StartAnim,cr.plugins_.Sprite.prototype.acts.MoveToBottom,cr.plugins_.Sprite.prototype.acts.ToggleBoolInstanceVar,cr.plugins_.Sprite.prototype.acts.MoveForward,cr.behaviors.Physics.prototype.acts.ApplyImpulseToward,cr.behaviors.Physics.prototype.acts.EnableCollisions,cr.behaviors.scrollto.prototype.cnds.IsEnabled,cr.behaviors.Bullet.prototype.acts.SetEnabled,cr.behaviors.Physics.prototype.cnds.CompareVelocity,
cr.plugins_.Sprite.prototype.acts.RotateTowardPosition,cr.behaviors.Physics.prototype.acts.SetImmovable,cr.behaviors.Physics.prototype.acts.ApplyImpulseAtAngle,cr.plugins_.Sprite.prototype.exps.Angle,cr.behaviors.Physics.prototype.exps.VelocityX,cr.behaviors.Physics.prototype.exps.VelocityY,cr.plugins_.Tilemap.prototype.cnds.IsBoolInstanceVarSet,cr.behaviors.Physics.prototype.acts.SetEnabled,cr.plugins_.Sprite.prototype.acts.SetPos,cr.behaviors.Bullet.prototype.acts.SetSpeed,cr.behaviors.Bullet.prototype.acts.SetGravity,
cr.behaviors.Physics.prototype.acts.SetVelocity,cr.behaviors.Pin.prototype.acts.Unpin,cr.behaviors.Platform.prototype.cnds.OnLand,cr.plugins_.NinePatch.prototype.exps.Width,cr.plugins_.NinePatch.prototype.acts.SetWidth,cr.plugins_.NinePatch.prototype.exps.Count,cr.behaviors.Bullet.prototype.cnds.IsEnabled,cr.behaviors.Sin.prototype.acts.SetMagnitude,cr.behaviors.Flash.prototype.cnds.IsFlashing,cr.plugins_.Sprite.prototype.exps.BBoxLeft,cr.plugins_.Sprite.prototype.exps.BBoxTop,cr.behaviors.Flash.prototype.cnds.OnFlashEnded,
cr.behaviors.EightDir.prototype.exps.MaxSpeed,cr.system_object.prototype.cnds.PickNth,cr.plugins_.Sprite.prototype.exps.Width,cr.plugins_.Sprite.prototype.exps.Height,cr.behaviors.Rotate.prototype.acts.SetEnabled,cr.behaviors.scrollto.prototype.acts.Shake,cr.behaviors.lunarray_LiteTween.prototype.acts.SetDuration,cr.plugins_.Spritefont2.prototype.acts.SetVisible,cr.plugins_.Sprite.prototype.exps.AnimationFrame,cr.plugins_.Spritefont2.prototype.acts.SetText,cr.system_object.prototype.cnds.PickAll,
cr.behaviors.solid.prototype.acts.SetEnabled,cr.behaviors.Bullet.prototype.exps.Speed,cr.plugins_.NinePatch.prototype.acts.SetInstanceVar,cr.system_object.prototype.exps.str,cr.plugins_.Function.prototype.cnds.CompareParam,cr.plugins_.Sprite.prototype.cnds.OnAnyAnimFinished,cr.plugins_.Arr.prototype.cnds.CompareSize,cr.plugins_.Arr.prototype.acts.Push,cr.plugins_.Audio.prototype.acts.StopAll,cr.plugins_.Spritefont2.prototype.cnds.CompareInstanceVar,cr.system_object.prototype.cnds.IsPreview,cr.system_object.prototype.acts.RestartLayout,
cr.system_object.prototype.exps.zeropad,cr.plugins_.Audio.prototype.acts.SetPlaybackRate,cr.system_object.prototype.acts.ToggleBoolVar,cr.plugins_.Audio.prototype.acts.SetMasterVolume,cr.plugins_.Audio.prototype.acts.SetSilent,cr.plugins_.Keyboard.prototype.cnds.IsKeyDown,cr.plugins_.Mouse.prototype.exps.X,cr.plugins_.Mouse.prototype.exps.Y,cr.plugins_.LocalStorage.prototype.acts.ClearStorage,cr.system_object.prototype.acts.ResetGlobals,cr.plugins_.TiledBg.prototype.acts.SetWidth,cr.system_object.prototype.exps.loadingprogress,
cr.system_object.prototype.cnds.OnLoadFinished,cr.plugins_.Spritefont2.prototype.cnds.IsVisible,cr.system_object.prototype.exps.left,cr.system_object.prototype.exps.len,cr.plugins_.Spritefont2.prototype.exps.Text,cr.plugins_.Spritefont2.prototype.cnds.CompareText,cr.plugins_.LocalStorage.prototype.acts.CheckItemExists,cr.plugins_.LocalStorage.prototype.cnds.OnItemExists,cr.plugins_.LocalStorage.prototype.acts.GetItem,cr.plugins_.LocalStorage.prototype.exps.ItemValue,cr.plugins_.LocalStorage.prototype.cnds.CompareValue,
cr.plugins_.Browser.prototype.acts.ConsoleLog,cr.plugins_.LocalStorage.prototype.acts.SetItem,cr.plugins_.gamepad.prototype.cnds.HasGamepads,cr.plugins_.gamepad.prototype.cnds.CompareAxis,cr.plugins_.gamepad.prototype.cnds.IsButtonDown,cr.plugins_.Keyboard.prototype.cnds.IsKeyCodeDown]};
self.C3_JsPropNameTable=[{Audio:0},{Function:0},{Keyboard:0},{Mouse:0},{LevelProperties:0},{BonusScoreTable:0},{CollisionProbe:0},{LocalStorage:0},{Browser:0},{Misc:0},{Gamepad:0},{BunnyMario:0},{MarioHitbox:0},{SmallMario:0},{SuperMario:0},{SmallLuigi:0},{LuigiHitbox:0},{BunnyLuigi:0},{SuperLuigi:0},{ScrollTo:0},{CameraLock:0},{CameraLock2:0},{LiteTween:0},{Persist:0},{MapPlayer:0},{Pin:0},{"8Direction":0},{SystemCamera:0},{DamageBlock:0},{InstaDeathBlock:0},{BossRoomEdge:0},{CameraXYLock:0},{AutoscrollStop:0},
{RoomEdge:0},{SlidingArea:0},{Sine:0},{PlayerAirBubble:0},{MarioMapCamera:0},{NoSpringZone:0},{Platform:0},{Toads:0},{PlayerSpawn:0},{SpawnpointAtBoss:0},{Toadsworth:0},{VPad:0},{PipeFall:0},{PipeEnd:0},{PipeRise:0},{PipeWalk:0},{GoTo_Location:0},{AirMan:0},{AirMan_Projectile:0},{AirMan_ProjectileSprite:0},{Physics:0},{Bullet:0},{AngryBird:0},{AngryBirdClone:0},{Sling:0},{SlingCircle:0},{SlingOverlay:0},{EggBomb:0},{EggDetect:0},{Bonzi_Coconut:0},{REPLACEVINE:0},{BonziBuddy:0},{BonziVine:0},{BonziHand:0},
{Bowser:0},{BowserFlame:0},{BowserHitbox:0},{BowserMine:0},{BowserMineRespawnPos:0},{SpawnBlockLocation:0},{Eggman:0},{Eggman_Ball:0},{Eggman_thrust:0},{Giant:0},{Rotate:0},{GiantHand_ArcLeft:0},{GiantHand_ArcRight:0},{Jumpthru:0},{GiantHand_Left:0},{GiantHand_Right:0},{VP_Gear:0},{DestroyOutsideLayout:0},{VPBody:0},{Flash:0},{VPHead:0},{Eagle:0},{Sign_Boss:0},{Vector:0},{SignBoss_Text:0},{BossDestroyBoom:0},{EagleDetect:0},{Solid:0},{AirTikki:0},{AirTikki_Enemy:0},{AirTikki_EnemySprite:0},{AirTikkiEnabler:0},
{AirTikkiSpikes:0},{FanFiend:0},{LightingLord_PlatformRotatr:0},{LightningLord:0},{LightningLord_Platform:0},{LightningLord_Projectile:0},{Copipi:0},{Pipi:0},{Pipi_Egg:0},{Pipi_EggCrack:0},{ScwormPipes:0},{ScwormSpawner:0},{Bee:0},{Bee_Rotator:0},{Kremling:0},{KremlingHitbox:0},{Boo:0},{Goomba:0},{GoombaHitbox:0},{Kamek:0},{KamekBroom:0},{KamekProjectile:0},{Koopa:0},{KoopaHitbox:0},{Buzzbomber:0},{Buzzbomber_Projectile:0},{Snapjaw:0},{SnapjawHitbox:0},{Spikes:0},{SpikesHitbox:0},{Debrie:0},{Debrie_Hitbox:0},
{DebrieSpawn:0},{HammerTroll:0},{HammerTrollHitbox:0},{HammerTrollRock:0},{Troll:0},{TrollHitbox:0},{ShellTroll:0},{ShellTrollHitbox:0},{TrollShell:0},{Rat:0},{RatHitbox:0},{Cog:0},{CogAttack:0},{CogHitbox:0},{CogHQ_Crusher:0},{RiseTween:0},{LowerTween:0},{CogHQ_CrusherPiston:0},{CogPropeller:0},{Minion:0},{MinionHitbox:0},{VectorBot:0},{VectorBot_Hitbox:0},{DodoHitbox:0},{Dodo:0},{Pigs:0},{Lava:0},{Coin:0},{BlockCoin:0},{Platform2:0},{BossGoal:0},{PSwitch:0},{"1UP":0},{"1UPHitbox":0},{Carrot:0},
{MetalCap:0},{Mushroom:0},{MushroomHitbox:0},{Spring:0},{CannonBox:0},{CannonBox_Bullet:0},{SpecialCoin:0},{Door:0},{Pie:0},{Pie_Hitbox:0},{PieStack:0},{Vine:0},{Checkpoint:0},{FerisWeheel:0},{SpecialCoinLocation:0},{PBlock:0},{CannonBoxSpawnPos:0},{BowserSwingPrompt:0},{GameOverArrow:0},{GameOverMenu:0},{GameOverText:0},{HUD_Font:0},{PauseArrow:0},{RunningIndicator:0},{SpecialCollectedCard1:0},{SpecialCollectedCard2:0},{SpecialCollectedCard3:0},{IndicatorSpeed:0},{FloatingScore:0},{CaveBG:0},{IceBG:0},
{Curtains:0},{LevelEnterFadeIn:0},{MapLevelComplete:0},{MapStoppingPoint:0},{StartMap:0},{Dialogue_Font:0},{DialogueBox:0},{Fade:0},{FadeInBG:0},{LoadingBar:0},{LoadingBarBase:0},{PeachLetter:0},{TheEnd:0},{PlayerIcon:0},{PauseArrow2:0},{DEBUG_Audio:0},{OptionsArrow:0},{PlusModeIndicator:0},{BlackOut:0},{RestartGameMenu:0},{BowserSwingPrompt2:0},{Block:0},{Brick:0},{CannonBlock:0},{DonutBlock:0},{DonutBlock_Coll:0},{Infinite_Box:0},{Infinite_Ground:0},{QuestionBlock:0},{VerticalPipe:0},{InvisibleBlock:0},
{HorizontalPipe:0},{GrabBlock:0},{Tilemap_GhostHouse:0},{Tilemap_SMB3:0},{Tilemap_Trolberg:0},{WorldMap:0},{Sine2:0},{MovingPlatform:0},{SeeSaw1:0},{SeeSaw2:0},{SeeSawWeight:0},{TNT:0},{RotatingPlatform:0},{Trolberg_Ground:0},{Water:0},{PoachedEggs_Tilemap:0},{VerticalPipeUpward:0},{Tilemap_MariosHouse:0},{MarioFence:0},{SpawnBlock:0},{Explosion:0},{HitPuff:0},{Invincibility_Sparkle:0},{SmokePuff:0},{WaterSplash:0},{BrickRubble:0},{REPLACEVINE2:0},{MarioSprites:0},{Mushrooms:0},{GroundWalkers:0},
{EnemySolidTiled:0},{EnemySolidSprite:0},{EnemySolid9Patch:0},{BlockBump:0},{SeeSaw:0},{Bosses:0},{Throwable_Objects:0},{EnemySolidTilemap:0},{Sprites:0},{Pipes:0},{Effects:0},{PushBack:0},{Slope:0},{PlayerHitboxes:0},{LuigiSprites:0},{PlayerSprites:0},{EnemyVarHealth:0},{PlayerCallBasic:0},{PLAYER_WALK_ACCEL:0},{PLAYER_RUN_ACCEL:0},{PLAYER_SKID_ACCEL:0},{PLAYER_DECEL:0},{PLAYER_ICE_ACCEL:0},{PLAYER_ICE_DECEL:0},{PLAYER_WALK_SPEED:0},{PLAYER_RUN_SPEED:0},{PLAYER_SPRINT_SPEED:0},{PLAYER_GRAVITY:0},
{PLAYER_JUMPHOLD_GRAVITY:0},{AbsSpeedX:0},{Gentle:0},{Steep:0},{WarpActive:0},{PipeUID:0},{RedActive:0},{BonziActive:0},{GiantActive:0},{DebrieRain:0},{SignActive:0},{EggmanActive:0},{AirManActive:0},{Speech_Text:0},{DEBUG_giantHand_Y:0},{KOOPA_STATE_SHELL_STOPPED:0},{KOOPA_STATE_SHELL_MOVING:0},{KOOPA_STATE_WALKING:0},{KOOPA_STATE_PARA:0},{KOOPA_STATE_BOUNCING:0},{SHELL_STOPPED:0},{SHELL_MOVING:0},{BowserPlayerCall:0},{offset_X1:0},{offset_X2:0},{PlayerDirection:0},{MapCrossTime:0},{TimerDecrement:0},
{bowserDirection:0},{PressedStart:0},{NewGameChosen:0},{KamekMapCutsceneActive:0},{MOVEMODE_PLATFORM:0},{MOVEMODE_FROZEN:0},{MOVEMODE_WIN:0},{MOVEMODE_AFTER_WIN:0},{PlusMode:0},{BeatenPlusMode:0},{SaveSlot:0},{GameExists:0},{StompHeight:0},{EntryType:0},{MarioForm:0},{LuigiForm:0},{Lives:0},{CurrentPlayer:0},{Score:0},{Coins:0},{StarCoins:0},{CollectedStarCoin1:0},{CollectedStarCoin2:0},{CollectedStarCoin3:0},{Timer:0},{HasWon:0},{TimerCounting:0},{OpeningDoor:0},{PSwitchTimer:0},{Paused:0},{StarmanTimer_Layout:0},
{PowerMeter:0},{PowMeter:0},{CheckpointActive:0},{CheckpointLayout:0},{IsTalking:0},{LevelsBeaten:0},{ClearedMariosHouse:0},{LevelStarCoins_MariosHouse:0},{LevelBeaten_1:0},{LevelStarCoins_1:0},{LevelBeaten_2:0},{LevelStarCoins_2:0},{LevelBeaten_3:0},{LevelStarCoins_3:0},{LevelBeaten_4:0},{LevelStarCoins_4:0},{LevelBeaten_5:0},{LevelStarCoins_5:0},{LevelBeaten_6:0},{LevelStarCoins_6:0},{LevelBeaten_7:0},{LevelStarCoins_7:0},{LevelBeaten_8:0},{LevelStarCoins_8:0},{LevelBeaten_9:0},{LevelStarCoins_9:0},
{StarCoin_Values_CollectedNone:0},{StarCoin_Values_CollectedOnly3:0},{StarCoin_Values_CollectedOnly2:0},{StarCoin_Values_Collected2and3:0},{StarCoin_Values_CollectedOnly1:0},{StarCoin_Values_Collected1and3:0},{StarCoin_Values_Collected1and2:0},{StarCoin_Values_CollectedAll3:0},{AllLevelStarCoinsCollected:0},{BunnyMarioImplementation:0},{SilenceAudio:0},{Delay1:0},{Delay2:0},{Boss:0},{DEADZONE:0},{leftKey:0},{DEFAULT_LeftCtrl:0},{rightKey:0},{DEFAULT_RightCtrl:0},{upKey:0},{DEFAULT_UpCtrl:0},{downKey:0},
{DEFAULT_DownCtrl:0},{jumpKey:0},{DEFAULT_JumpCtrl:0},{runKey:0},{DEFAULT_RunCtrl:0},{startKey:0},{DEFAULT_StartCtrl:0},{isUnbound:0},{LastKeyPressed:0},{RightCtrl:0},{LeftCtrl:0},{UpCtrl:0},{DownCtrl:0},{JumpCtrl:0},{RunCtrl:0},{StartCtrl:0},{CurrentLogo:0}];
